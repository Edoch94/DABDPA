<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Distributed architectures for big data processing and analytics - 13&nbsp; RDD based programming</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12_rdd_keyvalue_pairs.html" rel="next">
<link href="./10_intro_spark.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11_rdd_based_programming.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">RDD based programming</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Distributed architectures for big data processing and analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">About this Book</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Big data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_architectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Big data architectures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03b_HDFS_clc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">HDFS and Hadoop: command line commands</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_intro_hadoop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Hadoop and MapReduce</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_hadoop_implementation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How to write MapReduce programs in Hadoop</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_mapreduce_patterns_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">MapReduce patterns - 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_mapreduce_advanced_topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MapReduce and Hadoop Advanced Topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_mapreduce_patterns_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MapReduce patterns - 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_sql_operators_mapreduce.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Relational Algebra Operations and MapReduce</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10b_spark_submit_execute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">How to submit/execute a Spark application</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_intro_spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_rdd_based_programming.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">RDD based programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_rdd_keyvalue_pairs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">RDDs and key-value pairs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_rdd_numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">RDD of numbers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_cache_accumulators_broadcast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Cache, Accumulators, Broadcast Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15b_pagerank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Introduction to PageRank</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_sparksql_dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Spark SQL and DataFrames</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18a_spark_mllib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Spark MLlib</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18b_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Classification algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18c_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Clustering algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18d_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Regression algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18e_mining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Itemset and Association rule mining</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_graph_analytics_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Graph analytics in Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_graph_analytics_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Graph Analytics in Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_streaming_analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_structured_streaming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Spark structured streaming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_streaming_frameworks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#spark-context" id="toc-spark-context" class="nav-link active" data-scroll-target="#spark-context">Spark Context</a></li>
  <li><a href="#rdd-basics" id="toc-rdd-basics" class="nav-link" data-scroll-target="#rdd-basics">RDD basics</a></li>
  <li><a href="#rdd-create-and-save" id="toc-rdd-create-and-save" class="nav-link" data-scroll-target="#rdd-create-and-save">RDD: create and save</a></li>
  <li><a href="#transformations-and-actions" id="toc-transformations-and-actions" class="nav-link" data-scroll-target="#transformations-and-actions">Transformations and Actions</a></li>
  <li><a href="#passing-functions-to-transformations-and-actions" id="toc-passing-functions-to-transformations-and-actions" class="nav-link" data-scroll-target="#passing-functions-to-transformations-and-actions">Passing functions to Transformations and Actions</a></li>
  <li><a href="#basic-transformations" id="toc-basic-transformations" class="nav-link" data-scroll-target="#basic-transformations">Basic Transformations</a></li>
  <li><a href="#basic-actions" id="toc-basic-actions" class="nav-link" data-scroll-target="#basic-actions">Basic Actions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">RDD based programming</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="spark-context" class="level3">
<h3 class="anchored" data-anchor-id="spark-context">Spark Context</h3>
<p>The “connection” of the driver to the cluster is based on the Spark Context object</p>
<ul>
<li>In Python the name of the class is <code>SparkContext</code></li>
<li>The Spark Context is built by means of the constructor of the <code>SparkContext</code> class</li>
<li>The only parameter is a configuration object</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">## Create a configuration object and</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">## set the name of the application</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>conf <span class="op">=</span> SparkConf().setAppName(<span class="st">"Application name"</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">## Create a Spark Context object</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>sc <span class="op">=</span> SparkContext(conf<span class="op">=</span>conf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>The Spark Context object can be obtained also by using the <code>SparkContext.getOrCreate(conf)</code> method, whose only parameter is a configuration object. Notice that, if the <code>SparkContext</code> object already exists for this application, the current <code>SparkContext</code> object is returned, otherwise, a new <code>SparkContext</code> object is returned: there is always one single <code>SparkContext</code> object for each application.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">## Create a configuration object and</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">## set the name of the application</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>conf <span class="op">=</span> SparkConf().setAppName(<span class="st">"Application name"</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">## Retrieve the current SparkContext object or</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">## create a new one</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>sc <span class="op">=</span> SparkContext.getOrCreate(conf<span class="op">=</span>conf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="rdd-basics" class="level3">
<h3 class="anchored" data-anchor-id="rdd-basics">RDD basics</h3>
<p>A Spark RDD is an immutable distributed collection of objects. Each RDD is split in partitions, allowing to parallelize the code based on RDDs (i.e., code is executed on each partition in isolation).</p>
<p>RDDs can contain any type of Scala, Java, and Python objects, including user-defined classes.</p>
</section>
<section id="rdd-create-and-save" class="level3">
<h3 class="anchored" data-anchor-id="rdd-create-and-save">RDD: create and save</h3>
<p>RDDs can be created</p>
<ul>
<li>By loading an external dataset (e.g., the content of a folder, a single file, a database table)</li>
<li>By parallelizing a local collection of objects created in the Driver (e.g., a Java collection)</li>
</ul>
<section id="create-rdds-from-files" class="level4">
<h4 class="anchored" data-anchor-id="create-rdds-from-files">Create RDDs from files</h4>
<p>To built an RDD from <strong>an input textual file</strong>, use the <code>textFile(name)</code> method of the <code>SparkContext</code> class.</p>
<ul>
<li>The returned RDD is an RDD of Strings associated with the content of the name textual file;</li>
<li>Each line of the input file is associated with an object (a string) of the instantiated RDD;</li>
<li>By default, if the input file is an HDFS file the number of partitions of the created RDD is equal to the number of HDFS blocks used to store the file, in order to support data locality.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">## Build an RDD of strings from the input textual file</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">## myfile.txt</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">## Each element of the RDD is a line of the input file</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>inputFile <span class="op">=</span> <span class="st">"myfile.txt"</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>lines <span class="op">=</span> sc.textFile(inputFile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that no computation occurs when <code>sc.textFile()</code> is invoked: Spark only records how to create the RDD, and the data is lazily read from the input file only when the data is needed (i.e., when an action is applied on lines, or on one of its “descendant” RDDs).</p>
</div>
</div>
</div>
<p>To build an RDD from a <strong>folder containing textual files</strong>, use the <code>textFile(name)</code> method of the <code>SparkContext</code> class.</p>
<ul>
<li>If name is the path of a folder all files inside that folder are considered;</li>
<li>The returned RDD contains one string for each line of the files contained on the name folder.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## Build an RDD of strings from all the files stored in</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">## myfolder</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">## Each element of the RDD is a line of the input files</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>inputFolder <span class="op">=</span> <span class="st">"myfolder/"</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>lines <span class="op">=</span> sc.textFile(inputFolder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that all files inside myfolder are considered, also those without suffix or with a suffix different from “.txt”.</p>
</div>
</div>
</div>
<p>To set the (minimum) <strong>number of partitions</strong>, use the <code>textFile(name, minPartitions)</code> method of the <code>SparkContext</code> class.</p>
<ul>
<li>This option can be used to increase the parallelization of the submitted application;</li>
<li>For the HDFS files, the number of partitions <code>minPartitions</code> must be greater than the number of blocks/chunks.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">## Build an RDD of strings from the input textual file</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">## myfile.txt</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">## The number of partitions is manually set to 4</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">## Each element of the RDD is a line of the input file</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>inputFile <span class="op">=</span> <span class="st">"myfile.txt“</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="er">lines = sc.textFile</span>(inputFile, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="create-rdds-from-a-local-python-collection" class="level4">
<h4 class="anchored" data-anchor-id="create-rdds-from-a-local-python-collection">Create RDDs from a local Python collection</h4>
<p>An RDD can be built from a local Python collection/list of local python objects using the <code>parallelize(c)</code> method of the <code>SparkContext</code> class</p>
<ul>
<li>The created RDD is an RDD of objects of the same type of objects of the input python collection <code>c</code></li>
<li>In the created RDD, there is one object for each element of the input collection</li>
<li>Spark tries to set the number of partitions automatically based on your cluster’s characteristics</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">## Create a local python list</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>inputList <span class="op">=</span> [</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="st">'First element'</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="st">'Second element'</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="st">'Third element'</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>]</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">## Build an RDD of Strings from the local list.</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">## The number of partitions is set automatically by Spark</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">## There is one element of the RDD for each element</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">## of the local list</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>distRDDList <span class="op">=</span> sc.parallelize(inputList)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that no computation occurs when <code>sc.parallelize(c)</code> is invoked: Spark only records how to create the RDD, and the data is lazily read from the input file only when the data is needed (i.e., when an action is applied on <code>distRDDlist</code>, or on one of its “descendant” RDDs).</p>
</div>
</div>
</div>
<p>When the <code>parallelize(c)</code> is invoked, Spark tries to set the number of partitions automatically based on the cluster’s characteristics, but the developer can set the number of partition by using the method <code>parallelize(c, numSlices)</code> of the <code>SparkContext</code> class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">## Create a local python list</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>inputList <span class="op">=</span> [</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="st">'First element'</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="st">'Second element'</span>,</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="st">'Third element'</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>]</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">## Build an RDD of Strings from the local list.</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">## The number of partitions is set to 3</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">## There is one element of the RDD for each element</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">## of the local list</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>distRDDList <span class="op">=</span> sc.parallelize(inputList, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="save-rdds" class="level4">
<h4 class="anchored" data-anchor-id="save-rdds">Save RDDs</h4>
<p>An RDD can be easily stored in textual (HDFS) files using the <code>saveAsTextFile(path)</code> method of the <code>RDD</code> class</p>
<ul>
<li><code>path</code> is the path of a folder</li>
<li>The method is invoked on the RDD to store in the output folder</li>
<li>Each object of the RDD on which the <code>saveAsTextFile</code> method is invoked is stored in one line of the output files stored in the output folder, and there is one output file for each partition of the input RDD.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">## Store the content of linesRDD in the output folder</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">## Each element of the RDD is stored in one line</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">## of the textual files of the output folder</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>outputPath<span class="op">=</span><span class="st">"risFolder/"</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>linesRDD.saveAsTextFile(outputPath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that <code>saveAsTextFile()</code> is an action, hence Spark computes the content associated with <code>linesRDD</code> when <code>saveAsTextFile()</code> is invoked. Spark computes the content of an RDD only when that content is needed.</p>
<p>Moreover, notice that the output folder contains one textual file for each partition of <code>linesRDD</code>, such that each output file contains the elements of one partition.</p>
</div>
</div>
</div>
</section>
<section id="retrieve-the-content-of-rdds-and-store-it-local-python-variables" class="level4">
<h4 class="anchored" data-anchor-id="retrieve-the-content-of-rdds-and-store-it-local-python-variables">Retrieve the content of RDDs and store it local Python variables</h4>
<p>The content of an RDD can be retrieved from the nodes of the cluster and stored in a local python variable of the Driver using the <code>collect()</code> method of the <code>RDD</code> class.</p>
<p>The <code>collect()</code> method of the <code>RDD</code> class is invoked on the RDD to retrieve. It returns a local python list of objects containing the same objects of the considered RDD.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pay attention to the size of the RDD: large RDDs cannot be stored in a local variable of the Driver.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">## Retrieve the content of the linesRDD and store it</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">## in a local python list</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">## The local python list contains a copy of each</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">## element of linesRDD</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>contentOfLines<span class="op">=</span>linesRDD.collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>contentOfLines</code></td>
<td>Local python variable: it is allocated in the main memory of the Driver process/task</td>
</tr>
<tr class="even">
<td><code>linesRDD</code></td>
<td>RDD of strings: it is distributed across the nodes of the cluster</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="transformations-and-actions" class="level3">
<h3 class="anchored" data-anchor-id="transformations-and-actions">Transformations and Actions</h3>
<p>RDD support two types of operations</p>
<ul>
<li>Transformations</li>
<li>Actions</li>
</ul>
<section id="transformations" class="level4">
<h4 class="anchored" data-anchor-id="transformations">Transformations</h4>
<p>Transformations are operations on RDDs that <strong>return a new RDD</strong>. This type of operation apply a transformation on the elements of the input RDD(s) and the result of the transformation is stored in/associated with a new RDD.</p>
<p>Remember that RDDs are immutable, hence the content of an already existing RDD cannot be changed, and it only possible to applied a transformation on the content of an RDD and then store/assign the result in/to a new RDD.</p>
<p>Transformations are computed <strong>lazily</strong>, which means that transformations are computed (executed) only when an action is applied on the RDDs generated by the transformation operations. When a transformation is invoked, Spark keeps only track of the dependency between the input RDD and the new RDD returned by the transformation, and the content of the new RDD is not computed.</p>
<p>The graph of dependencies between RDDs represents the information about which RDDs are used to create a new RDD. This is called <strong>lineage graph</strong>, and it is represented as a <strong>DAG</strong> <strong>(Directed Acyclic Graph)</strong>: it is needed to compute the content of an RDD the first time an action is invoked on it, or to compute again the content of an RDD (or some of its partitions) when failures occur.</p>
<p>The lineage graph is also useful for <strong>optimization</strong> purposes: when the content of an RDD is needed, Spark can consider the chain of transformations that are applied to compute the content of the needed RDD and potentially decide how to execute the chain of transformations. In this way, Spark can potentially change the order of some transformations or merge some of them based on its optimization engine.</p>
</section>
<section id="actions" class="level4">
<h4 class="anchored" data-anchor-id="actions">Actions</h4>
<p>Actions are operations that</p>
<ul>
<li>return <strong>results to the Driver program</strong> (i.e., return local python variables). Pay attention to the size of the returned results because they must be stored in the main memory of the Driver program.</li>
<li>write the result in the storage (output file/folder). The size of the result can be large in this case since it is directly stored in the (distributed) file system.</li>
</ul>
<section id="example-of-lineage-graph-dag" class="level5">
<h5 class="anchored" data-anchor-id="example-of-lineage-graph-dag">Example of lineage graph (DAG)</h5>
<p>Consider the following code</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="im">from</span> pyspark <span class="im">import</span> SparkConf, SparkContext</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="im">import</span> sys</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb10-5"><a href="#cb10-5"></a>conf <span class="op">=</span> SparkConf().setAppName(<span class="st">"Spark Application"</span>)</span>
<span id="cb10-6"><a href="#cb10-6"></a>sc <span class="op">=</span> SparkContext(conf<span class="op">=</span>conf)</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">## Select the rows containing the word "error"</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> line: line.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span>)</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">## Select the rows containing the word "warning"</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>warningRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> line: line.find(<span class="st">'warning'</span>)<span class="op">&gt;=</span><span class="dv">0</span>)</span>
<span id="cb10-16"><a href="#cb10-16"></a></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">## Union of errorsRDD and warningRDD</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">## The result is associated with a new RDD: badLinesRDD</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>badLinesRDD <span class="op">=</span> errorsRDD.union(warningRDD)</span>
<span id="cb10-20"><a href="#cb10-20"></a></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="co">## Remove duplicates lines (i.e., those lines containing</span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">## both "error" and "warning")</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>uniqueBadLinesRDD <span class="op">=</span> badLinesRDD.distinct()</span>
<span id="cb10-24"><a href="#cb10-24"></a></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">## Count the number of bad lines by applying</span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co">## the count() action</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>numBadLines <span class="op">=</span> uniqueBadLinesRDD.count()</span>
<span id="cb10-28"><a href="#cb10-28"></a></span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="co">## Print the result on the standard output of the driver</span></span>
<span id="cb10-30"><a href="#cb10-30"></a><span class="bu">print</span>(<span class="st">"Lines with problems:"</span>, numBadLines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Visual representation of the DAG</figcaption>
<p><img src="images/11_rdd_based_programming/dag_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Notice that:</p>
<ul>
<li>The application reads the input log file only when the <code>count()</code> action is invoked: this is the first action of the program;</li>
<li><code>filter()</code>, <code>union()</code>, and <code>distinct()</code> are transformations, so they are computed lazily;</li>
<li>Also <code>textFile()</code> is computed lazily, however it is not a transformation because it is not applied on an RDD.</li>
</ul>
<p>Spark, similarly to an SQL optimizer, can potentially optimize the execution of some transformations; for instance, in this case the two filters + union + distinct can be potentially optimized and transformed in one single filter applying the constraint (i.e.&nbsp;The element contains the string “error” or “warning”). This optimization improves the efficiency of the application, but Spark can performs this kind of optimizations only on particular types of RDDs: Datasets and DataFrames.</p>
</section>
</section>
</section>
<section id="passing-functions-to-transformations-and-actions" class="level3">
<h3 class="anchored" data-anchor-id="passing-functions-to-transformations-and-actions">Passing functions to Transformations and Actions</h3>
<p>Many transformations (and some actions) are based on user provided functions that specify which transformation function must be applied on the elements of the input RDD. For example, the <code>filter()</code> transformation selects the elements of an RDD satisfying a user specified constraint, which is a Boolean function applied on each element of the input RDD.</p>
<p>Each language has its own solution to pass functions to Spark’s transformations and actions. In Python, it is possible to use</p>
<ul>
<li>Lambda functions/expressions: simple functions that can be written as one single expression</li>
<li>Local user defined functions (local defs): used for multi-statement functions or statements that do not return a value</li>
</ul>
<section id="example-based-on-the-filter-transformation" class="level4">
<h4 class="anchored" data-anchor-id="example-based-on-the-filter-transformation">Example based on the filter transformation</h4>
<ol type="1">
<li>Create an RDD from a log file;</li>
<li>Create a new RDD containing only the lines of the log file containing the word “error”. The <code>filter()</code> transformation applies the filter constraint on each element of the input RDD; the filter constraint is specified by means of a Boolean function that returns true for the elements satisfying the constraint and false for the others.</li>
</ol>
<section id="solution-based-on-lambda-expressions-lambda" class="level5">
<h5 class="anchored" data-anchor-id="solution-based-on-lambda-expressions-lambda">Solution based on lambda expressions (<code>lambda</code>)</h5>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">## Select the rows containing the word "error"</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> l: l.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>lambda l: l.find('error')&gt;=0</code></td>
<td>This part of the code, which is based on a lambda expression, defines on the fly the function to apply. This part of the code is applied on each object of <code>inputRDD</code>: if it returns true then the current object is “stored” in the new <code>errorsRDD</code> RDD, otherwise the input object is discarded.</td>
</tr>
</tbody>
</table>
</section>
<section id="solution-based-on-function-def" class="level5">
<h5 class="anchored" data-anchor-id="solution-based-on-function-def">Solution based on function (<code>def</code>)</h5>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">## Define the content of the Boolean function that is applied</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">## to select the elements of interest</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw">def</span> myFunction(l):</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="cf">if</span> l.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span>: <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="cf">else</span>: <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb12-9"><a href="#cb12-9"></a></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">## Select the rows containing the word “error”</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(myFunction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>def myFunction(l):</code></td>
<td>When it is invoked, this function analyses the value of the parameter line and returns True if the string line contains the substring “error”. Otherwise, it returns False.</td>
</tr>
<tr class="even">
<td><code>.filter(myFunction)</code></td>
<td>For each object <code>o</code> in <code>inputRDD</code>, the <code>myFunction</code> function is automatically invoked. If <code>myFunction</code> returns True, then <code>o</code> is stored in the new RDD <code>errorsRDD</code>. Otherwise, <code>o</code> is discarded.</td>
</tr>
</tbody>
</table>
</section>
<section id="solution-based-on-function-def-1" class="level5">
<h5 class="anchored" data-anchor-id="solution-based-on-function-def-1">Solution based on function (<code>def</code>)</h5>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">## Define the content of the Boolean function that is applied</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">## to select the elements of interest</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw">def</span> myFunction(l):</span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="cf">return</span> l.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span></span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">## Select the rows containing the word “error”</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(myFunction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>return l.find('error')&gt;=0</code></td>
<td>This part of the code is the same used in the lambda-based solution.</td>
</tr>
<tr class="even">
<td><code>.filter(myFunction)</code></td>
<td>For each object <code>o</code> in <code>inputRDD</code>, the <code>myFunction</code> function is automatically invoked. If <code>myFunction</code> returns True, then <code>o</code> is stored in the new RDD <code>errorsRDD</code>. Otherwise, <code>o</code> is discarded.</td>
</tr>
</tbody>
</table>
</section>
<section id="solution-comparison" class="level5">
<h5 class="anchored" data-anchor-id="solution-comparison">Solution comparison</h5>
<p>The two solutions are more or less equivalent in terms of efficiency</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Lambda function-based code (<code>lambda</code>)</th>
<th>Local user defined functions (local <code>def</code>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>More concise</td>
<td>Less concise</td>
</tr>
<tr class="even">
<td>More readable</td>
<td>Less readable</td>
</tr>
<tr class="odd">
<td>Multi-statement functions or statements that do not return a value are not supported</td>
<td>Multi-statement functions or statements that do not return a value are supported</td>
</tr>
<tr class="even">
<td>Code cannot be reused</td>
<td>Code can be reused (some functions are used in several applications)</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="basic-transformations" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="basic-transformations">Basic Transformations</h3>
<ul>
<li>Some basic transformations analyze the content of one single RDD and return a new RDD (e.g., <code>filter()</code>, <code>map()</code>, <code>flatMap()</code>, <code>distinct()</code>, <code>sample()</code>)</li>
<li>Some other transformations analyze the content of two (input) RDDs and return a new RDD (e.g., <code>union()</code>, <code>intersection()</code>, <code>substract()</code>, <code>cartesian()</code>)</li>
</ul>
<section id="single-input-rdd-transformations" class="level4">
<h4 class="anchored" data-anchor-id="single-input-rdd-transformations">Single input RDD transformations</h4>
<section id="filter-transformation" class="level5">
<h5 class="anchored" data-anchor-id="filter-transformation">Filter transformation</h5>
<p>The filter transformation is applied on one single RDD and returns a new RDD containing only the elements of the input RDD that satisfy a user specified condition.</p>
<p>The filter transformation is based on the <code>filter(f)</code> method of the <code>RDD</code> class: a function <code>f</code> returning a Boolean value is passed to the <code>filter</code> method, where <code>f</code> contains the code associated with the condition that we want to apply on each element <code>e</code> of the input RDD. If the condition is satisfied then the call method returns true and the input element <code>e</code> is selected, otherwise, it returns false and the <code>e</code> element is discarded.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a log file;</li>
<li>Create a new RDD containing only the lines of the log file containing the word “error”.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">## Select the rows containing the word “error”</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> e: e.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that, in this case, the input RDD contains strings, hence, the implemented lambda function is applied on one string at a time and returns a Boolean value.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1, 2, 3, 3]</code>;</li>
<li>Create a new RDD containing only the values greater than <code>2</code>.</li>
</ol>
<p><strong>Using <code>lambda</code></strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb15-3"><a href="#cb15-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">## Select the values greater than 2</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>greaterRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> num : num<span class="op">&gt;</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that the input RDD contains integers, hence, the implemented lambda function is applied on one integer at a time and returns a Boolean value.</p>
<p><strong>Using <code>def</code></strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">## Define the function to be applied in the filter transformation</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="kw">def</span> greaterThan2(num):</span>
<span id="cb16-3"><a href="#cb16-3"></a>    <span class="cf">return</span> num<span class="op">&gt;</span><span class="dv">2</span></span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb16-7"><a href="#cb16-7"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">## Select the values greater than 2</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>greaterRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(greaterThan2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this case, the function to apply is defined using <code>def</code> and then is passed to the filter transformation.</p>
</div>
</div>
</div>
</section>
<section id="map-transformation" class="level5">
<h5 class="anchored" data-anchor-id="map-transformation">Map transformation</h5>
<p>The map transformation is used to create a new RDD by applying a function <code>f</code> on each element of the input RDD: the new RDD contains exactly one element <code>y</code> for each element <code>x</code> of the input RDD, in particular the value of <code>y</code> is obtained by applying a user defined function <code>f</code> on <code>x</code> (e.g., <code>y= f(x)</code>). The data type of <code>y</code> can be different from the data type of <code>x</code>.</p>
<p>The map transformation is based on the RDD <code>map(f)</code> method of the RDD class: a function <code>f</code> implementing the transformation is passed to the <code>map</code> method, where <code>f</code> contains the code that is applied over each element of the input RDD to create the elements of the returned RDD. For each input element of the input RDD exactly one single new element is returned by <code>f</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a textual file containing the surnames of a list of users (each line of the file contains one surname);</li>
<li>Create a new RDD containing the length of each surname.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"usernames.txt"</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">## Compute the lengths of the input surnames</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>lenghtsRDD <span class="op">=</span> inputRDD.<span class="bu">map</span>(<span class="kw">lambda</span> line: <span class="bu">len</span>(line))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that the input RDD is an RDD of strings, hence, also the input of the lambda function is a String. Instead, the new RDD is an RDD of Integers, since the lambda function returns a new Integer for each input element.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1, 2, 3, 3]</code>;</li>
<li>Create a new RDD containing the square of each input element.</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb18-3"><a href="#cb18-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">## Compute the square of each input element</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>squaresRDD <span class="op">=</span> inputRDD.<span class="bu">map</span>(<span class="kw">lambda</span> element: element<span class="op">*</span>element)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="flatmap-transformation" class="level5">
<h5 class="anchored" data-anchor-id="flatmap-transformation">FlatMap transformation</h5>
<p>The flatMap transformation is used to create a new RDD by applying a function <code>f</code> on each element of the input RDD. The new RDD contains a list of elements obtained by applying <code>f</code> on each element <code>x</code> of the input RDD; in other words, the function <code>f</code> applied on an element <code>x</code> of the input RDD returns a list of values <code>[y]</code> (e.g., <code>[y]= f(x)</code>). <code>[y]</code> can be the empty list.</p>
<p>The final result is the concatenation of the list of values obtained by applying <code>f</code> over all the elements of the input RDD (i.e., the final RDD contains the concatenation of the lists obtained by applying <code>f</code> over all the elements of the input RDD).</p>
<p>Notice that</p>
<ul>
<li>duplicates are not removed</li>
<li>the data type of <code>y</code> can be different from the data type of <code>x</code></li>
</ul>
<p>The flatMap transformation is based on the <code>flatMap(f)</code> method of the <code>RDD</code> class A function <code>f</code> implementing the transformation is passed to the <code>flatMap</code> method, where <code>f</code> contains the code that is applied on each element of the input RDD and returns a list of elements which will be included in the new returned RDD: for each element of the input RDD a list of new elements is returned by <code>f</code>. The returned list can be empty.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a textual file containing a generic text (each line of the input file can contain many words);</li>
<li>Create a new RDD containing the list of words, with repetitions, occurring in the input textual document. In other words, each element of the returned RDD is one of the words occurring in the input textual file, and the words occurring multiple times in the input file appear multiple times, as distinct elements, also in the returned RDD.</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"document.txt"</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">## Compute/identify the list of words occurring in document.txt</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>listOfWordsRDD <span class="op">=</span> inputRDD.flatMap(<span class="kw">lambda</span> l: l.split(<span class="st">' '</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this case the lambda function returns a “list” of values for each input element. However, notice that the new RDD (i.e., <code>listOfWordsRDD</code>) contains the “concatenation” of the lists obtained by applying the lambda function over all the elements of <code>inputRDD</code>: the new RDD is an RDD of strings and not an RDD of lists of strings.</p>
</div>
</div>
</div>
</section>
<section id="distinct-information" class="level5">
<h5 class="anchored" data-anchor-id="distinct-information">Distinct information</h5>
<p>The distinct transformation is applied on one single RDD and returns a new RDD containing the list of distinct elements (values) of the input RDD.</p>
<p>The distinct transformation is based on the <code>distinct()</code> method of the <code>RDD</code> class, and no functions are needed in this case.</p>
<p>A shuffle operation is executed for computing the result of the distinct transformation, so that data from different input partitions gets be compared to remove duplicates. The shuffle operation is used to repartition the input data: all the repetitions of the same input element are associated with the same output partition (in which one single copy of the element is stored), and a hash function assigns each input element to one of the new partitions.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a textual file containing the names of a list of users (each line of the input file contains one name);</li>
<li>Create a new RDD containing the list of distinct names occurring in the input file. The type of the new RDD is the same of the input RDD.</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="co">## Read the content of a textual input file</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"names.txt"</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">## Select the distinct names occurring in inputRDD</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>distinctNamesRDD <span class="op">=</span> inputRDD.distinct()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1, 2, 3, 3]</code>;</li>
<li>Create a new RDD containing only the distinct values appearing in the input RDD.</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb21-3"><a href="#cb21-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">## Compute the set of distinct words occurring in inputRDD</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>distinctIntRDD <span class="op">=</span> inputRDD.distinct()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="sortby-transformation" class="level5">
<h5 class="anchored" data-anchor-id="sortby-transformation">SortBy transformation</h5>
<p>The sortBy transformation is applied on one RDD and returns a new RDD containing the same content of the input RDD sorted in ascending order.</p>
<p>The sortBy transformation is based on the <code>sortBy(keyfunc)</code> method of the <code>RDD</code> class: each element of the input RDD is initially mapped to a new value by applying the specified function <code>keyfunc</code>, and then the input elements are sorted by considering the values returned by the invocation of <code>keyfunc</code> on the input values.</p>
<p>The <code>sortBy(keyfunc, ascending)</code> method of the <code>RDD</code> class allows specifying if the values in the returned RDD are sorted in ascending or descending order by using the Boolean parameter <code>ascending</code></p>
<ul>
<li><code>ascending</code> set to True means ascending order</li>
<li><code>ascending</code> set to False means descending order</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a textual file containing the names of a list of users (each line of the input file contains one name);</li>
<li>Create a new RDD containing the list of users sorted by name (based on the alphabetic order).</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">## Read the content of a textual input file</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"names.txt"</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co">## Sort the content of the input RDD by name.</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co">## Store the sorted result in a new RDD</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>sortedNamesRDD <span class="op">=</span> inputRDD.sortBy(<span class="kw">lambda</span> name: name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that each input element of the lambda expression is a string. The goal is sorting the input names (strings) in alphabetic order, which is the standard sort order for strings. For this reason the lambda function returns the input strings without modifying them.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a textual file containing the names of a list of users (each line of the input file contains one name);</li>
<li>Create a new RDD containing the list of users sorted by the length of their name (i.e., the sort order is based on <code>len(name)</code>).</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">## Read the content of a textual input file</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"names.txt"</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co">## Sort the content of the input RDD by name.</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co">## Store the sorted result in a new RDD</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>sortedNamesLenRDD <span class="op">=</span> inputRDD.sortBy(<span class="kw">lambda</span> name: <span class="bu">len</span>(name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this case, each input element is a string but we are interested in sorting the input names (strings) by length (integer), which is not the standard sort order for strings. For this reason the lambda function returns the length of each input string, and the sort operation is performed on the returned integer values (the lengths of the input names).</p>
</div>
</div>
</div>
</section>
<section id="sample-transformation" class="level5">
<h5 class="anchored" data-anchor-id="sample-transformation">Sample transformation</h5>
<p>The sample transformation is applied on one single RDD and returns a new RDD containing a random sample of the elements (values) of the input RDD.</p>
<p>The sample transformation is based on the <code>sample(withReplacement, fraction)</code> method of <code>RDD</code> class:</p>
<ul>
<li><code>withReplacement</code> specifies if the random sample is with replacement (True) or not (False);</li>
<li><code>fraction</code> specifies the expected size of the sample as a fraction of the input RDD’s size (values in the range <span class="math inline">\([0, 1]\)</span>).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a textual file containing a set of sentences (each line of the file contains one sentence);</li>
<li>Create a new RDD containing a random sample of sentences, using the “without replacement” strategy and setting fraction to <span class="math inline">\(0.2\)</span> (i.e., <span class="math inline">\(20%\)</span>).</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">## Read the content of a textual input file</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"sentences.txt"</span>)</span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co">## Create a random sample of sentences</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>randomSentencesRDD <span class="op">=</span> inputRDD.sample(<span class="va">False</span>,<span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1, 2, 3, 3]</code>;</li>
<li>Create a new RDD containing a random sample of the input values, using the “replacement” strategy and setting fraction to <span class="math inline">\(0.2\)</span> (i.e., <span class="math inline">\(20%\)</span>).</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb25-3"><a href="#cb25-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb25-4"><a href="#cb25-4"></a></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="co">## Create a sample of the inputRDD</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>randomSentencesRDD <span class="op">=</span> inputRDD.sample(<span class="va">True</span>,<span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="set-transformations" class="level4">
<h4 class="anchored" data-anchor-id="set-transformations">Set transformations</h4>
<p>Spark provides also a set of transformations that operate on two input RDDs and return a new RDD. Some of them implement standard set transformations:</p>
<ul>
<li>Union</li>
<li>Intersection</li>
<li>Subtract</li>
<li>Cartesian</li>
</ul>
<p>All these transformations have</p>
<ul>
<li>Two input RDDs: one is the RDD on which the method is invoked, while the other RDD is passed as parameter to the method</li>
<li>One output RDD</li>
</ul>
<p>All the involved RDDs have the same data type when union, intersection, or subtract are used, instead mixed data types can be used with the cartesian transformation.</p>
<section id="union-transformation" class="level5">
<h5 class="anchored" data-anchor-id="union-transformation">Union transformation</h5>
<p>The union transformation is based on the <code>union(other)</code> method of the <code>RDD</code> class: <code>other</code> is the second RDD to use, and the method returns a new RDD containing the union (with duplicates) of the elements of the two input RDDs.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Duplicates elements are not removed</strong>. This choice is related to optimization reasons: removing duplicates means having a global view of the whole content of the two input RDDs, but, since each RDD is split in partitions that are stored in different nodes of the cluster, the contents of all partitions should be shared to remove duplicates, and that’s a computationally costly operation.</p>
<p>The shuffle operation is not needed in this case.</p>
</div>
</div>
<p>If removing duplicates is needed after performing the union transformation, apply the <code>distinct()</code> transformation on the output of the <code>union()</code> transformation, but pay attention that <code>distinct()</code> is a computational costly operation (it is associated with a shuffle operation). Use <code>distinct()</code> if and only if duplicate removal is indispensable for the application.</p>
</section>
<section id="intersection-transformation" class="level5">
<h5 class="anchored" data-anchor-id="intersection-transformation">Intersection transformation</h5>
<p>The intersection transformation is based on the <code>intersection(other)</code> method of the <code>RDD</code> class: <code>other</code> is the second RDD to use, and the method returns a new RDD containing the elements (without duplicates) occurring in both input RDDs.</p>
<p>Duplicates are removed: a shuffle operation is executed for computing the result of intersection, since elements from different input partitions must be compared to find common elements.</p>
</section>
<section id="subtract-transformation" class="level5">
<h5 class="anchored" data-anchor-id="subtract-transformation">Subtract transformation</h5>
<p>The subtract transformation is based on the <code>subtract(other)</code> method of the <code>RDD</code> class: <code>other</code> is the second RDD to use, and the result contains the elements appearing only in the RDD on which the subtract method is invoked. Notice that in this transformation the two input RDDs play different roles.</p>
<p>Duplicates are not removed, but a shuffle operation is executed for computing the result of subtract, since elements from different input partitions must be compared.</p>
</section>
<section id="cartesian-transformation" class="level5">
<h5 class="anchored" data-anchor-id="cartesian-transformation">Cartesian transformation</h5>
<p>The cartesian transformation is based on the <code>cartesian(other)</code> method of the <code>RDD</code> class: <code>other</code> is the second RDD to use, the data types of the objects of the two input RDDs can be different, and the returned RDD is an RDD of pairs (tuples) containing all the combinations composed of one element of the first input RDD and one element of the second input RDD (see later what an RDD of pairs is).</p>
<p>In this transformation a large amount of data is sent on the network: elements from different input partitions must be combined to compute the returned pairs, but the elements of the two input RDDs are stored in different partitions, which could be even in different servers.</p>
</section>
<section id="examples-of-set-transformations" class="level5">
<h5 class="anchored" data-anchor-id="examples-of-set-transformations">Examples of set transformations</h5>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create two RDDs of integers
<ul>
<li><code>inputRDD1</code> contains the values <code>[1, 2, 2, 3, 3]</code></li>
<li><code>inputRDD2</code> contains the values <code>[3, 4, 5]</code></li>
</ul></li>
<li>Create four new RDDs
<ul>
<li><code>outputUnionRDD</code> contains the union of <code>inputRDD1</code> and <code>inputRDD2</code></li>
<li><code>outputIntersectionRDD</code> contains the intersection of <code>inputRDD1</code> and <code>inputRDD2</code></li>
<li><code>outputSubtractRDD</code> contains the result of <code>inputRDD1</code> &nbsp;<code>inputRDD2</code></li>
<li><code>outputCartesianRDD</code> contains the cartesian product of <code>inputRDD1</code> and <code>inputRDD2</code></li>
</ul></li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="co">## Create two RDD of integers</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>inputList1 <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb26-3"><a href="#cb26-3"></a>inputRDD1 <span class="op">=</span> sc.parallelize(inputList1)</span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a>inputList2 <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb26-6"><a href="#cb26-6"></a>inputRDD2 <span class="op">=</span> sc.parallelize(inputList2)</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">## Create four new RDDs by using union, intersection, </span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co">## subtract, and cartesian</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>outputUnionRDD <span class="op">=</span> inputRDD1.union(inputRDD2)</span>
<span id="cb26-11"><a href="#cb26-11"></a></span>
<span id="cb26-12"><a href="#cb26-12"></a>outputIntersectionRDD <span class="op">=</span> inputRDD1.intersection(inputRDD2)</span>
<span id="cb26-13"><a href="#cb26-13"></a></span>
<span id="cb26-14"><a href="#cb26-14"></a>outputSubtractRDD <span class="op">=</span> inputRDD1.subtract(inputRDD2)</span>
<span id="cb26-15"><a href="#cb26-15"></a></span>
<span id="cb26-16"><a href="#cb26-16"></a>outputCartesianRDD <span class="op">=</span> inputRDD1.cartesian(inputRDD2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>outputCartesianRDD</code></td>
<td>Each element of the returned RDD is a pair (tuple) of integer elements.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create two RDDs
<ul>
<li><code>inputRDD1</code> contains the Integer values <code>[1, 2, 3]</code></li>
<li><code>inputRDD2</code> contains the String values <code>["A", "B"]</code></li>
</ul></li>
<li>Create a new RDD containing the cartesian product of <code>inputRDD1</code> and <code>inputRDD2</code></li>
</ol>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co">## Create an RDD of Integers and an RDD of Strings</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>inputList1 <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb27-3"><a href="#cb27-3"></a>inputRDD1 <span class="op">=</span> sc.parallelize(inputList1)</span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a>inputList2 <span class="op">=</span> [<span class="st">"A"</span>,<span class="st">"B"</span>]</span>
<span id="cb27-6"><a href="#cb27-6"></a>inputRDD2 <span class="op">=</span> sc.parallelize(inputList2)</span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="co">## Compute the cartesian product</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>outputCartesianRDD <span class="op">=</span> inputRDD1.cartesian(inputRDD2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>outputCartesianRDD</code></td>
<td>Each element of the returned RDD is a pair (tuple) of integer elements.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="summary" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="summary">Summary</h4>
<section id="single-input-rdd-transformations-1" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="single-input-rdd-transformations-1">Single input RDD transformations</h5>
<p>All the examples reported in the following tables are applied on an RDD of integers containing the following elements (i.e., values): <code>[1,2,3,3]</code>.</p>
<div class="column-page">
<p><strong>Purposes</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>filter(f)</code></td>
<td>Return an RDD consisting only of the elements of the input RDD that pass the condition passed to <code>filter()</code>. The input RDD and the new RDD have the same data type.</td>
</tr>
<tr class="even">
<td><code>map(f)</code></td>
<td>Apply a function to each element in the RDD and return an RDD of the result. The applied function return one element for each element of the input RDD. The input RDD and the new RDD can have a different data type.</td>
</tr>
<tr class="odd">
<td><code>flatMap(f)</code></td>
<td>Apply a function to each element in the RDD and return an RDD of the result. The applied function return a set of elements (from 0 to many) for each element of the input RDD. The input RDD and the new RDD can have a different data type.</td>
</tr>
<tr class="even">
<td><code>distinct()</code></td>
<td>Remove duplicates.</td>
</tr>
<tr class="odd">
<td><code>sortBy(keyfunc)</code></td>
<td>Return a new RDD containing the same values of the input RDD sorted in ascending order.</td>
</tr>
<tr class="even">
<td><code>sample(withReplacement, fraction)</code></td>
<td>Sample the content of the input RDD, with or without replacement and return the selected sample. The input RDD and the new RDD have the same data type.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 45%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Example function</th>
<th>Example result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>filter(f)</code></td>
<td><code>filter(lambda x: x != 1)</code></td>
<td><code>[2,3,3]</code></td>
</tr>
<tr class="even">
<td><code>map(f)</code></td>
<td><p><code>map(lambda x: x+1)</code></p>
<p>For each input element <code>x</code>, the element with value <code>x+1</code> is included in the new RDD</p></td>
<td><code>[2,3,4,4]</code></td>
</tr>
<tr class="odd">
<td><code>flatMap(f)</code></td>
<td><p><code>flatMap(lambda x: list(range(x,4))</code></p>
<p>For each input element <code>x</code>, the set of elements with values from <code>x</code> to 3 are returned</p></td>
<td><code>[1,2,3,2,3,3,3]</code></td>
</tr>
<tr class="even">
<td><code>distinct()</code></td>
<td><code>distinct()</code></td>
<td><code>[1,2,3]</code></td>
</tr>
<tr class="odd">
<td><code>sortBy(keyfunc)</code></td>
<td><p><code>sortBy(lambda v: v)</code></p>
<p>Sort the input integer values in ascending order by using the standard integer sort order</p></td>
<td><code>[1,2,3,3]</code></td>
</tr>
<tr class="even">
<td><code>sample(withReplacement, fraction)</code></td>
<td><code>sample(True, 0.2)</code></td>
<td>Non deterministic</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="two-input-rdd-transformations" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="two-input-rdd-transformations">Two input RDD transformations</h5>
<p>All the examples reported in the following tables are applied on the following two RDDs of integers</p>
<ul>
<li><code>inputRDD1</code>: <code>[1,2,2,3,3]</code></li>
<li><code>inputRDD2</code>: <code>[3,4,5]</code></li>
</ul>
<div class="column-page">
<p><strong>Purposes</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>union(other)</code></td>
<td>Return a new RDD containing the union of the elements of the input RDD and the elements of the one passed as parameter to <code>union()</code>. Duplicate values are not removed. All the RDDs have the same data type.</td>
</tr>
<tr class="even">
<td><code>intersection(other)</code></td>
<td>Return a new RDD containing the intersection of the elements of the input RDD and the elements of the one passed as parameter to <code>intersection()</code>. All the RDDs have the same data type.</td>
</tr>
<tr class="odd">
<td><code>subtract(other)</code></td>
<td>Return a new RDD the elements appearing only in the input RDD and not in the one passed as parameter to <code>subtract()</code>. All the RDDs have the same data type.</td>
</tr>
<tr class="even">
<td><code>cartesian(other)</code></td>
<td>Return a new RDD containing the cartesian product of the elements of the input RDD and the elements of the one passed as parameter to <code>cartesian()</code>. All the RDDs have the same data type.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 45%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Example function</th>
<th>Example result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>union(other)</code></td>
<td><code>inputRDD1.union(inputRDD2)</code></td>
<td><code>[1,2,2,3,3,3,4,5]</code></td>
</tr>
<tr class="even">
<td><code>intersection(other)</code></td>
<td><code>inputRDD1.intersection(inputRDD2)</code></td>
<td><code>[3]</code></td>
</tr>
<tr class="odd">
<td><code>subtract(other)</code></td>
<td><code>inputRDD1.subtract(inputRDD2)</code></td>
<td><code>[1,2,2]</code></td>
</tr>
<tr class="even">
<td><code>cartesian(other)</code></td>
<td><code>inputRDD1.cartesian(inputRDD2)</code></td>
<td><code>[(1,3),(1,4),...,(3,5)]</code></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>
<section id="basic-actions" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="basic-actions">Basic Actions</h3>
<p>Spark actions can retrieve the content of an RDD or the result of a function applied on an RDD and</p>
<ul>
<li>Store it in a local Python variable of the Driver program
<ul>
<li>Pay attention to the size of the returned value</li>
<li>Pay attentions that date are sent on the network from the nodes containing the content of RDDs and the executor running the Driver</li>
</ul></li>
<li>Store the content of an RDD in an output folder or database</li>
</ul>
<p>The Spark actions that return a result that is stored in local (Python) variables of the Driver 1. Are executed locally on each node containing partitions of the RDD on which the action is invoked, and so local results are generated in each node; 2. Local results are sent on the network to the Driver that computes the final result and store it in local variables of the Driver.</p>
<p>The basic actions returning (Python) objects to the Driver are</p>
<ul>
<li><code>collect()</code></li>
<li><code>count()</code></li>
<li><code>countByValue()</code></li>
<li><code>take()</code></li>
<li><code>top()</code></li>
<li><code>takeSample()</code></li>
<li><code>reduce()</code></li>
<li><code>fold()</code></li>
<li><code>aggregate()</code></li>
<li><code>foreach()</code></li>
</ul>
<section id="collect-action" class="level4">
<h4 class="anchored" data-anchor-id="collect-action">Collect action</h4>
<p>The collect action returns a local Python list of objects containing the same objects of the considered RDD.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pay attention to the size of the RDD: large RDD cannot be memorized in a local variable of the Driver.</p>
</div>
</div>
<p>The collect action is based on the <code>collect()</code> method of the <code>RDD</code> class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1,2,3,3]</code>;</li>
<li>Retrieve the values of the created RDD and store them in a local python list that is instantiated in the Driver.</li>
</ol>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb28-3"><a href="#cb28-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co">## Retrieve the elements of the inputRDD and store them in</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="co">## a local python list</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>retrievedValues <span class="op">=</span> inputRDD.collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>inputRDD</code></td>
<td>It is distributed across the nodes of the cluster. It can be large and it is stored in the local disks of the nodes if it is needed.</td>
</tr>
<tr class="even">
<td><code>retrievedValues</code></td>
<td>It is a local python variable. It can only be stored in the main memory of the process/task associated with the Driver. Pay attention to the size of the list. Use the <code>collect()</code> action if and only if sure that the list is small. Otherwise, store the content of the RDD in a file by using the <code>saveAsTextFile</code> method.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="count-action" class="level4">
<h4 class="anchored" data-anchor-id="count-action">Count action</h4>
<p>Count the number of elements of an RDD.</p>
<p>The count action is based on the <code>count()</code> method of the <code>RDD</code> class: it returns the number of elements of the input RDD.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Consider the textual files “document1.txt” and “document2.txt”;</li>
<li>Print the name of the file with more lines.</li>
</ol>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">## Read the content of the two input textual files</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>inputRDD1 <span class="op">=</span> sc.textFile(<span class="st">"document1.txt"</span>)</span>
<span id="cb29-3"><a href="#cb29-3"></a>inputRDD2 <span class="op">=</span> sc.textFile(<span class="st">"document2.txt"</span>)</span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="co">## Count the number of lines of the two files = number of elements</span></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="co">## of the two RDDs</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>numLinesDoc1 <span class="op">=</span> inputRDD1.count()</span>
<span id="cb29-8"><a href="#cb29-8"></a>numLinesDoc2 <span class="op">=</span> inputRDD2.count()</span>
<span id="cb29-9"><a href="#cb29-9"></a></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="cf">if</span> numLinesDoc1<span class="op">&gt;</span> numLinesDoc2: </span>
<span id="cb29-11"><a href="#cb29-11"></a>    <span class="bu">print</span>(<span class="st">"document1.txt"</span>)</span>
<span id="cb29-12"><a href="#cb29-12"></a><span class="cf">elif</span> numLinesDoc2<span class="op">&gt;</span> numLinesDoc1: </span>
<span id="cb29-13"><a href="#cb29-13"></a>    <span class="bu">print</span>(<span class="st">"document2.txt"</span>)</span>
<span id="cb29-14"><a href="#cb29-14"></a><span class="cf">else</span>: </span>
<span id="cb29-15"><a href="#cb29-15"></a>    <span class="bu">print</span>(<span class="st">"Same number of lines"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="countbyvalue-action" class="level4">
<h4 class="anchored" data-anchor-id="countbyvalue-action">CountByValue action</h4>
<p>The countByValue action returns a local python dictionary containing the information about the number of times each element occurs in the RDD</p>
<ul>
<li>The keys of the dictionary are associated with the input elements</li>
<li>The values are the frequencies of the elements</li>
</ul>
<p>The countByValue action is based on the <code>countByValue()</code> method of the <code>RDD</code> class. The amount of used main memory in the Driver is related to the number of distinct elements/keys.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a textual file containing the first names of a list of users (each line contain one name);</li>
<li>Compute the number of occurrences of each name and store this information in a local variable of the Driver.</li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>namesRDD <span class="op">=</span> sc.textFile(<span class="st">"names.txt"</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co">## Compute the number of occurrencies of each name</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>namesOccurrences <span class="op">=</span> namesRDD.countByValue()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>namesOccurrences = namesRDD.countByValue()</code></td>
<td>Also in this case, pay attention to the size of the returned dictionary (that is related to the number of distinct names in this case). Use the <code>countByValue()</code> action if and only if you are sure that the returned dictionary is small. Otherwise, use an appropriate chain of Spark’s transformations and write the final result in a file by using the <code>saveAsTextFile</code> method.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="take-action" class="level4">
<h4 class="anchored" data-anchor-id="take-action">Take action</h4>
<p>The <code>take(num)</code> action returns a local python list of objects containing the first <code>num</code> elements of the considered RDD. The order of the elements in an RDD is consistent with the order of the elements in the file or collection that has been used to create the RDD.</p>
<p>The take action is based on the <code>take(num)</code> method of the <code>RDD</code> class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1,5,3,3,2]</code>;</li>
<li>Retrieve the first two values of the created RDD and store them in a local python list that is instantiated in the Driver.</li>
</ol>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 5, 3, 3,2 in this RDD</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>]</span>
<span id="cb31-3"><a href="#cb31-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="co">## Retrieve the first two elements of the inputRDD and store them in</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co">## a local python list</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>retrievedValues <span class="op">=</span> inputRDD.take(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="first-action" class="level4">
<h4 class="anchored" data-anchor-id="first-action">First action</h4>
<p>The <code>first()</code> action returns a local python object containing the first element of the considered RDD. The order of the elements in an RDD is consistent with the order of the elements in the file or collection that has been used to create the RDD.</p>
<p>The first action is based on the <code>first()</code> method of the <code>RDD</code> class.</p>
<p>Notice that the only difference between <code>first()</code> and <code>take(1)</code> is given by the fact that <code>first()</code> returns a single element (the returned element is the first element of the RDD), while <code>take(1)</code> returns a list of elements containing one single element (the only element of the returned list is the first element of the RDD).</p>
</section>
<section id="top-action" class="level4">
<h4 class="anchored" data-anchor-id="top-action">Top action</h4>
<p>The <code>top(num)</code> action returns a local python list of objects containing the top num (largest) elements of the considered RDD. The ordering is the default one of class associated with the objects stored in the RDD (the descending order is used).</p>
<p>The top action is based on the <code>top(num)</code> method of the <code>RDD</code> class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1,5,3,4,2]</code>;</li>
<li>Retrieve the top-2 greatest values of the created RDD and store them in a local python list that is instantiated in the Driver.</li>
</ol>
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 5, 3, 4,2 in this RDD</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>]</span>
<span id="cb32-3"><a href="#cb32-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb32-4"><a href="#cb32-4"></a></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co">## Retrieve the top-2 elements of the inputRDD and store them in</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co">## a local python list</span></span>
<span id="cb32-7"><a href="#cb32-7"></a>retrievedValues <span class="op">=</span> inputRDD.top(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>The <code>top(num, key)</code> action returns a local python list of objects containing the num largest elements of the considered RDD sorted by considering a user specified sorting function.</p>
<p>The top action is based on the <code>top(num, key)</code> method of the <code>RDD</code> class</p>
<ul>
<li><code>num</code> is the number of elements to be selected;</li>
<li><code>key</code> is a function that is applied on each input element before comparing them.</li>
</ul>
<p>The comparison between elements is based on the values returned by the invocations of this function.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of strings containing the values <code>['Paolo','Giovanni','Luca']</code>;</li>
<li>Retrieve the 2 longest names (longest strings) of the created RDD and store them in a local python list that is instantiated in the Driver.</li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="co">## Create an RDD of strings. Load the values 'Paolo', 'Giovanni', 'Luca']</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co">## in the RDD</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>inputList <span class="op">=</span> [<span class="st">'Paolo'</span>,<span class="st">'Giovanni'</span>,<span class="st">'Luca'</span>]</span>
<span id="cb33-4"><a href="#cb33-4"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co">## Retrieve the 2 longest names of the inputRDD and store them in</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="co">## a local python list</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>retrievedValues <span class="op">=</span> inputRDD.top(<span class="dv">2</span>,<span class="kw">lambda</span> s:<span class="bu">len</span>(s))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="takeordered-action" class="level4">
<h4 class="anchored" data-anchor-id="takeordered-action">TakeOrdered action</h4>
<p>The <code>takeOrdered(num)</code> action returns a local python list of objects containing the num smallest elements of the considered RDD. The ordering is the default one of class associated with the objects stored in the RDD (the ascending order is used).</p>
<p>The takeOrdered action is based on the <code>takeOrdered(num)</code> method of the <code>RDD</code> class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1,5,3,4,2]</code>;</li>
<li>Retrieve the 2 smallest values of the created RDD and store them in a local python list that is instantiated in the Driver.</li>
</ol>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 5, 3, 4,2 in this RDD</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>]</span>
<span id="cb34-3"><a href="#cb34-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co">## Retrieve the 2 smallest elements of the inputRDD and store them in</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co">## a local python list</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>retrievedValues <span class="op">=</span> inputRDD.takeOrdered(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>The <code>takeOrdered(num, key)</code> action returns a local python list of objects containing the num smallest elements of the considered RDD sorted by considering a user specified sorting function.</p>
<p>The takeOrdered action is based on the <code>takeOrdered(num, key)</code> method of the <code>RDD</code> class</p>
<ul>
<li><code>num</code> is the number of elements to be selected;</li>
<li><code>key</code> is a function that is applied on each input element before comparing them.</li>
</ul>
<p>The comparison between elements is based on the values returned by the invocations of this function.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of strings containing the values <code>['Paolo','Giovanni','Luca']</code>;</li>
<li>Retrieve the 2 shortest names (shortest strings) of the created RDD and store them in a local python list that is instantiated in the Driver.</li>
</ol>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="co">## Create an RDD of strings. Load the values 'Paolo', 'Giovanni', 'Luca']</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co">## in the RDD</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>inputList <span class="op">=</span> [<span class="st">'Paolo'</span>,<span class="st">'Giovanni'</span>,<span class="st">'Luca'</span>]</span>
<span id="cb35-4"><a href="#cb35-4"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb35-5"><a href="#cb35-5"></a></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co">## Retrieve the 2 shortest names of the inputRDD and store them in</span></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="co">## a local python list</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>retrievedValues <span class="op">=</span> inputRDD.takeOrdered(<span class="dv">2</span>,<span class="kw">lambda</span> s:<span class="bu">len</span>(s))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="takesample-action" class="level4">
<h4 class="anchored" data-anchor-id="takesample-action">TakeSample action</h4>
<p>The <code>takeSample(withReplacement, num)</code> action returns a local python list of objects containing num random elements of the considered RDD.</p>
<p>The takeSampleaction is based on the <code>takeSample(withReplacement, num)</code> method of the <code>RDD</code> class, where <code>withReplacement</code> specifies if the random sample is with replacement (True) or not (False).</p>
<p>The <code>takeSample(withReplacement, num, seed)</code> method of the <code>RDD</code> class is used when the seed has to be set.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-34-contents" aria-controls="callout-34" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-34" class="callout-34-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1,5,3,3,2]</code>;</li>
<li>Retrieve randomly, without replacement, 2 values from the created RDD and store them in a local python list that is instantiated in the Driver.</li>
</ol>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 5, 3, 3,2 in this RDD</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>]</span>
<span id="cb36-3"><a href="#cb36-3"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="co">## Retrieve randomly two elements of the inputRDD and store them in</span></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="co">## a local python list</span></span>
<span id="cb36-7"><a href="#cb36-7"></a>randomValues<span class="op">=</span> inputRDD.takeSample(<span class="va">True</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="reduce" class="level4">
<h4 class="anchored" data-anchor-id="reduce">Reduce</h4>
<p>Return a single python object obtained by combining all the objects of the input RDD by using a user provide function. The provided function must be associative and commutative, otherwise the result depends on the content of the partitions and the order used to analyze the elements of the RDD’s partitions. The returned object and the ones of the input RDD are all instances of the same data type/class.</p>
<p>The reduce action is based on the <code>reduce(f)</code> method of the <code>RDD</code> class: a function <code>f</code> is passed to the reduce method</p>
<ul>
<li>Given two arbitrary input elements, <code>f</code> is used to combine them in one single value</li>
<li><code>f</code> is recursively invoked over the elements of the input RDD until the input values are reduced to one single value</li>
</ul>
<p>Suppose <span class="math inline">\(L\)</span> contains the list of elements of the input RDD. To compute the final element/value, the reduce action operates as follows</p>
<ol type="1">
<li>Apply the user specified function on a pair of elements <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span> occurring in <span class="math inline">\(L\)</span> and obtain a new element <span class="math inline">\(e_\textbf{new}\)</span>;</li>
<li>Remove the original elements <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span> from <span class="math inline">\(L\)</span> and then insert the element <span class="math inline">\(e_\textbf{new}\)</span> in <span class="math inline">\(L\)</span>;</li>
<li>If <span class="math inline">\(L\)</span> contains only one value, then return it as final result of the reduce action, otherwise, return to step 1.</li>
</ol>
<p>Function <span class="math inline">\(f\)</span> must be associative and commutative, so that the computation of the reduce action can be performed in parallel without problems, otherwise the result depends on how the input RDD is partitioned (i.e., for the functions that are not associative and commutative the output depends on how the RDD is split in partitions and how the content of each partition is analyzed).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1,2,3,3]</code>;</li>
<li>Compute the sum of the values occurring in the RDD and store the result in a local python integer variable in the Driver.</li>
</ol>
<div class="sourceCode" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>inputListReduce <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb37-3"><a href="#cb37-3"></a>inputRDDReduce <span class="op">=</span> sc.parallelize(inputListReduce)</span>
<span id="cb37-4"><a href="#cb37-4"></a></span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="co">## Compute the sum of the values</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>sumValues <span class="op">=</span> inputRDDReduce.<span class="bu">reduce</span>(<span class="kw">lambda</span> e1, e2: e1<span class="op">+</span>e2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>lambda e1, e2: e1+e2</code></td>
<td>This lambda function combines two input integer elements at a time and returns theirs sum.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-36-contents" aria-controls="callout-36" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-36" class="callout-36-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1,2,3,3]</code>;</li>
<li>Compute the maximum value occurring in the RDD and store the result in a local python integer variable in the Driver.</li>
</ol>
<p><strong>Solution 1</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a><span class="co">## Define the function for the reduce action</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="kw">def</span> computeMax(v1,v2):</span>
<span id="cb38-3"><a href="#cb38-3"></a>    <span class="cf">if</span> v1<span class="op">&gt;</span>v2:</span>
<span id="cb38-4"><a href="#cb38-4"></a>        <span class="cf">return</span> v1</span>
<span id="cb38-5"><a href="#cb38-5"></a>    <span class="cf">else</span>:</span>
<span id="cb38-6"><a href="#cb38-6"></a>        <span class="cf">return</span> v2</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb38-9"><a href="#cb38-9"></a>inputListReduce <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb38-10"><a href="#cb38-10"></a>inputRDDReduce <span class="op">=</span> sc.parallelize(inputListReduce)</span>
<span id="cb38-11"><a href="#cb38-11"></a></span>
<span id="cb38-12"><a href="#cb38-12"></a><span class="co">## Compute the maximum value</span></span>
<span id="cb38-13"><a href="#cb38-13"></a>maxValue <span class="op">=</span> inputRDDReduce.<span class="bu">reduce</span>(computeMax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Solution 2</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>inputListReduce <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb39-3"><a href="#cb39-3"></a>inputRDDReduce <span class="op">=</span> sc.parallelize(inputListReduce)</span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co">## Compute the maximum value</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>maxValue <span class="op">=</span> inputRDDReduce.<span class="bu">reduce</span>(<span class="kw">lambda</span> e1, e2: <span class="bu">max</span>(e1, e2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="fold-action" class="level4">
<h4 class="anchored" data-anchor-id="fold-action">Fold action</h4>
<p>Return a single python object obtained by combining all the objects of the input RDD and a “zero” value by using a user provided function, which must be associative (otherwise the result depends on how the RDD is partitioned), but it is not required to be commutative. An initial neutral “zero” value is also specified.</p>
<p>The fold action is based on the <code>fold(zeroValue, op)</code> method of the <code>RDD</code> class. A function <code>op</code> is passed to the fold method; given two arbitrary input elements, <code>op</code> is</p>
<ul>
<li>used to combine them in one single value</li>
<li>used to combine input elements with the “zero” value</li>
<li>recursively invoked over the elements of the input RDD until the input values are reduced to one single value</li>
</ul>
<p>The “zero” value is the neutral value for the used function <code>op</code> (i.e., “zero” combined with any value <span class="math inline">\(v\)</span> by using <code>op</code> is equal to <span class="math inline">\(v\)</span>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-37-contents" aria-controls="callout-37" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-37" class="callout-37-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of strings containing the values <code>['This ','is ','a ','test']</code>;</li>
<li>Compute the concatenation of the values occurring in the RDD (from left to right) and store the result in a local python string variable in the Driver.</li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>inputListFold <span class="op">=</span> [<span class="st">'This '</span>,<span class="st">'is '</span>,<span class="st">'a '</span>,<span class="st">'test'</span>]</span>
<span id="cb40-3"><a href="#cb40-3"></a>inputRDDFold <span class="op">=</span> sc.parallelize(inputListFold)</span>
<span id="cb40-4"><a href="#cb40-4"></a></span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="co">## Concatenate the input strings</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>finalString <span class="op">=</span> inputRDDFold.fold(<span class="st">''</span>, <span class="kw">lambda</span> s1, s2: s1<span class="op">+</span>s2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fold vs Reduce
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Fold is characterized by the “zero” value;</li>
<li>Fold can be used to parallelize functions that are associative but non-commutative (e.g., concatenation of a list of strings).</li>
</ol>
</div>
</div>
</section>
<section id="aggregate-action" class="level4">
<h4 class="anchored" data-anchor-id="aggregate-action">Aggregate action</h4>
<p>Return a single python object obtained by combining the objects of the RDD and an initial “zero” value by using two user provide functions. The provided functions must be associative, otherwise the result depends on how the RDD is partitioned. The returned objects and the ones of the input RDD can be instances of different classes (this is the main difference with respect to <code>reduce()</code> and <code>fold()</code>).</p>
<p>The aggregate action is based on the <code>aggregate(zeroValue,seqOp,combOp)</code> method of the <code>RDD</code> class. The input RDD contains objects of type <code>T</code> while the returned object is of type <code>U</code>, with <code>U</code> different from <code>T</code>.</p>
<ul>
<li>One function is needed for merging an element of type <code>T</code> with an element of type <code>U</code> to return a new element of type <code>U</code>: it is used to merge the elements of the input RDD and the accumulator of each partition;</li>
<li>One function is needed for merging two elements of type <code>U</code> to return a new element of type <code>U</code>: it is used to merge two elements of type U obtained as partial results generated by two different partitions.</li>
</ul>
<p>The <code>seqOp</code> function contains the code that is applied to combine the accumulator value (one accumulator for each partition) with the elements of each partition: one local result per partition is computed by recursively applying <code>seqOp</code>.</p>
<p>The <code>combOp</code> function contains the code that is applied to combine two elements of type U returned as partial results by two different partitions: the global final result is computed by recursively applying <code>combOp</code>.</p>
<section id="how-it-works" class="level5">
<h5 class="anchored" data-anchor-id="how-it-works">How it works</h5>
<p>Suppose that <span class="math inline">\(L\)</span> contains the list of elements of the input RDD and this RDD is split in a set of partitions (i.e., a set of lists <span class="math inline">\({L_1,..., L_n}\)</span>). The aggregate action computes a partial result in each partition and then combines/merges the results. It operates as follows:</p>
<ol type="1">
<li>Aggregate the partial results in each partition, obtaining a set of partial results (of type <code>U</code>) <span class="math inline">\(P={p_1, .., p_n}\)</span>;</li>
<li>Apply the <code>combOp</code> function on a pair of elements <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> in <span class="math inline">\(P\)</span> and obtain a new element <span class="math inline">\(p_\textbf{new}\)</span>;</li>
<li>Remove the original elements <span class="math inline">\(p1\)</span> and <span class="math inline">\(p2\)</span> from <span class="math inline">\(P\)</span> and then insert the element <span class="math inline">\(p_\textbf{new}\)</span> in <span class="math inline">\(P\)</span>;</li>
<li>If <span class="math inline">\(P\)</span> contains only one value then return it as final result of the aggregate action. Otherwise, return to step 2.</li>
</ol>
<p>Suppose that <span class="math inline">\(L_i\)</span> is the list of elements on the <span class="math inline">\(i\)</span>-th partition of the input RDD, and <code>zeroValue</code> is the initial zero value. To compute the partial result over the elements in <span class="math inline">\(L_i\)</span> the aggregate action operates as follows</p>
<ol type="1">
<li>Set <code>accumulator</code> to <code>zeroValue</code> (<code>accumulator=zeroValue</code>);</li>
<li>Apply the <code>seqOp</code> function on <code>accumulator</code> and an elements <span class="math inline">\(ej\)</span> in <span class="math inline">\(L_i\)</span> and update <code>accumulator</code> with the value returned by <code>seqOp</code>;</li>
<li>Remove the original elements <span class="math inline">\(e_j\)</span> from <span class="math inline">\(L_i\)</span>;</li>
<li>If <span class="math inline">\(L_i\)</span> is empty return <code>accumulator</code> as (final) partial result <span class="math inline">\(p_i\)</span> of the <span class="math inline">\(i\)</span>-th partition. Otherwise, return to step 2.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-39-contents" aria-controls="callout-39" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-39" class="callout-39-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of integers containing the values <code>[1,2,3,3]</code>;</li>
<li>Compute both
<ul>
<li>the sum of the values occurring in the input RDD</li>
<li>and the number of elements of the input RDD</li>
</ul></li>
<li>Store in a local python variable of the Driver the average computed over the values of the input RDD.</li>
</ol>
<div class="sourceCode" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>inputListAggr <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb41-3"><a href="#cb41-3"></a>inRDD <span class="op">=</span> sc.parallelize(inputListAggr)</span>
<span id="cb41-4"><a href="#cb41-4"></a></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="co">## Instantiate the zero value</span></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="co">## We use a tuple containing two values:</span></span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="co">## (sum, number of represented elements)</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>zeroValue <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb41-9"><a href="#cb41-9"></a></span>
<span id="cb41-10"><a href="#cb41-10"></a><span class="co">## Compute the sum of the elements in inputRDDAggr and count them</span></span>
<span id="cb41-11"><a href="#cb41-11"></a>sumCount <span class="op">=</span> inRDD.aggregate(</span>
<span id="cb41-12"><a href="#cb41-12"></a>    zeroValue,</span>
<span id="cb41-13"><a href="#cb41-13"></a>    <span class="kw">lambda</span> acc, e: (acc[<span class="dv">0</span>]<span class="op">+</span>e, acc[<span class="dv">1</span>]<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb41-14"><a href="#cb41-14"></a>    <span class="kw">lambda</span> p1, p2: (p1[<span class="dv">0</span>]<span class="op">+</span>p2[<span class="dv">0</span>], p1[<span class="dv">1</span>]<span class="op">+</span>p2[<span class="dv">1</span>])</span>
<span id="cb41-15"><a href="#cb41-15"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 66%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>zeroValue(0,0)</code></td>
<td>Instantiate the “zero” value</td>
</tr>
<tr class="even">
<td><code>lambda acc, e: (acc[0]+e, acc[1]+1)</code></td>
<td>Given a partition <span class="math inline">\(p\)</span> of the input RDD, this is the function that is used to combine the elements of partition <span class="math inline">\(p\)</span> with the accumulator of partition <span class="math inline">\(p\)</span></td>
</tr>
<tr class="odd">
<td><code>acc</code></td>
<td>It is a tupe object, initialized to the “zero” value</td>
</tr>
<tr class="even">
<td><code>e</code></td>
<td>It is an integer</td>
</tr>
<tr class="odd">
<td><code>lambda p1, p2: (p1[0]+p2[0], p1[1]+p2[1])</code></td>
<td>This is the function that is used to combine the partial results emitted by the RDD partitions</td>
</tr>
<tr class="even">
<td><code>p1</code> and <code>p2</code></td>
<td>These are tuple objects</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="co">## Compute the average value</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>myAvg <span class="op">=</span> sumCount[<span class="dv">0</span>]<span class="op">/</span>sumCount[<span class="dv">1</span>]</span>
<span id="cb42-3"><a href="#cb42-3"></a></span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="co">## Print the average on the standard output of the driver</span></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="bu">print</span>(<span class="st">'Average:'</span>, myAvg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="aggregate-action-visual-simulation" class="level5">
<h5 class="anchored" data-anchor-id="aggregate-action-visual-simulation">Aggregate action: visual simulation</h5>
<ul>
<li><code>inRDD = [1,2,3,3]</code>;</li>
<li>Suppose <code>inRDD</code> is split in the following two partitions, <code>[1,2]</code> and <code>[3,3]</code>.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Visual simulation of the aggregate action</figcaption>
<p><img src="images/11_rdd_based_programming/aggregate_action_simulation.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
</section>
<section id="summary-1" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="summary-1">Summary</h4>
<p>All the examples reported in the following tables are applied on inputRDD that is an RDD of integers containing the following elements (i.e., values): <code>[1,2,3,3]</code>.</p>
<div class="column-page">
<p><strong>Purposes</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Action</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>collect()</code></td>
<td>Return a python list containing all the elements of the RDD on which it is applied. The objects of the RDD and objects of the returned list are objects of the same class.</td>
</tr>
<tr class="even">
<td><code>count()</code></td>
<td>Return the number of elements of the RDD.</td>
</tr>
<tr class="odd">
<td><code>countByValue()</code></td>
<td>Return a Map object containing the information about the number of times each element occurs in the RDD.</td>
</tr>
<tr class="even">
<td><code>take(num)</code></td>
<td>Return a Python list containing the first <code>num</code> elements of the RDD. The objects of the RDD and objects of the returned list are objects of the same class.</td>
</tr>
<tr class="odd">
<td><code>first()</code></td>
<td>Return the first element of the RDD.</td>
</tr>
<tr class="even">
<td><code>top(num)</code></td>
<td>Return a Python list containing the top <code>num</code> elements of the RDD based on the default sort order/comparator of the objects. The objects of the RDD and objects of the returned list are objects of the same class.</td>
</tr>
<tr class="odd">
<td><p><code>takeSample(withReplacement, num)</code></p>
<p><code>takeSample(withReplacement, num, seed)</code></p></td>
<td>Return a (Python) List containing a random sample of size <code>n</code> of the RDD. The objects of the RDD and objects of the returned list are objects of the same class.</td>
</tr>
<tr class="even">
<td><code>reduce(f)</code></td>
<td>Return a single Python object obtained by combining the values of the objects of the RDD by using a user provide function. The provided function must be associative and commutative The object returned by the method and the objects of the RDD belong to the same class.</td>
</tr>
<tr class="odd">
<td><code>fold(zeroValue, op)</code></td>
<td>Same as reduce but with the provided zero value.</td>
</tr>
<tr class="even">
<td><code>Aggregate(zeroValue, seqOp, combOp)</code></td>
<td>Similar to <code>reduce()</code> but used to return a different type.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 45%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Action</th>
<th>Example</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>collect()</code></td>
<td><code>inputRDD.collect()</code></td>
<td><code>[1,2,3,3]</code></td>
</tr>
<tr class="even">
<td><code>count()</code></td>
<td><code>inputRDD.count()</code></td>
<td><code>4</code></td>
</tr>
<tr class="odd">
<td><code>countByValue()</code></td>
<td><code>inputRDD.countByValue()</code></td>
<td><code>[(1,1),</code> <code>(2,1),</code> <code>(3,2)]</code></td>
</tr>
<tr class="even">
<td><code>take(num)</code></td>
<td><code>inputRDD.take(2)</code></td>
<td><code>[1,2]</code></td>
</tr>
<tr class="odd">
<td><code>first()</code></td>
<td><code>first()</code></td>
<td><code>1</code></td>
</tr>
<tr class="even">
<td><code>top(num)</code></td>
<td><code>inputRDD.top(2)</code></td>
<td><code>[3,3]</code></td>
</tr>
<tr class="odd">
<td><p><code>takeSample(withReplacement, num)</code></p>
<p><code>takeSample(withReplacement, num, seed)</code></p></td>
<td><code>inputRDD.takeSample(False,1)</code></td>
<td>Nondeterministic</td>
</tr>
<tr class="even">
<td><code>reduce(f)</code></td>
<td><p><code>inputRDD.reduce(lambda e1,e2: e1+e2)</code></p>
<p>The passed function is the sum</p></td>
<td><code>9</code></td>
</tr>
<tr class="odd">
<td><code>fold(zeroValue, op)</code></td>
<td><p><code>inputRDD.fold(0, lambda v1, v2: v1+v2)</code></p>
<p>The passed function is the sum and the passed zeroValue is 0.</p></td>
<td><code>9</code></td>
</tr>
<tr class="even">
<td><code>Aggregate(zeroValue, seqOp, combOp)</code></td>
<td><p><code>inputRDD.aggregate(</code> <code>zeroValue,</code> <code>lambda acc, e: (acc[0]+e, acc[1]+1),</code> <code>lambda p1, p2: (p1[0]+p2[0], p1[1]+p2[1])</code> <code>)</code></p>
<p>Compute a pair of integers where the first one is the sum of the values of the RDD and the second the number of elements</p></td>
<td><code>(9,4)</code></td>
</tr>
</tbody>
</table>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./10_intro_spark.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Spark</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12_rdd_keyvalue_pairs.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">RDDs and key-value pairs</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb43" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu"># RDD based programming</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="fu">## Spark Context</span></span>
<span id="cb43-3"><a href="#cb43-3"></a>The "connection" of the driver to the cluster is based on the Spark Context object</span>
<span id="cb43-4"><a href="#cb43-4"></a></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="ss">- </span>In Python the name of the class is <span class="in">`SparkContext`</span></span>
<span id="cb43-6"><a href="#cb43-6"></a><span class="ss">- </span>The Spark Context is built by means of the constructor of the <span class="in">`SparkContext`</span> class</span>
<span id="cb43-7"><a href="#cb43-7"></a><span class="ss">- </span>The only parameter is a configuration object</span>
<span id="cb43-8"><a href="#cb43-8"></a></span>
<span id="cb43-9"><a href="#cb43-9"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-10"><a href="#cb43-10"></a><span class="fu">### Example</span></span>
<span id="cb43-11"><a href="#cb43-11"></a><span class="in">```python</span></span>
<span id="cb43-12"><a href="#cb43-12"></a><span class="co">## Create a configuration object and</span></span>
<span id="cb43-13"><a href="#cb43-13"></a><span class="co">## set the name of the application</span></span>
<span id="cb43-14"><a href="#cb43-14"></a>conf <span class="op">=</span> SparkConf().setAppName(<span class="st">"Application name"</span>)</span>
<span id="cb43-15"><a href="#cb43-15"></a></span>
<span id="cb43-16"><a href="#cb43-16"></a><span class="co">## Create a Spark Context object</span></span>
<span id="cb43-17"><a href="#cb43-17"></a>sc <span class="op">=</span> SparkContext(conf<span class="op">=</span>conf)</span>
<span id="cb43-18"><a href="#cb43-18"></a><span class="in">```</span></span>
<span id="cb43-19"><a href="#cb43-19"></a>:::</span>
<span id="cb43-20"><a href="#cb43-20"></a></span>
<span id="cb43-21"><a href="#cb43-21"></a>The Spark Context object can be obtained also by using the <span class="in">`SparkContext.getOrCreate(conf)`</span> method, whose only parameter is a configuration object. Notice that, if the <span class="in">`SparkContext`</span> object already exists for this application, the current <span class="in">`SparkContext`</span> object is returned, otherwise, a new <span class="in">`SparkContext`</span> object is returned: there is always one single <span class="in">`SparkContext`</span> object for each application.</span>
<span id="cb43-22"><a href="#cb43-22"></a></span>
<span id="cb43-23"><a href="#cb43-23"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-24"><a href="#cb43-24"></a><span class="fu">### Example</span></span>
<span id="cb43-25"><a href="#cb43-25"></a><span class="in">```python</span></span>
<span id="cb43-26"><a href="#cb43-26"></a><span class="co">## Create a configuration object and</span></span>
<span id="cb43-27"><a href="#cb43-27"></a><span class="co">## set the name of the application</span></span>
<span id="cb43-28"><a href="#cb43-28"></a>conf <span class="op">=</span> SparkConf().setAppName(<span class="st">"Application name"</span>)</span>
<span id="cb43-29"><a href="#cb43-29"></a></span>
<span id="cb43-30"><a href="#cb43-30"></a><span class="co">## Retrieve the current SparkContext object or</span></span>
<span id="cb43-31"><a href="#cb43-31"></a><span class="co">## create a new one</span></span>
<span id="cb43-32"><a href="#cb43-32"></a>sc <span class="op">=</span> SparkContext.getOrCreate(conf<span class="op">=</span>conf)</span>
<span id="cb43-33"><a href="#cb43-33"></a><span class="in">```</span></span>
<span id="cb43-34"><a href="#cb43-34"></a>:::</span>
<span id="cb43-35"><a href="#cb43-35"></a></span>
<span id="cb43-36"><a href="#cb43-36"></a><span class="fu">## RDD basics</span></span>
<span id="cb43-37"><a href="#cb43-37"></a>A Spark RDD is an immutable distributed collection of objects. Each RDD is split in partitions, allowing to parallelize the code based on RDDs (i.e., code is executed on each partition in isolation).</span>
<span id="cb43-38"><a href="#cb43-38"></a></span>
<span id="cb43-39"><a href="#cb43-39"></a>RDDs can contain any type of Scala, Java, and Python objects, including user-defined classes.</span>
<span id="cb43-40"><a href="#cb43-40"></a></span>
<span id="cb43-41"><a href="#cb43-41"></a><span class="fu">## RDD: create and save</span></span>
<span id="cb43-42"><a href="#cb43-42"></a>RDDs can be created</span>
<span id="cb43-43"><a href="#cb43-43"></a></span>
<span id="cb43-44"><a href="#cb43-44"></a><span class="ss">- </span>By loading an external dataset (e.g., the content of a folder, a single file, a database table)</span>
<span id="cb43-45"><a href="#cb43-45"></a><span class="ss">- </span>By parallelizing a local collection of objects created in the Driver (e.g., a Java collection)</span>
<span id="cb43-46"><a href="#cb43-46"></a></span>
<span id="cb43-47"><a href="#cb43-47"></a><span class="fu">### Create RDDs from files</span></span>
<span id="cb43-48"><a href="#cb43-48"></a>To built an RDD from **an input textual file**, use the <span class="in">`textFile(name)`</span> method of the <span class="in">`SparkContext`</span> class. </span>
<span id="cb43-49"><a href="#cb43-49"></a></span>
<span id="cb43-50"><a href="#cb43-50"></a><span class="ss">- </span>The returned RDD is an RDD of Strings associated with the content of the name textual file;</span>
<span id="cb43-51"><a href="#cb43-51"></a><span class="ss">- </span>Each line of the input file is associated with an object (a string) of the instantiated RDD;</span>
<span id="cb43-52"><a href="#cb43-52"></a><span class="ss">- </span>By default, if the input file is an HDFS file the number of partitions of the created RDD is equal to the number of HDFS blocks used to store the file, in order to support data locality.</span>
<span id="cb43-53"><a href="#cb43-53"></a></span>
<span id="cb43-54"><a href="#cb43-54"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-55"><a href="#cb43-55"></a><span class="fu">### Example</span></span>
<span id="cb43-56"><a href="#cb43-56"></a><span class="in">```python</span></span>
<span id="cb43-57"><a href="#cb43-57"></a><span class="co">## Build an RDD of strings from the input textual file</span></span>
<span id="cb43-58"><a href="#cb43-58"></a><span class="co">## myfile.txt</span></span>
<span id="cb43-59"><a href="#cb43-59"></a><span class="co">## Each element of the RDD is a line of the input file</span></span>
<span id="cb43-60"><a href="#cb43-60"></a>inputFile <span class="op">=</span> <span class="st">"myfile.txt"</span></span>
<span id="cb43-61"><a href="#cb43-61"></a>lines <span class="op">=</span> sc.textFile(inputFile)</span>
<span id="cb43-62"><a href="#cb43-62"></a><span class="in">```</span></span>
<span id="cb43-63"><a href="#cb43-63"></a></span>
<span id="cb43-64"><a href="#cb43-64"></a>Notice that no computation occurs when <span class="in">`sc.textFile()`</span> is invoked: Spark only records how to create the RDD, and the data is lazily read from the input file only when the data is needed (i.e., when an action is applied on lines, or on one of its "descendant" RDDs).</span>
<span id="cb43-65"><a href="#cb43-65"></a>:::</span>
<span id="cb43-66"><a href="#cb43-66"></a></span>
<span id="cb43-67"><a href="#cb43-67"></a>To build an RDD from a **folder containing textual files**, use the <span class="in">`textFile(name)`</span> method of the <span class="in">`SparkContext`</span> class.</span>
<span id="cb43-68"><a href="#cb43-68"></a></span>
<span id="cb43-69"><a href="#cb43-69"></a><span class="ss">- </span>If name is the path of a folder all files inside that folder are considered;</span>
<span id="cb43-70"><a href="#cb43-70"></a><span class="ss">- </span>The returned RDD contains one string for each line of the files contained on the name folder.</span>
<span id="cb43-71"><a href="#cb43-71"></a></span>
<span id="cb43-72"><a href="#cb43-72"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-73"><a href="#cb43-73"></a><span class="fu">### Example</span></span>
<span id="cb43-74"><a href="#cb43-74"></a><span class="in">```python</span></span>
<span id="cb43-75"><a href="#cb43-75"></a><span class="co">## Build an RDD of strings from all the files stored in</span></span>
<span id="cb43-76"><a href="#cb43-76"></a><span class="co">## myfolder</span></span>
<span id="cb43-77"><a href="#cb43-77"></a><span class="co">## Each element of the RDD is a line of the input files</span></span>
<span id="cb43-78"><a href="#cb43-78"></a>inputFolder <span class="op">=</span> <span class="st">"myfolder/"</span></span>
<span id="cb43-79"><a href="#cb43-79"></a>lines <span class="op">=</span> sc.textFile(inputFolder)</span>
<span id="cb43-80"><a href="#cb43-80"></a><span class="in">```</span></span>
<span id="cb43-81"><a href="#cb43-81"></a></span>
<span id="cb43-82"><a href="#cb43-82"></a>Notice that all files inside myfolder are considered, also those without suffix or with a suffix different from ".txt".</span>
<span id="cb43-83"><a href="#cb43-83"></a>:::</span>
<span id="cb43-84"><a href="#cb43-84"></a></span>
<span id="cb43-85"><a href="#cb43-85"></a>To set the (minimum) **number of partitions**, use the <span class="in">`textFile(name, minPartitions)`</span> method of the <span class="in">`SparkContext`</span> class.</span>
<span id="cb43-86"><a href="#cb43-86"></a></span>
<span id="cb43-87"><a href="#cb43-87"></a><span class="ss">- </span>This option can be used to increase the parallelization of the submitted application;</span>
<span id="cb43-88"><a href="#cb43-88"></a><span class="ss">- </span>For the HDFS files, the number of partitions <span class="in">`minPartitions`</span> must be greater than the number of blocks/chunks.</span>
<span id="cb43-89"><a href="#cb43-89"></a></span>
<span id="cb43-90"><a href="#cb43-90"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-91"><a href="#cb43-91"></a><span class="fu">### Example</span></span>
<span id="cb43-92"><a href="#cb43-92"></a><span class="in">```python</span></span>
<span id="cb43-93"><a href="#cb43-93"></a><span class="co">## Build an RDD of strings from the input textual file</span></span>
<span id="cb43-94"><a href="#cb43-94"></a><span class="co">## myfile.txt</span></span>
<span id="cb43-95"><a href="#cb43-95"></a><span class="co">## The number of partitions is manually set to 4</span></span>
<span id="cb43-96"><a href="#cb43-96"></a><span class="co">## Each element of the RDD is a line of the input file</span></span>
<span id="cb43-97"><a href="#cb43-97"></a>inputFile <span class="op">=</span> <span class="st">"myfile.txt“</span></span>
<span id="cb43-98"><a href="#cb43-98"></a><span class="er">lines = sc.textFile</span>(inputFile, <span class="dv">4</span>)</span>
<span id="cb43-99"><a href="#cb43-99"></a>```</span>
<span id="cb43-100"><a href="#cb43-100"></a>:::</span>
<span id="cb43-101"><a href="#cb43-101"></a></span>
<span id="cb43-102"><a href="#cb43-102"></a><span class="co">### Create RDDs from a local Python collection</span></span>
<span id="cb43-103"><a href="#cb43-103"></a>An RDD can be built <span class="im">from</span> a local Python collection<span class="op">/</span><span class="bu">list</span> of local python objects using the `parallelize(c)` method of the `SparkContext` <span class="kw">class</span></span>
<span id="cb43-104"><a href="#cb43-104"></a></span>
<span id="cb43-105"><a href="#cb43-105"></a><span class="op">-</span> The created RDD <span class="kw">is</span> an RDD of objects of the same <span class="bu">type</span> of objects of the <span class="bu">input</span> python collection `c`</span>
<span id="cb43-106"><a href="#cb43-106"></a><span class="op">-</span> In the created RDD, there <span class="kw">is</span> one <span class="bu">object</span> <span class="cf">for</span> each element of the <span class="bu">input</span> collection</span>
<span id="cb43-107"><a href="#cb43-107"></a><span class="op">-</span> Spark tries to <span class="bu">set</span> the number of partitions automatically based on your cluster<span class="st">'s characteristics</span></span>
<span id="cb43-108"><a href="#cb43-108"></a></span>
<span id="cb43-109"><a href="#cb43-109"></a><span class="er">:::{.callout-note collapse="true"}</span></span>
<span id="cb43-110"><a href="#cb43-110"></a><span class="co">### Example</span></span>
<span id="cb43-111"><a href="#cb43-111"></a>```python</span>
<span id="cb43-112"><a href="#cb43-112"></a><span class="co">## Create a local python list</span></span>
<span id="cb43-113"><a href="#cb43-113"></a>inputList <span class="op">=</span> [</span>
<span id="cb43-114"><a href="#cb43-114"></a>    <span class="st">'First element'</span>,</span>
<span id="cb43-115"><a href="#cb43-115"></a>    <span class="st">'Second element'</span>,</span>
<span id="cb43-116"><a href="#cb43-116"></a>    <span class="st">'Third element'</span></span>
<span id="cb43-117"><a href="#cb43-117"></a>]</span>
<span id="cb43-118"><a href="#cb43-118"></a></span>
<span id="cb43-119"><a href="#cb43-119"></a><span class="co">## Build an RDD of Strings from the local list.</span></span>
<span id="cb43-120"><a href="#cb43-120"></a><span class="co">## The number of partitions is set automatically by Spark</span></span>
<span id="cb43-121"><a href="#cb43-121"></a><span class="co">## There is one element of the RDD for each element</span></span>
<span id="cb43-122"><a href="#cb43-122"></a><span class="co">## of the local list</span></span>
<span id="cb43-123"><a href="#cb43-123"></a>distRDDList <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-124"><a href="#cb43-124"></a>```</span>
<span id="cb43-125"><a href="#cb43-125"></a></span>
<span id="cb43-126"><a href="#cb43-126"></a>Notice that no computation occurs when `sc.parallelize(c)` <span class="kw">is</span> invoked: Spark only records how to create the RDD, <span class="kw">and</span> the data <span class="kw">is</span> lazily read <span class="im">from</span> the <span class="bu">input</span> <span class="bu">file</span> only when the data <span class="kw">is</span> needed (i.e., when an action <span class="kw">is</span> applied on `distRDDlist`, <span class="kw">or</span> on one of its <span class="st">"descendant"</span> RDDs).</span>
<span id="cb43-127"><a href="#cb43-127"></a>:::</span>
<span id="cb43-128"><a href="#cb43-128"></a></span>
<span id="cb43-129"><a href="#cb43-129"></a>When the `parallelize(c)` <span class="kw">is</span> invoked, Spark tries to <span class="bu">set</span> the number of partitions automatically based on the cluster<span class="st">'s characteristics, but the developer can set the number of partition by using the method `parallelize(c, numSlices)` of the `SparkContext` class.</span></span>
<span id="cb43-130"><a href="#cb43-130"></a></span>
<span id="cb43-131"><a href="#cb43-131"></a><span class="er">:::{.callout-note collapse="true"}</span></span>
<span id="cb43-132"><a href="#cb43-132"></a><span class="co">### Example</span></span>
<span id="cb43-133"><a href="#cb43-133"></a>```python</span>
<span id="cb43-134"><a href="#cb43-134"></a><span class="co">## Create a local python list</span></span>
<span id="cb43-135"><a href="#cb43-135"></a>inputList <span class="op">=</span> [</span>
<span id="cb43-136"><a href="#cb43-136"></a>    <span class="st">'First element'</span>,</span>
<span id="cb43-137"><a href="#cb43-137"></a>    <span class="st">'Second element'</span>,</span>
<span id="cb43-138"><a href="#cb43-138"></a>    <span class="st">'Third element'</span></span>
<span id="cb43-139"><a href="#cb43-139"></a>]</span>
<span id="cb43-140"><a href="#cb43-140"></a></span>
<span id="cb43-141"><a href="#cb43-141"></a><span class="co">## Build an RDD of Strings from the local list.</span></span>
<span id="cb43-142"><a href="#cb43-142"></a><span class="co">## The number of partitions is set to 3</span></span>
<span id="cb43-143"><a href="#cb43-143"></a><span class="co">## There is one element of the RDD for each element</span></span>
<span id="cb43-144"><a href="#cb43-144"></a><span class="co">## of the local list</span></span>
<span id="cb43-145"><a href="#cb43-145"></a>distRDDList <span class="op">=</span> sc.parallelize(inputList, <span class="dv">3</span>)</span>
<span id="cb43-146"><a href="#cb43-146"></a>```</span>
<span id="cb43-147"><a href="#cb43-147"></a>:::</span>
<span id="cb43-148"><a href="#cb43-148"></a></span>
<span id="cb43-149"><a href="#cb43-149"></a><span class="co">### Save RDDs</span></span>
<span id="cb43-150"><a href="#cb43-150"></a>An RDD can be easily stored <span class="kw">in</span> textual (HDFS) files using the `saveAsTextFile(path)` method of the `RDD` <span class="kw">class</span></span>
<span id="cb43-151"><a href="#cb43-151"></a></span>
<span id="cb43-152"><a href="#cb43-152"></a><span class="op">-</span> `path` <span class="kw">is</span> the path of a folder</span>
<span id="cb43-153"><a href="#cb43-153"></a><span class="op">-</span> The method <span class="kw">is</span> invoked on the RDD to store <span class="kw">in</span> the output folder</span>
<span id="cb43-154"><a href="#cb43-154"></a><span class="op">-</span> Each <span class="bu">object</span> of the RDD on which the `saveAsTextFile` method <span class="kw">is</span> invoked <span class="kw">is</span> stored <span class="kw">in</span> one line of the output files stored <span class="kw">in</span> the output folder, <span class="kw">and</span> there <span class="kw">is</span> one output <span class="bu">file</span> <span class="cf">for</span> each partition of the <span class="bu">input</span> RDD.</span>
<span id="cb43-155"><a href="#cb43-155"></a></span>
<span id="cb43-156"><a href="#cb43-156"></a><span class="in">:::{.callout-note collapse="true"}</span></span>
<span id="cb43-157"><a href="#cb43-157"></a><span class="fu">### Example</span></span>
<span id="cb43-158"><a href="#cb43-158"></a><span class="in">```python</span></span>
<span id="cb43-159"><a href="#cb43-159"></a><span class="co">## Store the content of linesRDD in the output folder</span></span>
<span id="cb43-160"><a href="#cb43-160"></a><span class="co">## Each element of the RDD is stored in one line</span></span>
<span id="cb43-161"><a href="#cb43-161"></a><span class="co">## of the textual files of the output folder</span></span>
<span id="cb43-162"><a href="#cb43-162"></a>outputPath<span class="op">=</span><span class="st">"risFolder/"</span></span>
<span id="cb43-163"><a href="#cb43-163"></a>linesRDD.saveAsTextFile(outputPath)</span>
<span id="cb43-164"><a href="#cb43-164"></a><span class="in">```</span></span>
<span id="cb43-165"><a href="#cb43-165"></a></span>
<span id="cb43-166"><a href="#cb43-166"></a>Notice that <span class="in">`saveAsTextFile()`</span> is an action, hence Spark computes the content associated with <span class="in">`linesRDD`</span> when <span class="in">`saveAsTextFile()`</span> is invoked. Spark computes the content of an RDD only when that content is needed.</span>
<span id="cb43-167"><a href="#cb43-167"></a></span>
<span id="cb43-168"><a href="#cb43-168"></a>Moreover, notice that the output folder contains one textual file for each partition of <span class="in">`linesRDD`</span>, such that each output file contains the elements of one partition.</span>
<span id="cb43-169"><a href="#cb43-169"></a>:::</span>
<span id="cb43-170"><a href="#cb43-170"></a></span>
<span id="cb43-171"><a href="#cb43-171"></a><span class="fu">### Retrieve the content of RDDs and store it local Python variables</span></span>
<span id="cb43-172"><a href="#cb43-172"></a>The content of an RDD can be retrieved from the nodes of the cluster and stored in a local python variable of the Driver using the <span class="in">`collect()`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb43-173"><a href="#cb43-173"></a></span>
<span id="cb43-174"><a href="#cb43-174"></a>The <span class="in">`collect()`</span> method of the <span class="in">`RDD`</span> class is invoked on the RDD to retrieve. It returns a local python list of objects containing the same objects of the considered RDD. </span>
<span id="cb43-175"><a href="#cb43-175"></a></span>
<span id="cb43-176"><a href="#cb43-176"></a>:::{.callout-warning}</span>
<span id="cb43-177"><a href="#cb43-177"></a>Pay attention to the size of the RDD: large RDDs cannot be stored in a local variable of the Driver.</span>
<span id="cb43-178"><a href="#cb43-178"></a>:::</span>
<span id="cb43-179"><a href="#cb43-179"></a></span>
<span id="cb43-180"><a href="#cb43-180"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-181"><a href="#cb43-181"></a><span class="fu">### Example</span></span>
<span id="cb43-182"><a href="#cb43-182"></a><span class="in">```python</span></span>
<span id="cb43-183"><a href="#cb43-183"></a><span class="co">## Retrieve the content of the linesRDD and store it</span></span>
<span id="cb43-184"><a href="#cb43-184"></a><span class="co">## in a local python list</span></span>
<span id="cb43-185"><a href="#cb43-185"></a><span class="co">## The local python list contains a copy of each</span></span>
<span id="cb43-186"><a href="#cb43-186"></a><span class="co">## element of linesRDD</span></span>
<span id="cb43-187"><a href="#cb43-187"></a>contentOfLines<span class="op">=</span>linesRDD.collect()</span>
<span id="cb43-188"><a href="#cb43-188"></a><span class="in">```</span></span>
<span id="cb43-189"><a href="#cb43-189"></a></span>
<span id="cb43-190"><a href="#cb43-190"></a>| | |</span>
<span id="cb43-191"><a href="#cb43-191"></a>|---|---|</span>
<span id="cb43-192"><a href="#cb43-192"></a>| <span class="in">`contentOfLines`</span> | Local python variable: it is allocated in the main memory of the Driver process/task |</span>
<span id="cb43-193"><a href="#cb43-193"></a>| <span class="in">`linesRDD`</span> | RDD of strings: it is distributed across the nodes of the cluster |</span>
<span id="cb43-194"><a href="#cb43-194"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">20,80</span><span class="co">]</span>"}</span>
<span id="cb43-195"><a href="#cb43-195"></a>:::</span>
<span id="cb43-196"><a href="#cb43-196"></a></span>
<span id="cb43-197"><a href="#cb43-197"></a><span class="fu">## Transformations and Actions</span></span>
<span id="cb43-198"><a href="#cb43-198"></a>RDD support two types of operations</span>
<span id="cb43-199"><a href="#cb43-199"></a></span>
<span id="cb43-200"><a href="#cb43-200"></a><span class="ss">- </span>Transformations</span>
<span id="cb43-201"><a href="#cb43-201"></a><span class="ss">- </span>Actions</span>
<span id="cb43-202"><a href="#cb43-202"></a></span>
<span id="cb43-203"><a href="#cb43-203"></a><span class="fu">### Transformations</span></span>
<span id="cb43-204"><a href="#cb43-204"></a>Transformations are operations on RDDs that **return a new RDD**. This type of operation apply a transformation on the elements of the input RDD(s) and the result of the transformation is stored in/associated with a new RDD. </span>
<span id="cb43-205"><a href="#cb43-205"></a></span>
<span id="cb43-206"><a href="#cb43-206"></a>Remember that RDDs are immutable, hence the content of an already existing RDD cannot be changed, and it only possible to applied a transformation on the content of an RDD and then store/assign the result in/to a new RDD.</span>
<span id="cb43-207"><a href="#cb43-207"></a></span>
<span id="cb43-208"><a href="#cb43-208"></a>Transformations are computed **lazily**, which means that transformations are computed (executed) only when an action is applied on the RDDs generated by the transformation operations. When a transformation is invoked, Spark keeps only track of the dependency between the input RDD and the new RDD returned by the transformation, and the content of the new RDD is not computed.</span>
<span id="cb43-209"><a href="#cb43-209"></a></span>
<span id="cb43-210"><a href="#cb43-210"></a>The graph of dependencies between RDDs represents the information about which RDDs are used to create a new RDD. This is called **lineage graph**, and it is represented as a **DAG** **(Directed Acyclic Graph)**: it is needed to compute the content of an RDD the first time an action is invoked on it, or to compute again the content of an RDD (or some of its partitions) when failures occur.</span>
<span id="cb43-211"><a href="#cb43-211"></a></span>
<span id="cb43-212"><a href="#cb43-212"></a>The lineage graph is also useful for **optimization** purposes: when the content of an RDD is needed, Spark can consider the chain of transformations that are applied to compute the content of the needed RDD and potentially decide how to execute the chain of transformations. In this way, Spark can potentially change the order of some transformations or merge some of them based on its optimization engine.</span>
<span id="cb43-213"><a href="#cb43-213"></a></span>
<span id="cb43-214"><a href="#cb43-214"></a><span class="fu">### Actions</span></span>
<span id="cb43-215"><a href="#cb43-215"></a>Actions are operations that </span>
<span id="cb43-216"><a href="#cb43-216"></a></span>
<span id="cb43-217"><a href="#cb43-217"></a><span class="ss">- </span>return **results to the Driver program** (i.e., return local python variables). Pay attention to the size of the returned results because they must be stored in the main memory of the Driver program.</span>
<span id="cb43-218"><a href="#cb43-218"></a><span class="ss">- </span>write the result in the storage (output file/folder). The size of the result can be large in this case since it is directly stored in the (distributed) file system.</span>
<span id="cb43-219"><a href="#cb43-219"></a></span>
<span id="cb43-220"><a href="#cb43-220"></a><span class="fu">#### Example of lineage graph (DAG)</span></span>
<span id="cb43-221"><a href="#cb43-221"></a>Consider the following code</span>
<span id="cb43-222"><a href="#cb43-222"></a></span>
<span id="cb43-223"><a href="#cb43-223"></a><span class="in">```python</span></span>
<span id="cb43-224"><a href="#cb43-224"></a><span class="im">from</span> pyspark <span class="im">import</span> SparkConf, SparkContext</span>
<span id="cb43-225"><a href="#cb43-225"></a><span class="im">import</span> sys</span>
<span id="cb43-226"><a href="#cb43-226"></a></span>
<span id="cb43-227"><a href="#cb43-227"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb43-228"><a href="#cb43-228"></a>conf <span class="op">=</span> SparkConf().setAppName(<span class="st">"Spark Application"</span>)</span>
<span id="cb43-229"><a href="#cb43-229"></a>sc <span class="op">=</span> SparkContext(conf<span class="op">=</span>conf)</span>
<span id="cb43-230"><a href="#cb43-230"></a></span>
<span id="cb43-231"><a href="#cb43-231"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb43-232"><a href="#cb43-232"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb43-233"><a href="#cb43-233"></a></span>
<span id="cb43-234"><a href="#cb43-234"></a><span class="co">## Select the rows containing the word "error"</span></span>
<span id="cb43-235"><a href="#cb43-235"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> line: line.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span>)</span>
<span id="cb43-236"><a href="#cb43-236"></a></span>
<span id="cb43-237"><a href="#cb43-237"></a><span class="co">## Select the rows containing the word "warning"</span></span>
<span id="cb43-238"><a href="#cb43-238"></a>warningRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> line: line.find(<span class="st">'warning'</span>)<span class="op">&gt;=</span><span class="dv">0</span>)</span>
<span id="cb43-239"><a href="#cb43-239"></a></span>
<span id="cb43-240"><a href="#cb43-240"></a><span class="co">## Union of errorsRDD and warningRDD</span></span>
<span id="cb43-241"><a href="#cb43-241"></a><span class="co">## The result is associated with a new RDD: badLinesRDD</span></span>
<span id="cb43-242"><a href="#cb43-242"></a>badLinesRDD <span class="op">=</span> errorsRDD.union(warningRDD)</span>
<span id="cb43-243"><a href="#cb43-243"></a></span>
<span id="cb43-244"><a href="#cb43-244"></a><span class="co">## Remove duplicates lines (i.e., those lines containing</span></span>
<span id="cb43-245"><a href="#cb43-245"></a><span class="co">## both "error" and "warning")</span></span>
<span id="cb43-246"><a href="#cb43-246"></a>uniqueBadLinesRDD <span class="op">=</span> badLinesRDD.distinct()</span>
<span id="cb43-247"><a href="#cb43-247"></a></span>
<span id="cb43-248"><a href="#cb43-248"></a><span class="co">## Count the number of bad lines by applying</span></span>
<span id="cb43-249"><a href="#cb43-249"></a><span class="co">## the count() action</span></span>
<span id="cb43-250"><a href="#cb43-250"></a>numBadLines <span class="op">=</span> uniqueBadLinesRDD.count()</span>
<span id="cb43-251"><a href="#cb43-251"></a></span>
<span id="cb43-252"><a href="#cb43-252"></a><span class="co">## Print the result on the standard output of the driver</span></span>
<span id="cb43-253"><a href="#cb43-253"></a><span class="bu">print</span>(<span class="st">"Lines with problems:"</span>, numBadLines)</span>
<span id="cb43-254"><a href="#cb43-254"></a><span class="in">```</span></span>
<span id="cb43-255"><a href="#cb43-255"></a></span>
<span id="cb43-256"><a href="#cb43-256"></a><span class="al">![Visual representation of the DAG](images/11_rdd_based_programming/dag_example.png)</span>{width=80%}</span>
<span id="cb43-257"><a href="#cb43-257"></a></span>
<span id="cb43-258"><a href="#cb43-258"></a>Notice that:</span>
<span id="cb43-259"><a href="#cb43-259"></a></span>
<span id="cb43-260"><a href="#cb43-260"></a><span class="ss">- </span>The application reads the input log file only when the <span class="in">`count()`</span> action is invoked: this is the first action of the program;</span>
<span id="cb43-261"><a href="#cb43-261"></a><span class="ss">- </span><span class="in">`filter()`</span>, <span class="in">`union()`</span>, and <span class="in">`distinct()`</span> are transformations, so they are computed lazily;</span>
<span id="cb43-262"><a href="#cb43-262"></a><span class="ss">- </span>Also <span class="in">`textFile()`</span> is computed lazily, however it is not a transformation because it is not applied on an RDD.</span>
<span id="cb43-263"><a href="#cb43-263"></a></span>
<span id="cb43-264"><a href="#cb43-264"></a>Spark, similarly to an SQL optimizer, can potentially optimize the execution of some transformations; for instance, in this case the two filters + union + distinct can be potentially optimized and transformed in one single filter applying the constraint (i.e. The element contains the string "error" or "warning"). This optimization improves the efficiency of the application, but Spark can performs this kind of optimizations only on particular types of RDDs: Datasets and DataFrames.</span>
<span id="cb43-265"><a href="#cb43-265"></a></span>
<span id="cb43-266"><a href="#cb43-266"></a><span class="fu">## Passing functions to Transformations and Actions</span></span>
<span id="cb43-267"><a href="#cb43-267"></a>Many transformations (and some actions) are based on user provided functions that specify which transformation function must be applied on the elements of the input RDD. For example, the <span class="in">`filter()`</span> transformation selects the elements of an RDD satisfying a user specified constraint, which is a Boolean function applied on each element of the input RDD.</span>
<span id="cb43-268"><a href="#cb43-268"></a></span>
<span id="cb43-269"><a href="#cb43-269"></a>Each language has its own solution to pass functions to Spark's transformations and actions. In Python, it is possible to use</span>
<span id="cb43-270"><a href="#cb43-270"></a></span>
<span id="cb43-271"><a href="#cb43-271"></a><span class="ss">- </span>Lambda functions/expressions: simple functions that can be written as one single expression</span>
<span id="cb43-272"><a href="#cb43-272"></a><span class="ss">- </span>Local user defined functions (local defs): used for multi-statement functions or statements that do not return a value</span>
<span id="cb43-273"><a href="#cb43-273"></a></span>
<span id="cb43-274"><a href="#cb43-274"></a><span class="fu">### Example based on the filter transformation</span></span>
<span id="cb43-275"><a href="#cb43-275"></a><span class="ss">1. </span>Create an RDD from a log file;</span>
<span id="cb43-276"><a href="#cb43-276"></a><span class="ss">2. </span>Create a new RDD containing only the lines of the log file containing the word "error". The <span class="in">`filter()`</span> transformation applies the filter constraint on each element of the input RDD; the filter constraint is specified by means of a Boolean function that returns true for the elements satisfying the constraint and false for the others.</span>
<span id="cb43-277"><a href="#cb43-277"></a></span>
<span id="cb43-278"><a href="#cb43-278"></a><span class="fu">#### Solution based on lambda expressions (`lambda`)</span></span>
<span id="cb43-279"><a href="#cb43-279"></a><span class="in">```python</span></span>
<span id="cb43-280"><a href="#cb43-280"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb43-281"><a href="#cb43-281"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb43-282"><a href="#cb43-282"></a></span>
<span id="cb43-283"><a href="#cb43-283"></a><span class="co">## Select the rows containing the word "error"</span></span>
<span id="cb43-284"><a href="#cb43-284"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> l: l.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span>)</span>
<span id="cb43-285"><a href="#cb43-285"></a><span class="in">```</span></span>
<span id="cb43-286"><a href="#cb43-286"></a></span>
<span id="cb43-287"><a href="#cb43-287"></a>| | |</span>
<span id="cb43-288"><a href="#cb43-288"></a>|-|---|</span>
<span id="cb43-289"><a href="#cb43-289"></a>| <span class="in">`lambda l: l.find('error')&gt;=0`</span> | This part of the code, which is based on a lambda expression, defines on the fly the function to apply. This part of the code is applied on each object of <span class="in">`inputRDD`</span>: if it returns true then the current object is "stored" in the new <span class="in">`errorsRDD`</span> RDD, otherwise the input object is discarded. |</span>
<span id="cb43-290"><a href="#cb43-290"></a></span>
<span id="cb43-291"><a href="#cb43-291"></a><span class="fu">#### Solution based on function (`def`)</span></span>
<span id="cb43-292"><a href="#cb43-292"></a><span class="in">```python</span></span>
<span id="cb43-293"><a href="#cb43-293"></a><span class="co">## Define the content of the Boolean function that is applied</span></span>
<span id="cb43-294"><a href="#cb43-294"></a><span class="co">## to select the elements of interest</span></span>
<span id="cb43-295"><a href="#cb43-295"></a><span class="kw">def</span> myFunction(l):</span>
<span id="cb43-296"><a href="#cb43-296"></a>    <span class="cf">if</span> l.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span>: <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb43-297"><a href="#cb43-297"></a>    <span class="cf">else</span>: <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb43-298"><a href="#cb43-298"></a></span>
<span id="cb43-299"><a href="#cb43-299"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb43-300"><a href="#cb43-300"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb43-301"><a href="#cb43-301"></a></span>
<span id="cb43-302"><a href="#cb43-302"></a><span class="co">## Select the rows containing the word “error”</span></span>
<span id="cb43-303"><a href="#cb43-303"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(myFunction)</span>
<span id="cb43-304"><a href="#cb43-304"></a><span class="in">```</span></span>
<span id="cb43-305"><a href="#cb43-305"></a></span>
<span id="cb43-306"><a href="#cb43-306"></a>| | |</span>
<span id="cb43-307"><a href="#cb43-307"></a>|-|---|</span>
<span id="cb43-308"><a href="#cb43-308"></a>| <span class="in">`def myFunction(l):`</span> | When it is invoked, this function analyses the value of the parameter line and returns True if the string line contains the substring "error". Otherwise, it returns False. |</span>
<span id="cb43-309"><a href="#cb43-309"></a>| <span class="in">`.filter(myFunction)`</span> | For each object <span class="in">`o`</span> in <span class="in">`inputRDD`</span>, the <span class="in">`myFunction`</span> function is automatically invoked. If <span class="in">`myFunction`</span> returns True, then <span class="in">`o`</span> is stored in the new RDD <span class="in">`errorsRDD`</span>. Otherwise, <span class="in">`o`</span> is discarded. |</span>
<span id="cb43-310"><a href="#cb43-310"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">20,80</span><span class="co">]</span>"}</span>
<span id="cb43-311"><a href="#cb43-311"></a></span>
<span id="cb43-312"><a href="#cb43-312"></a><span class="fu">#### Solution based on function (`def`)</span></span>
<span id="cb43-313"><a href="#cb43-313"></a><span class="in">```python</span></span>
<span id="cb43-314"><a href="#cb43-314"></a><span class="co">## Define the content of the Boolean function that is applied</span></span>
<span id="cb43-315"><a href="#cb43-315"></a><span class="co">## to select the elements of interest</span></span>
<span id="cb43-316"><a href="#cb43-316"></a><span class="kw">def</span> myFunction(l):</span>
<span id="cb43-317"><a href="#cb43-317"></a>    <span class="cf">return</span> l.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span></span>
<span id="cb43-318"><a href="#cb43-318"></a></span>
<span id="cb43-319"><a href="#cb43-319"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb43-320"><a href="#cb43-320"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb43-321"><a href="#cb43-321"></a></span>
<span id="cb43-322"><a href="#cb43-322"></a><span class="co">## Select the rows containing the word “error”</span></span>
<span id="cb43-323"><a href="#cb43-323"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(myFunction)</span>
<span id="cb43-324"><a href="#cb43-324"></a><span class="in">```</span></span>
<span id="cb43-325"><a href="#cb43-325"></a>| | |</span>
<span id="cb43-326"><a href="#cb43-326"></a>|---|---|</span>
<span id="cb43-327"><a href="#cb43-327"></a>| <span class="in">`return l.find('error')&gt;=0`</span> | This part of the code is the same used in the lambda-based solution. |</span>
<span id="cb43-328"><a href="#cb43-328"></a>| <span class="in">`.filter(myFunction)`</span> | For each object <span class="in">`o`</span> in <span class="in">`inputRDD`</span>, the <span class="in">`myFunction`</span> function is automatically invoked. If <span class="in">`myFunction`</span> returns True, then <span class="in">`o`</span> is stored in the new RDD <span class="in">`errorsRDD`</span>. Otherwise, <span class="in">`o`</span> is discarded. |</span>
<span id="cb43-329"><a href="#cb43-329"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">20,80</span><span class="co">]</span>"}</span>
<span id="cb43-330"><a href="#cb43-330"></a></span>
<span id="cb43-331"><a href="#cb43-331"></a><span class="fu">#### Solution comparison</span></span>
<span id="cb43-332"><a href="#cb43-332"></a>The two solutions are more or less equivalent in terms of efficiency</span>
<span id="cb43-333"><a href="#cb43-333"></a></span>
<span id="cb43-334"><a href="#cb43-334"></a>| Lambda function-based code (<span class="in">`lambda`</span>) | Local user defined functions (local <span class="in">`def`</span>) |</span>
<span id="cb43-335"><a href="#cb43-335"></a>|---|---|</span>
<span id="cb43-336"><a href="#cb43-336"></a>| More concise | Less concise |</span>
<span id="cb43-337"><a href="#cb43-337"></a>| More readable | Less readable |</span>
<span id="cb43-338"><a href="#cb43-338"></a>| Multi-statement functions or statements that do not return a value are not supported | Multi-statement functions or statements that do not return a value are supported |</span>
<span id="cb43-339"><a href="#cb43-339"></a>| Code cannot be reused | Code can be reused (some functions are used in several applications) |</span>
<span id="cb43-340"><a href="#cb43-340"></a></span>
<span id="cb43-341"><a href="#cb43-341"></a><span class="fu">## Basic Transformations</span></span>
<span id="cb43-342"><a href="#cb43-342"></a><span class="ss">- </span>Some basic transformations analyze the content of one single RDD and return a new RDD (e.g., <span class="in">`filter()`</span>, <span class="in">`map()`</span>, <span class="in">`flatMap()`</span>, <span class="in">`distinct()`</span>, <span class="in">`sample()`</span>)</span>
<span id="cb43-343"><a href="#cb43-343"></a><span class="ss">- </span>Some other transformations analyze the content of two (input) RDDs and return a new RDD (e.g., <span class="in">`union()`</span>, <span class="in">`intersection()`</span>, <span class="in">`substract()`</span>, <span class="in">`cartesian()`</span>)</span>
<span id="cb43-344"><a href="#cb43-344"></a></span>
<span id="cb43-345"><a href="#cb43-345"></a><span class="fu">### Single input RDD transformations</span></span>
<span id="cb43-346"><a href="#cb43-346"></a></span>
<span id="cb43-347"><a href="#cb43-347"></a><span class="fu">#### Filter transformation</span></span>
<span id="cb43-348"><a href="#cb43-348"></a>The filter transformation is applied on one single RDD and returns a new RDD containing only the elements of the input RDD that satisfy a user specified condition.</span>
<span id="cb43-349"><a href="#cb43-349"></a></span>
<span id="cb43-350"><a href="#cb43-350"></a>The filter transformation is based on the <span class="in">`filter(f)`</span> method of the <span class="in">`RDD`</span> class: a function <span class="in">`f`</span> returning a Boolean value is passed to the <span class="in">`filter`</span> method, where <span class="in">`f`</span> contains the code associated with the condition that we want to apply on each element <span class="in">`e`</span> of the input RDD. If the condition is satisfied then the call method returns true and the input element <span class="in">`e`</span> is selected, otherwise, it returns false and the <span class="in">`e`</span> element is discarded.</span>
<span id="cb43-351"><a href="#cb43-351"></a></span>
<span id="cb43-352"><a href="#cb43-352"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-353"><a href="#cb43-353"></a><span class="fu">### Example 1</span></span>
<span id="cb43-354"><a href="#cb43-354"></a><span class="ss">1. </span>Create an RDD from a log file;</span>
<span id="cb43-355"><a href="#cb43-355"></a><span class="ss">2. </span>Create a new RDD containing only the lines of the log file containing the word "error".</span>
<span id="cb43-356"><a href="#cb43-356"></a></span>
<span id="cb43-357"><a href="#cb43-357"></a><span class="in">```python</span></span>
<span id="cb43-358"><a href="#cb43-358"></a><span class="co">## Read the content of a log file</span></span>
<span id="cb43-359"><a href="#cb43-359"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"log.txt"</span>)</span>
<span id="cb43-360"><a href="#cb43-360"></a></span>
<span id="cb43-361"><a href="#cb43-361"></a><span class="co">## Select the rows containing the word “error”</span></span>
<span id="cb43-362"><a href="#cb43-362"></a>errorsRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> e: e.find(<span class="st">'error'</span>)<span class="op">&gt;=</span><span class="dv">0</span>)</span>
<span id="cb43-363"><a href="#cb43-363"></a><span class="in">```</span></span>
<span id="cb43-364"><a href="#cb43-364"></a></span>
<span id="cb43-365"><a href="#cb43-365"></a>Notice that, in this case, the input RDD contains strings, hence, the implemented lambda function is applied on one string at a time and returns a Boolean value.</span>
<span id="cb43-366"><a href="#cb43-366"></a>:::</span>
<span id="cb43-367"><a href="#cb43-367"></a></span>
<span id="cb43-368"><a href="#cb43-368"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-369"><a href="#cb43-369"></a><span class="fu">### Example 2</span></span>
<span id="cb43-370"><a href="#cb43-370"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1, 2, 3, 3]`</span>;</span>
<span id="cb43-371"><a href="#cb43-371"></a><span class="ss">2. </span>Create a new RDD containing only the values greater than <span class="in">`2`</span>.</span>
<span id="cb43-372"><a href="#cb43-372"></a></span>
<span id="cb43-373"><a href="#cb43-373"></a>**Using `lambda`**</span>
<span id="cb43-374"><a href="#cb43-374"></a><span class="in">```python</span></span>
<span id="cb43-375"><a href="#cb43-375"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-376"><a href="#cb43-376"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb43-377"><a href="#cb43-377"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-378"><a href="#cb43-378"></a></span>
<span id="cb43-379"><a href="#cb43-379"></a><span class="co">## Select the values greater than 2</span></span>
<span id="cb43-380"><a href="#cb43-380"></a>greaterRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(<span class="kw">lambda</span> num : num<span class="op">&gt;</span><span class="dv">2</span>)</span>
<span id="cb43-381"><a href="#cb43-381"></a><span class="in">```</span></span>
<span id="cb43-382"><a href="#cb43-382"></a></span>
<span id="cb43-383"><a href="#cb43-383"></a>Notice that the input RDD contains integers, hence, the implemented lambda function is applied on one integer at a time and returns a Boolean value.</span>
<span id="cb43-384"><a href="#cb43-384"></a></span>
<span id="cb43-385"><a href="#cb43-385"></a>**Using `def`**</span>
<span id="cb43-386"><a href="#cb43-386"></a><span class="in">```python</span></span>
<span id="cb43-387"><a href="#cb43-387"></a><span class="co">## Define the function to be applied in the filter transformation</span></span>
<span id="cb43-388"><a href="#cb43-388"></a><span class="kw">def</span> greaterThan2(num):</span>
<span id="cb43-389"><a href="#cb43-389"></a>    <span class="cf">return</span> num<span class="op">&gt;</span><span class="dv">2</span></span>
<span id="cb43-390"><a href="#cb43-390"></a></span>
<span id="cb43-391"><a href="#cb43-391"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-392"><a href="#cb43-392"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb43-393"><a href="#cb43-393"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-394"><a href="#cb43-394"></a></span>
<span id="cb43-395"><a href="#cb43-395"></a><span class="co">## Select the values greater than 2</span></span>
<span id="cb43-396"><a href="#cb43-396"></a>greaterRDD <span class="op">=</span> inputRDD.<span class="bu">filter</span>(greaterThan2)</span>
<span id="cb43-397"><a href="#cb43-397"></a><span class="in">```</span></span>
<span id="cb43-398"><a href="#cb43-398"></a></span>
<span id="cb43-399"><a href="#cb43-399"></a>In this case, the function to apply is defined using <span class="in">`def`</span> and then is passed to the filter transformation.</span>
<span id="cb43-400"><a href="#cb43-400"></a>:::</span>
<span id="cb43-401"><a href="#cb43-401"></a></span>
<span id="cb43-402"><a href="#cb43-402"></a><span class="fu">#### Map transformation</span></span>
<span id="cb43-403"><a href="#cb43-403"></a>The map transformation is used to create a new RDD by applying a function <span class="in">`f`</span> on each element of the input RDD: the new RDD contains exactly one element <span class="in">`y`</span> for each element <span class="in">`x`</span> of the input RDD, in particular the value of <span class="in">`y`</span> is obtained by applying a user defined function <span class="in">`f`</span> on <span class="in">`x`</span> (e.g., <span class="in">`y= f(x)`</span>). The data type of <span class="in">`y`</span> can be different from the data type of <span class="in">`x`</span>.</span>
<span id="cb43-404"><a href="#cb43-404"></a></span>
<span id="cb43-405"><a href="#cb43-405"></a>The map transformation is based on the RDD <span class="in">`map(f)`</span> method of the RDD class: a function <span class="in">`f`</span> implementing the transformation is passed to the <span class="in">`map`</span> method, where <span class="in">`f`</span> contains the code that is applied over each element of the input RDD to create the elements of the returned RDD. For each input element of the input RDD exactly one single new element is returned by <span class="in">`f`</span>.</span>
<span id="cb43-406"><a href="#cb43-406"></a></span>
<span id="cb43-407"><a href="#cb43-407"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-408"><a href="#cb43-408"></a><span class="fu">### Example 1</span></span>
<span id="cb43-409"><a href="#cb43-409"></a><span class="ss">1. </span>Create an RDD from a textual file containing the surnames of a list of users (each line of the file contains one surname);</span>
<span id="cb43-410"><a href="#cb43-410"></a><span class="ss">2. </span>Create a new RDD containing the length of each surname.</span>
<span id="cb43-411"><a href="#cb43-411"></a></span>
<span id="cb43-412"><a href="#cb43-412"></a><span class="in">```python</span></span>
<span id="cb43-413"><a href="#cb43-413"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb43-414"><a href="#cb43-414"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"usernames.txt"</span>)</span>
<span id="cb43-415"><a href="#cb43-415"></a></span>
<span id="cb43-416"><a href="#cb43-416"></a><span class="co">## Compute the lengths of the input surnames</span></span>
<span id="cb43-417"><a href="#cb43-417"></a>lenghtsRDD <span class="op">=</span> inputRDD.<span class="bu">map</span>(<span class="kw">lambda</span> line: <span class="bu">len</span>(line))</span>
<span id="cb43-418"><a href="#cb43-418"></a><span class="in">```</span></span>
<span id="cb43-419"><a href="#cb43-419"></a></span>
<span id="cb43-420"><a href="#cb43-420"></a>Notice that the input RDD is an RDD of strings, hence, also the input of the lambda function is a String. Instead, the new RDD is an RDD of Integers, since the lambda function returns a new Integer for each input element. </span>
<span id="cb43-421"><a href="#cb43-421"></a>:::</span>
<span id="cb43-422"><a href="#cb43-422"></a></span>
<span id="cb43-423"><a href="#cb43-423"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-424"><a href="#cb43-424"></a><span class="fu">### Example 2</span></span>
<span id="cb43-425"><a href="#cb43-425"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1, 2, 3, 3]`</span>;</span>
<span id="cb43-426"><a href="#cb43-426"></a><span class="ss">2. </span>Create a new RDD containing the square of each input element.</span>
<span id="cb43-427"><a href="#cb43-427"></a></span>
<span id="cb43-428"><a href="#cb43-428"></a><span class="in">```python</span></span>
<span id="cb43-429"><a href="#cb43-429"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-430"><a href="#cb43-430"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb43-431"><a href="#cb43-431"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-432"><a href="#cb43-432"></a></span>
<span id="cb43-433"><a href="#cb43-433"></a><span class="co">## Compute the square of each input element</span></span>
<span id="cb43-434"><a href="#cb43-434"></a>squaresRDD <span class="op">=</span> inputRDD.<span class="bu">map</span>(<span class="kw">lambda</span> element: element<span class="op">*</span>element)</span>
<span id="cb43-435"><a href="#cb43-435"></a><span class="in">```</span></span>
<span id="cb43-436"><a href="#cb43-436"></a>::: </span>
<span id="cb43-437"><a href="#cb43-437"></a></span>
<span id="cb43-438"><a href="#cb43-438"></a><span class="fu">#### FlatMap transformation</span></span>
<span id="cb43-439"><a href="#cb43-439"></a>The flatMap transformation is used to create a new RDD by applying a function <span class="in">`f`</span> on each element of the input RDD. The new RDD contains a list of elements obtained by applying <span class="in">`f`</span> on each element <span class="in">`x`</span> of the input RDD; in other words, the function <span class="in">`f`</span> applied on an element <span class="in">`x`</span> of the input RDD returns a list of values <span class="in">`[y]`</span> (e.g., <span class="in">`[y]= f(x)`</span>). <span class="in">`[y]`</span> can be the empty list.</span>
<span id="cb43-440"><a href="#cb43-440"></a></span>
<span id="cb43-441"><a href="#cb43-441"></a>The final result is the concatenation of the list of values obtained by applying <span class="in">`f`</span> over all the elements of the input RDD (i.e., the final RDD contains the concatenation of the lists obtained by applying <span class="in">`f`</span> over all the elements of the input RDD). </span>
<span id="cb43-442"><a href="#cb43-442"></a></span>
<span id="cb43-443"><a href="#cb43-443"></a>Notice that </span>
<span id="cb43-444"><a href="#cb43-444"></a></span>
<span id="cb43-445"><a href="#cb43-445"></a><span class="ss">- </span>duplicates are not removed</span>
<span id="cb43-446"><a href="#cb43-446"></a><span class="ss">- </span>the data type of <span class="in">`y`</span> can be different from the data type of <span class="in">`x`</span></span>
<span id="cb43-447"><a href="#cb43-447"></a></span>
<span id="cb43-448"><a href="#cb43-448"></a>The flatMap transformation is based on the <span class="in">`flatMap(f)`</span> method of the <span class="in">`RDD`</span> class</span>
<span id="cb43-449"><a href="#cb43-449"></a>A function <span class="in">`f`</span> implementing the transformation is passed to the <span class="in">`flatMap`</span> method, where <span class="in">`f`</span> contains the code that is applied on each element of the input RDD and returns a list of elements which will be included in the new returned RDD: for each element of the input RDD a list of new elements is returned by <span class="in">`f`</span>. The returned list can be empty.</span>
<span id="cb43-450"><a href="#cb43-450"></a></span>
<span id="cb43-451"><a href="#cb43-451"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-452"><a href="#cb43-452"></a><span class="fu">### Example</span></span>
<span id="cb43-453"><a href="#cb43-453"></a><span class="ss">1. </span>Create an RDD from a textual file containing a generic text (each line of the input file can contain many words);</span>
<span id="cb43-454"><a href="#cb43-454"></a><span class="ss">2. </span>Create a new RDD containing the list of words, with repetitions, occurring in the input textual document. In other words, each element of the returned RDD is one of the words occurring in the input textual file, and the words occurring multiple times in the input file appear multiple times, as distinct elements, also in the returned RDD.</span>
<span id="cb43-455"><a href="#cb43-455"></a></span>
<span id="cb43-456"><a href="#cb43-456"></a><span class="in">```python</span></span>
<span id="cb43-457"><a href="#cb43-457"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb43-458"><a href="#cb43-458"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"document.txt"</span>)</span>
<span id="cb43-459"><a href="#cb43-459"></a></span>
<span id="cb43-460"><a href="#cb43-460"></a><span class="co">## Compute/identify the list of words occurring in document.txt</span></span>
<span id="cb43-461"><a href="#cb43-461"></a>listOfWordsRDD <span class="op">=</span> inputRDD.flatMap(<span class="kw">lambda</span> l: l.split(<span class="st">' '</span>))</span>
<span id="cb43-462"><a href="#cb43-462"></a><span class="in">```</span></span>
<span id="cb43-463"><a href="#cb43-463"></a></span>
<span id="cb43-464"><a href="#cb43-464"></a>In this case the lambda function returns a "list" of values for each input element. However, notice that the new RDD (i.e., <span class="in">`listOfWordsRDD`</span>) contains the "concatenation" of the lists obtained by applying the lambda function over all the elements of <span class="in">`inputRDD`</span>: the new RDD is an RDD of strings and not an RDD of lists of strings.</span>
<span id="cb43-465"><a href="#cb43-465"></a>:::</span>
<span id="cb43-466"><a href="#cb43-466"></a></span>
<span id="cb43-467"><a href="#cb43-467"></a><span class="fu">#### Distinct information</span></span>
<span id="cb43-468"><a href="#cb43-468"></a>The distinct transformation is applied on one single RDD and returns a new RDD containing the list of distinct elements (values) of the input RDD.</span>
<span id="cb43-469"><a href="#cb43-469"></a></span>
<span id="cb43-470"><a href="#cb43-470"></a>The distinct transformation is based on the <span class="in">`distinct()`</span> method of the <span class="in">`RDD`</span> class, and no functions are needed in this case.</span>
<span id="cb43-471"><a href="#cb43-471"></a></span>
<span id="cb43-472"><a href="#cb43-472"></a>A shuffle operation is executed for computing the result of the distinct transformation, so that data from different input partitions gets be compared to remove duplicates. The shuffle operation is used to repartition the input data: all the repetitions of the same input element are associated with the same output partition (in which one single copy of the element is stored), and a hash function assigns each input element to one of the new partitions.</span>
<span id="cb43-473"><a href="#cb43-473"></a></span>
<span id="cb43-474"><a href="#cb43-474"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-475"><a href="#cb43-475"></a><span class="fu">### Example 1</span></span>
<span id="cb43-476"><a href="#cb43-476"></a><span class="ss">1. </span>Create an RDD from a textual file containing the names of a list of users (each line of the input file contains one name);</span>
<span id="cb43-477"><a href="#cb43-477"></a><span class="ss">2. </span>Create a new RDD containing the list of distinct names occurring in the input file. The type of the new RDD is the same of the input RDD. </span>
<span id="cb43-478"><a href="#cb43-478"></a></span>
<span id="cb43-479"><a href="#cb43-479"></a><span class="in">```python</span></span>
<span id="cb43-480"><a href="#cb43-480"></a><span class="co">## Read the content of a textual input file</span></span>
<span id="cb43-481"><a href="#cb43-481"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"names.txt"</span>)</span>
<span id="cb43-482"><a href="#cb43-482"></a></span>
<span id="cb43-483"><a href="#cb43-483"></a><span class="co">## Select the distinct names occurring in inputRDD</span></span>
<span id="cb43-484"><a href="#cb43-484"></a>distinctNamesRDD <span class="op">=</span> inputRDD.distinct()</span>
<span id="cb43-485"><a href="#cb43-485"></a><span class="in">```</span></span>
<span id="cb43-486"><a href="#cb43-486"></a>:::</span>
<span id="cb43-487"><a href="#cb43-487"></a></span>
<span id="cb43-488"><a href="#cb43-488"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-489"><a href="#cb43-489"></a><span class="fu">### Example 2</span></span>
<span id="cb43-490"><a href="#cb43-490"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1, 2, 3, 3]`</span>;</span>
<span id="cb43-491"><a href="#cb43-491"></a><span class="ss">2. </span>Create a new RDD containing only the distinct values appearing in the input RDD.</span>
<span id="cb43-492"><a href="#cb43-492"></a></span>
<span id="cb43-493"><a href="#cb43-493"></a><span class="in">```python</span></span>
<span id="cb43-494"><a href="#cb43-494"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-495"><a href="#cb43-495"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb43-496"><a href="#cb43-496"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-497"><a href="#cb43-497"></a></span>
<span id="cb43-498"><a href="#cb43-498"></a><span class="co">## Compute the set of distinct words occurring in inputRDD</span></span>
<span id="cb43-499"><a href="#cb43-499"></a>distinctIntRDD <span class="op">=</span> inputRDD.distinct()</span>
<span id="cb43-500"><a href="#cb43-500"></a><span class="in">```</span></span>
<span id="cb43-501"><a href="#cb43-501"></a>:::</span>
<span id="cb43-502"><a href="#cb43-502"></a></span>
<span id="cb43-503"><a href="#cb43-503"></a><span class="fu">#### SortBy transformation</span></span>
<span id="cb43-504"><a href="#cb43-504"></a>The sortBy transformation is applied on one RDD and returns a new RDD containing the same content of the input RDD sorted in ascending order.</span>
<span id="cb43-505"><a href="#cb43-505"></a></span>
<span id="cb43-506"><a href="#cb43-506"></a>The sortBy transformation is based on the <span class="in">`sortBy(keyfunc)`</span> method of the <span class="in">`RDD`</span> class: each element of the input RDD is initially mapped to a new value by applying the specified function <span class="in">`keyfunc`</span>, and then the input elements are sorted by considering the values returned by the invocation of <span class="in">`keyfunc`</span> on the input values.</span>
<span id="cb43-507"><a href="#cb43-507"></a></span>
<span id="cb43-508"><a href="#cb43-508"></a>The <span class="in">`sortBy(keyfunc, ascending)`</span> method of the <span class="in">`RDD`</span> class allows specifying if the values in the returned RDD are sorted in ascending or descending order by using the Boolean parameter <span class="in">`ascending`</span></span>
<span id="cb43-509"><a href="#cb43-509"></a></span>
<span id="cb43-510"><a href="#cb43-510"></a><span class="ss">- </span><span class="in">`ascending`</span> set to True means ascending order</span>
<span id="cb43-511"><a href="#cb43-511"></a><span class="ss">- </span><span class="in">`ascending`</span> set to False means descending order</span>
<span id="cb43-512"><a href="#cb43-512"></a></span>
<span id="cb43-513"><a href="#cb43-513"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-514"><a href="#cb43-514"></a><span class="fu">### Example 1</span></span>
<span id="cb43-515"><a href="#cb43-515"></a><span class="ss">1. </span>Create an RDD from a textual file containing the names of a list of users (each line of the input file contains one name);</span>
<span id="cb43-516"><a href="#cb43-516"></a><span class="ss">2. </span>Create a new RDD containing the list of users sorted by name (based on the alphabetic order).</span>
<span id="cb43-517"><a href="#cb43-517"></a></span>
<span id="cb43-518"><a href="#cb43-518"></a><span class="in">```python</span></span>
<span id="cb43-519"><a href="#cb43-519"></a><span class="co">## Read the content of a textual input file</span></span>
<span id="cb43-520"><a href="#cb43-520"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"names.txt"</span>)</span>
<span id="cb43-521"><a href="#cb43-521"></a></span>
<span id="cb43-522"><a href="#cb43-522"></a><span class="co">## Sort the content of the input RDD by name.</span></span>
<span id="cb43-523"><a href="#cb43-523"></a><span class="co">## Store the sorted result in a new RDD</span></span>
<span id="cb43-524"><a href="#cb43-524"></a>sortedNamesRDD <span class="op">=</span> inputRDD.sortBy(<span class="kw">lambda</span> name: name)</span>
<span id="cb43-525"><a href="#cb43-525"></a><span class="in">```</span></span>
<span id="cb43-526"><a href="#cb43-526"></a></span>
<span id="cb43-527"><a href="#cb43-527"></a>Notice that each input element of the lambda expression is a string. The goal is sorting the input names (strings) in alphabetic order, which is the standard sort order for strings. For this reason the lambda function returns the input strings without modifying them.</span>
<span id="cb43-528"><a href="#cb43-528"></a>:::</span>
<span id="cb43-529"><a href="#cb43-529"></a></span>
<span id="cb43-530"><a href="#cb43-530"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-531"><a href="#cb43-531"></a><span class="fu">### Example 2</span></span>
<span id="cb43-532"><a href="#cb43-532"></a><span class="ss">1. </span>Create an RDD from a textual file containing the names of a list of users (each line of the input file contains one name);</span>
<span id="cb43-533"><a href="#cb43-533"></a><span class="ss">2. </span>Create a new RDD containing the list of users sorted by the length of their name (i.e., the sort order is based on <span class="in">`len(name)`</span>).</span>
<span id="cb43-534"><a href="#cb43-534"></a></span>
<span id="cb43-535"><a href="#cb43-535"></a><span class="in">```python</span></span>
<span id="cb43-536"><a href="#cb43-536"></a><span class="co">## Read the content of a textual input file</span></span>
<span id="cb43-537"><a href="#cb43-537"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"names.txt"</span>)</span>
<span id="cb43-538"><a href="#cb43-538"></a></span>
<span id="cb43-539"><a href="#cb43-539"></a><span class="co">## Sort the content of the input RDD by name.</span></span>
<span id="cb43-540"><a href="#cb43-540"></a><span class="co">## Store the sorted result in a new RDD</span></span>
<span id="cb43-541"><a href="#cb43-541"></a>sortedNamesLenRDD <span class="op">=</span> inputRDD.sortBy(<span class="kw">lambda</span> name: <span class="bu">len</span>(name))</span>
<span id="cb43-542"><a href="#cb43-542"></a><span class="in">```</span></span>
<span id="cb43-543"><a href="#cb43-543"></a></span>
<span id="cb43-544"><a href="#cb43-544"></a>In this case, each input element is a string but we are interested in sorting the input names (strings) by length (integer), which is not the standard sort order for strings. For this reason the lambda function returns the length of each input string, and the sort operation is performed on the returned integer values (the lengths of the input names).</span>
<span id="cb43-545"><a href="#cb43-545"></a>:::</span>
<span id="cb43-546"><a href="#cb43-546"></a></span>
<span id="cb43-547"><a href="#cb43-547"></a><span class="fu">#### Sample transformation</span></span>
<span id="cb43-548"><a href="#cb43-548"></a>The sample transformation is applied on one single RDD and returns a new RDD containing a random sample of the elements (values) of the input RDD.</span>
<span id="cb43-549"><a href="#cb43-549"></a></span>
<span id="cb43-550"><a href="#cb43-550"></a>The sample transformation is based on the <span class="in">`sample(withReplacement, fraction)`</span> method of <span class="in">`RDD`</span> class: </span>
<span id="cb43-551"><a href="#cb43-551"></a></span>
<span id="cb43-552"><a href="#cb43-552"></a><span class="ss">- </span><span class="in">`withReplacement`</span> specifies if the random sample is with replacement (True) or not (False);</span>
<span id="cb43-553"><a href="#cb43-553"></a><span class="ss">- </span><span class="in">`fraction`</span> specifies the expected size of the sample as a fraction of the input RDD's size (values in the range $<span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>$).</span>
<span id="cb43-554"><a href="#cb43-554"></a></span>
<span id="cb43-555"><a href="#cb43-555"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-556"><a href="#cb43-556"></a><span class="fu">### Example 1</span></span>
<span id="cb43-557"><a href="#cb43-557"></a><span class="ss">1. </span>Create an RDD from a textual file containing a set of sentences (each line of the file contains one sentence);</span>
<span id="cb43-558"><a href="#cb43-558"></a><span class="ss">2. </span>Create a new RDD containing a random sample of sentences, using the "without replacement" strategy and setting fraction to $0.2$ (i.e., $20%$).</span>
<span id="cb43-559"><a href="#cb43-559"></a></span>
<span id="cb43-560"><a href="#cb43-560"></a><span class="in">```python</span></span>
<span id="cb43-561"><a href="#cb43-561"></a><span class="co">## Read the content of a textual input file</span></span>
<span id="cb43-562"><a href="#cb43-562"></a>inputRDD <span class="op">=</span> sc.textFile(<span class="st">"sentences.txt"</span>)</span>
<span id="cb43-563"><a href="#cb43-563"></a></span>
<span id="cb43-564"><a href="#cb43-564"></a><span class="co">## Create a random sample of sentences</span></span>
<span id="cb43-565"><a href="#cb43-565"></a>randomSentencesRDD <span class="op">=</span> inputRDD.sample(<span class="va">False</span>,<span class="fl">0.2</span>)</span>
<span id="cb43-566"><a href="#cb43-566"></a><span class="in">```</span></span>
<span id="cb43-567"><a href="#cb43-567"></a>:::</span>
<span id="cb43-568"><a href="#cb43-568"></a></span>
<span id="cb43-569"><a href="#cb43-569"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-570"><a href="#cb43-570"></a><span class="fu">### Example 2</span></span>
<span id="cb43-571"><a href="#cb43-571"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1, 2, 3, 3]`</span>;</span>
<span id="cb43-572"><a href="#cb43-572"></a><span class="ss">2. </span>Create a new RDD containing a random sample of the input values, using the "replacement" strategy and setting fraction to $0.2$ (i.e., $20%$).</span>
<span id="cb43-573"><a href="#cb43-573"></a></span>
<span id="cb43-574"><a href="#cb43-574"></a><span class="in">```python</span></span>
<span id="cb43-575"><a href="#cb43-575"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-576"><a href="#cb43-576"></a>inputList <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb43-577"><a href="#cb43-577"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-578"><a href="#cb43-578"></a></span>
<span id="cb43-579"><a href="#cb43-579"></a><span class="co">## Create a sample of the inputRDD</span></span>
<span id="cb43-580"><a href="#cb43-580"></a>randomSentencesRDD <span class="op">=</span> inputRDD.sample(<span class="va">True</span>,<span class="fl">0.2</span>)</span>
<span id="cb43-581"><a href="#cb43-581"></a><span class="in">```</span></span>
<span id="cb43-582"><a href="#cb43-582"></a>:::</span>
<span id="cb43-583"><a href="#cb43-583"></a></span>
<span id="cb43-584"><a href="#cb43-584"></a><span class="fu">### Set transformations</span></span>
<span id="cb43-585"><a href="#cb43-585"></a>Spark provides also a set of transformations that operate on two input RDDs and return a new RDD. Some of them implement standard set transformations:</span>
<span id="cb43-586"><a href="#cb43-586"></a></span>
<span id="cb43-587"><a href="#cb43-587"></a><span class="ss">- </span>Union</span>
<span id="cb43-588"><a href="#cb43-588"></a><span class="ss">- </span>Intersection</span>
<span id="cb43-589"><a href="#cb43-589"></a><span class="ss">- </span>Subtract</span>
<span id="cb43-590"><a href="#cb43-590"></a><span class="ss">- </span>Cartesian</span>
<span id="cb43-591"><a href="#cb43-591"></a></span>
<span id="cb43-592"><a href="#cb43-592"></a>All these transformations have</span>
<span id="cb43-593"><a href="#cb43-593"></a></span>
<span id="cb43-594"><a href="#cb43-594"></a><span class="ss">- </span>Two input RDDs: one is the RDD on which the method is invoked, while the other RDD is passed as parameter to the method</span>
<span id="cb43-595"><a href="#cb43-595"></a><span class="ss">- </span>One output RDD</span>
<span id="cb43-596"><a href="#cb43-596"></a></span>
<span id="cb43-597"><a href="#cb43-597"></a>All the involved RDDs have the same data type when union, intersection, or subtract are used, instead mixed data types can be used with the cartesian transformation.</span>
<span id="cb43-598"><a href="#cb43-598"></a></span>
<span id="cb43-599"><a href="#cb43-599"></a><span class="fu">#### Union transformation</span></span>
<span id="cb43-600"><a href="#cb43-600"></a>The union transformation is based on the <span class="in">`union(other)`</span> method of the <span class="in">`RDD`</span> class: <span class="in">`other`</span> is the second RDD to use, and the method returns a new RDD containing the union (with duplicates) of the elements of the two input RDDs.</span>
<span id="cb43-601"><a href="#cb43-601"></a></span>
<span id="cb43-602"><a href="#cb43-602"></a>:::{.callout-warning}</span>
<span id="cb43-603"><a href="#cb43-603"></a>**Duplicates elements are not removed**. This choice is related to optimization reasons: removing duplicates means having a global view of the whole content of the two input RDDs, but, since each RDD is split in partitions that are stored in different nodes of the cluster, the contents of all partitions should be shared to remove duplicates, and that's a computationally costly operation.</span>
<span id="cb43-604"><a href="#cb43-604"></a></span>
<span id="cb43-605"><a href="#cb43-605"></a>The shuffle operation is not needed in this case.</span>
<span id="cb43-606"><a href="#cb43-606"></a>:::</span>
<span id="cb43-607"><a href="#cb43-607"></a></span>
<span id="cb43-608"><a href="#cb43-608"></a>If removing duplicates is needed after performing the union transformation, apply the <span class="in">`distinct()`</span> transformation on the output of the <span class="in">`union()`</span> transformation, but pay attention that <span class="in">`distinct()`</span> is a computational costly operation (it is associated with a shuffle operation). Use <span class="in">`distinct()`</span> if and only if duplicate removal is indispensable for the application.</span>
<span id="cb43-609"><a href="#cb43-609"></a></span>
<span id="cb43-610"><a href="#cb43-610"></a><span class="fu">#### Intersection transformation</span></span>
<span id="cb43-611"><a href="#cb43-611"></a>The intersection transformation is based on the <span class="in">`intersection(other)`</span> method of the <span class="in">`RDD`</span> class: <span class="in">`other`</span> is the second RDD to use, and the method returns a new RDD containing the elements (without duplicates) occurring in both input RDDs. </span>
<span id="cb43-612"><a href="#cb43-612"></a></span>
<span id="cb43-613"><a href="#cb43-613"></a>Duplicates are removed: a shuffle operation is executed for computing the result of intersection, since elements from different input partitions must be compared to find common elements. </span>
<span id="cb43-614"><a href="#cb43-614"></a></span>
<span id="cb43-615"><a href="#cb43-615"></a><span class="fu">#### Subtract transformation</span></span>
<span id="cb43-616"><a href="#cb43-616"></a>The subtract transformation is based on the <span class="in">`subtract(other)`</span> method of the <span class="in">`RDD`</span> class: <span class="in">`other`</span> is the second RDD to use, and the result contains the elements appearing only in the RDD on which the subtract method is invoked. Notice that in this transformation the two input RDDs play different roles.</span>
<span id="cb43-617"><a href="#cb43-617"></a></span>
<span id="cb43-618"><a href="#cb43-618"></a>Duplicates are not removed, but a shuffle operation is executed for computing the result of subtract, since elements from different input partitions must be compared. </span>
<span id="cb43-619"><a href="#cb43-619"></a></span>
<span id="cb43-620"><a href="#cb43-620"></a><span class="fu">#### Cartesian transformation</span></span>
<span id="cb43-621"><a href="#cb43-621"></a>The cartesian transformation is based on the <span class="in">`cartesian(other)`</span> method of the <span class="in">`RDD`</span> class: <span class="in">`other`</span> is the second RDD to use, the data types of the objects of the two input RDDs can be different, and the returned RDD is an RDD of pairs (tuples) containing all the combinations composed of one element of the first input RDD and one element of the second input RDD (see later what an RDD of pairs is).</span>
<span id="cb43-622"><a href="#cb43-622"></a></span>
<span id="cb43-623"><a href="#cb43-623"></a>In this transformation a large amount of data is sent on the network: elements from different input partitions must be combined to compute the returned pairs, but the elements of the two input RDDs are stored in different partitions, which could be even in different servers.</span>
<span id="cb43-624"><a href="#cb43-624"></a></span>
<span id="cb43-625"><a href="#cb43-625"></a><span class="fu">#### Examples of set transformations</span></span>
<span id="cb43-626"><a href="#cb43-626"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-627"><a href="#cb43-627"></a><span class="fu">### Example 1</span></span>
<span id="cb43-628"><a href="#cb43-628"></a><span class="ss">1. </span>Create two RDDs of integers</span>
<span id="cb43-629"><a href="#cb43-629"></a><span class="ss">    - </span><span class="in">`inputRDD1`</span> contains the values <span class="in">`[1, 2, 2, 3, 3]`</span></span>
<span id="cb43-630"><a href="#cb43-630"></a><span class="ss">    - </span><span class="in">`inputRDD2`</span> contains the values <span class="in">`[3, 4, 5]`</span></span>
<span id="cb43-631"><a href="#cb43-631"></a><span class="ss">2. </span>Create four new RDDs</span>
<span id="cb43-632"><a href="#cb43-632"></a><span class="ss">    - </span><span class="in">`outputUnionRDD`</span> contains the union of <span class="in">`inputRDD1`</span> and <span class="in">`inputRDD2`</span></span>
<span id="cb43-633"><a href="#cb43-633"></a><span class="ss">    - </span><span class="in">`outputIntersectionRDD`</span> contains the intersection of <span class="in">`inputRDD1`</span> and <span class="in">`inputRDD2`</span></span>
<span id="cb43-634"><a href="#cb43-634"></a><span class="ss">    - </span><span class="in">`outputSubtractRDD`</span> contains the result of <span class="in">`inputRDD1`</span> \ <span class="in">`inputRDD2`</span></span>
<span id="cb43-635"><a href="#cb43-635"></a><span class="ss">    - </span><span class="in">`outputCartesianRDD`</span> contains the cartesian product of <span class="in">`inputRDD1`</span> and <span class="in">`inputRDD2`</span></span>
<span id="cb43-636"><a href="#cb43-636"></a></span>
<span id="cb43-637"><a href="#cb43-637"></a><span class="in">```python</span></span>
<span id="cb43-638"><a href="#cb43-638"></a><span class="co">## Create two RDD of integers</span></span>
<span id="cb43-639"><a href="#cb43-639"></a>inputList1 <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb43-640"><a href="#cb43-640"></a>inputRDD1 <span class="op">=</span> sc.parallelize(inputList1)</span>
<span id="cb43-641"><a href="#cb43-641"></a></span>
<span id="cb43-642"><a href="#cb43-642"></a>inputList2 <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb43-643"><a href="#cb43-643"></a>inputRDD2 <span class="op">=</span> sc.parallelize(inputList2)</span>
<span id="cb43-644"><a href="#cb43-644"></a></span>
<span id="cb43-645"><a href="#cb43-645"></a><span class="co">## Create four new RDDs by using union, intersection, </span></span>
<span id="cb43-646"><a href="#cb43-646"></a><span class="co">## subtract, and cartesian</span></span>
<span id="cb43-647"><a href="#cb43-647"></a>outputUnionRDD <span class="op">=</span> inputRDD1.union(inputRDD2)</span>
<span id="cb43-648"><a href="#cb43-648"></a></span>
<span id="cb43-649"><a href="#cb43-649"></a>outputIntersectionRDD <span class="op">=</span> inputRDD1.intersection(inputRDD2)</span>
<span id="cb43-650"><a href="#cb43-650"></a></span>
<span id="cb43-651"><a href="#cb43-651"></a>outputSubtractRDD <span class="op">=</span> inputRDD1.subtract(inputRDD2)</span>
<span id="cb43-652"><a href="#cb43-652"></a></span>
<span id="cb43-653"><a href="#cb43-653"></a>outputCartesianRDD <span class="op">=</span> inputRDD1.cartesian(inputRDD2)</span>
<span id="cb43-654"><a href="#cb43-654"></a><span class="in">```</span></span>
<span id="cb43-655"><a href="#cb43-655"></a></span>
<span id="cb43-656"><a href="#cb43-656"></a>| | |</span>
<span id="cb43-657"><a href="#cb43-657"></a>|-|---|</span>
<span id="cb43-658"><a href="#cb43-658"></a>| <span class="in">`outputCartesianRDD`</span> | Each element of the returned RDD is a pair (tuple) of integer elements. |</span>
<span id="cb43-659"><a href="#cb43-659"></a></span>
<span id="cb43-660"><a href="#cb43-660"></a>:::</span>
<span id="cb43-661"><a href="#cb43-661"></a></span>
<span id="cb43-662"><a href="#cb43-662"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-663"><a href="#cb43-663"></a><span class="fu">### Example 2</span></span>
<span id="cb43-664"><a href="#cb43-664"></a><span class="ss">1. </span>Create two RDDs</span>
<span id="cb43-665"><a href="#cb43-665"></a><span class="ss">    - </span><span class="in">`inputRDD1`</span> contains the Integer values <span class="in">`[1, 2, 3]`</span></span>
<span id="cb43-666"><a href="#cb43-666"></a><span class="ss">    - </span><span class="in">`inputRDD2`</span> contains the String values <span class="in">`["A", "B"]`</span></span>
<span id="cb43-667"><a href="#cb43-667"></a><span class="ss">2. </span>Create a new RDD containing the cartesian product of <span class="in">`inputRDD1`</span> and <span class="in">`inputRDD2`</span></span>
<span id="cb43-668"><a href="#cb43-668"></a></span>
<span id="cb43-669"><a href="#cb43-669"></a><span class="in">```python</span></span>
<span id="cb43-670"><a href="#cb43-670"></a><span class="co">## Create an RDD of Integers and an RDD of Strings</span></span>
<span id="cb43-671"><a href="#cb43-671"></a>inputList1 <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb43-672"><a href="#cb43-672"></a>inputRDD1 <span class="op">=</span> sc.parallelize(inputList1)</span>
<span id="cb43-673"><a href="#cb43-673"></a></span>
<span id="cb43-674"><a href="#cb43-674"></a>inputList2 <span class="op">=</span> [<span class="st">"A"</span>,<span class="st">"B"</span>]</span>
<span id="cb43-675"><a href="#cb43-675"></a>inputRDD2 <span class="op">=</span> sc.parallelize(inputList2)</span>
<span id="cb43-676"><a href="#cb43-676"></a></span>
<span id="cb43-677"><a href="#cb43-677"></a><span class="co">## Compute the cartesian product</span></span>
<span id="cb43-678"><a href="#cb43-678"></a>outputCartesianRDD <span class="op">=</span> inputRDD1.cartesian(inputRDD2)</span>
<span id="cb43-679"><a href="#cb43-679"></a><span class="in">```</span></span>
<span id="cb43-680"><a href="#cb43-680"></a></span>
<span id="cb43-681"><a href="#cb43-681"></a>| | |</span>
<span id="cb43-682"><a href="#cb43-682"></a>|-|---|</span>
<span id="cb43-683"><a href="#cb43-683"></a>| <span class="in">`outputCartesianRDD`</span> | Each element of the returned RDD is a pair (tuple) of integer elements. |</span>
<span id="cb43-684"><a href="#cb43-684"></a></span>
<span id="cb43-685"><a href="#cb43-685"></a>:::</span>
<span id="cb43-686"><a href="#cb43-686"></a></span>
<span id="cb43-687"><a href="#cb43-687"></a><span class="fu">### Summary</span></span>
<span id="cb43-688"><a href="#cb43-688"></a><span class="fu">#### Single input RDD transformations</span></span>
<span id="cb43-689"><a href="#cb43-689"></a>All the examples reported in the following tables are applied on an RDD of integers containing the following elements (i.e., values): <span class="in">`[1,2,3,3]`</span>.</span>
<span id="cb43-690"><a href="#cb43-690"></a></span>
<span id="cb43-691"><a href="#cb43-691"></a>::::{.content-visible when-format="html"}</span>
<span id="cb43-692"><a href="#cb43-692"></a>:::{.column-page}</span>
<span id="cb43-693"><a href="#cb43-693"></a></span>
<span id="cb43-694"><a href="#cb43-694"></a>**Purposes**</span>
<span id="cb43-695"><a href="#cb43-695"></a></span>
<span id="cb43-696"><a href="#cb43-696"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-697"><a href="#cb43-697"></a>| Transformation                      | Purpose                                                                                                                                                                                                                                      |</span>
<span id="cb43-698"><a href="#cb43-698"></a>+=====================================+==============================================================================================================================================================================================================================================+</span>
<span id="cb43-699"><a href="#cb43-699"></a>| <span class="in">`filter(f)`</span>                         | Return an RDD consisting only of the elements of the input RDD that pass the condition passed to <span class="in">`filter()`</span>. The input RDD and the new RDD have the same data type.                                                                          |</span>
<span id="cb43-700"><a href="#cb43-700"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-701"><a href="#cb43-701"></a>| <span class="in">`map(f)`</span>                            | Apply a function to each element in the RDD and return an RDD of the result. The applied function return one element for each element of the input RDD. The input RDD and the new RDD can have a different data type.                        |</span>
<span id="cb43-702"><a href="#cb43-702"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-703"><a href="#cb43-703"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-704"><a href="#cb43-704"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-705"><a href="#cb43-705"></a>| <span class="in">`flatMap(f)`</span>                        | Apply a function to each element in the RDD and return an RDD of the result. The applied function return a set of elements (from 0 to many) for each element of the input RDD. The input RDD and the new RDD can have a different data type. |</span>
<span id="cb43-706"><a href="#cb43-706"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-707"><a href="#cb43-707"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-708"><a href="#cb43-708"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-709"><a href="#cb43-709"></a>| <span class="in">`distinct()`</span>                        | Remove duplicates.                                                                                                                                                                                                                           |</span>
<span id="cb43-710"><a href="#cb43-710"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-711"><a href="#cb43-711"></a>| <span class="in">`sortBy(keyfunc)`</span>                   | Return a new RDD containing the same values of the input RDD sorted in ascending order.                                                                                                                                                      |</span>
<span id="cb43-712"><a href="#cb43-712"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-713"><a href="#cb43-713"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-714"><a href="#cb43-714"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-715"><a href="#cb43-715"></a>| <span class="in">`sample(withReplacement, fraction)`</span> | Sample the content of the input RDD, with or without replacement and return the selected sample. The input RDD and the new RDD have the same data type.                                                                                      |</span>
<span id="cb43-716"><a href="#cb43-716"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-717"><a href="#cb43-717"></a></span>
<span id="cb43-718"><a href="#cb43-718"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb43-719"><a href="#cb43-719"></a></span>
<span id="cb43-720"><a href="#cb43-720"></a>**Examples**</span>
<span id="cb43-721"><a href="#cb43-721"></a></span>
<span id="cb43-722"><a href="#cb43-722"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-723"><a href="#cb43-723"></a>| Transformation                      | Example function                                                                          | Example result    |</span>
<span id="cb43-724"><a href="#cb43-724"></a>+=====================================+===========================================================================================+===================+</span>
<span id="cb43-725"><a href="#cb43-725"></a>| <span class="in">`filter(f)`</span>                         | <span class="in">`filter(lambda x: x != 1)`</span>                                                                | <span class="in">`[2,3,3]`</span>         |</span>
<span id="cb43-726"><a href="#cb43-726"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-727"><a href="#cb43-727"></a>| <span class="in">`map(f)`</span>                            | <span class="in">`map(lambda x: x+1)`</span>                                                                      | <span class="in">`[2,3,4,4]`</span>       |</span>
<span id="cb43-728"><a href="#cb43-728"></a>|                                     |                                                                                           |                   |</span>
<span id="cb43-729"><a href="#cb43-729"></a>|                                     | For each input element <span class="in">`x`</span>, the element with value <span class="in">`x+1`</span> is included in the new RDD       |                   |</span>
<span id="cb43-730"><a href="#cb43-730"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-731"><a href="#cb43-731"></a>| <span class="in">`flatMap(f)`</span>                        | <span class="in">`flatMap(lambda x: list(range(x,4))`</span>                                                      | <span class="in">`[1,2,3,2,3,3,3]`</span> |</span>
<span id="cb43-732"><a href="#cb43-732"></a>|                                     |                                                                                           |                   |</span>
<span id="cb43-733"><a href="#cb43-733"></a>|                                     | For each input element <span class="in">`x`</span>, the set of elements with values from <span class="in">`x`</span> to 3 are returned    |                   |</span>
<span id="cb43-734"><a href="#cb43-734"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-735"><a href="#cb43-735"></a>| <span class="in">`distinct()`</span>                        | <span class="in">`distinct()`</span>                                                                              | <span class="in">`[1,2,3]`</span>         |</span>
<span id="cb43-736"><a href="#cb43-736"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-737"><a href="#cb43-737"></a>| <span class="in">`sortBy(keyfunc)`</span>                   | <span class="in">`sortBy(lambda v: v)`</span>                                                                     | <span class="in">`[1,2,3,3]`</span>       |</span>
<span id="cb43-738"><a href="#cb43-738"></a>|                                     |                                                                                           |                   |</span>
<span id="cb43-739"><a href="#cb43-739"></a>|                                     | Sort the input integer values in ascending order by using the standard integer sort order |                   |</span>
<span id="cb43-740"><a href="#cb43-740"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-741"><a href="#cb43-741"></a>| <span class="in">`sample(withReplacement, fraction)`</span> | <span class="in">`sample(True, 0.2)`</span>                                                                       | Non deterministic |</span>
<span id="cb43-742"><a href="#cb43-742"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-743"><a href="#cb43-743"></a></span>
<span id="cb43-744"><a href="#cb43-744"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb43-745"><a href="#cb43-745"></a></span>
<span id="cb43-746"><a href="#cb43-746"></a>:::</span>
<span id="cb43-747"><a href="#cb43-747"></a>::::</span>
<span id="cb43-748"><a href="#cb43-748"></a></span>
<span id="cb43-749"><a href="#cb43-749"></a>:::{.content-visible when-format="pdf"}</span>
<span id="cb43-750"><a href="#cb43-750"></a></span>
<span id="cb43-751"><a href="#cb43-751"></a>\newpage</span>
<span id="cb43-752"><a href="#cb43-752"></a></span>
<span id="cb43-753"><a href="#cb43-753"></a>\blandscape</span>
<span id="cb43-754"><a href="#cb43-754"></a></span>
<span id="cb43-755"><a href="#cb43-755"></a>**Purposes**</span>
<span id="cb43-756"><a href="#cb43-756"></a></span>
<span id="cb43-757"><a href="#cb43-757"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-758"><a href="#cb43-758"></a>| Transformation                      | Purpose                                                                                                                                                                                                                                      |</span>
<span id="cb43-759"><a href="#cb43-759"></a>+=====================================+==============================================================================================================================================================================================================================================+</span>
<span id="cb43-760"><a href="#cb43-760"></a>| <span class="in">`filter(f)`</span>                         | Return an RDD consisting only of the elements of the input RDD that pass the condition passed to <span class="in">`filter()`</span>. The input RDD and the new RDD have the same data type.                                                                          |</span>
<span id="cb43-761"><a href="#cb43-761"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-762"><a href="#cb43-762"></a>| <span class="in">`map(f)`</span>                            | Apply a function to each element in the RDD and return an RDD of the result. The applied function return one element for each element of the input RDD. The input RDD and the new RDD can have a different data type.                        |</span>
<span id="cb43-763"><a href="#cb43-763"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-764"><a href="#cb43-764"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-765"><a href="#cb43-765"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-766"><a href="#cb43-766"></a>| <span class="in">`flatMap(f)`</span>                        | Apply a function to each element in the RDD and return an RDD of the result. The applied function return a set of elements (from 0 to many) for each element of the input RDD. The input RDD and the new RDD can have a different data type. |</span>
<span id="cb43-767"><a href="#cb43-767"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-768"><a href="#cb43-768"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-769"><a href="#cb43-769"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-770"><a href="#cb43-770"></a>| <span class="in">`distinct()`</span>                        | Remove duplicates.                                                                                                                                                                                                                           |</span>
<span id="cb43-771"><a href="#cb43-771"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-772"><a href="#cb43-772"></a>| <span class="in">`sortBy(keyfunc)`</span>                   | Return a new RDD containing the same values of the input RDD sorted in ascending order.                                                                                                                                                      |</span>
<span id="cb43-773"><a href="#cb43-773"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-774"><a href="#cb43-774"></a>|                                     |                                                                                                                                                                                                                                              |</span>
<span id="cb43-775"><a href="#cb43-775"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-776"><a href="#cb43-776"></a>| <span class="in">`sample(withReplacement, fraction)`</span> | Sample the content of the input RDD, with or without replacement and return the selected sample. The input RDD and the new RDD have the same data type.                                                                                      |</span>
<span id="cb43-777"><a href="#cb43-777"></a>+-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-778"><a href="#cb43-778"></a></span>
<span id="cb43-779"><a href="#cb43-779"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb43-780"><a href="#cb43-780"></a></span>
<span id="cb43-781"><a href="#cb43-781"></a>\newpage</span>
<span id="cb43-782"><a href="#cb43-782"></a></span>
<span id="cb43-783"><a href="#cb43-783"></a>**Examples**</span>
<span id="cb43-784"><a href="#cb43-784"></a></span>
<span id="cb43-785"><a href="#cb43-785"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-786"><a href="#cb43-786"></a>| Transformation                      | Example function                                                                          | Example result    |</span>
<span id="cb43-787"><a href="#cb43-787"></a>+=====================================+===========================================================================================+===================+</span>
<span id="cb43-788"><a href="#cb43-788"></a>| <span class="in">`filter(f)`</span>                         | <span class="in">`filter(lambda x: x != 1)`</span>                                                                | <span class="in">`[2,3,3]`</span>         |</span>
<span id="cb43-789"><a href="#cb43-789"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-790"><a href="#cb43-790"></a>| <span class="in">`map(f)`</span>                            | <span class="in">`map(lambda x: x+1)`</span>                                                                      | <span class="in">`[2,3,4,4]`</span>       |</span>
<span id="cb43-791"><a href="#cb43-791"></a>|                                     |                                                                                           |                   |</span>
<span id="cb43-792"><a href="#cb43-792"></a>|                                     | For each input element <span class="in">`x`</span>, the element with value <span class="in">`x+1`</span> is included in the new RDD       |                   |</span>
<span id="cb43-793"><a href="#cb43-793"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-794"><a href="#cb43-794"></a>| <span class="in">`flatMap(f)`</span>                        | <span class="in">`flatMap(lambda x: list(range(x,4))`</span>                                                      | <span class="in">`[1,2,3,2,3,3,3]`</span> |</span>
<span id="cb43-795"><a href="#cb43-795"></a>|                                     |                                                                                           |                   |</span>
<span id="cb43-796"><a href="#cb43-796"></a>|                                     | For each input element <span class="in">`x`</span>, the set of elements with values from <span class="in">`x`</span> to 3 are returned    |                   |</span>
<span id="cb43-797"><a href="#cb43-797"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-798"><a href="#cb43-798"></a>| <span class="in">`distinct()`</span>                        | <span class="in">`distinct()`</span>                                                                              | <span class="in">`[1,2,3]`</span>         |</span>
<span id="cb43-799"><a href="#cb43-799"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-800"><a href="#cb43-800"></a>| <span class="in">`sortBy(keyfunc)`</span>                   | <span class="in">`sortBy(lambda v: v)`</span>                                                                     | <span class="in">`[1,2,3,3]`</span>       |</span>
<span id="cb43-801"><a href="#cb43-801"></a>|                                     |                                                                                           |                   |</span>
<span id="cb43-802"><a href="#cb43-802"></a>|                                     | Sort the input integer values in ascending order by using the standard integer sort order |                   |</span>
<span id="cb43-803"><a href="#cb43-803"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-804"><a href="#cb43-804"></a>| <span class="in">`sample(withReplacement, fraction)`</span> | <span class="in">`sample(True, 0.2)`</span>                                                                       | Non deterministic |</span>
<span id="cb43-805"><a href="#cb43-805"></a>+-------------------------------------+-------------------------------------------------------------------------------------------+-------------------+</span>
<span id="cb43-806"><a href="#cb43-806"></a></span>
<span id="cb43-807"><a href="#cb43-807"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb43-808"><a href="#cb43-808"></a></span>
<span id="cb43-809"><a href="#cb43-809"></a>\elandscape</span>
<span id="cb43-810"><a href="#cb43-810"></a></span>
<span id="cb43-811"><a href="#cb43-811"></a>:::</span>
<span id="cb43-812"><a href="#cb43-812"></a></span>
<span id="cb43-813"><a href="#cb43-813"></a><span class="fu">#### Two input RDD transformations</span></span>
<span id="cb43-814"><a href="#cb43-814"></a>All the examples reported in the following tables are applied on the following two RDDs of integers</span>
<span id="cb43-815"><a href="#cb43-815"></a></span>
<span id="cb43-816"><a href="#cb43-816"></a><span class="ss">- </span><span class="in">`inputRDD1`</span>: <span class="in">`[1,2,2,3,3]`</span></span>
<span id="cb43-817"><a href="#cb43-817"></a><span class="ss">- </span><span class="in">`inputRDD2`</span>: <span class="in">`[3,4,5]`</span></span>
<span id="cb43-818"><a href="#cb43-818"></a></span>
<span id="cb43-819"><a href="#cb43-819"></a>::::{.content-visible when-format="html"}</span>
<span id="cb43-820"><a href="#cb43-820"></a>:::{.column-page}</span>
<span id="cb43-821"><a href="#cb43-821"></a></span>
<span id="cb43-822"><a href="#cb43-822"></a>**Purposes**</span>
<span id="cb43-823"><a href="#cb43-823"></a></span>
<span id="cb43-824"><a href="#cb43-824"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-825"><a href="#cb43-825"></a>| Transformation        | Purpose                                                                                                                                                                                                      |</span>
<span id="cb43-826"><a href="#cb43-826"></a>+=======================+==============================================================================================================================================================================================================+</span>
<span id="cb43-827"><a href="#cb43-827"></a>| <span class="in">`union(other)`</span>        | Return a new RDD containing the union of the elements of the input RDD and the elements of the one passed as parameter to <span class="in">`union()`</span>. Duplicate values are not removed. All the RDDs have the same data type. |</span>
<span id="cb43-828"><a href="#cb43-828"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-829"><a href="#cb43-829"></a>| <span class="in">`intersection(other)`</span> | Return a new RDD containing the intersection of the elements of the input RDD and the elements of the one passed as parameter to <span class="in">`intersection()`</span>. All the RDDs have the same data type.                     |</span>
<span id="cb43-830"><a href="#cb43-830"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-831"><a href="#cb43-831"></a>| <span class="in">`subtract(other)`</span>     | Return a new RDD the elements appearing only in the input RDD and not in the one passed as parameter to <span class="in">`subtract()`</span>. All the RDDs have the same data type.                                                  |</span>
<span id="cb43-832"><a href="#cb43-832"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-833"><a href="#cb43-833"></a>| <span class="in">`cartesian(other)`</span>    | Return a new RDD containing the cartesian product of the elements of the input RDD and the elements of the one passed as parameter to <span class="in">`cartesian()`</span>. All the RDDs have the same data type.                   |</span>
<span id="cb43-834"><a href="#cb43-834"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-835"><a href="#cb43-835"></a></span>
<span id="cb43-836"><a href="#cb43-836"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb43-837"><a href="#cb43-837"></a></span>
<span id="cb43-838"><a href="#cb43-838"></a>**Examples**</span>
<span id="cb43-839"><a href="#cb43-839"></a></span>
<span id="cb43-840"><a href="#cb43-840"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-841"><a href="#cb43-841"></a>| Transformation        | Example function                    | Example result            |</span>
<span id="cb43-842"><a href="#cb43-842"></a>+=======================+=====================================+===========================+</span>
<span id="cb43-843"><a href="#cb43-843"></a>| <span class="in">`union(other)`</span>        | <span class="in">`inputRDD1.union(inputRDD2)`</span>        | <span class="in">`[1,2,2,3,3,3,4,5]`</span>       |</span>
<span id="cb43-844"><a href="#cb43-844"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-845"><a href="#cb43-845"></a>| <span class="in">`intersection(other)`</span> | <span class="in">`inputRDD1.intersection(inputRDD2)`</span> | <span class="in">`[3]`</span>                     |</span>
<span id="cb43-846"><a href="#cb43-846"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-847"><a href="#cb43-847"></a>| <span class="in">`subtract(other)`</span>     | <span class="in">`inputRDD1.subtract(inputRDD2)`</span>     | <span class="in">`[1,2,2]`</span>                 |</span>
<span id="cb43-848"><a href="#cb43-848"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-849"><a href="#cb43-849"></a>| <span class="in">`cartesian(other)`</span>    | <span class="in">`inputRDD1.cartesian(inputRDD2)`</span>    | <span class="in">`[(1,3),(1,4),...,(3,5)]`</span> |</span>
<span id="cb43-850"><a href="#cb43-850"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-851"><a href="#cb43-851"></a></span>
<span id="cb43-852"><a href="#cb43-852"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb43-853"><a href="#cb43-853"></a></span>
<span id="cb43-854"><a href="#cb43-854"></a>:::</span>
<span id="cb43-855"><a href="#cb43-855"></a>::::</span>
<span id="cb43-856"><a href="#cb43-856"></a></span>
<span id="cb43-857"><a href="#cb43-857"></a>:::{.content-visible when-format="pdf"}</span>
<span id="cb43-858"><a href="#cb43-858"></a></span>
<span id="cb43-859"><a href="#cb43-859"></a>\newpage</span>
<span id="cb43-860"><a href="#cb43-860"></a></span>
<span id="cb43-861"><a href="#cb43-861"></a>\blandscape</span>
<span id="cb43-862"><a href="#cb43-862"></a></span>
<span id="cb43-863"><a href="#cb43-863"></a>**Purposes**</span>
<span id="cb43-864"><a href="#cb43-864"></a></span>
<span id="cb43-865"><a href="#cb43-865"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-866"><a href="#cb43-866"></a>| Transformation        | Purpose                                                                                                                                                                                                      |</span>
<span id="cb43-867"><a href="#cb43-867"></a>+=======================+==============================================================================================================================================================================================================+</span>
<span id="cb43-868"><a href="#cb43-868"></a>| <span class="in">`union(other)`</span>        | Return a new RDD containing the union of the elements of the input RDD and the elements of the one passed as parameter to <span class="in">`union()`</span>. Duplicate values are not removed. All the RDDs have the same data type. |</span>
<span id="cb43-869"><a href="#cb43-869"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-870"><a href="#cb43-870"></a>| <span class="in">`intersection(other)`</span> | Return a new RDD containing the intersection of the elements of the input RDD and the elements of the one passed as parameter to <span class="in">`intersection()`</span>. All the RDDs have the same data type.                     |</span>
<span id="cb43-871"><a href="#cb43-871"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-872"><a href="#cb43-872"></a>| <span class="in">`subtract(other)`</span>     | Return a new RDD the elements appearing only in the input RDD and not in the one passed as parameter to <span class="in">`subtract()`</span>. All the RDDs have the same data type.                                                  |</span>
<span id="cb43-873"><a href="#cb43-873"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-874"><a href="#cb43-874"></a>| <span class="in">`cartesian(other)`</span>    | Return a new RDD containing the cartesian product of the elements of the input RDD and the elements of the one passed as parameter to <span class="in">`cartesian()`</span>. All the RDDs have the same data type.                   |</span>
<span id="cb43-875"><a href="#cb43-875"></a>+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-876"><a href="#cb43-876"></a></span>
<span id="cb43-877"><a href="#cb43-877"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb43-878"><a href="#cb43-878"></a></span>
<span id="cb43-879"><a href="#cb43-879"></a>\newpage</span>
<span id="cb43-880"><a href="#cb43-880"></a></span>
<span id="cb43-881"><a href="#cb43-881"></a>**Examples**</span>
<span id="cb43-882"><a href="#cb43-882"></a></span>
<span id="cb43-883"><a href="#cb43-883"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-884"><a href="#cb43-884"></a>| Transformation        | Example function                    | Example result            |</span>
<span id="cb43-885"><a href="#cb43-885"></a>+=======================+=====================================+===========================+</span>
<span id="cb43-886"><a href="#cb43-886"></a>| <span class="in">`union(other)`</span>        | <span class="in">`inputRDD1.union(inputRDD2)`</span>        | <span class="in">`[1,2,2,3,3,3,4,5]`</span>       |</span>
<span id="cb43-887"><a href="#cb43-887"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-888"><a href="#cb43-888"></a>| <span class="in">`intersection(other)`</span> | <span class="in">`inputRDD1.intersection(inputRDD2)`</span> | <span class="in">`[3]`</span>                     |</span>
<span id="cb43-889"><a href="#cb43-889"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-890"><a href="#cb43-890"></a>| <span class="in">`subtract(other)`</span>     | <span class="in">`inputRDD1.subtract(inputRDD2)`</span>     | <span class="in">`[1,2,2]`</span>                 |</span>
<span id="cb43-891"><a href="#cb43-891"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-892"><a href="#cb43-892"></a>| <span class="in">`cartesian(other)`</span>    | <span class="in">`inputRDD1.cartesian(inputRDD2)`</span>    | <span class="in">`[(1,3),(1,4),...,(3,5)]`</span> |</span>
<span id="cb43-893"><a href="#cb43-893"></a>+-----------------------+-------------------------------------+---------------------------+</span>
<span id="cb43-894"><a href="#cb43-894"></a></span>
<span id="cb43-895"><a href="#cb43-895"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb43-896"><a href="#cb43-896"></a></span>
<span id="cb43-897"><a href="#cb43-897"></a>\elandscape</span>
<span id="cb43-898"><a href="#cb43-898"></a></span>
<span id="cb43-899"><a href="#cb43-899"></a>:::</span>
<span id="cb43-900"><a href="#cb43-900"></a></span>
<span id="cb43-901"><a href="#cb43-901"></a><span class="fu">## Basic Actions</span></span>
<span id="cb43-902"><a href="#cb43-902"></a>Spark actions can retrieve the content of an RDD or the result of a function applied on an RDD and </span>
<span id="cb43-903"><a href="#cb43-903"></a></span>
<span id="cb43-904"><a href="#cb43-904"></a><span class="ss">- </span>Store it in a local Python variable of the Driver program</span>
<span id="cb43-905"><a href="#cb43-905"></a><span class="ss">    - </span>Pay attention to the size of the returned value</span>
<span id="cb43-906"><a href="#cb43-906"></a><span class="ss">    - </span>Pay attentions that date are sent on the network from the nodes containing the content of RDDs and the executor running the Driver</span>
<span id="cb43-907"><a href="#cb43-907"></a><span class="ss">- </span>Store the content of an RDD in an output folder or database</span>
<span id="cb43-908"><a href="#cb43-908"></a></span>
<span id="cb43-909"><a href="#cb43-909"></a>The Spark actions that return a result that is stored in local (Python) variables of the Driver</span>
<span id="cb43-910"><a href="#cb43-910"></a><span class="ss">1. </span>Are executed locally on each node containing partitions of the RDD on which the action is invoked, and so local results are generated in each node;</span>
<span id="cb43-911"><a href="#cb43-911"></a><span class="ss">2. </span>Local results are sent on the network to the Driver that computes the final result and store it in local variables of the Driver.</span>
<span id="cb43-912"><a href="#cb43-912"></a></span>
<span id="cb43-913"><a href="#cb43-913"></a>The basic actions returning (Python) objects to the Driver are</span>
<span id="cb43-914"><a href="#cb43-914"></a></span>
<span id="cb43-915"><a href="#cb43-915"></a><span class="ss">- </span><span class="in">`collect()`</span></span>
<span id="cb43-916"><a href="#cb43-916"></a><span class="ss">- </span><span class="in">`count()`</span></span>
<span id="cb43-917"><a href="#cb43-917"></a><span class="ss">- </span><span class="in">`countByValue()`</span></span>
<span id="cb43-918"><a href="#cb43-918"></a><span class="ss">- </span><span class="in">`take()`</span></span>
<span id="cb43-919"><a href="#cb43-919"></a><span class="ss">- </span><span class="in">`top()`</span></span>
<span id="cb43-920"><a href="#cb43-920"></a><span class="ss">- </span><span class="in">`takeSample()`</span></span>
<span id="cb43-921"><a href="#cb43-921"></a><span class="ss">- </span><span class="in">`reduce()`</span></span>
<span id="cb43-922"><a href="#cb43-922"></a><span class="ss">- </span><span class="in">`fold()`</span></span>
<span id="cb43-923"><a href="#cb43-923"></a><span class="ss">- </span><span class="in">`aggregate()`</span></span>
<span id="cb43-924"><a href="#cb43-924"></a><span class="ss">- </span><span class="in">`foreach()`</span></span>
<span id="cb43-925"><a href="#cb43-925"></a></span>
<span id="cb43-926"><a href="#cb43-926"></a><span class="fu">### Collect action</span></span>
<span id="cb43-927"><a href="#cb43-927"></a>The collect action returns a local Python list of objects containing the same objects of the considered RDD.</span>
<span id="cb43-928"><a href="#cb43-928"></a></span>
<span id="cb43-929"><a href="#cb43-929"></a>:::{.callout-warning}</span>
<span id="cb43-930"><a href="#cb43-930"></a>Pay attention to the size of the RDD: large RDD cannot be memorized in a local variable of the Driver.</span>
<span id="cb43-931"><a href="#cb43-931"></a>:::</span>
<span id="cb43-932"><a href="#cb43-932"></a></span>
<span id="cb43-933"><a href="#cb43-933"></a>The collect action is based on the <span class="in">`collect()`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb43-934"><a href="#cb43-934"></a></span>
<span id="cb43-935"><a href="#cb43-935"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-936"><a href="#cb43-936"></a><span class="fu">### Example</span></span>
<span id="cb43-937"><a href="#cb43-937"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1,2,3,3]`</span>;</span>
<span id="cb43-938"><a href="#cb43-938"></a><span class="ss">2. </span>Retrieve the values of the created RDD and store them in a local python list that is instantiated in the Driver.</span>
<span id="cb43-939"><a href="#cb43-939"></a></span>
<span id="cb43-940"><a href="#cb43-940"></a><span class="in">```python</span></span>
<span id="cb43-941"><a href="#cb43-941"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-942"><a href="#cb43-942"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb43-943"><a href="#cb43-943"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-944"><a href="#cb43-944"></a></span>
<span id="cb43-945"><a href="#cb43-945"></a><span class="co">## Retrieve the elements of the inputRDD and store them in</span></span>
<span id="cb43-946"><a href="#cb43-946"></a><span class="co">## a local python list</span></span>
<span id="cb43-947"><a href="#cb43-947"></a>retrievedValues <span class="op">=</span> inputRDD.collect()</span>
<span id="cb43-948"><a href="#cb43-948"></a><span class="in">```</span></span>
<span id="cb43-949"><a href="#cb43-949"></a></span>
<span id="cb43-950"><a href="#cb43-950"></a>|||</span>
<span id="cb43-951"><a href="#cb43-951"></a>|-|---|</span>
<span id="cb43-952"><a href="#cb43-952"></a>| <span class="in">`inputRDD`</span> | It is distributed across the nodes of the cluster. It can be large and it is stored in the local disks of the nodes if it is needed.|</span>
<span id="cb43-953"><a href="#cb43-953"></a>| <span class="in">`retrievedValues`</span> | It is a local python variable. It can only be stored in the main memory of the process/task associated with the Driver. Pay attention to the size of the list. Use the <span class="in">`collect()`</span> action if and only if sure that the list is small. Otherwise, store the content of the RDD in a file by using the <span class="in">`saveAsTextFile`</span> method. |</span>
<span id="cb43-954"><a href="#cb43-954"></a></span>
<span id="cb43-955"><a href="#cb43-955"></a>:::</span>
<span id="cb43-956"><a href="#cb43-956"></a></span>
<span id="cb43-957"><a href="#cb43-957"></a><span class="fu">### Count action</span></span>
<span id="cb43-958"><a href="#cb43-958"></a>Count the number of elements of an RDD.</span>
<span id="cb43-959"><a href="#cb43-959"></a></span>
<span id="cb43-960"><a href="#cb43-960"></a>The count action is based on the <span class="in">`count()`</span> method of the <span class="in">`RDD`</span> class: it returns the number of elements of the input RDD.</span>
<span id="cb43-961"><a href="#cb43-961"></a></span>
<span id="cb43-962"><a href="#cb43-962"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-963"><a href="#cb43-963"></a><span class="fu">### Example</span></span>
<span id="cb43-964"><a href="#cb43-964"></a><span class="ss">1. </span>Consider the textual files "document1.txt" and "document2.txt";</span>
<span id="cb43-965"><a href="#cb43-965"></a><span class="ss">2. </span>Print the name of the file with more lines.</span>
<span id="cb43-966"><a href="#cb43-966"></a></span>
<span id="cb43-967"><a href="#cb43-967"></a><span class="in">```python</span></span>
<span id="cb43-968"><a href="#cb43-968"></a><span class="co">## Read the content of the two input textual files</span></span>
<span id="cb43-969"><a href="#cb43-969"></a>inputRDD1 <span class="op">=</span> sc.textFile(<span class="st">"document1.txt"</span>)</span>
<span id="cb43-970"><a href="#cb43-970"></a>inputRDD2 <span class="op">=</span> sc.textFile(<span class="st">"document2.txt"</span>)</span>
<span id="cb43-971"><a href="#cb43-971"></a></span>
<span id="cb43-972"><a href="#cb43-972"></a><span class="co">## Count the number of lines of the two files = number of elements</span></span>
<span id="cb43-973"><a href="#cb43-973"></a><span class="co">## of the two RDDs</span></span>
<span id="cb43-974"><a href="#cb43-974"></a>numLinesDoc1 <span class="op">=</span> inputRDD1.count()</span>
<span id="cb43-975"><a href="#cb43-975"></a>numLinesDoc2 <span class="op">=</span> inputRDD2.count()</span>
<span id="cb43-976"><a href="#cb43-976"></a></span>
<span id="cb43-977"><a href="#cb43-977"></a><span class="cf">if</span> numLinesDoc1<span class="op">&gt;</span> numLinesDoc2: </span>
<span id="cb43-978"><a href="#cb43-978"></a>    <span class="bu">print</span>(<span class="st">"document1.txt"</span>)</span>
<span id="cb43-979"><a href="#cb43-979"></a><span class="cf">elif</span> numLinesDoc2<span class="op">&gt;</span> numLinesDoc1: </span>
<span id="cb43-980"><a href="#cb43-980"></a>    <span class="bu">print</span>(<span class="st">"document2.txt"</span>)</span>
<span id="cb43-981"><a href="#cb43-981"></a><span class="cf">else</span>: </span>
<span id="cb43-982"><a href="#cb43-982"></a>    <span class="bu">print</span>(<span class="st">"Same number of lines"</span>)</span>
<span id="cb43-983"><a href="#cb43-983"></a><span class="in">```</span></span>
<span id="cb43-984"><a href="#cb43-984"></a>:::</span>
<span id="cb43-985"><a href="#cb43-985"></a></span>
<span id="cb43-986"><a href="#cb43-986"></a><span class="fu">### CountByValue action</span></span>
<span id="cb43-987"><a href="#cb43-987"></a>The countByValue action returns a local python dictionary containing the information about the number of times each element occurs in the RDD</span>
<span id="cb43-988"><a href="#cb43-988"></a></span>
<span id="cb43-989"><a href="#cb43-989"></a><span class="ss">- </span>The keys of the dictionary are associated with the input elements</span>
<span id="cb43-990"><a href="#cb43-990"></a><span class="ss">- </span>The values are the frequencies of the elements</span>
<span id="cb43-991"><a href="#cb43-991"></a></span>
<span id="cb43-992"><a href="#cb43-992"></a>The countByValue action is based on the <span class="in">`countByValue()`</span> method of the <span class="in">`RDD`</span> class. The amount of used main memory in the Driver is related to the number of distinct elements/keys.</span>
<span id="cb43-993"><a href="#cb43-993"></a></span>
<span id="cb43-994"><a href="#cb43-994"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-995"><a href="#cb43-995"></a><span class="fu">### Example</span></span>
<span id="cb43-996"><a href="#cb43-996"></a><span class="ss">1. </span>Create an RDD from a textual file containing the first names of a list of users (each line contain one name);</span>
<span id="cb43-997"><a href="#cb43-997"></a><span class="ss">2. </span>Compute the number of occurrences of each name and store this information in a local variable of the Driver.</span>
<span id="cb43-998"><a href="#cb43-998"></a></span>
<span id="cb43-999"><a href="#cb43-999"></a><span class="in">```python</span></span>
<span id="cb43-1000"><a href="#cb43-1000"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb43-1001"><a href="#cb43-1001"></a>namesRDD <span class="op">=</span> sc.textFile(<span class="st">"names.txt"</span>)</span>
<span id="cb43-1002"><a href="#cb43-1002"></a></span>
<span id="cb43-1003"><a href="#cb43-1003"></a><span class="co">## Compute the number of occurrencies of each name</span></span>
<span id="cb43-1004"><a href="#cb43-1004"></a>namesOccurrences <span class="op">=</span> namesRDD.countByValue()</span>
<span id="cb43-1005"><a href="#cb43-1005"></a><span class="in">```</span></span>
<span id="cb43-1006"><a href="#cb43-1006"></a></span>
<span id="cb43-1007"><a href="#cb43-1007"></a>|||</span>
<span id="cb43-1008"><a href="#cb43-1008"></a>|-|-|</span>
<span id="cb43-1009"><a href="#cb43-1009"></a>| <span class="in">`namesOccurrences = namesRDD.countByValue()`</span> | Also in this case, pay attention to the size of the returned dictionary (that is related to the number of distinct names in this case). Use the <span class="in">`countByValue()`</span> action if and only if you are sure that the returned dictionary is small. Otherwise, use an appropriate chain of Spark’s transformations and write the final result in a file by using the <span class="in">`saveAsTextFile`</span> method.</span>
<span id="cb43-1010"><a href="#cb43-1010"></a></span>
<span id="cb43-1011"><a href="#cb43-1011"></a>:::</span>
<span id="cb43-1012"><a href="#cb43-1012"></a></span>
<span id="cb43-1013"><a href="#cb43-1013"></a><span class="fu">### Take action</span></span>
<span id="cb43-1014"><a href="#cb43-1014"></a>The <span class="in">`take(num)`</span> action returns a local python list of objects containing the first <span class="in">`num`</span> elements of the considered RDD. The order of the elements in an RDD is consistent with the order of the elements in the file or collection that has been used to create the RDD.</span>
<span id="cb43-1015"><a href="#cb43-1015"></a></span>
<span id="cb43-1016"><a href="#cb43-1016"></a>The take action is based on the <span class="in">`take(num)`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb43-1017"><a href="#cb43-1017"></a></span>
<span id="cb43-1018"><a href="#cb43-1018"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1019"><a href="#cb43-1019"></a><span class="fu">### Example</span></span>
<span id="cb43-1020"><a href="#cb43-1020"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1,5,3,3,2]`</span>;</span>
<span id="cb43-1021"><a href="#cb43-1021"></a><span class="ss">2. </span>Retrieve the first two values of the created RDD and store them in a local python list that is instantiated in the Driver.</span>
<span id="cb43-1022"><a href="#cb43-1022"></a></span>
<span id="cb43-1023"><a href="#cb43-1023"></a><span class="in">```python</span></span>
<span id="cb43-1024"><a href="#cb43-1024"></a><span class="co">## Create an RDD of integers. Load the values 1, 5, 3, 3,2 in this RDD</span></span>
<span id="cb43-1025"><a href="#cb43-1025"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>]</span>
<span id="cb43-1026"><a href="#cb43-1026"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-1027"><a href="#cb43-1027"></a></span>
<span id="cb43-1028"><a href="#cb43-1028"></a><span class="co">## Retrieve the first two elements of the inputRDD and store them in</span></span>
<span id="cb43-1029"><a href="#cb43-1029"></a><span class="co">## a local python list</span></span>
<span id="cb43-1030"><a href="#cb43-1030"></a>retrievedValues <span class="op">=</span> inputRDD.take(<span class="dv">2</span>)</span>
<span id="cb43-1031"><a href="#cb43-1031"></a><span class="in">```</span></span>
<span id="cb43-1032"><a href="#cb43-1032"></a>:::</span>
<span id="cb43-1033"><a href="#cb43-1033"></a></span>
<span id="cb43-1034"><a href="#cb43-1034"></a><span class="fu">### First action</span></span>
<span id="cb43-1035"><a href="#cb43-1035"></a>The <span class="in">`first()`</span> action returns a local python object containing the first element of the considered RDD. The order of the elements in an RDD is consistent with the order of the elements in the file or collection that has been used to create the RDD.</span>
<span id="cb43-1036"><a href="#cb43-1036"></a></span>
<span id="cb43-1037"><a href="#cb43-1037"></a>The first action is based on the <span class="in">`first()`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb43-1038"><a href="#cb43-1038"></a></span>
<span id="cb43-1039"><a href="#cb43-1039"></a>Notice that the only difference between <span class="in">`first()`</span> and <span class="in">`take(1)`</span> is given by the fact that <span class="in">`first()`</span> returns a single element (the returned element is the first element of the RDD), while <span class="in">`take(1)`</span> returns a list of elements containing one single element (the only element of the returned list is the first element of the RDD).</span>
<span id="cb43-1040"><a href="#cb43-1040"></a></span>
<span id="cb43-1041"><a href="#cb43-1041"></a><span class="fu">### Top action</span></span>
<span id="cb43-1042"><a href="#cb43-1042"></a>The <span class="in">`top(num)`</span> action returns a local python list of objects containing the top num (largest) elements of the considered RDD. The ordering is the default one of class associated with the objects stored in the RDD (the descending order is used).</span>
<span id="cb43-1043"><a href="#cb43-1043"></a></span>
<span id="cb43-1044"><a href="#cb43-1044"></a>The top action is based on the <span class="in">`top(num)`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb43-1045"><a href="#cb43-1045"></a></span>
<span id="cb43-1046"><a href="#cb43-1046"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1047"><a href="#cb43-1047"></a><span class="fu">### Example</span></span>
<span id="cb43-1048"><a href="#cb43-1048"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1,5,3,4,2]`</span>;</span>
<span id="cb43-1049"><a href="#cb43-1049"></a><span class="ss">2. </span>Retrieve the top-2 greatest values of the created RDD and store them in a local python list that is instantiated in the Driver.</span>
<span id="cb43-1050"><a href="#cb43-1050"></a></span>
<span id="cb43-1051"><a href="#cb43-1051"></a><span class="in">```python</span></span>
<span id="cb43-1052"><a href="#cb43-1052"></a><span class="co">## Create an RDD of integers. Load the values 1, 5, 3, 4,2 in this RDD</span></span>
<span id="cb43-1053"><a href="#cb43-1053"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>]</span>
<span id="cb43-1054"><a href="#cb43-1054"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-1055"><a href="#cb43-1055"></a></span>
<span id="cb43-1056"><a href="#cb43-1056"></a><span class="co">## Retrieve the top-2 elements of the inputRDD and store them in</span></span>
<span id="cb43-1057"><a href="#cb43-1057"></a><span class="co">## a local python list</span></span>
<span id="cb43-1058"><a href="#cb43-1058"></a>retrievedValues <span class="op">=</span> inputRDD.top(<span class="dv">2</span>)</span>
<span id="cb43-1059"><a href="#cb43-1059"></a><span class="in">```</span></span>
<span id="cb43-1060"><a href="#cb43-1060"></a>:::</span>
<span id="cb43-1061"><a href="#cb43-1061"></a></span>
<span id="cb43-1062"><a href="#cb43-1062"></a>The <span class="in">`top(num, key)`</span> action returns a local python list of objects containing the num largest elements of the considered RDD sorted by considering a user specified sorting function. </span>
<span id="cb43-1063"><a href="#cb43-1063"></a></span>
<span id="cb43-1064"><a href="#cb43-1064"></a>The top action is based on the <span class="in">`top(num, key)`</span> method of the <span class="in">`RDD`</span> class</span>
<span id="cb43-1065"><a href="#cb43-1065"></a></span>
<span id="cb43-1066"><a href="#cb43-1066"></a><span class="ss">- </span><span class="in">`num`</span> is the number of elements to be selected;</span>
<span id="cb43-1067"><a href="#cb43-1067"></a><span class="ss">- </span><span class="in">`key`</span> is a function that is applied on each input element before comparing them.</span>
<span id="cb43-1068"><a href="#cb43-1068"></a></span>
<span id="cb43-1069"><a href="#cb43-1069"></a>The comparison between elements is based on the values returned by the invocations of this function.</span>
<span id="cb43-1070"><a href="#cb43-1070"></a></span>
<span id="cb43-1071"><a href="#cb43-1071"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1072"><a href="#cb43-1072"></a><span class="fu">### Example</span></span>
<span id="cb43-1073"><a href="#cb43-1073"></a><span class="ss">1. </span>Create an RDD of strings containing the values <span class="in">`['Paolo','Giovanni','Luca']`</span>;</span>
<span id="cb43-1074"><a href="#cb43-1074"></a><span class="ss">2. </span>Retrieve the 2 longest names (longest strings) of the created RDD and store them in a local python list that is instantiated in the Driver.</span>
<span id="cb43-1075"><a href="#cb43-1075"></a></span>
<span id="cb43-1076"><a href="#cb43-1076"></a><span class="in">```python</span></span>
<span id="cb43-1077"><a href="#cb43-1077"></a><span class="co">## Create an RDD of strings. Load the values 'Paolo', 'Giovanni', 'Luca']</span></span>
<span id="cb43-1078"><a href="#cb43-1078"></a><span class="co">## in the RDD</span></span>
<span id="cb43-1079"><a href="#cb43-1079"></a>inputList <span class="op">=</span> [<span class="st">'Paolo'</span>,<span class="st">'Giovanni'</span>,<span class="st">'Luca'</span>]</span>
<span id="cb43-1080"><a href="#cb43-1080"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-1081"><a href="#cb43-1081"></a></span>
<span id="cb43-1082"><a href="#cb43-1082"></a><span class="co">## Retrieve the 2 longest names of the inputRDD and store them in</span></span>
<span id="cb43-1083"><a href="#cb43-1083"></a><span class="co">## a local python list</span></span>
<span id="cb43-1084"><a href="#cb43-1084"></a>retrievedValues <span class="op">=</span> inputRDD.top(<span class="dv">2</span>,<span class="kw">lambda</span> s:<span class="bu">len</span>(s))</span>
<span id="cb43-1085"><a href="#cb43-1085"></a><span class="in">```</span></span>
<span id="cb43-1086"><a href="#cb43-1086"></a>:::</span>
<span id="cb43-1087"><a href="#cb43-1087"></a></span>
<span id="cb43-1088"><a href="#cb43-1088"></a><span class="fu">### TakeOrdered action</span></span>
<span id="cb43-1089"><a href="#cb43-1089"></a>The <span class="in">`takeOrdered(num)`</span> action returns a local python list of objects containing the num smallest elements of the considered RDD. The ordering is the default one of class associated with the objects stored in the RDD (the ascending order is used).</span>
<span id="cb43-1090"><a href="#cb43-1090"></a></span>
<span id="cb43-1091"><a href="#cb43-1091"></a>The takeOrdered action is based on the <span class="in">`takeOrdered(num)`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb43-1092"><a href="#cb43-1092"></a></span>
<span id="cb43-1093"><a href="#cb43-1093"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1094"><a href="#cb43-1094"></a><span class="fu">### Example</span></span>
<span id="cb43-1095"><a href="#cb43-1095"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1,5,3,4,2]`</span>;</span>
<span id="cb43-1096"><a href="#cb43-1096"></a><span class="ss">2. </span>Retrieve the 2 smallest values of the created RDD and store them in a local python list that is instantiated in the Driver.</span>
<span id="cb43-1097"><a href="#cb43-1097"></a></span>
<span id="cb43-1098"><a href="#cb43-1098"></a><span class="in">```python</span></span>
<span id="cb43-1099"><a href="#cb43-1099"></a><span class="co">## Create an RDD of integers. Load the values 1, 5, 3, 4,2 in this RDD</span></span>
<span id="cb43-1100"><a href="#cb43-1100"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>]</span>
<span id="cb43-1101"><a href="#cb43-1101"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-1102"><a href="#cb43-1102"></a></span>
<span id="cb43-1103"><a href="#cb43-1103"></a><span class="co">## Retrieve the 2 smallest elements of the inputRDD and store them in</span></span>
<span id="cb43-1104"><a href="#cb43-1104"></a><span class="co">## a local python list</span></span>
<span id="cb43-1105"><a href="#cb43-1105"></a>retrievedValues <span class="op">=</span> inputRDD.takeOrdered(<span class="dv">2</span>)</span>
<span id="cb43-1106"><a href="#cb43-1106"></a><span class="in">```</span></span>
<span id="cb43-1107"><a href="#cb43-1107"></a></span>
<span id="cb43-1108"><a href="#cb43-1108"></a>:::</span>
<span id="cb43-1109"><a href="#cb43-1109"></a></span>
<span id="cb43-1110"><a href="#cb43-1110"></a></span>
<span id="cb43-1111"><a href="#cb43-1111"></a>The <span class="in">`takeOrdered(num, key)`</span> action returns a local python list of objects containing the num smallest elements of the considered RDD sorted by considering a user specified sorting function.</span>
<span id="cb43-1112"><a href="#cb43-1112"></a></span>
<span id="cb43-1113"><a href="#cb43-1113"></a>The takeOrdered action is based on the <span class="in">`takeOrdered(num, key)`</span> method of the <span class="in">`RDD`</span> class</span>
<span id="cb43-1114"><a href="#cb43-1114"></a></span>
<span id="cb43-1115"><a href="#cb43-1115"></a><span class="ss">- </span><span class="in">`num`</span> is the number of elements to be selected;</span>
<span id="cb43-1116"><a href="#cb43-1116"></a><span class="ss">- </span><span class="in">`key`</span> is a function that is applied on each input element before comparing them.</span>
<span id="cb43-1117"><a href="#cb43-1117"></a></span>
<span id="cb43-1118"><a href="#cb43-1118"></a>The comparison between elements is based on the values returned by the invocations of this function.</span>
<span id="cb43-1119"><a href="#cb43-1119"></a></span>
<span id="cb43-1120"><a href="#cb43-1120"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1121"><a href="#cb43-1121"></a><span class="fu">### Example</span></span>
<span id="cb43-1122"><a href="#cb43-1122"></a><span class="ss">1. </span>Create an RDD of strings containing the values <span class="in">`['Paolo','Giovanni','Luca']`</span>;</span>
<span id="cb43-1123"><a href="#cb43-1123"></a><span class="ss">2. </span>Retrieve the 2 shortest names (shortest strings) of the created RDD and store them in a local python list that is instantiated in the Driver.</span>
<span id="cb43-1124"><a href="#cb43-1124"></a></span>
<span id="cb43-1125"><a href="#cb43-1125"></a><span class="in">```python</span></span>
<span id="cb43-1126"><a href="#cb43-1126"></a><span class="co">## Create an RDD of strings. Load the values 'Paolo', 'Giovanni', 'Luca']</span></span>
<span id="cb43-1127"><a href="#cb43-1127"></a><span class="co">## in the RDD</span></span>
<span id="cb43-1128"><a href="#cb43-1128"></a>inputList <span class="op">=</span> [<span class="st">'Paolo'</span>,<span class="st">'Giovanni'</span>,<span class="st">'Luca'</span>]</span>
<span id="cb43-1129"><a href="#cb43-1129"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-1130"><a href="#cb43-1130"></a></span>
<span id="cb43-1131"><a href="#cb43-1131"></a><span class="co">## Retrieve the 2 shortest names of the inputRDD and store them in</span></span>
<span id="cb43-1132"><a href="#cb43-1132"></a><span class="co">## a local python list</span></span>
<span id="cb43-1133"><a href="#cb43-1133"></a>retrievedValues <span class="op">=</span> inputRDD.takeOrdered(<span class="dv">2</span>,<span class="kw">lambda</span> s:<span class="bu">len</span>(s))</span>
<span id="cb43-1134"><a href="#cb43-1134"></a><span class="in">```</span></span>
<span id="cb43-1135"><a href="#cb43-1135"></a></span>
<span id="cb43-1136"><a href="#cb43-1136"></a>:::</span>
<span id="cb43-1137"><a href="#cb43-1137"></a></span>
<span id="cb43-1138"><a href="#cb43-1138"></a><span class="fu">### TakeSample action</span></span>
<span id="cb43-1139"><a href="#cb43-1139"></a>The <span class="in">`takeSample(withReplacement, num)`</span> action returns a local python list of objects containing num random elements of the considered RDD.</span>
<span id="cb43-1140"><a href="#cb43-1140"></a></span>
<span id="cb43-1141"><a href="#cb43-1141"></a>The takeSampleaction is based on the <span class="in">`takeSample(withReplacement, num)`</span> method of the <span class="in">`RDD`</span> class, where <span class="in">`withReplacement`</span> specifies if the random sample is with replacement (True) or not (False).</span>
<span id="cb43-1142"><a href="#cb43-1142"></a></span>
<span id="cb43-1143"><a href="#cb43-1143"></a>The <span class="in">`takeSample(withReplacement, num, seed)`</span> method of the <span class="in">`RDD`</span> class is used when the seed has to be set.</span>
<span id="cb43-1144"><a href="#cb43-1144"></a></span>
<span id="cb43-1145"><a href="#cb43-1145"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1146"><a href="#cb43-1146"></a><span class="fu">### Example</span></span>
<span id="cb43-1147"><a href="#cb43-1147"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1,5,3,3,2]`</span>;</span>
<span id="cb43-1148"><a href="#cb43-1148"></a><span class="ss">2. </span>Retrieve randomly, without replacement, 2 values from the created RDD and store them in a local python list that is instantiated in the Driver.</span>
<span id="cb43-1149"><a href="#cb43-1149"></a></span>
<span id="cb43-1150"><a href="#cb43-1150"></a><span class="in">```python</span></span>
<span id="cb43-1151"><a href="#cb43-1151"></a><span class="co">## Create an RDD of integers. Load the values 1, 5, 3, 3,2 in this RDD</span></span>
<span id="cb43-1152"><a href="#cb43-1152"></a>inputList <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>]</span>
<span id="cb43-1153"><a href="#cb43-1153"></a>inputRDD <span class="op">=</span> sc.parallelize(inputList)</span>
<span id="cb43-1154"><a href="#cb43-1154"></a></span>
<span id="cb43-1155"><a href="#cb43-1155"></a><span class="co">## Retrieve randomly two elements of the inputRDD and store them in</span></span>
<span id="cb43-1156"><a href="#cb43-1156"></a><span class="co">## a local python list</span></span>
<span id="cb43-1157"><a href="#cb43-1157"></a>randomValues<span class="op">=</span> inputRDD.takeSample(<span class="va">True</span>, <span class="dv">2</span>)</span>
<span id="cb43-1158"><a href="#cb43-1158"></a><span class="in">```</span></span>
<span id="cb43-1159"><a href="#cb43-1159"></a></span>
<span id="cb43-1160"><a href="#cb43-1160"></a>:::</span>
<span id="cb43-1161"><a href="#cb43-1161"></a></span>
<span id="cb43-1162"><a href="#cb43-1162"></a><span class="fu">### Reduce</span></span>
<span id="cb43-1163"><a href="#cb43-1163"></a>Return a single python object obtained by combining all the objects of the input RDD by using a user provide function. The provided function must be associative and commutative, otherwise the result depends on the content of the partitions and the order used to analyze the elements of the RDD's partitions. The returned object and the ones of the input RDD are all instances of the same data type/class.</span>
<span id="cb43-1164"><a href="#cb43-1164"></a></span>
<span id="cb43-1165"><a href="#cb43-1165"></a>The reduce action is based on the <span class="in">`reduce(f)`</span> method of the <span class="in">`RDD`</span> class: a function <span class="in">`f`</span> is passed to the reduce method</span>
<span id="cb43-1166"><a href="#cb43-1166"></a></span>
<span id="cb43-1167"><a href="#cb43-1167"></a><span class="ss">- </span>Given two arbitrary input elements, <span class="in">`f`</span> is used to combine them in one single value</span>
<span id="cb43-1168"><a href="#cb43-1168"></a><span class="ss">- </span><span class="in">`f`</span> is recursively invoked over the elements of the input RDD until the input values are reduced to one single value</span>
<span id="cb43-1169"><a href="#cb43-1169"></a></span>
<span id="cb43-1170"><a href="#cb43-1170"></a>Suppose $L$ contains the list of elements of the input RDD. To compute the final element/value, the reduce action operates as follows</span>
<span id="cb43-1171"><a href="#cb43-1171"></a></span>
<span id="cb43-1172"><a href="#cb43-1172"></a><span class="ss">1. </span>Apply the user specified function on a pair of elements $e_1$ and $e_2$ occurring in $L$ and obtain a new element $e_\textbf{new}$;</span>
<span id="cb43-1173"><a href="#cb43-1173"></a><span class="ss">2. </span>Remove the original elements $e_1$ and $e_2$ from $L$ and then insert the element $e_\textbf{new}$ in $L$;</span>
<span id="cb43-1174"><a href="#cb43-1174"></a><span class="ss">3. </span>If $L$ contains only one value, then return it as final result of the reduce action, otherwise, return to step 1.</span>
<span id="cb43-1175"><a href="#cb43-1175"></a></span>
<span id="cb43-1176"><a href="#cb43-1176"></a>Function $f$ must be associative and commutative, so that the computation of the reduce action can be performed in parallel without problems, otherwise the result depends on how the input RDD is partitioned (i.e., for the functions that are not associative and commutative the output depends on how the RDD is split in partitions and how the content of each partition is analyzed).</span>
<span id="cb43-1177"><a href="#cb43-1177"></a></span>
<span id="cb43-1178"><a href="#cb43-1178"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1179"><a href="#cb43-1179"></a><span class="fu">### Example 1</span></span>
<span id="cb43-1180"><a href="#cb43-1180"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1,2,3,3]`</span>;</span>
<span id="cb43-1181"><a href="#cb43-1181"></a><span class="ss">2. </span>Compute the sum of the values occurring in the RDD and store the result in a local python integer variable in the Driver.</span>
<span id="cb43-1182"><a href="#cb43-1182"></a></span>
<span id="cb43-1183"><a href="#cb43-1183"></a><span class="in">```python</span></span>
<span id="cb43-1184"><a href="#cb43-1184"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-1185"><a href="#cb43-1185"></a>inputListReduce <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb43-1186"><a href="#cb43-1186"></a>inputRDDReduce <span class="op">=</span> sc.parallelize(inputListReduce)</span>
<span id="cb43-1187"><a href="#cb43-1187"></a></span>
<span id="cb43-1188"><a href="#cb43-1188"></a><span class="co">## Compute the sum of the values</span></span>
<span id="cb43-1189"><a href="#cb43-1189"></a>sumValues <span class="op">=</span> inputRDDReduce.<span class="bu">reduce</span>(<span class="kw">lambda</span> e1, e2: e1<span class="op">+</span>e2)</span>
<span id="cb43-1190"><a href="#cb43-1190"></a><span class="in">```</span></span>
<span id="cb43-1191"><a href="#cb43-1191"></a></span>
<span id="cb43-1192"><a href="#cb43-1192"></a>|||</span>
<span id="cb43-1193"><a href="#cb43-1193"></a>|-|---|</span>
<span id="cb43-1194"><a href="#cb43-1194"></a>| <span class="in">`lambda e1, e2: e1+e2`</span> | This lambda function combines two input integer elements at a time and returns theirs sum. |</span>
<span id="cb43-1195"><a href="#cb43-1195"></a>:::</span>
<span id="cb43-1196"><a href="#cb43-1196"></a></span>
<span id="cb43-1197"><a href="#cb43-1197"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1198"><a href="#cb43-1198"></a><span class="fu">### Example 2</span></span>
<span id="cb43-1199"><a href="#cb43-1199"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1,2,3,3]`</span>;</span>
<span id="cb43-1200"><a href="#cb43-1200"></a><span class="ss">2. </span>Compute the maximum value occurring in the RDD and store the result in a local python integer variable in the Driver.</span>
<span id="cb43-1201"><a href="#cb43-1201"></a></span>
<span id="cb43-1202"><a href="#cb43-1202"></a>**Solution 1**</span>
<span id="cb43-1203"><a href="#cb43-1203"></a></span>
<span id="cb43-1204"><a href="#cb43-1204"></a><span class="in">```python</span></span>
<span id="cb43-1205"><a href="#cb43-1205"></a><span class="co">## Define the function for the reduce action</span></span>
<span id="cb43-1206"><a href="#cb43-1206"></a><span class="kw">def</span> computeMax(v1,v2):</span>
<span id="cb43-1207"><a href="#cb43-1207"></a>    <span class="cf">if</span> v1<span class="op">&gt;</span>v2:</span>
<span id="cb43-1208"><a href="#cb43-1208"></a>        <span class="cf">return</span> v1</span>
<span id="cb43-1209"><a href="#cb43-1209"></a>    <span class="cf">else</span>:</span>
<span id="cb43-1210"><a href="#cb43-1210"></a>        <span class="cf">return</span> v2</span>
<span id="cb43-1211"><a href="#cb43-1211"></a></span>
<span id="cb43-1212"><a href="#cb43-1212"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-1213"><a href="#cb43-1213"></a>inputListReduce <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb43-1214"><a href="#cb43-1214"></a>inputRDDReduce <span class="op">=</span> sc.parallelize(inputListReduce)</span>
<span id="cb43-1215"><a href="#cb43-1215"></a></span>
<span id="cb43-1216"><a href="#cb43-1216"></a><span class="co">## Compute the maximum value</span></span>
<span id="cb43-1217"><a href="#cb43-1217"></a>maxValue <span class="op">=</span> inputRDDReduce.<span class="bu">reduce</span>(computeMax)</span>
<span id="cb43-1218"><a href="#cb43-1218"></a><span class="in">```</span></span>
<span id="cb43-1219"><a href="#cb43-1219"></a></span>
<span id="cb43-1220"><a href="#cb43-1220"></a>**Solution 2**</span>
<span id="cb43-1221"><a href="#cb43-1221"></a></span>
<span id="cb43-1222"><a href="#cb43-1222"></a><span class="in">```python</span></span>
<span id="cb43-1223"><a href="#cb43-1223"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-1224"><a href="#cb43-1224"></a>inputListReduce <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb43-1225"><a href="#cb43-1225"></a>inputRDDReduce <span class="op">=</span> sc.parallelize(inputListReduce)</span>
<span id="cb43-1226"><a href="#cb43-1226"></a></span>
<span id="cb43-1227"><a href="#cb43-1227"></a><span class="co">## Compute the maximum value</span></span>
<span id="cb43-1228"><a href="#cb43-1228"></a>maxValue <span class="op">=</span> inputRDDReduce.<span class="bu">reduce</span>(<span class="kw">lambda</span> e1, e2: <span class="bu">max</span>(e1, e2))</span>
<span id="cb43-1229"><a href="#cb43-1229"></a><span class="in">```</span></span>
<span id="cb43-1230"><a href="#cb43-1230"></a>:::</span>
<span id="cb43-1231"><a href="#cb43-1231"></a></span>
<span id="cb43-1232"><a href="#cb43-1232"></a><span class="fu">### Fold action</span></span>
<span id="cb43-1233"><a href="#cb43-1233"></a>Return a single python object obtained by combining all the objects of the input RDD and a "zero" value by using a user provided function, which must be associative (otherwise the result depends on how the RDD is partitioned), but it is not required to be commutative. An initial neutral "zero" value is also specified. </span>
<span id="cb43-1234"><a href="#cb43-1234"></a></span>
<span id="cb43-1235"><a href="#cb43-1235"></a>The fold action is based on the <span class="in">`fold(zeroValue, op)`</span> method of the <span class="in">`RDD`</span> class. A function <span class="in">`op`</span> is passed to the fold method; given two arbitrary input elements, <span class="in">`op`</span> is </span>
<span id="cb43-1236"><a href="#cb43-1236"></a></span>
<span id="cb43-1237"><a href="#cb43-1237"></a><span class="ss">- </span>used to combine them in one single value</span>
<span id="cb43-1238"><a href="#cb43-1238"></a><span class="ss">- </span>used to combine input elements with the "zero" value</span>
<span id="cb43-1239"><a href="#cb43-1239"></a><span class="ss">- </span>recursively invoked over the elements of the input RDD until the input values are reduced to one single value</span>
<span id="cb43-1240"><a href="#cb43-1240"></a></span>
<span id="cb43-1241"><a href="#cb43-1241"></a>The "zero" value is the neutral value for the used function <span class="in">`op`</span> (i.e., "zero" combined with any value $v$ by using <span class="in">`op`</span> is equal to $v$).</span>
<span id="cb43-1242"><a href="#cb43-1242"></a></span>
<span id="cb43-1243"><a href="#cb43-1243"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1244"><a href="#cb43-1244"></a><span class="fu">### Example 1</span></span>
<span id="cb43-1245"><a href="#cb43-1245"></a><span class="ss">1. </span>Create an RDD of strings containing the values <span class="in">`['This ','is ','a ','test']`</span>;</span>
<span id="cb43-1246"><a href="#cb43-1246"></a><span class="ss">2. </span>Compute the concatenation of the values occurring in the RDD (from left to right) and store the result in a local python string variable in the Driver.</span>
<span id="cb43-1247"><a href="#cb43-1247"></a></span>
<span id="cb43-1248"><a href="#cb43-1248"></a><span class="in">```python</span></span>
<span id="cb43-1249"><a href="#cb43-1249"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-1250"><a href="#cb43-1250"></a>inputListFold <span class="op">=</span> [<span class="st">'This '</span>,<span class="st">'is '</span>,<span class="st">'a '</span>,<span class="st">'test'</span>]</span>
<span id="cb43-1251"><a href="#cb43-1251"></a>inputRDDFold <span class="op">=</span> sc.parallelize(inputListFold)</span>
<span id="cb43-1252"><a href="#cb43-1252"></a></span>
<span id="cb43-1253"><a href="#cb43-1253"></a><span class="co">## Concatenate the input strings</span></span>
<span id="cb43-1254"><a href="#cb43-1254"></a>finalString <span class="op">=</span> inputRDDFold.fold(<span class="st">''</span>, <span class="kw">lambda</span> s1, s2: s1<span class="op">+</span>s2)</span>
<span id="cb43-1255"><a href="#cb43-1255"></a><span class="in">```</span></span>
<span id="cb43-1256"><a href="#cb43-1256"></a></span>
<span id="cb43-1257"><a href="#cb43-1257"></a>:::</span>
<span id="cb43-1258"><a href="#cb43-1258"></a></span>
<span id="cb43-1259"><a href="#cb43-1259"></a>:::{.callout-tip}</span>
<span id="cb43-1260"><a href="#cb43-1260"></a><span class="fu">### Fold vs Reduce</span></span>
<span id="cb43-1261"><a href="#cb43-1261"></a><span class="ss">1. </span>Fold is characterized by the "zero" value;</span>
<span id="cb43-1262"><a href="#cb43-1262"></a><span class="ss">2. </span>Fold can be used to parallelize functions that are associative but non-commutative (e.g., concatenation of a list of strings).</span>
<span id="cb43-1263"><a href="#cb43-1263"></a>:::</span>
<span id="cb43-1264"><a href="#cb43-1264"></a></span>
<span id="cb43-1265"><a href="#cb43-1265"></a><span class="fu">### Aggregate action</span></span>
<span id="cb43-1266"><a href="#cb43-1266"></a>Return a single python object obtained by combining the objects of the RDD and an initial "zero" value by using two user provide functions. The provided functions must be associative, otherwise the result depends on how the RDD is partitioned. The returned objects and the ones of the input RDD can be instances of different classes (this is the main difference with respect to <span class="in">`reduce()`</span> and <span class="in">`fold()`</span>).</span>
<span id="cb43-1267"><a href="#cb43-1267"></a></span>
<span id="cb43-1268"><a href="#cb43-1268"></a>The aggregate action is based on the <span class="in">`aggregate(zeroValue,seqOp,combOp)`</span> method of the <span class="in">`RDD`</span> class. The input RDD contains objects of type <span class="in">`T`</span> while the returned object is of type <span class="in">`U`</span>, with <span class="in">`U`</span> different from <span class="in">`T`</span>.</span>
<span id="cb43-1269"><a href="#cb43-1269"></a></span>
<span id="cb43-1270"><a href="#cb43-1270"></a><span class="ss">- </span>One function is needed for merging an element of type <span class="in">`T`</span> with an element of type <span class="in">`U`</span> to return a new element of type <span class="in">`U`</span>: it is used to merge the elements of the input RDD and the accumulator of each partition;</span>
<span id="cb43-1271"><a href="#cb43-1271"></a><span class="ss">- </span>One function is needed for merging two elements of type <span class="in">`U`</span> to return a new element of type <span class="in">`U`</span>: it is used to merge two elements of type U obtained as partial results generated by two different partitions.</span>
<span id="cb43-1272"><a href="#cb43-1272"></a></span>
<span id="cb43-1273"><a href="#cb43-1273"></a>The <span class="in">`seqOp`</span> function contains the code that is applied to combine the accumulator value (one accumulator for each partition) with the elements of each partition: one local result per partition is computed by recursively applying <span class="in">`seqOp`</span>.</span>
<span id="cb43-1274"><a href="#cb43-1274"></a></span>
<span id="cb43-1275"><a href="#cb43-1275"></a>The <span class="in">`combOp`</span> function contains the code that is applied to combine two elements of type U returned as partial results by two different partitions: the global final result is computed by recursively applying <span class="in">`combOp`</span>.</span>
<span id="cb43-1276"><a href="#cb43-1276"></a></span>
<span id="cb43-1277"><a href="#cb43-1277"></a></span>
<span id="cb43-1278"><a href="#cb43-1278"></a><span class="fu">#### How it works</span></span>
<span id="cb43-1279"><a href="#cb43-1279"></a>Suppose that $L$ contains the list of elements of the input RDD and this RDD is split in a set of partitions (i.e., a set of lists ${L_1,..., L_n}$). The aggregate action computes a partial result in each partition and then combines/merges the results. It operates as follows:</span>
<span id="cb43-1280"><a href="#cb43-1280"></a></span>
<span id="cb43-1281"><a href="#cb43-1281"></a><span class="ss">1. </span>Aggregate the partial results in each partition, obtaining a set of partial results (of type <span class="in">`U`</span>) $P={p_1, .., p_n}$;</span>
<span id="cb43-1282"><a href="#cb43-1282"></a><span class="ss">2. </span>Apply the <span class="in">`combOp`</span> function on a pair of elements $p_1$ and $p_2$ in $P$ and obtain a new element $p_\textbf{new}$;</span>
<span id="cb43-1283"><a href="#cb43-1283"></a><span class="ss">3. </span>Remove the original elements $p1$ and $p2$ from $P$ and then insert the element $p_\textbf{new}$ in $P$;</span>
<span id="cb43-1284"><a href="#cb43-1284"></a><span class="ss">4. </span>If $P$ contains only one value then return it as final result of the aggregate action. Otherwise, return to step 2.</span>
<span id="cb43-1285"><a href="#cb43-1285"></a></span>
<span id="cb43-1286"><a href="#cb43-1286"></a>Suppose that $L_i$ is the list of elements on the $i$-th partition of the input RDD, and <span class="in">`zeroValue`</span> is the initial zero value. To compute the partial result over the elements in $L_i$ the aggregate action operates as follows </span>
<span id="cb43-1287"><a href="#cb43-1287"></a></span>
<span id="cb43-1288"><a href="#cb43-1288"></a><span class="ss">1. </span>Set <span class="in">`accumulator`</span> to <span class="in">`zeroValue`</span> (<span class="in">`accumulator=zeroValue`</span>);</span>
<span id="cb43-1289"><a href="#cb43-1289"></a><span class="ss">2. </span>Apply the <span class="in">`seqOp`</span> function on <span class="in">`accumulator`</span> and an elements $ej$ in $L_i$ and update <span class="in">`accumulator`</span> with the value returned by <span class="in">`seqOp`</span>;</span>
<span id="cb43-1290"><a href="#cb43-1290"></a><span class="ss">3. </span>Remove the original elements $e_j$ from $L_i$;</span>
<span id="cb43-1291"><a href="#cb43-1291"></a><span class="ss">4. </span>If $L_i$ is empty return <span class="in">`accumulator`</span> as (final) partial result $p_i$ of the $i$-th partition. Otherwise, return to step 2.</span>
<span id="cb43-1292"><a href="#cb43-1292"></a></span>
<span id="cb43-1293"><a href="#cb43-1293"></a>:::{.callout-note collapse="true"}</span>
<span id="cb43-1294"><a href="#cb43-1294"></a><span class="ss">1. </span>Create an RDD of integers containing the values <span class="in">`[1,2,3,3]`</span>;</span>
<span id="cb43-1295"><a href="#cb43-1295"></a><span class="ss">2. </span>Compute both</span>
<span id="cb43-1296"><a href="#cb43-1296"></a><span class="ss">    - </span>the sum of the values occurring in the input RDD</span>
<span id="cb43-1297"><a href="#cb43-1297"></a><span class="ss">    - </span>and the number of elements of the input RDD</span>
<span id="cb43-1298"><a href="#cb43-1298"></a><span class="ss">3. </span>Store in a local python variable of the Driver the average computed over the values of the input RDD.</span>
<span id="cb43-1299"><a href="#cb43-1299"></a></span>
<span id="cb43-1300"><a href="#cb43-1300"></a><span class="in">```python</span></span>
<span id="cb43-1301"><a href="#cb43-1301"></a><span class="co">## Create an RDD of integers. Load the values 1, 2, 3, 3 in this RDD</span></span>
<span id="cb43-1302"><a href="#cb43-1302"></a>inputListAggr <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb43-1303"><a href="#cb43-1303"></a>inRDD <span class="op">=</span> sc.parallelize(inputListAggr)</span>
<span id="cb43-1304"><a href="#cb43-1304"></a></span>
<span id="cb43-1305"><a href="#cb43-1305"></a><span class="co">## Instantiate the zero value</span></span>
<span id="cb43-1306"><a href="#cb43-1306"></a><span class="co">## We use a tuple containing two values:</span></span>
<span id="cb43-1307"><a href="#cb43-1307"></a><span class="co">## (sum, number of represented elements)</span></span>
<span id="cb43-1308"><a href="#cb43-1308"></a>zeroValue <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb43-1309"><a href="#cb43-1309"></a></span>
<span id="cb43-1310"><a href="#cb43-1310"></a><span class="co">## Compute the sum of the elements in inputRDDAggr and count them</span></span>
<span id="cb43-1311"><a href="#cb43-1311"></a>sumCount <span class="op">=</span> inRDD.aggregate(</span>
<span id="cb43-1312"><a href="#cb43-1312"></a>    zeroValue,</span>
<span id="cb43-1313"><a href="#cb43-1313"></a>    <span class="kw">lambda</span> acc, e: (acc[<span class="dv">0</span>]<span class="op">+</span>e, acc[<span class="dv">1</span>]<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb43-1314"><a href="#cb43-1314"></a>    <span class="kw">lambda</span> p1, p2: (p1[<span class="dv">0</span>]<span class="op">+</span>p2[<span class="dv">0</span>], p1[<span class="dv">1</span>]<span class="op">+</span>p2[<span class="dv">1</span>])</span>
<span id="cb43-1315"><a href="#cb43-1315"></a>)</span>
<span id="cb43-1316"><a href="#cb43-1316"></a><span class="in">```</span></span>
<span id="cb43-1317"><a href="#cb43-1317"></a></span>
<span id="cb43-1318"><a href="#cb43-1318"></a>|||</span>
<span id="cb43-1319"><a href="#cb43-1319"></a>|-|--|</span>
<span id="cb43-1320"><a href="#cb43-1320"></a>| <span class="in">`zeroValue(0,0)`</span> | Instantiate the "zero" value |</span>
<span id="cb43-1321"><a href="#cb43-1321"></a>| <span class="in">`lambda acc, e: (acc[0]+e, acc[1]+1)`</span> | Given a partition $p$ of the input RDD, this is the function that is used to combine the elements of partition $p$ with the accumulator of partition $p$ |</span>
<span id="cb43-1322"><a href="#cb43-1322"></a>| <span class="in">`acc`</span> | It is a tupe object, initialized to the "zero" value |</span>
<span id="cb43-1323"><a href="#cb43-1323"></a>| <span class="in">`e`</span> | It is an integer |</span>
<span id="cb43-1324"><a href="#cb43-1324"></a>| <span class="in">`lambda p1, p2: (p1[0]+p2[0], p1[1]+p2[1])`</span> | This is the function that is used to combine the partial results emitted by the RDD partitions |</span>
<span id="cb43-1325"><a href="#cb43-1325"></a>| <span class="in">`p1`</span> and <span class="in">`p2`</span> | These are tuple objects |</span>
<span id="cb43-1326"><a href="#cb43-1326"></a></span>
<span id="cb43-1327"><a href="#cb43-1327"></a><span class="in">```python</span></span>
<span id="cb43-1328"><a href="#cb43-1328"></a><span class="co">## Compute the average value</span></span>
<span id="cb43-1329"><a href="#cb43-1329"></a>myAvg <span class="op">=</span> sumCount[<span class="dv">0</span>]<span class="op">/</span>sumCount[<span class="dv">1</span>]</span>
<span id="cb43-1330"><a href="#cb43-1330"></a></span>
<span id="cb43-1331"><a href="#cb43-1331"></a><span class="co">## Print the average on the standard output of the driver</span></span>
<span id="cb43-1332"><a href="#cb43-1332"></a><span class="bu">print</span>(<span class="st">'Average:'</span>, myAvg)</span>
<span id="cb43-1333"><a href="#cb43-1333"></a><span class="in">```</span></span>
<span id="cb43-1334"><a href="#cb43-1334"></a></span>
<span id="cb43-1335"><a href="#cb43-1335"></a>:::</span>
<span id="cb43-1336"><a href="#cb43-1336"></a></span>
<span id="cb43-1337"><a href="#cb43-1337"></a><span class="fu">#### Aggregate action: visual simulation</span></span>
<span id="cb43-1338"><a href="#cb43-1338"></a><span class="ss">- </span><span class="in">`inRDD = [1,2,3,3]`</span>;</span>
<span id="cb43-1339"><a href="#cb43-1339"></a><span class="ss">- </span>Suppose <span class="in">`inRDD`</span> is split in the following two partitions, <span class="in">`[1,2]`</span> and <span class="in">`[3,3]`</span>.</span>
<span id="cb43-1340"><a href="#cb43-1340"></a></span>
<span id="cb43-1341"><a href="#cb43-1341"></a><span class="al">![Visual simulation of the aggregate action](images/11_rdd_based_programming/aggregate_action_simulation.png)</span>{width=80%}</span>
<span id="cb43-1342"><a href="#cb43-1342"></a></span>
<span id="cb43-1343"><a href="#cb43-1343"></a><span class="fu">### Summary</span></span>
<span id="cb43-1344"><a href="#cb43-1344"></a>All the examples reported in the following tables are applied on inputRDD that is an RDD of integers containing the following elements (i.e., values): <span class="in">`[1,2,3,3]`</span>.</span>
<span id="cb43-1345"><a href="#cb43-1345"></a></span>
<span id="cb43-1346"><a href="#cb43-1346"></a>::::{.content-visible when-format="html"}</span>
<span id="cb43-1347"><a href="#cb43-1347"></a>:::{.column-page}</span>
<span id="cb43-1348"><a href="#cb43-1348"></a></span>
<span id="cb43-1349"><a href="#cb43-1349"></a>**Purposes**</span>
<span id="cb43-1350"><a href="#cb43-1350"></a></span>
<span id="cb43-1351"><a href="#cb43-1351"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1352"><a href="#cb43-1352"></a>| Action                                   | Purpose                                                                                                                                                                                                                                                                     |</span>
<span id="cb43-1353"><a href="#cb43-1353"></a>+==========================================+=============================================================================================================================================================================================================================================================================+</span>
<span id="cb43-1354"><a href="#cb43-1354"></a>| <span class="in">`collect()`</span>                              | Return a python list containing all the elements of the RDD on which it is applied. The objects of the RDD and objects of the returned list are objects of the same class.                                                                                                  |</span>
<span id="cb43-1355"><a href="#cb43-1355"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1356"><a href="#cb43-1356"></a>| <span class="in">`count()`</span>                                | Return the number of elements of the RDD.                                                                                                                                                                                                                                   |</span>
<span id="cb43-1357"><a href="#cb43-1357"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1358"><a href="#cb43-1358"></a>| <span class="in">`countByValue()`</span>                         | Return a Map object containing the information about the number of times each element occurs in the RDD.                                                                                                                                                                    |</span>
<span id="cb43-1359"><a href="#cb43-1359"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1360"><a href="#cb43-1360"></a>| <span class="in">`take(num)`</span>                              | Return a Python list containing the first <span class="in">`num`</span> elements of the RDD. The objects of the RDD and objects of the returned list are objects of the same class.                                                                                                                 |</span>
<span id="cb43-1361"><a href="#cb43-1361"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1362"><a href="#cb43-1362"></a>| <span class="in">`first()`</span>                                | Return the first element of the RDD.                                                                                                                                                                                                                                        |</span>
<span id="cb43-1363"><a href="#cb43-1363"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1364"><a href="#cb43-1364"></a>| <span class="in">`top(num)`</span>                               | Return a Python list containing the top <span class="in">`num`</span> elements of the RDD based on the default sort order/comparator of the objects. The objects of the RDD and objects of the returned list are objects of the same class.                                                         |</span>
<span id="cb43-1365"><a href="#cb43-1365"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1366"><a href="#cb43-1366"></a>| <span class="in">`takeSample(withReplacement, num)`</span>       | Return a (Python) List containing a random sample of size <span class="in">`n`</span> of the RDD. The objects of the RDD and objects of the returned list are objects of the same class.                                                                                                            |</span>
<span id="cb43-1367"><a href="#cb43-1367"></a>|                                          |                                                                                                                                                                                                                                                                             |</span>
<span id="cb43-1368"><a href="#cb43-1368"></a>| <span class="in">`takeSample(withReplacement, num, seed)`</span> |                                                                                                                                                                                                                                                                             |</span>
<span id="cb43-1369"><a href="#cb43-1369"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1370"><a href="#cb43-1370"></a>| <span class="in">`reduce(f)`</span>                              | Return a single Python object obtained by combining the values of the objects of the RDD by using a user provide function. The provided function must be associative and commutative The object returned by the method and the objects of the RDD belong to the same class. |</span>
<span id="cb43-1371"><a href="#cb43-1371"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1372"><a href="#cb43-1372"></a>| <span class="in">`fold(zeroValue, op)`</span>                    | Same as reduce but with the provided zero value.                                                                                                                                                                                                                            |</span>
<span id="cb43-1373"><a href="#cb43-1373"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1374"><a href="#cb43-1374"></a>| <span class="in">`Aggregate(zeroValue, seqOp, combOp)`</span>    | Similar to <span class="in">`reduce()`</span> but used to return a different type.                                                                                                                                                                                                                  |</span>
<span id="cb43-1375"><a href="#cb43-1375"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1376"><a href="#cb43-1376"></a></span>
<span id="cb43-1377"><a href="#cb43-1377"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb43-1378"><a href="#cb43-1378"></a></span>
<span id="cb43-1379"><a href="#cb43-1379"></a>**Examples**</span>
<span id="cb43-1380"><a href="#cb43-1380"></a></span>
<span id="cb43-1381"><a href="#cb43-1381"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1382"><a href="#cb43-1382"></a>| Action                                   | Example                                                                                                                  | Result           |</span>
<span id="cb43-1383"><a href="#cb43-1383"></a>+==========================================+==========================================================================================================================+==================+</span>
<span id="cb43-1384"><a href="#cb43-1384"></a>| <span class="in">`collect()`</span>                              | <span class="in">`inputRDD.collect()`</span>                                                                                                     | <span class="in">`[1,2,3,3]`</span>      |</span>
<span id="cb43-1385"><a href="#cb43-1385"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1386"><a href="#cb43-1386"></a>| <span class="in">`count()`</span>                                | <span class="in">`inputRDD.count()`</span>                                                                                                       | <span class="in">`4`</span>              |</span>
<span id="cb43-1387"><a href="#cb43-1387"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1388"><a href="#cb43-1388"></a>| <span class="in">`countByValue()`</span>                         | <span class="in">`inputRDD.countByValue()`</span>                                                                                                | <span class="in">`[(1,1),`</span>        |</span>
<span id="cb43-1389"><a href="#cb43-1389"></a>|                                          |                                                                                                                          | <span class="in">`(2,1),`</span>         |</span>
<span id="cb43-1390"><a href="#cb43-1390"></a>|                                          |                                                                                                                          | <span class="in">`(3,2)]`</span>         |</span>
<span id="cb43-1391"><a href="#cb43-1391"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1392"><a href="#cb43-1392"></a>| <span class="in">`take(num)`</span>                              | <span class="in">`inputRDD.take(2)`</span>                                                                                                       | <span class="in">`[1,2]`</span>          |</span>
<span id="cb43-1393"><a href="#cb43-1393"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1394"><a href="#cb43-1394"></a>| <span class="in">`first()`</span>                                | <span class="in">`first()`</span>                                                                                                                | <span class="in">`1`</span>              |</span>
<span id="cb43-1395"><a href="#cb43-1395"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1396"><a href="#cb43-1396"></a>| <span class="in">`top(num)`</span>                               | <span class="in">`inputRDD.top(2)`</span>                                                                                                        | <span class="in">`[3,3]`</span>          |</span>
<span id="cb43-1397"><a href="#cb43-1397"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1398"><a href="#cb43-1398"></a>| <span class="in">`takeSample(withReplacement, num)`</span>       | <span class="in">`inputRDD.takeSample(False,1)`</span>                                                                                           | Nondeterministic |</span>
<span id="cb43-1399"><a href="#cb43-1399"></a>|                                          |                                                                                                                          |                  |</span>
<span id="cb43-1400"><a href="#cb43-1400"></a>| <span class="in">`takeSample(withReplacement, num, seed)`</span> |                                                                                                                          |                  |</span>
<span id="cb43-1401"><a href="#cb43-1401"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1402"><a href="#cb43-1402"></a>| <span class="in">`reduce(f)`</span>                              | <span class="in">`inputRDD.reduce(lambda e1,e2: e1+e2)`</span>                                                                                   | <span class="in">`9`</span>              |</span>
<span id="cb43-1403"><a href="#cb43-1403"></a>|                                          |                                                                                                                          |                  |</span>
<span id="cb43-1404"><a href="#cb43-1404"></a>|                                          | The passed function is the sum                                                                                           |                  |</span>
<span id="cb43-1405"><a href="#cb43-1405"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1406"><a href="#cb43-1406"></a>| <span class="in">`fold(zeroValue, op)`</span>                    | <span class="in">`inputRDD.fold(0, lambda v1, v2: v1+v2)`</span>                                                                                 | <span class="in">`9`</span>              |</span>
<span id="cb43-1407"><a href="#cb43-1407"></a>|                                          |                                                                                                                          |                  |</span>
<span id="cb43-1408"><a href="#cb43-1408"></a>|                                          | The passed function is the sum and the passed zeroValue is 0.                                                            |                  |</span>
<span id="cb43-1409"><a href="#cb43-1409"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1410"><a href="#cb43-1410"></a>| <span class="in">`Aggregate(zeroValue, seqOp, combOp)`</span>    | <span class="in">`inputRDD.aggregate(`</span>                                                                                                    | <span class="in">`(9,4)`</span>          |</span>
<span id="cb43-1411"><a href="#cb43-1411"></a>|                                          | <span class="in">`    zeroValue,`</span>                                                                                                         |                  |</span>
<span id="cb43-1412"><a href="#cb43-1412"></a>|                                          | <span class="in">`    lambda acc, e: (acc[0]+e, acc[1]+1),`</span>                                                                               |                  |</span>
<span id="cb43-1413"><a href="#cb43-1413"></a>|                                          | <span class="in">`    lambda p1, p2: (p1[0]+p2[0], p1[1]+p2[1])`</span>                                                                          |                  |</span>
<span id="cb43-1414"><a href="#cb43-1414"></a>|                                          | <span class="in">`)`</span>                                                                                                                      |                  |</span>
<span id="cb43-1415"><a href="#cb43-1415"></a>|                                          |                                                                                                                          |                  |</span>
<span id="cb43-1416"><a href="#cb43-1416"></a>|                                          | Compute a pair of integers where the first one is the sum of the values of the RDD and the second the number of elements |                  |</span>
<span id="cb43-1417"><a href="#cb43-1417"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1418"><a href="#cb43-1418"></a></span>
<span id="cb43-1419"><a href="#cb43-1419"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb43-1420"><a href="#cb43-1420"></a></span>
<span id="cb43-1421"><a href="#cb43-1421"></a>:::</span>
<span id="cb43-1422"><a href="#cb43-1422"></a>::::</span>
<span id="cb43-1423"><a href="#cb43-1423"></a></span>
<span id="cb43-1424"><a href="#cb43-1424"></a>:::{.content-visible when-format="pdf"}</span>
<span id="cb43-1425"><a href="#cb43-1425"></a></span>
<span id="cb43-1426"><a href="#cb43-1426"></a>\newpage</span>
<span id="cb43-1427"><a href="#cb43-1427"></a></span>
<span id="cb43-1428"><a href="#cb43-1428"></a>\blandscape</span>
<span id="cb43-1429"><a href="#cb43-1429"></a></span>
<span id="cb43-1430"><a href="#cb43-1430"></a>**Purposes**</span>
<span id="cb43-1431"><a href="#cb43-1431"></a></span>
<span id="cb43-1432"><a href="#cb43-1432"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1433"><a href="#cb43-1433"></a>| Action                                   | Purpose                                                                                                                                                                                                                                                                     |</span>
<span id="cb43-1434"><a href="#cb43-1434"></a>+==========================================+=============================================================================================================================================================================================================================================================================+</span>
<span id="cb43-1435"><a href="#cb43-1435"></a>| <span class="in">`collect()`</span>                              | Return a python list containing all the elements of the RDD on which it is applied. The objects of the RDD and objects of the returned list are objects of the same class.                                                                                                  |</span>
<span id="cb43-1436"><a href="#cb43-1436"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1437"><a href="#cb43-1437"></a>| <span class="in">`count()`</span>                                | Return the number of elements of the RDD.                                                                                                                                                                                                                                   |</span>
<span id="cb43-1438"><a href="#cb43-1438"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1439"><a href="#cb43-1439"></a>| <span class="in">`countByValue()`</span>                         | Return a Map object containing the information about the number of times each element occurs in the RDD.                                                                                                                                                                    |</span>
<span id="cb43-1440"><a href="#cb43-1440"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1441"><a href="#cb43-1441"></a>| <span class="in">`take(num)`</span>                              | Return a Python list containing the first <span class="in">`num`</span> elements of the RDD. The objects of the RDD and objects of the returned list are objects of the same class.                                                                                                                 |</span>
<span id="cb43-1442"><a href="#cb43-1442"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1443"><a href="#cb43-1443"></a>| <span class="in">`first()`</span>                                | Return the first element of the RDD.                                                                                                                                                                                                                                        |</span>
<span id="cb43-1444"><a href="#cb43-1444"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1445"><a href="#cb43-1445"></a>| <span class="in">`top(num)`</span>                               | Return a Python list containing the top <span class="in">`num`</span> elements of the RDD based on the default sort order/comparator of the objects. The objects of the RDD and objects of the returned list are objects of the same class.                                                         |</span>
<span id="cb43-1446"><a href="#cb43-1446"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1447"><a href="#cb43-1447"></a>| <span class="in">`takeSample(withReplacement, num)`</span>       | Return a (Python) List containing a random sample of size <span class="in">`n`</span> of the RDD. The objects of the RDD and objects of the returned list are objects of the same class.                                                                                                            |</span>
<span id="cb43-1448"><a href="#cb43-1448"></a>|                                          |                                                                                                                                                                                                                                                                             |</span>
<span id="cb43-1449"><a href="#cb43-1449"></a>| <span class="in">`takeSample(withReplacement, num, seed)`</span> |                                                                                                                                                                                                                                                                             |</span>
<span id="cb43-1450"><a href="#cb43-1450"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1451"><a href="#cb43-1451"></a>| <span class="in">`reduce(f)`</span>                              | Return a single Python object obtained by combining the values of the objects of the RDD by using a user provide function. The provided function must be associative and commutative The object returned by the method and the objects of the RDD belong to the same class. |</span>
<span id="cb43-1452"><a href="#cb43-1452"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1453"><a href="#cb43-1453"></a>| <span class="in">`fold(zeroValue, op)`</span>                    | Same as reduce but with the provided zero value.                                                                                                                                                                                                                            |</span>
<span id="cb43-1454"><a href="#cb43-1454"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1455"><a href="#cb43-1455"></a>| <span class="in">`Aggregate(zeroValue, seqOp, combOp)`</span>    | Similar to <span class="in">`reduce()`</span> but used to return a different type.                                                                                                                                                                                                                  |</span>
<span id="cb43-1456"><a href="#cb43-1456"></a>+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb43-1457"><a href="#cb43-1457"></a></span>
<span id="cb43-1458"><a href="#cb43-1458"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb43-1459"><a href="#cb43-1459"></a></span>
<span id="cb43-1460"><a href="#cb43-1460"></a>\newpage</span>
<span id="cb43-1461"><a href="#cb43-1461"></a></span>
<span id="cb43-1462"><a href="#cb43-1462"></a>**Examples**</span>
<span id="cb43-1463"><a href="#cb43-1463"></a></span>
<span id="cb43-1464"><a href="#cb43-1464"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1465"><a href="#cb43-1465"></a>| Action                                   | Example                                                                                                                  | Result           |</span>
<span id="cb43-1466"><a href="#cb43-1466"></a>+==========================================+==========================================================================================================================+==================+</span>
<span id="cb43-1467"><a href="#cb43-1467"></a>| <span class="in">`collect()`</span>                              | <span class="in">`inputRDD.collect()`</span>                                                                                                     | <span class="in">`[1,2,3,3]`</span>      |</span>
<span id="cb43-1468"><a href="#cb43-1468"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1469"><a href="#cb43-1469"></a>| <span class="in">`count()`</span>                                | <span class="in">`inputRDD.count()`</span>                                                                                                       | <span class="in">`4`</span>              |</span>
<span id="cb43-1470"><a href="#cb43-1470"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1471"><a href="#cb43-1471"></a>| <span class="in">`countByValue()`</span>                         | <span class="in">`inputRDD.countByValue()`</span>                                                                                                | <span class="in">`[(1,1),`</span>        |</span>
<span id="cb43-1472"><a href="#cb43-1472"></a>|                                          |                                                                                                                          | <span class="in">`(2,1),`</span>         |</span>
<span id="cb43-1473"><a href="#cb43-1473"></a>|                                          |                                                                                                                          | <span class="in">`(3,2)]`</span>         |</span>
<span id="cb43-1474"><a href="#cb43-1474"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1475"><a href="#cb43-1475"></a>| <span class="in">`take(num)`</span>                              | <span class="in">`inputRDD.take(2)`</span>                                                                                                       | <span class="in">`[1,2]`</span>          |</span>
<span id="cb43-1476"><a href="#cb43-1476"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1477"><a href="#cb43-1477"></a>| <span class="in">`first()`</span>                                | <span class="in">`first()`</span>                                                                                                                | <span class="in">`1`</span>              |</span>
<span id="cb43-1478"><a href="#cb43-1478"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1479"><a href="#cb43-1479"></a>| <span class="in">`top(num)`</span>                               | <span class="in">`inputRDD.top(2)`</span>                                                                                                        | <span class="in">`[3,3]`</span>          |</span>
<span id="cb43-1480"><a href="#cb43-1480"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1481"><a href="#cb43-1481"></a>| <span class="in">`takeSample(withReplacement, num)`</span>       | <span class="in">`inputRDD.takeSample(False,1)`</span>                                                                                           | Nondeterministic |</span>
<span id="cb43-1482"><a href="#cb43-1482"></a>|                                          |                                                                                                                          |                  |</span>
<span id="cb43-1483"><a href="#cb43-1483"></a>| <span class="in">`takeSample(withReplacement, num, seed)`</span> |                                                                                                                          |                  |</span>
<span id="cb43-1484"><a href="#cb43-1484"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1485"><a href="#cb43-1485"></a>| <span class="in">`reduce(f)`</span>                              | <span class="in">`inputRDD.reduce(lambda e1,e2: e1+e2)`</span>                                                                                   | <span class="in">`9`</span>              |</span>
<span id="cb43-1486"><a href="#cb43-1486"></a>|                                          |                                                                                                                          |                  |</span>
<span id="cb43-1487"><a href="#cb43-1487"></a>|                                          | The passed function is the sum                                                                                           |                  |</span>
<span id="cb43-1488"><a href="#cb43-1488"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1489"><a href="#cb43-1489"></a>| <span class="in">`fold(zeroValue, op)`</span>                    | <span class="in">`inputRDD.fold(0, lambda v1, v2: v1+v2)`</span>                                                                                 | <span class="in">`9`</span>              |</span>
<span id="cb43-1490"><a href="#cb43-1490"></a>|                                          |                                                                                                                          |                  |</span>
<span id="cb43-1491"><a href="#cb43-1491"></a>|                                          | The passed function is the sum and the passed zeroValue is 0.                                                            |                  |</span>
<span id="cb43-1492"><a href="#cb43-1492"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1493"><a href="#cb43-1493"></a>| <span class="in">`Aggregate(zeroValue, seqOp, combOp)`</span>    | <span class="in">`inputRDD.aggregate(`</span>                                                                                                    | <span class="in">`(9,4)`</span>          |</span>
<span id="cb43-1494"><a href="#cb43-1494"></a>|                                          | <span class="in">`    zeroValue,`</span>                                                                                                         |                  |</span>
<span id="cb43-1495"><a href="#cb43-1495"></a>|                                          | <span class="in">`    lambda acc, e: (acc[0]+e, acc[1]+1),`</span>                                                                               |                  |</span>
<span id="cb43-1496"><a href="#cb43-1496"></a>|                                          | <span class="in">`    lambda p1, p2: (p1[0]+p2[0], p1[1]+p2[1])`</span>                                                                          |                  |</span>
<span id="cb43-1497"><a href="#cb43-1497"></a>|                                          | <span class="in">`)`</span>                                                                                                                      |                  |</span>
<span id="cb43-1498"><a href="#cb43-1498"></a>|                                          |                                                                                                                          |                  |</span>
<span id="cb43-1499"><a href="#cb43-1499"></a>|                                          | Compute a pair of integers where the first one is the sum of the values of the RDD and the second the number of elements |                  |</span>
<span id="cb43-1500"><a href="#cb43-1500"></a>+------------------------------------------+--------------------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb43-1501"><a href="#cb43-1501"></a></span>
<span id="cb43-1502"><a href="#cb43-1502"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb43-1503"><a href="#cb43-1503"></a></span>
<span id="cb43-1504"><a href="#cb43-1504"></a>\elandscape</span>
<span id="cb43-1505"><a href="#cb43-1505"></a></span>
<span id="cb43-1506"><a href="#cb43-1506"></a>:::</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>