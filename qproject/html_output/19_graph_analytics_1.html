<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Distributed architectures for big data processing and analytics - 24&nbsp; Graph analytics in Spark</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./20_graph_analytics_2.html" rel="next">
<link href="./18e_mining.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Graph analytics in Spark</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Distributed architectures for big data processing and analytics</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Index</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_01_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Big data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_architectures.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Big data architectures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03b_HDFS_clc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">HDFS and Hadoop: command line commands</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_intro_hadoop.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Hadoop and MapReduce</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_hadoop_implementation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How to write MapReduce programs in Hadoop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_mapreduce_patterns_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">MapReduce patterns - 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_mapreduce_advanced_topics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MapReduce and Hadoop Advanced Topics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_mapreduce_patterns_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MapReduce patterns - 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_sql_operators_mapreduce.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Relational Algebra Operations and MapReduce</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10b_spark_submit_execute.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">How to submit/execute a Spark application</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_intro_spark.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Spark</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_rdd_based_programming.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">RDD based programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_rdd_keyvalue_pairs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">RDDs and key-value pairs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_rdd_numbers.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">RDD of numbers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_cache_accumulators_broadcast.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Cache, Accumulators, Broadcast Variables</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15b_pagerank.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Introduction to PageRank</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_sparksql_dataframes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Spark SQL and DataFrames</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18a_spark_mllib.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Spark MLlib</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18b_classification.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Classification algorithms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18c_clustering.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Clustering algorithms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18d_regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Regression algorithms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18e_mining.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Itemset and Association rule mining</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_graph_analytics_1.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Graph analytics in Spark</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_graph_analytics_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Graph Analytics in Spark</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_streaming_analytics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_structured_streaming.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Spark structured streaming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_streaming_frameworks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#spark-graphx-and-graphframes" id="toc-spark-graphx-and-graphframes" class="nav-link" data-scroll-target="#spark-graphx-and-graphframes">Spark GraphX and GraphFrames</a></li>
  <li><a href="#building-and-querying-graphs-with-graphframes" id="toc-building-and-querying-graphs-with-graphframes" class="nav-link" data-scroll-target="#building-and-querying-graphs-with-graphframes">Building and querying graphs with GraphFrames</a></li>
  <li><a href="#basic-statistics" id="toc-basic-statistics" class="nav-link" data-scroll-target="#basic-statistics">Basic statistics</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Graph analytics in Spark</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>Graphs are data structures composed of nodes and edges</p>
<ul>
<li>nodes/vertexes are denoted as <span class="math inline">\(V=\{v_1,v_2,...,v_n\}\)</span></li>
<li>edges are denoted as <span class="math inline">\(E=\{e_1,e_2,...,e_n\}\)</span></li>
</ul>
<p>Graph analytics is the process of analyzing relationships between vertexes and edges.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Example of graph</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/graph_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Graphs are called <strong>undirected</strong> if edges do not have a direction, otherwise they are called <strong>directed</strong> graphs. Vertexes and edges can have data associated with them</p>
<ul>
<li>weights are associated to edges (e.g., they may represent the strength of the relationship);</li>
<li>labels are associated to vertexes (e.g., they may be the string associated with the name of the vertex).</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Graph with labels and weights</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/labels_weights_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Why graph analytics?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Graphs are natural way of describing relationships. Some practical example of analytics over graphs</p>
<ul>
<li>Ranking web pages (Google PageRank)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Pages in the web</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/rank_pages_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<ul>
<li>Detecting group of friends</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Social networks</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/social_network_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Movies watched by users</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/movies_watched_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<ul>
<li>Determine importance of infrastructure in electrical networks</li>
<li>…</li>
</ul>
</div>
</div>
</section>
<section id="spark-graphx-and-graphframes" class="level3">
<h3 class="anchored" data-anchor-id="spark-graphx-and-graphframes">Spark GraphX and GraphFrames</h3>
<p>GraphX is the Spark RDD-based library for performing graph processing. It is a core part of Spark.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Spark core libraries</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/spark_core.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>GraphX</p>
<ul>
<li>is low level interface with RDD</li>
<li>is very powerful: many application and libraries built on top of it</li>
<li>is not easy to use or optimize</li>
<li>has no Python version of the APIs</li>
</ul>
<p><a href="https://graphframes.github.io/graphframes/docs/_site/index.html">GraphFrames</a> is a library DataFrame-based for performing graph processing. It is a Spark external package built on top of GraphX.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">GraphFrame structure</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/graphframes_structure.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="building-and-querying-graphs-with-graphframes" class="level3">
<h3 class="anchored" data-anchor-id="building-and-querying-graphs-with-graphframes">Building and querying graphs with GraphFrames</h3>
<section id="building-a-graph" class="level4">
<h4 class="anchored" data-anchor-id="building-a-graph">Building a Graph</h4>
<p>Define vertexes and edges of the graph: vertexes and edges are represented by means of records inside DataFrames with specifically named columns</p>
<ul>
<li>One DataFrame for the definition of the vertexes of the graph. The DataFrames that are used to represent nodes/vertexes
<ul>
<li>Contain one record per vertex</li>
<li>Must contain a column named “id” that stores unique vertex IDs</li>
<li>Can contain other columns that are used to characterize vertexes</li>
</ul></li>
<li>One DataFrame for the definition of the edges of the graph. The DataFrames that are used to represent edges
<ul>
<li>Contain one record per edge</li>
<li>Must contain two columns “src” and “dst” storing source vertex IDs and destination vertex IDs of edges</li>
<li>Can contain other columns that are used to characterize edges</li>
</ul></li>
</ul>
<p>Create a graph of type <code>graphframes.graphframe.GraphFrame</code> by invoking the constructor <code>GraphFrame(v,e)</code></p>
<ul>
<li><code>v</code>: the DataFrame containing the definition of the vertexes</li>
<li><code>e</code>: the DataFrame containing the definition of the edges</li>
</ul>
<p>Graphs in graphframes are directed graphs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Building a graph example</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/building_graph_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given this Vertex DataFrame</p>
<table class="table">
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>u1</td>
<td>Alice</td>
<td>34</td>
</tr>
<tr class="even">
<td>u2</td>
<td>Bob</td>
<td>36</td>
</tr>
<tr class="odd">
<td>u3</td>
<td>Charlie</td>
<td>30</td>
</tr>
<tr class="even">
<td>u4</td>
<td>David</td>
<td>29</td>
</tr>
<tr class="odd">
<td>u5</td>
<td>Esther</td>
<td>32</td>
</tr>
<tr class="even">
<td>u6</td>
<td>Fanny</td>
<td>36</td>
</tr>
<tr class="odd">
<td>u7</td>
<td>Gabby</td>
<td>60</td>
</tr>
</tbody>
</table>
<p>And this Edge DataFrame</p>
<table class="table">
<thead>
<tr class="header">
<th>src</th>
<th>dst</th>
<th>relationship</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>u1</td>
<td>u2</td>
<td>friend</td>
</tr>
<tr class="even">
<td>u2</td>
<td>u3</td>
<td>follow</td>
</tr>
<tr class="odd">
<td>u3</td>
<td>u2</td>
<td>follow</td>
</tr>
<tr class="even">
<td>u6</td>
<td>u3</td>
<td>follow</td>
</tr>
<tr class="odd">
<td>u5</td>
<td>u6</td>
<td>follow</td>
</tr>
<tr class="even">
<td>u5</td>
<td>u4</td>
<td>friend</td>
</tr>
<tr class="odd">
<td>u4</td>
<td>u1</td>
<td>friend</td>
</tr>
<tr class="even">
<td>u1</td>
<td>u5</td>
<td>friend</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">from</span> graphframes <span class="im">import</span> GraphFrame</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">## Vertex DataFrame</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>v <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb1-5"><a href="#cb1-5"></a>    [</span>
<span id="cb1-6"><a href="#cb1-6"></a>        (<span class="st">"u1"</span>, <span class="st">"Alice"</span>, <span class="dv">34</span>),</span>
<span id="cb1-7"><a href="#cb1-7"></a>        (<span class="st">"u2"</span>, <span class="st">"Bob"</span>, <span class="dv">36</span>),</span>
<span id="cb1-8"><a href="#cb1-8"></a>        (<span class="st">"u3"</span>, <span class="st">"Charlie"</span>, <span class="dv">30</span>),</span>
<span id="cb1-9"><a href="#cb1-9"></a>        (<span class="st">"u4"</span>, <span class="st">"David"</span>, <span class="dv">29</span>),</span>
<span id="cb1-10"><a href="#cb1-10"></a>        (<span class="st">"u5"</span>, <span class="st">"Esther"</span>, <span class="dv">32</span>),</span>
<span id="cb1-11"><a href="#cb1-11"></a>        (<span class="st">"u6"</span>, <span class="st">"Fanny"</span>, <span class="dv">36</span>),</span>
<span id="cb1-12"><a href="#cb1-12"></a>        (<span class="st">"u7"</span>, <span class="st">"Gabby"</span>, <span class="dv">60</span>)</span>
<span id="cb1-13"><a href="#cb1-13"></a>    ],</span>
<span id="cb1-14"><a href="#cb1-14"></a>    [<span class="st">"id"</span>, <span class="st">"name"</span>, <span class="st">"age"</span>]</span>
<span id="cb1-15"><a href="#cb1-15"></a>)</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">## Edge DataFrame</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>e <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb1-19"><a href="#cb1-19"></a>    [</span>
<span id="cb1-20"><a href="#cb1-20"></a>        (<span class="st">"u1"</span>, <span class="st">"u2"</span>, <span class="st">"friend"</span>),</span>
<span id="cb1-21"><a href="#cb1-21"></a>        (<span class="st">"u2"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb1-22"><a href="#cb1-22"></a>        (<span class="st">"u3"</span>, <span class="st">"u2"</span>, <span class="st">"follow"</span>),</span>
<span id="cb1-23"><a href="#cb1-23"></a>        (<span class="st">"u6"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb1-24"><a href="#cb1-24"></a>        (<span class="st">"u5"</span>, <span class="st">"u6"</span>, <span class="st">"follow"</span>),</span>
<span id="cb1-25"><a href="#cb1-25"></a>        (<span class="st">"u5"</span>, <span class="st">"u4"</span>, <span class="st">"friend"</span>),</span>
<span id="cb1-26"><a href="#cb1-26"></a>        (<span class="st">"u4"</span>, <span class="st">"u1"</span>, <span class="st">"friend"</span>),</span>
<span id="cb1-27"><a href="#cb1-27"></a>        (<span class="st">"u1"</span>, <span class="st">"u5"</span>, <span class="st">"friend"</span>)</span>
<span id="cb1-28"><a href="#cb1-28"></a>    ],</span>
<span id="cb1-29"><a href="#cb1-29"></a>    [<span class="st">"src"</span>, <span class="st">"dst"</span>, <span class="st">"relationship"</span>]</span>
<span id="cb1-30"><a href="#cb1-30"></a>)</span>
<span id="cb1-31"><a href="#cb1-31"></a></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">## Create the graph</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>g <span class="op">=</span> GraphFrame(v, e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="directed-vs-undirected-edges" class="level4">
<h4 class="anchored" data-anchor-id="directed-vs-undirected-edges">Directed vs undirected edges</h4>
<p>In undirected graphs the edges indicate a two-way relationship (each edge can be traversed in both directions). In GraphX it is possible to use <code>to_undirected()</code> to create an undirected copy of the Graph. Unfortunately GraphFrames does not support it, but it is possible to convert a graph by applying a flatMap function over the edges of the directed graph that creates symmetric edges and then create a new GraphFrame.</p>
</section>
<section id="cache-graphs" class="level4">
<h4 class="anchored" data-anchor-id="cache-graphs">Cache graphs</h4>
<p>As with RDD and DataFrame, it is possible to cache graphs in GraphFrame: it is convenient if the same (complex) graph result of (multiple) transformations is used multiple times in the same application. To do it, simply invoke <code>cache()</code> on the GraphFrame to cache, so that it persists the DataFrame-based representation of vertexes and edges of the graph.</p>
</section>
<section id="querying-the-graph" class="level4">
<h4 class="anchored" data-anchor-id="querying-the-graph">Querying the graph</h4>
<p>Some specific methods are provided to execute queries on graphs</p>
<ul>
<li><code>filterVertices(condition)</code></li>
<li><code>filterEdges(condition)</code></li>
<li><code>dropIsolatedVertices()</code></li>
</ul>
<p>The returned result is the filtered version of the input graph.</p>
<section id="filterverticescondition" class="level5">
<h5 class="anchored" data-anchor-id="filterverticescondition"><code>filterVertices(condition)</code></h5>
<p><code>filterVertices(condition)</code> selects only the vertexes for which the specified condition is satisfied and returns a new graph with only the subset of selected vertexes.</p>
<p><code>condition</code> contains an SQL-like condition on the values of the attributes of the vertexes (e.g., “age&gt;35”).</p>
</section>
<section id="filteredgescondition" class="level5">
<h5 class="anchored" data-anchor-id="filteredgescondition"><code>filterEdges(condition)</code></h5>
<p><code>filterEdges(condition)</code> selects only the edges for which the specified condition is satisfied and returns a new graph with only the subset of selected edges.</p>
<p><code>condition</code> contains an SQL-like condition on the values of the attributes of the edges (e.g., “relationship=‘friend’”).</p>
</section>
<section id="dropisolatedvertices" class="level5">
<h5 class="anchored" data-anchor-id="dropisolatedvertices"><code>dropIsolatedVertices()</code></h5>
<p><code>dropIsolatedVertices()</code> drops the vertexes that are not connected with any other node and returns a new graph without the dropped nodes.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given the input graph, create a new subgraph</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Input graph</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/vertex_filtering_example_1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<ol type="1">
<li>Include only the vertexes associated with users characterized by age between 29 and 50</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Filter vertexes</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/vertex_filtering_example_2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<ol start="2" type="1">
<li>Include only the edges representing the friend relationship</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Filter edges</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/vertex_filtering_example_3.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<ol start="3" type="1">
<li>Drop isolated vertexes</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Drop isolated vertices</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/vertex_filtering_example_4.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Output graph</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/vertex_filtering_example_5.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">from</span> graphframes <span class="im">import</span> GraphFrame</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">## Vertex DataFrame</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>v <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb2-5"><a href="#cb2-5"></a>    [</span>
<span id="cb2-6"><a href="#cb2-6"></a>        (<span class="st">"u1"</span>, <span class="st">"Alice"</span>, <span class="dv">34</span>),</span>
<span id="cb2-7"><a href="#cb2-7"></a>        (<span class="st">"u2"</span>, <span class="st">"Bob"</span>, <span class="dv">36</span>),</span>
<span id="cb2-8"><a href="#cb2-8"></a>        (<span class="st">"u3"</span>, <span class="st">"Charlie"</span>, <span class="dv">30</span>),</span>
<span id="cb2-9"><a href="#cb2-9"></a>        (<span class="st">"u4"</span>, <span class="st">"David"</span>, <span class="dv">29</span>),</span>
<span id="cb2-10"><a href="#cb2-10"></a>        (<span class="st">"u5"</span>, <span class="st">"Esther"</span>, <span class="dv">32</span>),</span>
<span id="cb2-11"><a href="#cb2-11"></a>        (<span class="st">"u6"</span>, <span class="st">"Fanny"</span>, <span class="dv">36</span>),</span>
<span id="cb2-12"><a href="#cb2-12"></a>        (<span class="st">"u7"</span>, <span class="st">"Gabby"</span>, <span class="dv">60</span>)</span>
<span id="cb2-13"><a href="#cb2-13"></a>    ],</span>
<span id="cb2-14"><a href="#cb2-14"></a>    [<span class="st">"id"</span>, <span class="st">"name"</span>, <span class="st">"age"</span>]</span>
<span id="cb2-15"><a href="#cb2-15"></a>)</span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">## Edge DataFrame</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>e <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb2-19"><a href="#cb2-19"></a>    [</span>
<span id="cb2-20"><a href="#cb2-20"></a>        (<span class="st">"u1"</span>, <span class="st">"u2"</span>, <span class="st">"friend"</span>),</span>
<span id="cb2-21"><a href="#cb2-21"></a>        (<span class="st">"u2"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb2-22"><a href="#cb2-22"></a>        (<span class="st">"u3"</span>, <span class="st">"u2"</span>, <span class="st">"follow"</span>),</span>
<span id="cb2-23"><a href="#cb2-23"></a>        (<span class="st">"u6"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb2-24"><a href="#cb2-24"></a>        (<span class="st">"u5"</span>, <span class="st">"u6"</span>, <span class="st">"follow"</span>),</span>
<span id="cb2-25"><a href="#cb2-25"></a>        (<span class="st">"u5"</span>, <span class="st">"u4"</span>, <span class="st">"friend"</span>),</span>
<span id="cb2-26"><a href="#cb2-26"></a>        (<span class="st">"u4"</span>, <span class="st">"u1"</span>, <span class="st">"friend"</span>),</span>
<span id="cb2-27"><a href="#cb2-27"></a>        (<span class="st">"u1"</span>, <span class="st">"u5"</span>, <span class="st">"friend"</span>)</span>
<span id="cb2-28"><a href="#cb2-28"></a>    ],</span>
<span id="cb2-29"><a href="#cb2-29"></a>    [<span class="st">"src"</span>, <span class="st">"dst"</span>, <span class="st">"relationship"</span>]</span>
<span id="cb2-30"><a href="#cb2-30"></a>)</span>
<span id="cb2-31"><a href="#cb2-31"></a></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">## Create the graph</span></span>
<span id="cb2-33"><a href="#cb2-33"></a>g <span class="op">=</span> GraphFrame(v, e)</span>
<span id="cb2-34"><a href="#cb2-34"></a></span>
<span id="cb2-35"><a href="#cb2-35"></a>selectedUsersandFriendRelGraph <span class="op">=</span> g <span class="op">\</span></span>
<span id="cb2-36"><a href="#cb2-36"></a>    .filterVertices(<span class="st">"age&gt;=29 AND age&lt;=50"</span>) <span class="op">\</span></span>
<span id="cb2-37"><a href="#cb2-37"></a>    .filterEdges(<span class="st">"relationship='friend'"</span>) <span class="op">\</span></span>
<span id="cb2-38"><a href="#cb2-38"></a>    .dropIsolatedVertices()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Given a GraphFrame, it is possible to access its vertexes and edges</p>
<ul>
<li><code>g.vertices</code> returns the DataFrame associated with the vertexes of the input graph</li>
<li><code>g.edges</code> returns the DataFrame associated with the edges of the input graph</li>
</ul>
<p>All the standard DataFrame transformations/actions are available also for the DataFrames that are used to store vertexes and edges. For example, the number of vertexes and the number of edges can be computed by invoking the <code>count()</code> action on the DataFrames vertices and edges, respectively.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given the input graph</p>
<ol type="1">
<li>Count how many vertexes and edges has the graph</li>
<li>Find the smallest value of age (i.e., the age of the youngest user in the graph)</li>
<li>Count the number of edges of type “follow” in the graph</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">from</span> graphframes <span class="im">import</span> GraphFrame</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">## Vertex DataFrame</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>v <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb3-5"><a href="#cb3-5"></a>    [</span>
<span id="cb3-6"><a href="#cb3-6"></a>        (<span class="st">"u1"</span>, <span class="st">"Alice"</span>, <span class="dv">34</span>),</span>
<span id="cb3-7"><a href="#cb3-7"></a>        (<span class="st">"u2"</span>, <span class="st">"Bob"</span>, <span class="dv">36</span>),</span>
<span id="cb3-8"><a href="#cb3-8"></a>        (<span class="st">"u3"</span>, <span class="st">"Charlie"</span>, <span class="dv">30</span>),</span>
<span id="cb3-9"><a href="#cb3-9"></a>        (<span class="st">"u4"</span>, <span class="st">"David"</span>, <span class="dv">29</span>),</span>
<span id="cb3-10"><a href="#cb3-10"></a>        (<span class="st">"u5"</span>, <span class="st">"Esther"</span>, <span class="dv">32</span>),</span>
<span id="cb3-11"><a href="#cb3-11"></a>        (<span class="st">"u6"</span>, <span class="st">"Fanny"</span>, <span class="dv">36</span>),</span>
<span id="cb3-12"><a href="#cb3-12"></a>        (<span class="st">"u7"</span>, <span class="st">"Gabby"</span>, <span class="dv">60</span>)</span>
<span id="cb3-13"><a href="#cb3-13"></a>    ],</span>
<span id="cb3-14"><a href="#cb3-14"></a>    [<span class="st">"id"</span>, <span class="st">"name"</span>, <span class="st">"age"</span>]</span>
<span id="cb3-15"><a href="#cb3-15"></a>)</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">## Edge DataFrame</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>e <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb3-19"><a href="#cb3-19"></a>    [</span>
<span id="cb3-20"><a href="#cb3-20"></a>        (<span class="st">"u1"</span>, <span class="st">"u2"</span>, <span class="st">"friend"</span>),</span>
<span id="cb3-21"><a href="#cb3-21"></a>        (<span class="st">"u2"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb3-22"><a href="#cb3-22"></a>        (<span class="st">"u3"</span>, <span class="st">"u2"</span>, <span class="st">"follow"</span>),</span>
<span id="cb3-23"><a href="#cb3-23"></a>        (<span class="st">"u6"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb3-24"><a href="#cb3-24"></a>        (<span class="st">"u5"</span>, <span class="st">"u6"</span>, <span class="st">"follow"</span>),</span>
<span id="cb3-25"><a href="#cb3-25"></a>        (<span class="st">"u5"</span>, <span class="st">"u4"</span>, <span class="st">"friend"</span>),</span>
<span id="cb3-26"><a href="#cb3-26"></a>        (<span class="st">"u4"</span>, <span class="st">"u1"</span>, <span class="st">"friend"</span>),</span>
<span id="cb3-27"><a href="#cb3-27"></a>        (<span class="st">"u1"</span>, <span class="st">"u5"</span>, <span class="st">"friend"</span>)</span>
<span id="cb3-28"><a href="#cb3-28"></a>    ],</span>
<span id="cb3-29"><a href="#cb3-29"></a>    [<span class="st">"src"</span>, <span class="st">"dst"</span>, <span class="st">"relationship"</span>]</span>
<span id="cb3-30"><a href="#cb3-30"></a>)</span>
<span id="cb3-31"><a href="#cb3-31"></a></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="co">## Create the graph</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>g <span class="op">=</span> GraphFrame(v, e)</span>
<span id="cb3-34"><a href="#cb3-34"></a></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="co">## Count how many vertexes and edges has the graph</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="bu">print</span>(<span class="st">"Number of vertexes: "</span>,g.vertices.count())</span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="bu">print</span>(<span class="st">"Number of edges: "</span>,g.edges.count())</span>
<span id="cb3-38"><a href="#cb3-38"></a></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">## Print on the standard output the smallest value of age</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="co">## (i.e., the age of the youngest user in the graph)</span></span>
<span id="cb3-41"><a href="#cb3-41"></a>g.vertices.agg({<span class="st">"age"</span>:<span class="st">"min"</span>}).show()</span>
<span id="cb3-42"><a href="#cb3-42"></a></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="co">## Print on the standard output</span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="co">## the number of "follow" edges in the graph.</span></span>
<span id="cb3-45"><a href="#cb3-45"></a>numFollows <span class="op">=</span> g.edges.<span class="bu">filter</span>(<span class="st">"relationship = 'follow' "</span>).count()</span>
<span id="cb3-46"><a href="#cb3-46"></a></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="bu">print</span>(numFollows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="motif-finding" class="level4">
<h4 class="anchored" data-anchor-id="motif-finding">Motif finding</h4>
<p>Motif finding refers to searching for structural patterns in graphs. A simple Domain-Specific Language (DSL) is used to specify the structure of the interesting patterns: the paths/subgraphs in the graph matching the specified structural pattern are selected.</p>
<section id="dsl-for-motif-finding" class="level5">
<h5 class="anchored" data-anchor-id="dsl-for-motif-finding">DSL for Motif finding</h5>
<p>The basic unit of a pattern is a connection between vertexes</p>
<p><span class="math display">\[
(v1) – [e1] \rightarrow (v2)
\]</span></p>
<p>means: an arbitrary edge [e1] from an arbitrary vertex (v1) to another arbitrary vertex (v2)</p>
<ul>
<li>Edges are denoted by square brackets: <span class="math inline">\([e1]\)</span></li>
<li>Vertexes are expressed by round brackets: <span class="math inline">\((v1)\)</span>, <span class="math inline">\((v2)\)</span></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Basic unit</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_basic_unit.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Patterns are chains of basic units</p>
<p><span class="math display">\[
(v1) – [e1] \rightarrow (v2);\quad (v2) – [e2] \rightarrow (v3)
\]</span></p>
<p>means: an arbitrary edge from an arbitrary vertex <span class="math inline">\(v1\)</span> to another arbitrary vertex <span class="math inline">\(v2\)</span> and another arbitrary edge from <span class="math inline">\(v2\)</span> to another arbitrary vertex <span class="math inline">\(v3\)</span>. Notice that <span class="math inline">\(v3\)</span> and <span class="math inline">\(v1\)</span> can be the same vertex.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Basic unit chaining</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_basic_unit_chaining.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>The same vertex name is used in a pattern to have a reference to the same vertex</p>
<p><span class="math display">\[
(v1) – [e1] \rightarrow (v2);\quad (v2) – [e2] \rightarrow (v1)
\]</span></p>
<p>means: an arbitrary edge from an arbitrary vertex <span class="math inline">\(v1\)</span> to another arbitrary vertex <span class="math inline">\(v2\)</span> and vice-versa.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Basic unit self-chaining</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_basic_unit_chaining.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>It is acceptable to omit names for vertices or edges in patterns when not needed</p>
<p><span class="math display">\[
(v1)-[\quad]\rightarrow(v2)
\]</span></p>
<p>means: an arbitrary edge between two arbitrary vertexes <span class="math inline">\(v1\)</span>, <span class="math inline">\(v2\)</span>, but does not assign a name to the edge. These are called <strong>anonymous</strong> vertexes and edges.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Anonymous vertexes and edges</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_anonyomous_vertexes.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>A basic unit (an edge between two vertexes) can be negated to indicate that the edge should not be present in the graph</p>
<p><span class="math display">\[
(v1)-[\quad]\rightarrow(v2);\quad !(v2)-[\quad]\rightarrow(v1)
\]</span></p>
<p>means: edges from <span class="math inline">\(v1\)</span> to <span class="math inline">\(v2\)</span> but no edges from <span class="math inline">\(v2\)</span> to <span class="math inline">\(v1\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Negating edges</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_negating_edges.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>The <code>find(motif)</code> method of GraphFrame is used to select motifs</p>
<ul>
<li><code>motif</code> is a DSL representation of the structural pattern</li>
</ul>
<p><code>find()</code> returns a DataFrame of all the paths matching the structural motif/pattern, one path per record. The returned DataFrame will have a column for each of the named elements (vertexes and edges) in the structural pattern/motif: Each column is a struct, and the fields of each struct are the labels/features of the associated vertex or edge. It can return duplicate rows/records, if there are many paths connecting the same nodes.</p>
<p>More complex queries on the structure and content of the patterns can be expressed by applying filters to the result DataFrame (i.e., more complex queries can be applied by combing <code>find()</code> and <code>filter()</code>).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given the following graph</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Example graph</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Find the paths/subgraphs matching the pattern</p>
<p><span class="math display">\[
(v1) – [e1] \rightarrow (v2);\quad (v2) – [e2] \rightarrow (v1)
\]</span></p>
<p>Store the result in a DataFrame</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Result</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Pay attention that two paths are returned:</p>
<ul>
<li><span class="math inline">\(u2 \rightarrow \text{follow} \rightarrow u3 \rightarrow \text{follow} \rightarrow u2\)</span></li>
<li><span class="math inline">\(u3 \rightarrow \text{follow} \rightarrow u2 \rightarrow \text{follow} \rightarrow u3\)</span></li>
</ul>
<p>The content of the returned Dataframe is the following</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th><span class="math inline">\(v1\)</span></th>
<th><span class="math inline">\(e1\)</span></th>
<th><span class="math inline">\(v2\)</span></th>
<th><span class="math inline">\(e2\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\([u2, \text{Bob}, 36]\)</span></td>
<td><span class="math inline">\([u2, u3, \text{follow}]\)</span></td>
<td><span class="math inline">\([u3, \text[Charlie], 30]\)</span></td>
<td><span class="math inline">\([u3, u2, \text{follow}]\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\([u3, \text[Charlie], 30]\)</span></td>
<td><span class="math inline">\([u3, u2, \text{follow}]\)</span></td>
<td><span class="math inline">\([u2, \text{Bob}, 36]\)</span></td>
<td><span class="math inline">\([u2, u3, \text{follow}]\)</span></td>
</tr>
</tbody>
</table>
<ul>
<li>There is one column for each (distinct) named vertex and edge of the structural pattern;</li>
<li>The records are associated with the vertexes and edges of the selected paths;</li>
<li>All columns are associated with the data type “struct”. Each struct has the same “schema/features” of the associated vertex or edge.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">from</span> graphframes <span class="im">import</span> GraphFrame</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">## Vertex DataFrame</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>v <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb4-5"><a href="#cb4-5"></a>    [</span>
<span id="cb4-6"><a href="#cb4-6"></a>        (<span class="st">"u1"</span>, <span class="st">"Alice"</span>, <span class="dv">34</span>),</span>
<span id="cb4-7"><a href="#cb4-7"></a>        (<span class="st">"u2"</span>, <span class="st">"Bob"</span>, <span class="dv">36</span>),</span>
<span id="cb4-8"><a href="#cb4-8"></a>        (<span class="st">"u3"</span>, <span class="st">"Charlie"</span>, <span class="dv">30</span>),</span>
<span id="cb4-9"><a href="#cb4-9"></a>        (<span class="st">"u4"</span>, <span class="st">"David"</span>, <span class="dv">29</span>),</span>
<span id="cb4-10"><a href="#cb4-10"></a>        (<span class="st">"u5"</span>, <span class="st">"Esther"</span>, <span class="dv">32</span>),</span>
<span id="cb4-11"><a href="#cb4-11"></a>        (<span class="st">"u6"</span>, <span class="st">"Fanny"</span>, <span class="dv">36</span>),</span>
<span id="cb4-12"><a href="#cb4-12"></a>        (<span class="st">"u7"</span>, <span class="st">"Gabby"</span>, <span class="dv">60</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a>    ],</span>
<span id="cb4-14"><a href="#cb4-14"></a>    [<span class="st">"id"</span>, <span class="st">"name"</span>, <span class="st">"age"</span>]</span>
<span id="cb4-15"><a href="#cb4-15"></a>)</span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">## Edge DataFrame</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>e <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb4-19"><a href="#cb4-19"></a>    [</span>
<span id="cb4-20"><a href="#cb4-20"></a>        (<span class="st">"u1"</span>, <span class="st">"u2"</span>, <span class="st">"friend"</span>),</span>
<span id="cb4-21"><a href="#cb4-21"></a>        (<span class="st">"u2"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb4-22"><a href="#cb4-22"></a>        (<span class="st">"u3"</span>, <span class="st">"u2"</span>, <span class="st">"follow"</span>),</span>
<span id="cb4-23"><a href="#cb4-23"></a>        (<span class="st">"u6"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb4-24"><a href="#cb4-24"></a>        (<span class="st">"u5"</span>, <span class="st">"u6"</span>, <span class="st">"follow"</span>),</span>
<span id="cb4-25"><a href="#cb4-25"></a>        (<span class="st">"u5"</span>, <span class="st">"u4"</span>, <span class="st">"friend"</span>),</span>
<span id="cb4-26"><a href="#cb4-26"></a>        (<span class="st">"u4"</span>, <span class="st">"u1"</span>, <span class="st">"friend"</span>),</span>
<span id="cb4-27"><a href="#cb4-27"></a>        (<span class="st">"u1"</span>, <span class="st">"u5"</span>, <span class="st">"friend"</span>)</span>
<span id="cb4-28"><a href="#cb4-28"></a>    ],</span>
<span id="cb4-29"><a href="#cb4-29"></a>    [<span class="st">"src"</span>, <span class="st">"dst"</span>, <span class="st">"relationship"</span>]</span>
<span id="cb4-30"><a href="#cb4-30"></a>)</span>
<span id="cb4-31"><a href="#cb4-31"></a></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="co">## Create the graph</span></span>
<span id="cb4-33"><a href="#cb4-33"></a>g <span class="op">=</span> GraphFrame(v, e)</span>
<span id="cb4-34"><a href="#cb4-34"></a></span>
<span id="cb4-35"><a href="#cb4-35"></a><span class="co">## Retrieve the motifs associated with the pattern</span></span>
<span id="cb4-36"><a href="#cb4-36"></a><span class="co">## vertex -&gt; edge -&gt; vertex -&gt; edge -&gt;vertex</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>motifs <span class="op">=</span> g.find(<span class="st">"(v1)-[e1]-&gt;(v2); (v2)-[e2]-&gt;(v1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given the following graph</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Example graph</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Find the paths/subgraphs matching the pattern</p>
<p><span class="math display">\[
(v1) - [\text{friend}] \rightarrow (v2);\quad (v2) - [\text{follow}] \rightarrow (v3)
\]</span></p>
<p>Store the result in a DataFrame</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">First selected path</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_3.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Second selected path</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_4.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="im">from</span> graphframes <span class="im">import</span> GraphFrame</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">## Vertex DataFrame</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>v <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb5-5"><a href="#cb5-5"></a>    [</span>
<span id="cb5-6"><a href="#cb5-6"></a>        (<span class="st">"u1"</span>, <span class="st">"Alice"</span>, <span class="dv">34</span>),</span>
<span id="cb5-7"><a href="#cb5-7"></a>        (<span class="st">"u2"</span>, <span class="st">"Bob"</span>, <span class="dv">36</span>),</span>
<span id="cb5-8"><a href="#cb5-8"></a>        (<span class="st">"u3"</span>, <span class="st">"Charlie"</span>, <span class="dv">30</span>),</span>
<span id="cb5-9"><a href="#cb5-9"></a>        (<span class="st">"u4"</span>, <span class="st">"David"</span>, <span class="dv">29</span>),</span>
<span id="cb5-10"><a href="#cb5-10"></a>        (<span class="st">"u5"</span>, <span class="st">"Esther"</span>, <span class="dv">32</span>),</span>
<span id="cb5-11"><a href="#cb5-11"></a>        (<span class="st">"u6"</span>, <span class="st">"Fanny"</span>, <span class="dv">36</span>),</span>
<span id="cb5-12"><a href="#cb5-12"></a>        (<span class="st">"u7"</span>, <span class="st">"Gabby"</span>, <span class="dv">60</span>)</span>
<span id="cb5-13"><a href="#cb5-13"></a>    ],</span>
<span id="cb5-14"><a href="#cb5-14"></a>    [<span class="st">"id"</span>, <span class="st">"name"</span>, <span class="st">"age"</span>]</span>
<span id="cb5-15"><a href="#cb5-15"></a>)</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">## Edge DataFrame</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>e <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb5-19"><a href="#cb5-19"></a>    [</span>
<span id="cb5-20"><a href="#cb5-20"></a>        (<span class="st">"u1"</span>, <span class="st">"u2"</span>, <span class="st">"friend"</span>),</span>
<span id="cb5-21"><a href="#cb5-21"></a>        (<span class="st">"u2"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb5-22"><a href="#cb5-22"></a>        (<span class="st">"u3"</span>, <span class="st">"u2"</span>, <span class="st">"follow"</span>),</span>
<span id="cb5-23"><a href="#cb5-23"></a>        (<span class="st">"u6"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb5-24"><a href="#cb5-24"></a>        (<span class="st">"u5"</span>, <span class="st">"u6"</span>, <span class="st">"follow"</span>),</span>
<span id="cb5-25"><a href="#cb5-25"></a>        (<span class="st">"u5"</span>, <span class="st">"u4"</span>, <span class="st">"friend"</span>),</span>
<span id="cb5-26"><a href="#cb5-26"></a>        (<span class="st">"u4"</span>, <span class="st">"u1"</span>, <span class="st">"friend"</span>),</span>
<span id="cb5-27"><a href="#cb5-27"></a>        (<span class="st">"u1"</span>, <span class="st">"u5"</span>, <span class="st">"friend"</span>)</span>
<span id="cb5-28"><a href="#cb5-28"></a>    ],</span>
<span id="cb5-29"><a href="#cb5-29"></a>    [<span class="st">"src"</span>, <span class="st">"dst"</span>, <span class="st">"relationship"</span>]</span>
<span id="cb5-30"><a href="#cb5-30"></a>)</span>
<span id="cb5-31"><a href="#cb5-31"></a></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="co">## Create the graph</span></span>
<span id="cb5-33"><a href="#cb5-33"></a>g <span class="op">=</span> GraphFrame(v, e)</span>
<span id="cb5-34"><a href="#cb5-34"></a></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co">## Retrieve the motifs associated with the pattern</span></span>
<span id="cb5-36"><a href="#cb5-36"></a><span class="co">## vertex -&gt; edge -&gt; vertex -&gt; edge -&gt;vertex</span></span>
<span id="cb5-37"><a href="#cb5-37"></a>motifs <span class="op">=</span> g.find(<span class="st">"(v1)-[friend]-&gt;(v2); (v2)-[follow]-&gt;(v3)"</span>)</span>
<span id="cb5-38"><a href="#cb5-38"></a></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="co">## Filter the motifs (the content of the motifs DataFrame)</span></span>
<span id="cb5-40"><a href="#cb5-40"></a><span class="co">## Select only the ones matching the pattern</span></span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="co">## vertex -&gt; friend-&gt; vertex -&gt; follow -&gt;vertex</span></span>
<span id="cb5-42"><a href="#cb5-42"></a>motifsFriendFollow <span class="op">=</span> motifs <span class="op">\</span></span>
<span id="cb5-43"><a href="#cb5-43"></a>    <span class="co">#.filter("friend.relationship='friend' AND follow.relationship='follow' ") # &lt;1&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>Columns friend and follow are structs with three fields/attributes: “src”, “dst”, “relationship”. To access a field of a struct column use the syntax <code>columnName.field</code> (e.g., <code>friend.relationship</code>)</li>
</ol>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="basic-statistics" class="level3">
<h3 class="anchored" data-anchor-id="basic-statistics">Basic statistics</h3>
<p>Some specific properties are provided to compute basic statistics on the degrees of the vertexes</p>
<ul>
<li><code>degrees</code></li>
<li><code>inDegrees</code></li>
<li><code>outDegrees</code></li>
</ul>
<p>The returned result of each of this property is a DataFrame with id and (in/out)Degree value.</p>
<section id="degrees" class="level4">
<h4 class="anchored" data-anchor-id="degrees"><code>degrees</code></h4>
<p><code>degrees</code> returns the degree of each vertex (i.e., the number of edges associated with each vertex). The result is stored in a DataFrame with Columns (vertex) “id” and “degree”, with one record per vertex. Only the vertexes with <span class="math inline">\(\text{degree} \geq 1\)</span> are stored in the returned DataFrame.</p>
</section>
<section id="indegrees" class="level4">
<h4 class="anchored" data-anchor-id="indegrees"><code>inDegrees</code></h4>
<p><code>inDegrees</code> returns the in-degree of each vertex (i.e., the number of in-edges associated with each vertex). The result is stored in a DataFrame with Columns (vertex) “id” and “inDegree”, with one record per vertex. Only the vertexes with <span class="math inline">\(\text{in-degree} \geq 1\)</span> are stored in the returned DataFrame.</p>
</section>
<section id="outdegrees" class="level4">
<h4 class="anchored" data-anchor-id="outdegrees"><code>outDegrees</code></h4>
<p><code>outDegrees</code> returns the out-degree of each vertex (i.e., the number of out-edges associated with each vertex). The result is stored in a DataFrame with Columns (vertex) “id” and “outDegree”, with one record per vertex. Only the vertexes with <span class="math inline">\(\text{out-degree} \geq 1\)</span> are stored in the returned DataFrame.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given the input graph, compute</p>
<ul>
<li>Degree of each vertex</li>
<li>inDegree of each vertex</li>
<li>outDegree of each vertex</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="im">from</span> graphframes <span class="im">import</span> GraphFrame</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">## Vertex DataFrame</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>v <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb6-5"><a href="#cb6-5"></a>    [</span>
<span id="cb6-6"><a href="#cb6-6"></a>        (<span class="st">"u1"</span>, <span class="st">"Alice"</span>, <span class="dv">34</span>),</span>
<span id="cb6-7"><a href="#cb6-7"></a>        (<span class="st">"u2"</span>, <span class="st">"Bob"</span>, <span class="dv">36</span>),</span>
<span id="cb6-8"><a href="#cb6-8"></a>        (<span class="st">"u3"</span>, <span class="st">"Charlie"</span>, <span class="dv">30</span>),</span>
<span id="cb6-9"><a href="#cb6-9"></a>        (<span class="st">"u4"</span>, <span class="st">"David"</span>, <span class="dv">29</span>),</span>
<span id="cb6-10"><a href="#cb6-10"></a>        (<span class="st">"u5"</span>, <span class="st">"Esther"</span>, <span class="dv">32</span>),</span>
<span id="cb6-11"><a href="#cb6-11"></a>        (<span class="st">"u6"</span>, <span class="st">"Fanny"</span>, <span class="dv">36</span>),</span>
<span id="cb6-12"><a href="#cb6-12"></a>        (<span class="st">"u7"</span>, <span class="st">"Gabby"</span>, <span class="dv">60</span>)</span>
<span id="cb6-13"><a href="#cb6-13"></a>    ],</span>
<span id="cb6-14"><a href="#cb6-14"></a>    [<span class="st">"id"</span>, <span class="st">"name"</span>, <span class="st">"age"</span>]</span>
<span id="cb6-15"><a href="#cb6-15"></a>)</span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">## Edge DataFrame</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>e <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb6-19"><a href="#cb6-19"></a>    [</span>
<span id="cb6-20"><a href="#cb6-20"></a>        (<span class="st">"u1"</span>, <span class="st">"u2"</span>, <span class="st">"friend"</span>),</span>
<span id="cb6-21"><a href="#cb6-21"></a>        (<span class="st">"u2"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb6-22"><a href="#cb6-22"></a>        (<span class="st">"u3"</span>, <span class="st">"u2"</span>, <span class="st">"follow"</span>),</span>
<span id="cb6-23"><a href="#cb6-23"></a>        (<span class="st">"u6"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb6-24"><a href="#cb6-24"></a>        (<span class="st">"u5"</span>, <span class="st">"u6"</span>, <span class="st">"follow"</span>),</span>
<span id="cb6-25"><a href="#cb6-25"></a>        (<span class="st">"u5"</span>, <span class="st">"u4"</span>, <span class="st">"friend"</span>),</span>
<span id="cb6-26"><a href="#cb6-26"></a>        (<span class="st">"u4"</span>, <span class="st">"u1"</span>, <span class="st">"friend"</span>),</span>
<span id="cb6-27"><a href="#cb6-27"></a>        (<span class="st">"u1"</span>, <span class="st">"u5"</span>, <span class="st">"friend"</span>)</span>
<span id="cb6-28"><a href="#cb6-28"></a>    ],</span>
<span id="cb6-29"><a href="#cb6-29"></a>    [<span class="st">"src"</span>, <span class="st">"dst"</span>, <span class="st">"relationship"</span>]</span>
<span id="cb6-30"><a href="#cb6-30"></a>)</span>
<span id="cb6-31"><a href="#cb6-31"></a></span>
<span id="cb6-32"><a href="#cb6-32"></a><span class="co">## Create the graph</span></span>
<span id="cb6-33"><a href="#cb6-33"></a>g <span class="op">=</span> GraphFrame(v, e)</span>
<span id="cb6-34"><a href="#cb6-34"></a></span>
<span id="cb6-35"><a href="#cb6-35"></a><span class="co">## Retrieve the DataFrame with the information about the degree of</span></span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="co">## each vertex</span></span>
<span id="cb6-37"><a href="#cb6-37"></a>vertexesDegreesDF <span class="op">=</span> g.degrees</span>
<span id="cb6-38"><a href="#cb6-38"></a></span>
<span id="cb6-39"><a href="#cb6-39"></a><span class="co">## Retrieve the DataFrame with the information about the in-degree of</span></span>
<span id="cb6-40"><a href="#cb6-40"></a><span class="co">## each vertex</span></span>
<span id="cb6-41"><a href="#cb6-41"></a>vertexesInDegreesDF <span class="op">=</span> g.inDegrees</span>
<span id="cb6-42"><a href="#cb6-42"></a></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="co">## Retrieve the DataFrame with the information about the out-degree of</span></span>
<span id="cb6-44"><a href="#cb6-44"></a><span class="co">## each vertex</span></span>
<span id="cb6-45"><a href="#cb6-45"></a>vertexesOutDegreesDF <span class="op">=</span> g.outDegrees</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given the input graph, select only the ids of the vertexes with at least 2 in-edges.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Example graph</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">First selected vertex</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_5.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Second selected vertex</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_6.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Resulting vertexes</figcaption><p></p>
<p><img src="images/19_graph_analytics_1/motif_finding_example_7.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>The selected IDs are <span class="math inline">\(u2\)</span> and <span class="math inline">\(u3\)</span></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="im">from</span> graphframes <span class="im">import</span> GraphFrame</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">## Vertex DataFrame</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>v <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb7-5"><a href="#cb7-5"></a>    [</span>
<span id="cb7-6"><a href="#cb7-6"></a>        (<span class="st">"u1"</span>, <span class="st">"Alice"</span>, <span class="dv">34</span>),</span>
<span id="cb7-7"><a href="#cb7-7"></a>        (<span class="st">"u2"</span>, <span class="st">"Bob"</span>, <span class="dv">36</span>),</span>
<span id="cb7-8"><a href="#cb7-8"></a>        (<span class="st">"u3"</span>, <span class="st">"Charlie"</span>, <span class="dv">30</span>),</span>
<span id="cb7-9"><a href="#cb7-9"></a>        (<span class="st">"u4"</span>, <span class="st">"David"</span>, <span class="dv">29</span>),</span>
<span id="cb7-10"><a href="#cb7-10"></a>        (<span class="st">"u5"</span>, <span class="st">"Esther"</span>, <span class="dv">32</span>),</span>
<span id="cb7-11"><a href="#cb7-11"></a>        (<span class="st">"u6"</span>, <span class="st">"Fanny"</span>, <span class="dv">36</span>),</span>
<span id="cb7-12"><a href="#cb7-12"></a>        (<span class="st">"u7"</span>, <span class="st">"Gabby"</span>, <span class="dv">60</span>)</span>
<span id="cb7-13"><a href="#cb7-13"></a>    ],</span>
<span id="cb7-14"><a href="#cb7-14"></a>    [<span class="st">"id"</span>, <span class="st">"name"</span>, <span class="st">"age"</span>]</span>
<span id="cb7-15"><a href="#cb7-15"></a>)</span>
<span id="cb7-16"><a href="#cb7-16"></a></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">## Edge DataFrame</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>e <span class="op">=</span> spark.createDataFrame(</span>
<span id="cb7-19"><a href="#cb7-19"></a>    [</span>
<span id="cb7-20"><a href="#cb7-20"></a>        (<span class="st">"u1"</span>, <span class="st">"u2"</span>, <span class="st">"friend"</span>),</span>
<span id="cb7-21"><a href="#cb7-21"></a>        (<span class="st">"u2"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb7-22"><a href="#cb7-22"></a>        (<span class="st">"u3"</span>, <span class="st">"u2"</span>, <span class="st">"follow"</span>),</span>
<span id="cb7-23"><a href="#cb7-23"></a>        (<span class="st">"u6"</span>, <span class="st">"u3"</span>, <span class="st">"follow"</span>),</span>
<span id="cb7-24"><a href="#cb7-24"></a>        (<span class="st">"u5"</span>, <span class="st">"u6"</span>, <span class="st">"follow"</span>),</span>
<span id="cb7-25"><a href="#cb7-25"></a>        (<span class="st">"u5"</span>, <span class="st">"u4"</span>, <span class="st">"friend"</span>),</span>
<span id="cb7-26"><a href="#cb7-26"></a>        (<span class="st">"u4"</span>, <span class="st">"u1"</span>, <span class="st">"friend"</span>),</span>
<span id="cb7-27"><a href="#cb7-27"></a>        (<span class="st">"u1"</span>, <span class="st">"u5"</span>, <span class="st">"friend"</span>)</span>
<span id="cb7-28"><a href="#cb7-28"></a>    ],</span>
<span id="cb7-29"><a href="#cb7-29"></a>    [<span class="st">"src"</span>, <span class="st">"dst"</span>, <span class="st">"relationship"</span>]</span>
<span id="cb7-30"><a href="#cb7-30"></a>)</span>
<span id="cb7-31"><a href="#cb7-31"></a></span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="co">## Create the graph</span></span>
<span id="cb7-33"><a href="#cb7-33"></a>g <span class="op">=</span> GraphFrame(v, e)</span>
<span id="cb7-34"><a href="#cb7-34"></a></span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="co">## Retrieve the DataFrame with the information about the in-degree of</span></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="co">## each vertex</span></span>
<span id="cb7-37"><a href="#cb7-37"></a>vertexesInDegreesDF <span class="op">=</span> g.inDegrees</span>
<span id="cb7-38"><a href="#cb7-38"></a></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="co">## Select only the vertexes with and in-degree value &gt;=2</span></span>
<span id="cb7-40"><a href="#cb7-40"></a>selectedVertexesDF <span class="op">=</span> vertexesInDegreesDF.<span class="bu">filter</span>(<span class="st">"inDegree&gt;=2"</span>)</span>
<span id="cb7-41"><a href="#cb7-41"></a></span>
<span id="cb7-42"><a href="#cb7-42"></a><span class="co">## Select only the content of Column id</span></span>
<span id="cb7-43"><a href="#cb7-43"></a>selectedVertexesIDsDF <span class="op">=</span> selectedVertexesDF.select(<span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./18e_mining.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Itemset and Association rule mining</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./20_graph_analytics_2.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Graph Analytics in Spark</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>