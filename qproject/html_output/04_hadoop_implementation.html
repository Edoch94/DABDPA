<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Distributed architectures for big data processing and analytics - 6&nbsp; How to write MapReduce programs in Hadoop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05_mapreduce_patterns_1.html" rel="next">
<link href="./03_intro_hadoop.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04_hadoop_implementation.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How to write MapReduce programs in Hadoop</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Distributed architectures for big data processing and analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">About this Book</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Big data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_architectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Big data architectures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03b_HDFS_clc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">HDFS and Hadoop: command line commands</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_intro_hadoop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Hadoop and MapReduce</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_hadoop_implementation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How to write MapReduce programs in Hadoop</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_mapreduce_patterns_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">MapReduce patterns - 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_mapreduce_advanced_topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MapReduce and Hadoop Advanced Topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_mapreduce_patterns_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MapReduce patterns - 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_sql_operators_mapreduce.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Relational Algebra Operations and MapReduce</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10b_spark_submit_execute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">How to submit/execute a Spark application</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_intro_spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_rdd_based_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">RDD based programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_rdd_keyvalue_pairs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">RDDs and key-value pairs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_rdd_numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">RDD of numbers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_cache_accumulators_broadcast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Cache, Accumulators, Broadcast Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15b_pagerank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Introduction to PageRank</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_sparksql_dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Spark SQL and DataFrames</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18a_spark_mllib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Spark MLlib</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18b_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Classification algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18c_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Clustering algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18d_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Regression algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18e_mining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Itemset and Association rule mining</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_graph_analytics_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Graph analytics in Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_graph_analytics_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Graph Analytics in Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_streaming_analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_structured_streaming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Spark structured streaming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_streaming_frameworks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-components-summary" id="toc-the-components-summary" class="nav-link active" data-scroll-target="#the-components-summary">The components: summary</a></li>
  <li><a href="#hadoop-implementation-of-the-mapreduce-phases" id="toc-hadoop-implementation-of-the-mapreduce-phases" class="nav-link" data-scroll-target="#hadoop-implementation-of-the-mapreduce-phases">Hadoop implementation of the MapReduce phases</a></li>
  <li><a href="#structure-of-a-mapreduce-program-in-hadoop" id="toc-structure-of-a-mapreduce-program-in-hadoop" class="nav-link" data-scroll-target="#structure-of-a-mapreduce-program-in-hadoop">Structure of a MapReduce program in Hadoop</a></li>
  <li><a href="#combiner" id="toc-combiner" class="nav-link" data-scroll-target="#combiner">Combiner</a></li>
  <li><a href="#personalized-data-types" id="toc-personalized-data-types" class="nav-link" data-scroll-target="#personalized-data-types">Personalized Data Types</a></li>
  <li><a href="#sharing-parameters-among-driver-mappers-and-reducers" id="toc-sharing-parameters-among-driver-mappers-and-reducers" class="nav-link" data-scroll-target="#sharing-parameters-among-driver-mappers-and-reducers">Sharing parameters among Driver, Mappers, and Reducers</a></li>
  <li><a href="#counters" id="toc-counters" class="nav-link" data-scroll-target="#counters">Counters</a></li>
  <li><a href="#map-only-job" id="toc-map-only-job" class="nav-link" data-scroll-target="#map-only-job">Map-only job</a></li>
  <li><a href="#in-mapper-combiner" id="toc-in-mapper-combiner" class="nav-link" data-scroll-target="#in-mapper-combiner">In-Mapper combiner</a></li>
  <li><a href="#maven-project" id="toc-maven-project" class="nav-link" data-scroll-target="#maven-project">Maven project</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How to write MapReduce programs in Hadoop</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Designers and developers focus on the definition of the Map and Reduce functions (i.e., <span class="math inline">\(m\)</span> and <span class="math inline">\(r\)</span>), and they don’t need to manage the distributed execution of the map, shuffle and sort, and reduce phases. Indeed, the Hadoop framework coordinates the execution of the MapReduce program, managing:</p>
<ul>
<li>the parallel execution of the map and reduce phases</li>
<li>the execution of the shuffle and sort phase</li>
<li>the scheduling of the subtasks</li>
<li>the synchronization</li>
</ul>
<section id="the-components-summary" class="level3">
<h3 class="anchored" data-anchor-id="the-components-summary">The components: summary</h3>
<p>The programming language to use to give instructions to Hadoop is Java. A Hadoop MapReduce program consists of three main parts:</p>
<ul>
<li>Driver</li>
<li>Mapper</li>
<li>Reducer</li>
</ul>
<p>Each part is “implemented” by means of a specific class.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Terminology
</div>
</div>
<div class="callout-body-container callout-body">
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Driver class</td>
<td>The class containing the method/code that coordinates the configuration of the job and the “workflow” of the application</td>
</tr>
<tr class="even">
<td>Mapper class</td>
<td>A class “implementing” the map function</td>
</tr>
<tr class="odd">
<td>Reducer class</td>
<td>A class “implementing” the reduce function</td>
</tr>
<tr class="even">
<td>Driver</td>
<td>Instance of the Driver class (i.e., an object)</td>
</tr>
<tr class="odd">
<td>Mapper</td>
<td>Instance of the Mapper class (i.e., an object)</td>
</tr>
<tr class="even">
<td>Reducer</td>
<td>Instance of the Reducer class (i.e., an object)</td>
</tr>
<tr class="odd">
<td>(Hadoop) Job</td>
<td>Execution/run of a MapReduce code over a data set</td>
</tr>
<tr class="even">
<td>Task</td>
<td>Execution/run of a Mapper (Map task) or a Reducer (Reduce task) on a slice of data. Notice that there may be many tasks for each job</td>
</tr>
<tr class="odd">
<td>Input split</td>
<td>Fixed-size piece of the input data. Usually each split has approximately the same size of a HDFS block/chunk</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="driver-instance" class="level4">
<h4 class="anchored" data-anchor-id="driver-instance">Driver (instance)</h4>
<p>The Driver is characterized by the <code>main()</code> method, which accepts arguments from the command line (i.e., it is the entry point of the application). Also, it has a <code>run()</code> method</p>
<ul>
<li>It configures the job</li>
<li>It submits the job to the Hadoop Cluster</li>
<li>It “coordinates” the work flow of the application</li>
<li>It runs on the client machine (i.e., it does not run on the cluster)</li>
</ul>
</section>
<section id="mapper-instance" class="level4">
<h4 class="anchored" data-anchor-id="mapper-instance">Mapper (instance)</h4>
<p>The Mapper is an instance of the Mapper class.</p>
<ul>
<li>It “implements” the map phase;</li>
<li>It is characterized by the <code>map()</code> method, which processes the <code>(key, value)</code> pairs of the input file and emits <code>(key, value)</code> pairs and is invoked one time for each input <code>(key, value)</code> pair;</li>
<li>It runs on the cluster.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Driver will try to create one Mapper instance for each input block, pushing to the maximum parallelization possible.</p>
</div>
</div>
</section>
<section id="reducer-instance" class="level4">
<h4 class="anchored" data-anchor-id="reducer-instance">Reducer (instance)</h4>
<p>The Reducer is an instance of the Reduce class.</p>
<ul>
<li>It “implements” the reduce phase;</li>
<li>It is characterized by the <code>reduce()</code> method, which processes <code>(key, [list of values])</code> pairs and emits <code>(key, value)</code> pairs and is invoked one time for each distinct key;</li>
<li>It runs on the cluster.</li>
</ul>
</section>
</section>
<section id="hadoop-implementation-of-the-mapreduce-phases" class="level3">
<h3 class="anchored" data-anchor-id="hadoop-implementation-of-the-mapreduce-phases">Hadoop implementation of the MapReduce phases</h3>
<p>The main characteristics Hadoop implementation of the MapReduce are the following</p>
<ul>
<li>The input <code>key-value</code> pairs are read from the HDFS file system.</li>
<li>The map method of the Mapper is invoked over each input <code>key-value</code> pair, and emits a set of intermediate <code>key-value</code> pairs that are stored in the local file system of the computing server (they are not stored in HDFS).</li>
<li>The intermediate results are aggregated by means of a shuffle and sort procedure, and a set of <code>(key, [list of values])</code> pairs is generated. Notice that one <code>(key, [list of values])</code> for each distinct key.</li>
<li>The reduce method of the Reducer is applied over each <code>(key, [list of values])</code> pair, and emits a set of <code>key-value</code> pairs that are stored in HDFS (the final result of the MapReduce application).</li>
<li>Intermediate <code>key-value</code> pairs are transient, which means that they are not stored on the distributed files system, while they are stored locally to the node producing or processing them.</li>
<li>In order to parallelize the work/the job, Hadoop executes a set of tasks in parallel
<ul>
<li>It instantiates one Mapper (Task) for each input split</li>
<li>It instantiates a user-specified number of Reducers: each reducer is associated with a set of keys, and it receives and processes all the key-value pairs associated with its set of keys</li>
</ul></li>
<li>Mappers and Reducers are executed on the nodes/servers of the clusters</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">MapReduce data flow with a single reducer</figcaption>
<p><img src="images/04_hadoop_implementation/data_flow_single_reducer.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">MapReduce data flow with multiple reducers</figcaption>
<p><img src="images/04_hadoop_implementation/data_flow_multiple_reducers.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<section id="driver-class" class="level4">
<h4 class="anchored" data-anchor-id="driver-class">Driver class</h4>
<p>The Driver class extends the <code>org.apache.hadoop.conf.Configured</code> class and implements the <code>org.apache.hadoop.util.Tool</code> interface <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>It is possible to write a Driver class that does not extend Configured and does not implement Tool, however some low level details related to some command line parameters must be managed in that case.</p>
<p>The designer/developer implements the <code>main()</code> and <code>run()</code> methods.</p>
<p>The <code>run()</code> method configures the job, defining</p>
<ul>
<li>The name of the Job</li>
<li>The job Input format</li>
<li>The job Output format</li>
<li>The Mapper class
<ul>
<li>Name of the class</li>
<li>Type of its input <code>(key, value)</code> pairs</li>
<li>Type of its output <code>(key, value)</code> pairs</li>
</ul></li>
<li>The Reducer class
<ul>
<li>Name of the class</li>
<li>Type of its input <code>(key, value)</code> pairs</li>
<li>Type of its output <code>(key, value)</code> pairs</li>
</ul></li>
<li>The Number of Reducers<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
</ul>
</section>
<section id="mapper-class" class="level4">
<h4 class="anchored" data-anchor-id="mapper-class">Mapper class</h4>
<p>The Mapper class extends the</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1"></a>org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">mapreduce</span><span class="op">.</span><span class="fu">Mapper</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>class which is a generic type/generic class with four type parameters:</p>
<ul>
<li>input key type</li>
<li>input value type</li>
<li>output key type</li>
<li>output value type</li>
</ul>
<p>The designer/developer implements the <code>map()</code> method, that is automatically called by the framework for each <code>(key, value)</code> pair of the input file.</p>
<p>The <code>map()</code> method</p>
<ul>
<li>Processes its input <code>(key, value)</code> pairs by using standard Java code</li>
<li>Emits <code>(key, value)</code> pairs by using the <code>context.write(key, value)</code> method</li>
</ul>
</section>
<section id="reducer-class" class="level4">
<h4 class="anchored" data-anchor-id="reducer-class">Reducer class</h4>
<p>The Reducer class extends the</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1"></a>org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">mapreduce</span><span class="op">.</span><span class="fu">Reducer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>class, which is a generic type/generic class with four type parameters:</p>
<ul>
<li>input key type</li>
<li>input value type</li>
<li>output key type</li>
<li>output value type</li>
</ul>
<p>The designer/developer implements the <code>reduce()</code> method, that is automatically called by the framework for each <code>(key, [list of values])</code> pair obtained by aggregating the output of the mapper(s).</p>
<p>The <code>reduce()</code> method</p>
<ul>
<li>Processes its input <code>(key, [list of values])</code> pairs by using standard Java code</li>
<li>Emits <code>(key, value)</code> pairs by using the <code>context.write(key, value)</code> method</li>
</ul>
</section>
<section id="data-types" class="level4">
<h4 class="anchored" data-anchor-id="data-types">Data Types</h4>
<p>Hadoop has its own basic data types optimized for network serialization</p>
<ul>
<li><code>org.apache.hadoop.io.Text</code>: like Java String</li>
<li><code>org.apache.hadoop.io.IntWritable</code>: like Java Integer</li>
<li><code>org.apache.hadoop.io.LongWritable</code>: like Java Long</li>
<li><code>org.apache.hadoop.io.FloatWritable</code>: like Java Float</li>
<li>…</li>
</ul>
<p>The basic Hadoop data types implement the <code>org.apache.hadoop.io.Writable</code> and <code>org.apache.hadoop.io.WritableComparable</code> interfaces</p>
<ul>
<li>All classes (data types) used to represent <strong>keys</strong> are instances of <code>WritableComparable</code>: keys must be “comparable” for supporting the sort and shuffle phase</li>
<li>All classes (data types) used to represent <strong>values</strong> are instances of <code>Writable</code>: usually, they are also instances of <code>WritableComparable</code> even if it is not indispensable</li>
</ul>
<p>Developers can define new data types by implementing the <code>org.apache.hadoop.io.Writable</code> and/or <code>org.apache.hadoop.io.WritableComparable</code> interfaces, allowing to manage complex data types.</p>
</section>
<section id="input-inputformat" class="level4">
<h4 class="anchored" data-anchor-id="input-inputformat">Input: <code>InputFormat</code></h4>
<p>The input of the MapReduce program is an HDFS file (or an HDFS folder), but the input of the Mapper is a set of <code>(key, value)</code> pairs.</p>
<p>The classes extending the <code>org.apache.hadoop.mapreduce.InputFormat</code> abstract class are used to read the input data and “logically transform” the input HDFS file in a set of <code>(key, value)</code> pairs.</p>
<p><code>InputFormat</code> describes the input-format specification for a MapReduce application and processes the input file(s). The <code>InputFormat</code> class is used to</p>
<ul>
<li>Read input data and validate the compliance of the input file with the expected input-format</li>
<li>Split the input file(s) into logical Input Splits, each of which is then assigned to an individual Mapper</li>
<li>Provide the <code>RecordReader</code> implementation to be used to divide the logical input split in a set of <code>(key,value)</code> pairs (also called records) for the mapper</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Getting data to the Mapper</figcaption>
<p><img src="images/04_hadoop_implementation/from_hdfs_to_mapper.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p><code>InputFormat</code> identifies partitions of the data that form an input split</p>
<ul>
<li>Each input split is a (reference to a) part of the input file processed by a single mapper</li>
<li>Each split is divided into records, and the mapper processes one record (i.e., a <code>(key,value)</code> pair) at a time</li>
</ul>
<p>A set of predefined classes extending the <code>InputFormat</code> abstract class are available for standard input file formats</p>
<ul>
<li><code>TextInputFormat</code>: <code>InputFormat</code> for plain text files</li>
<li><code>KeyValueTextInputFormat</code>: another <code>InputFormat</code> for plain text files</li>
<li><code>SequenceFileInputFormat</code>: an <code>InputFormat</code> for sequential/binary files</li>
<li>…</li>
</ul>
<section id="textinputformat" class="level5">
<h5 class="anchored" data-anchor-id="textinputformat"><code>TextInputFormat</code></h5>
<p><code>TextInputFormat</code> is an <code>InputFormat</code> for plain text files. Files are broken into lines, where either linefeed or carriage-return are used to signal end of line. One pair <code>(key, value)</code> is emitted for each line of the file:</p>
<ul>
<li>Key is the position (offset) of the line in the file</li>
<li>Value is the content of the line</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Getting data to the Mapper</figcaption>
<p><img src="images/04_hadoop_implementation/textinputformat_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="keyvaluetextinputformat" class="level5">
<h5 class="anchored" data-anchor-id="keyvaluetextinputformat"><code>KeyValueTextInputFormat</code></h5>
<p><code>KeyValueTextInputFormat</code> is an <code>InputFormat</code> for plain text files, where each line must have the format</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1"></a>key<span class="op">&lt;</span>separator<span class="op">&gt;</span>value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and the default separator is tab (<code>\t</code>).</p>
<p>Files are broken into lines, and either linefeed or carriage-return are used to signal end of line, and each line is split into key and value parts by considering the separator symbol/character.</p>
<p>One pair <code>(key, value)</code> is emitted for each line of the file</p>
<ul>
<li>Key is the text preceding the separator</li>
<li>Value is the text following the separator</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Getting data to the Mapper</figcaption>
<p><img src="images/04_hadoop_implementation/keyvaluetextinputformat_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="output-outputformat" class="level4">
<h4 class="anchored" data-anchor-id="output-outputformat">Output: <code>OutputFormat</code></h4>
<p>The classes extending the <code>org.apache.hadoop.mapreduce.OutputFormat</code> abstract class are used to write the output of the MapReduce program in HDFS.</p>
<p>A set of predefined classes extending the <code>OutputFormat</code> abstract class are available for standard output file formats</p>
<ul>
<li><code>TextOutputFormat</code>: an <code>OutputFormatfor</code> plain text files</li>
<li><code>SequenceFileOutputFormat</code>: an <code>OutputFormatfor</code> sequential/binary files</li>
<li>…</li>
</ul>
<section id="textoutputformat" class="level5">
<h5 class="anchored" data-anchor-id="textoutputformat"><code>TextOutputFormat</code></h5>
<p><code>TextOutputFormat</code> is an <code>OutputFormat</code> for plain text files: for each output <code>(key, value)</code> pair, <code>TextOutputFormat</code> writes one line in the output file. In particular, the format of each output line is</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1"></a><span class="st">"key</span><span class="sc">\t</span><span class="st">value</span><span class="sc">\n</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="structure-of-a-mapreduce-program-in-hadoop" class="level3">
<h3 class="anchored" data-anchor-id="structure-of-a-mapreduce-program-in-hadoop">Structure of a MapReduce program in Hadoop</h3>
<p>Always start from these templates. The parts of the code that should be changed to customize the Hadoop application are highlighted using notes.</p>
<section id="driver" class="level4">
<h4 class="anchored" data-anchor-id="driver">Driver</h4>
<div class="sourceCode" id="annotated-cell-5"><pre class="sourceCode numberSource java code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode java"><button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1"></a><span class="op">*</span> <span class="bu">Set</span> <span class="kw">package</span><span class="im"> </span><span class="op">*</span><span class="im">/</span></span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mypackage</span><span class="op">;</span> </span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3"></a></span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4"></a><span class="co">/* Import libraries */</span></span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6"></a></span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Job</span><span class="op">;</span></span>
<span id="annotated-cell-5-8"><a href="#annotated-cell-5-8"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Tool</span><span class="op">;</span></span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">ToolRunner</span><span class="op">;</span></span>
<span id="annotated-cell-5-10"><a href="#annotated-cell-5-10"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">conf</span><span class="op">.</span><span class="im">Configuration</span><span class="op">;</span></span>
<span id="annotated-cell-5-11"><a href="#annotated-cell-5-11"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">conf</span><span class="op">.</span><span class="im">Configured</span><span class="op">;</span></span>
<span id="annotated-cell-5-12"><a href="#annotated-cell-5-12"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.*;</span></span>
<span id="annotated-cell-5-13"><a href="#annotated-cell-5-13"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">input</span><span class="op">.</span><span class="im">TextInputFormat</span><span class="op">;</span></span>
<span id="annotated-cell-5-14"><a href="#annotated-cell-5-14"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">output</span><span class="op">.</span><span class="im">TextOutputFormat</span><span class="op">;</span></span>
<span id="annotated-cell-5-15"><a href="#annotated-cell-5-15"></a></span>
<span id="annotated-cell-5-16"><a href="#annotated-cell-5-16"></a><span class="co">/* Driver class */</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-17" class="code-annotation-target"><a href="#annotated-cell-5-17"></a><span class="kw">public</span> <span class="kw">class</span> MapReduceAppDriver <span class="kw">extends</span> Configured <span class="kw">implements</span> <span class="bu">Tool</span> <span class="op">{</span></span>
<span id="annotated-cell-5-18"><a href="#annotated-cell-5-18"></a>    <span class="at">@Override</span></span>
<span id="annotated-cell-5-19"><a href="#annotated-cell-5-19"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">run</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="annotated-cell-5-20"><a href="#annotated-cell-5-20"></a>        <span class="co">/* variables */</span></span>
<span id="annotated-cell-5-21"><a href="#annotated-cell-5-21"></a>        <span class="dt">int</span> exitCode<span class="op">;</span> </span>
<span id="annotated-cell-5-22"><a href="#annotated-cell-5-22"></a>        <span class="co">//...</span></span>
<span id="annotated-cell-5-23"><a href="#annotated-cell-5-23"></a></span>
<span id="annotated-cell-5-24"><a href="#annotated-cell-5-24"></a>        <span class="co">// Parse parameters</span></span>
<span id="annotated-cell-5-25"><a href="#annotated-cell-5-25"></a>        numberOfReducers <span class="op">=</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">parseInt</span><span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">]);</span> <span class="co">// Number of instances of the Reducer class</span></span>
<span id="annotated-cell-5-26"><a href="#annotated-cell-5-26"></a>        inputPath <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">(</span>args<span class="op">[</span><span class="dv">1</span><span class="op">]);</span> <span class="co">// Can be the path to a folder or to a file. If this is a folder path, the application will read all the files in it</span></span>
<span id="annotated-cell-5-27"><a href="#annotated-cell-5-27"></a>        outputDir <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">(</span>args<span class="op">[</span><span class="dv">2</span><span class="op">]);</span> <span class="co">// This is always the path to a folder</span></span>
<span id="annotated-cell-5-28"><a href="#annotated-cell-5-28"></a></span>
<span id="annotated-cell-5-29"><a href="#annotated-cell-5-29"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-30"><a href="#annotated-cell-5-30"></a>        <span class="co">//     JOB</span></span>
<span id="annotated-cell-5-31"><a href="#annotated-cell-5-31"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-32"><a href="#annotated-cell-5-32"></a>        <span class="co">// Define and configure a new job </span></span>
<span id="annotated-cell-5-33"><a href="#annotated-cell-5-33"></a>        <span class="bu">Configuration</span> conf <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getConf</span><span class="op">();</span> <span class="co">// Create a configuration object to design in it the application configuration</span></span>
<span id="annotated-cell-5-34"><a href="#annotated-cell-5-34"></a>        Job job <span class="op">=</span> Job<span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span>conf<span class="op">);</span> <span class="co">// Creation of the job, that is the application instance</span></span>
<span id="annotated-cell-5-35"><a href="#annotated-cell-5-35"></a></span>
<span id="annotated-cell-5-36"><a href="#annotated-cell-5-36"></a>        <span class="co">// Assign a name to the job</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3">3</button><span id="annotated-cell-5-37" class="code-annotation-target"><a href="#annotated-cell-5-37"></a>        job<span class="op">.</span><span class="fu">setJobName</span><span class="op">(</span><span class="st">"My First MapReduce program"</span><span class="op">);</span></span>
<span id="annotated-cell-5-38"><a href="#annotated-cell-5-38"></a></span>
<span id="annotated-cell-5-39"><a href="#annotated-cell-5-39"></a>        <span class="co">// Set path of the input file/folder (if it is a folder, the job reads all the files in the specified folder) for this job</span></span>
<span id="annotated-cell-5-40"><a href="#annotated-cell-5-40"></a>        FileInputFormat<span class="op">.</span><span class="fu">addInputPath</span><span class="op">(</span>job<span class="op">,</span> inputPath<span class="op">);</span></span>
<span id="annotated-cell-5-41"><a href="#annotated-cell-5-41"></a></span>
<span id="annotated-cell-5-42"><a href="#annotated-cell-5-42"></a>        <span class="co">// Set path of the output folder for this job</span></span>
<span id="annotated-cell-5-43"><a href="#annotated-cell-5-43"></a>        FileOutputFormat<span class="op">.</span><span class="fu">setOutputPath</span><span class="op">(</span>job<span class="op">,</span> outputDir<span class="op">);</span></span>
<span id="annotated-cell-5-44"><a href="#annotated-cell-5-44"></a></span>
<span id="annotated-cell-5-45"><a href="#annotated-cell-5-45"></a>        <span class="co">// Set input format</span></span>
<span id="annotated-cell-5-46"><a href="#annotated-cell-5-46"></a>        <span class="co">// TextInputFormat = textual files; the input types are (keys: LongWritable, values: text)</span></span>
<span id="annotated-cell-5-47"><a href="#annotated-cell-5-47"></a>        <span class="co">// KeyValueTextInputFormat = textual files; the input types are (keys: text, values: text)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="4">4</button><span id="annotated-cell-5-48" class="code-annotation-target"><a href="#annotated-cell-5-48"></a>        job<span class="op">.</span><span class="fu">setInputFormatClass</span><span class="op">(</span>TextInputFormat<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// This class also includes the information about the type of input data</span></span>
<span id="annotated-cell-5-49"><a href="#annotated-cell-5-49"></a></span>
<span id="annotated-cell-5-50"><a href="#annotated-cell-5-50"></a>        <span class="co">// Set job output format</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="5">5</button><span id="annotated-cell-5-51" class="code-annotation-target"><a href="#annotated-cell-5-51"></a>        job<span class="op">.</span><span class="fu">setOutputFormatClass</span><span class="op">(</span>TextOutputFormat<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="annotated-cell-5-52"><a href="#annotated-cell-5-52"></a></span>
<span id="annotated-cell-5-53"><a href="#annotated-cell-5-53"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-54"><a href="#annotated-cell-5-54"></a>        <span class="co">//   DRIVER</span></span>
<span id="annotated-cell-5-55"><a href="#annotated-cell-5-55"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-56"><a href="#annotated-cell-5-56"></a>        <span class="co">// Specify the class of the Driver for this job</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="6">6</button><span id="annotated-cell-5-57" class="code-annotation-target"><a href="#annotated-cell-5-57"></a>        job<span class="op">.</span><span class="fu">setJarByClass</span><span class="op">(</span>MapReduceAppDriver<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="annotated-cell-5-58"><a href="#annotated-cell-5-58"></a></span>
<span id="annotated-cell-5-59"><a href="#annotated-cell-5-59"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-60"><a href="#annotated-cell-5-60"></a>        <span class="co">//   MAPPER</span></span>
<span id="annotated-cell-5-61"><a href="#annotated-cell-5-61"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-62"><a href="#annotated-cell-5-62"></a>        <span class="co">// Set mapper class</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="7">7</button><span id="annotated-cell-5-63" class="code-annotation-target"><a href="#annotated-cell-5-63"></a>        job<span class="op">.</span><span class="fu">setMapperClass</span><span class="op">(</span>MyMapperClass<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="annotated-cell-5-64"><a href="#annotated-cell-5-64"></a>        </span>
<span id="annotated-cell-5-65"><a href="#annotated-cell-5-65"></a>        <span class="co">// Set map output key and value classes; these are also the key - value types of the reduces class</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="8">8</button><span id="annotated-cell-5-66" class="code-annotation-target"><a href="#annotated-cell-5-66"></a>        job<span class="op">.</span><span class="fu">setMapOutputKeyClass</span><span class="op">(</span>output key type<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// where type changes depending on the type (e.g., text, IntWritable)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="9">9</button><span id="annotated-cell-5-67" class="code-annotation-target"><a href="#annotated-cell-5-67"></a>        job<span class="op">.</span><span class="fu">setMapOutputValueClass</span><span class="op">(</span>output value type<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="annotated-cell-5-68"><a href="#annotated-cell-5-68"></a></span>
<span id="annotated-cell-5-69"><a href="#annotated-cell-5-69"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-70"><a href="#annotated-cell-5-70"></a>        <span class="co">//   REDUCER</span></span>
<span id="annotated-cell-5-71"><a href="#annotated-cell-5-71"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-72"><a href="#annotated-cell-5-72"></a>        <span class="co">// Set reduce class</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="10">10</button><span id="annotated-cell-5-73" class="code-annotation-target"><a href="#annotated-cell-5-73"></a>        job<span class="op">.</span><span class="fu">setReducerClass</span><span class="op">(</span>MyReducerClass<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="annotated-cell-5-74"><a href="#annotated-cell-5-74"></a></span>
<span id="annotated-cell-5-75"><a href="#annotated-cell-5-75"></a>        <span class="co">// Set reduce output key and value classes</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="11">11</button><span id="annotated-cell-5-76" class="code-annotation-target"><a href="#annotated-cell-5-76"></a>        job<span class="op">.</span><span class="fu">setOutputKeyClass</span><span class="op">(</span>output key type<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="12">12</button><span id="annotated-cell-5-77" class="code-annotation-target"><a href="#annotated-cell-5-77"></a>        job<span class="op">.</span><span class="fu">setOutputValueClass</span><span class="op">(</span>output value type<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="annotated-cell-5-78"><a href="#annotated-cell-5-78"></a></span>
<span id="annotated-cell-5-79"><a href="#annotated-cell-5-79"></a>        <span class="co">// Set number of reducers</span></span>
<span id="annotated-cell-5-80"><a href="#annotated-cell-5-80"></a>        job<span class="op">.</span><span class="fu">setNumReduceTasks</span><span class="op">(</span>numberOfReducers<span class="op">);</span></span>
<span id="annotated-cell-5-81"><a href="#annotated-cell-5-81"></a></span>
<span id="annotated-cell-5-82"><a href="#annotated-cell-5-82"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-83"><a href="#annotated-cell-5-83"></a>        <span class="co">//   OTHER</span></span>
<span id="annotated-cell-5-84"><a href="#annotated-cell-5-84"></a>        <span class="co">// **********************</span></span>
<span id="annotated-cell-5-85"><a href="#annotated-cell-5-85"></a>        <span class="co">// Execute the job and wait for completion</span></span>
<span id="annotated-cell-5-86"><a href="#annotated-cell-5-86"></a>        <span class="cf">if</span> <span class="op">(</span>job<span class="op">.</span><span class="fu">waitForCompletion</span><span class="op">(</span><span class="kw">true</span><span class="op">)==</span><span class="kw">true</span><span class="op">)</span> <span class="co">// with this method the application is run</span></span>
<span id="annotated-cell-5-87"><a href="#annotated-cell-5-87"></a>            exitCode<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="annotated-cell-5-88"><a href="#annotated-cell-5-88"></a>        <span class="cf">else</span></span>
<span id="annotated-cell-5-89"><a href="#annotated-cell-5-89"></a>            exitCode<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="annotated-cell-5-90"><a href="#annotated-cell-5-90"></a>        <span class="cf">return</span> exitCode<span class="op">;</span></span>
<span id="annotated-cell-5-91"><a href="#annotated-cell-5-91"></a>    <span class="op">}</span> <span class="co">// End of the run method</span></span>
<span id="annotated-cell-5-92"><a href="#annotated-cell-5-92"></a></span>
<span id="annotated-cell-5-93"><a href="#annotated-cell-5-93"></a>    <span class="co">/* main method of the driver class */</span></span>
<span id="annotated-cell-5-94"><a href="#annotated-cell-5-94"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span> args<span class="op">[])</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span> <span class="co">// This part of the code is always the same</span></span>
<span id="annotated-cell-5-95"><a href="#annotated-cell-5-95"></a>        <span class="co">/* Exploit the ToolRunner class to "configure" and run the Hadoop application */</span></span>
<span id="annotated-cell-5-96"><a href="#annotated-cell-5-96"></a>        <span class="dt">int</span> res <span class="op">=</span> ToolRunner<span class="op">.</span><span class="fu">run</span><span class="op">(</span></span>
<span id="annotated-cell-5-97"><a href="#annotated-cell-5-97"></a>            <span class="kw">new</span> <span class="bu">Configuration</span><span class="op">(),</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="13">13</button><span id="annotated-cell-5-98" class="code-annotation-target"><a href="#annotated-cell-5-98"></a>            <span class="kw">new</span> <span class="fu">MapReduceAppDriver</span><span class="op">(),</span></span>
<span id="annotated-cell-5-99"><a href="#annotated-cell-5-99"></a>            args</span>
<span id="annotated-cell-5-100"><a href="#annotated-cell-5-100"></a>        <span class="op">);</span></span>
<span id="annotated-cell-5-101"><a href="#annotated-cell-5-101"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">exit</span><span class="op">(</span>res<span class="op">);</span></span>
<span id="annotated-cell-5-102"><a href="#annotated-cell-5-102"></a>    <span class="op">}</span> <span class="co">// End of the main method</span></span>
<span id="annotated-cell-5-103"><a href="#annotated-cell-5-103"></a><span class="op">}</span> <span class="co">// End of public class MapReduceAppDriver</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="1" data-code-lines="1"><code>mypackage</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="2" data-code-lines="17"><code>MapReduceAppDriver</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="3" data-code-lines="37"><code>"My First MapReduce program"</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="4" data-code-lines="48"><code>TextInputFormat</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="5" data-code-lines="51"><code>TextInputFormat</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="6" data-code-lines="57"><code>MapReduceAppDriver</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="7" data-code-lines="63"><code>MyMapperClass</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="8" data-code-lines="66"><code>output value type</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="9" data-code-lines="67"><code>output value type</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="10" data-code-lines="73"><code>MyReducerClass</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="11">11</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="11" data-code-lines="76"><code>output value type</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="12">12</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="12" data-code-lines="77"><code>output value type</code></span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="13">13</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="13" data-code-lines="98"><code>MapReduceAppDriver</code></span>
</dd>
</dl>
</section>
<section id="mapper" class="level4">
<h4 class="anchored" data-anchor-id="mapper">Mapper</h4>
<div class="sourceCode" id="annotated-cell-6"><pre class="sourceCode numberSource java code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode java"><span id="annotated-cell-6-1"><a href="#annotated-cell-6-1"></a><span class="co">/* Set package */</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-2" class="code-annotation-target"><a href="#annotated-cell-6-2"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mypackage</span><span class="op">;</span></span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3"></a></span>
<span id="annotated-cell-6-4"><a href="#annotated-cell-6-4"></a><span class="co">/* Import libraries */</span></span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="annotated-cell-6-6"><a href="#annotated-cell-6-6"></a></span>
<span id="annotated-cell-6-7"><a href="#annotated-cell-6-7"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Mapper</span><span class="op">;</span></span>
<span id="annotated-cell-6-8"><a href="#annotated-cell-6-8"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.*;</span></span>
<span id="annotated-cell-6-9"><a href="#annotated-cell-6-9"></a></span>
<span id="annotated-cell-6-10"><a href="#annotated-cell-6-10"></a><span class="co">/* Mapper Class */</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2">2</button><span id="annotated-cell-6-11" class="code-annotation-target"><a href="#annotated-cell-6-11"></a><span class="kw">class</span> myMapperClass <span class="kw">extends</span> Mapper<span class="op">&lt;</span> <span class="co">// Mapper is a template</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3">3</button><span id="annotated-cell-6-12" class="code-annotation-target"><a href="#annotated-cell-6-12"></a>    MapperInputKeyType<span class="op">,</span> <span class="co">// Input key type (must be consistent with the InputFormat class specified in the Driver)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="4">4</button><span id="annotated-cell-6-13" class="code-annotation-target"><a href="#annotated-cell-6-13"></a>    MapperInputValueType<span class="op">,</span> <span class="co">// Input value type (must be consistent with the InputFormat class specified in the Driver)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="5">5</button><span id="annotated-cell-6-14" class="code-annotation-target"><a href="#annotated-cell-6-14"></a>    MapperOutputKeyType<span class="op">,</span> <span class="co">// Output key type</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="6">6</button><span id="annotated-cell-6-15" class="code-annotation-target"><a href="#annotated-cell-6-15"></a>    MapperOutputValueType <span class="co">// Output value type</span></span>
<span id="annotated-cell-6-16"><a href="#annotated-cell-6-16"></a><span class="op">&gt;{</span></span>
<span id="annotated-cell-6-17"><a href="#annotated-cell-6-17"></a><span class="co">/* Implementation of the map method */</span></span>
<span id="annotated-cell-6-18"><a href="#annotated-cell-6-18"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">map</span><span class="op">(</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="7">7</button><span id="annotated-cell-6-19" class="code-annotation-target"><a href="#annotated-cell-6-19"></a>        MapperInputKeyType key<span class="op">,</span> <span class="co">// Input key</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="8">8</button><span id="annotated-cell-6-20" class="code-annotation-target"><a href="#annotated-cell-6-20"></a>        MapperInputValueType value<span class="op">,</span> <span class="co">// Input value</span></span>
<span id="annotated-cell-6-21"><a href="#annotated-cell-6-21"></a>        <span class="bu">Context</span> context <span class="co">// This is an object containing the write method, that has to be invoked to return the (key, value) pairs</span></span>
<span id="annotated-cell-6-22"><a href="#annotated-cell-6-22"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span> <span class="op">{</span></span>
<span id="annotated-cell-6-23"><a href="#annotated-cell-6-23"></a></span>
<span id="annotated-cell-6-24"><a href="#annotated-cell-6-24"></a>        <span class="co">/* </span></span>
<span id="annotated-cell-6-25"><a href="#annotated-cell-6-25"></a><span class="co">        Process the input (key, value) pair and emit a set of (key,value) pairs. </span></span>
<span id="annotated-cell-6-26"><a href="#annotated-cell-6-26"></a><span class="co">        context.write(...) is used to emit (key, value) pairs context.write(new outputkey, new outputvalue); </span></span>
<span id="annotated-cell-6-27"><a href="#annotated-cell-6-27"></a><span class="co">        */</span> </span>
<span id="annotated-cell-6-28"><a href="#annotated-cell-6-28"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="9">9</button><span id="annotated-cell-6-29" class="code-annotation-target"><a href="#annotated-cell-6-29"></a>        context<span class="op">.</span><span class="fu">write</span><span class="op">(</span><span class="kw">new</span> outputkey<span class="op">,</span> <span class="kw">new</span> outputvalue<span class="op">);</span></span>
<span id="annotated-cell-6-30"><a href="#annotated-cell-6-30"></a>        <span class="co">// Notice context.write(...) has to be invoked a number of times equal to the number of (key, value) pairs have to be returned. Even 0 times is accepted</span></span>
<span id="annotated-cell-6-31"><a href="#annotated-cell-6-31"></a></span>
<span id="annotated-cell-6-32"><a href="#annotated-cell-6-32"></a>        <span class="co">// In the mapper instance also setup and cleanup methods can be implemented, but are not mandatory. Instead, the map method is mandatory</span></span>
<span id="annotated-cell-6-33"><a href="#annotated-cell-6-33"></a></span>
<span id="annotated-cell-6-34"><a href="#annotated-cell-6-34"></a>    <span class="op">}</span> <span class="co">// End of the map method</span></span>
<span id="annotated-cell-6-35"><a href="#annotated-cell-6-35"></a><span class="op">}</span> <span class="co">// End of class myMapperClass</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="1" data-code-lines="2"><code>mypackage</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="2" data-code-lines="11"><code>myMapperClass</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="3" data-code-lines="12"><code>MapperInputKeyType</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="4" data-code-lines="13"><code>MapperInputValueType</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="5" data-code-lines="14"><code>MapperOutputKeyType</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="6" data-code-lines="15"><code>MapperOutputValueType</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="7" data-code-lines="19"><code>MapperInputKeyType</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="8" data-code-lines="20"><code>MapperInputValueType</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="9" data-code-lines="29"><code>outputkey</code> and <code>outputvalue</code></span>
</dd>
</dl>
</section>
<section id="reducer" class="level4">
<h4 class="anchored" data-anchor-id="reducer">Reducer</h4>
<div class="sourceCode" id="annotated-cell-7"><pre class="sourceCode numberSource java code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode java"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1"></a><span class="co">/* Set package */</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mypackage</span><span class="op">;</span></span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3"></a></span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4"></a><span class="co">/* Import libraries */</span></span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Reducer</span><span class="op">;</span></span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.*;</span></span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8"></a></span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9"></a><span class="co">/* Reducer Class */</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-10" class="code-annotation-target"><a href="#annotated-cell-7-10"></a><span class="kw">class</span> myReducerClass <span class="kw">extends</span> Reducer<span class="op">&lt;</span> <span class="co">// Reducer is a template</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3">3</button><span id="annotated-cell-7-11" class="code-annotation-target"><a href="#annotated-cell-7-11"></a>    ReducerInputKeyType<span class="op">,</span> <span class="co">// Input key type (must be consistent with the OutputKeyType of the Mapper)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4">4</button><span id="annotated-cell-7-12" class="code-annotation-target"><a href="#annotated-cell-7-12"></a>    ReducerInputValueType<span class="op">,</span> <span class="co">// Input value type (must be consistent with the OutputValueType of the Mapper)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="5">5</button><span id="annotated-cell-7-13" class="code-annotation-target"><a href="#annotated-cell-7-13"></a>    ReducerOutputKeyType<span class="op">,</span> <span class="co">// Output key type (must be consistent with the OutputFormat class specified in the Driver)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="6">6</button><span id="annotated-cell-7-14" class="code-annotation-target"><a href="#annotated-cell-7-14"></a>    ReducerOutputValueType <span class="co">// Output value type (must be consistent with the OutputFormat class specified in the Driver)</span></span>
<span id="annotated-cell-7-15"><a href="#annotated-cell-7-15"></a><span class="op">&gt;{</span></span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16"></a>    <span class="co">/* Implementation of the reduce method */</span></span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">reduce</span><span class="op">(</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="7">7</button><span id="annotated-cell-7-18" class="code-annotation-target"><a href="#annotated-cell-7-18"></a>        ReducerInputKeyType key<span class="op">,</span> <span class="co">// Input key</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="8">8</button><span id="annotated-cell-7-19" class="code-annotation-target"><a href="#annotated-cell-7-19"></a>        <span class="bu">Iterable</span><span class="op">&lt;</span>ReducerInputValueType<span class="op">&gt;</span> values<span class="op">,</span> <span class="co">// Input values (list of values). Notice that since this is an Iterable it is not possible to iterate over it more than once (it works like a Python generator). This is done because the iterable can read directly the list from the file system without moving and storing the data on the local server</span></span>
<span id="annotated-cell-7-20"><a href="#annotated-cell-7-20"></a>        <span class="bu">Context</span> context</span>
<span id="annotated-cell-7-21"><a href="#annotated-cell-7-21"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span> <span class="op">{</span></span>
<span id="annotated-cell-7-22"><a href="#annotated-cell-7-22"></a></span>
<span id="annotated-cell-7-23"><a href="#annotated-cell-7-23"></a>        <span class="co">/* </span></span>
<span id="annotated-cell-7-24"><a href="#annotated-cell-7-24"></a><span class="co">        Process the input (key, [list of values]) pair and emit a set of (key,value) pairs. </span></span>
<span id="annotated-cell-7-25"><a href="#annotated-cell-7-25"></a><span class="co">        context.write(...) is used to emit (key, value) pairs context.write(new outputkey, new outputvalue); </span></span>
<span id="annotated-cell-7-26"><a href="#annotated-cell-7-26"></a><span class="co">        */</span></span>
<span id="annotated-cell-7-27"><a href="#annotated-cell-7-27"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="9">9</button><span id="annotated-cell-7-28" class="code-annotation-target"><a href="#annotated-cell-7-28"></a>        context<span class="op">.</span><span class="fu">write</span><span class="op">(</span><span class="kw">new</span> outputkey<span class="op">,</span> <span class="kw">new</span> outputvalue<span class="op">);</span></span>
<span id="annotated-cell-7-29"><a href="#annotated-cell-7-29"></a>        <span class="co">// Notice context.write(...) has to be invoked a number of times equal to the number of (key, value) pairs have to be returned. Even 0 times is accepted</span></span>
<span id="annotated-cell-7-30"><a href="#annotated-cell-7-30"></a>        <span class="co">// "new" has to be always specified</span></span>
<span id="annotated-cell-7-31"><a href="#annotated-cell-7-31"></a></span>
<span id="annotated-cell-7-32"><a href="#annotated-cell-7-32"></a>    <span class="op">}</span> <span class="co">// End of the reduce method</span></span>
<span id="annotated-cell-7-33"><a href="#annotated-cell-7-33"></a><span class="op">}</span> <span class="co">// End of class myReducerClass</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="1" data-code-lines="2"><code>mypackage</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="2" data-code-lines="10"><code>myReducerClass</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="3" data-code-lines="11"><code>ReducerInputKeyType</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="4" data-code-lines="12"><code>ReducerInputValueType</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="5" data-code-lines="13"><code>ReducerOutputKeyType</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="6" data-code-lines="14"><code>ReducerOutputValueType</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="7" data-code-lines="18"><code>ReducerInputKeyType</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="8" data-code-lines="19"><code>ReducerInputValueType</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="9" data-code-lines="28"><code>outputkey</code> and <code>outputvalue</code></span>
</dd>
</dl>
</section>
<section id="sec-wordcountexample" class="level4">
<h4 class="anchored" data-anchor-id="sec-wordcountexample">Example of a MapReduce program in Hadoop: Word Count</h4>
<p>The Word count problem consists of</p>
<ul>
<li>Input: (unstructured) textual file, where each line of the input file can contains a set of words</li>
<li>Output: number of occurrences of each word appearing in the input file</li>
<li>Parameters/arguments of the application:
<ul>
<li><code>args[0]</code>: number of instances of the reducer</li>
<li><code>args[1]</code>: path of the input file</li>
<li><code>args[2]</code>: path of the output folder</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Word Count input and output examples
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Input file</strong></p>
<pre><code>Toy example file for Hadoop. Hadoop running example.</code></pre>
<p><strong>Output file</strong></p>
<pre><code>(toy,1)
(example,2)
(file,1)
(for,1)
(hadoop,2)
(running,1)</code></pre>
</div>
</div>
</div>
<section id="driver-1" class="level5">
<h5 class="anchored" data-anchor-id="driver-1">Driver</h5>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">/* Set package */</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">wordcount</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">/* Import libraries */</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">conf</span><span class="op">.</span><span class="im">Configuration</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">conf</span><span class="op">.</span><span class="im">Configured</span><span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">fs</span><span class="op">.</span><span class="im">Path</span><span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IntWritable</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">Text</span><span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Job</span><span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">input</span><span class="op">.</span><span class="im">FileInputFormat</span><span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">input</span><span class="op">.</span><span class="im">TextInputFormat</span><span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">output</span><span class="op">.</span><span class="im">FileOutputFormat</span><span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">output</span><span class="op">.</span><span class="im">TextOutputFormat</span><span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Tool</span><span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">ToolRunner</span><span class="op">;</span></span>
<span id="cb7-17"><a href="#cb7-17"></a></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">/* Driver class */</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="kw">public</span> <span class="kw">class</span> WordCount <span class="kw">extends</span> Configured <span class="kw">implements</span> <span class="bu">Tool</span> <span class="op">{</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>    <span class="at">@Override</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>    <span class="kw">public</span> <span class="fu">intrun</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>        Path inputPath<span class="op">;</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>        Path outputDir<span class="op">;</span></span>
<span id="cb7-24"><a href="#cb7-24"></a>        <span class="dt">int</span> numberOfReducers<span class="op">;</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>        <span class="dt">int</span> exitCode<span class="op">;</span> </span>
<span id="cb7-26"><a href="#cb7-26"></a>        </span>
<span id="cb7-27"><a href="#cb7-27"></a>        <span class="co">// Parse input parameters</span></span>
<span id="cb7-28"><a href="#cb7-28"></a>        numberOfReducers <span class="op">=</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">parseInt</span><span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>        inputPath <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">(</span>args<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>        outputDir <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">(</span>args<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb7-31"><a href="#cb7-31"></a></span>
<span id="cb7-32"><a href="#cb7-32"></a>        <span class="co">// Define and configure a new job</span></span>
<span id="cb7-33"><a href="#cb7-33"></a>        <span class="bu">Configuration</span> conf <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getConf</span><span class="op">();</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>        Job job <span class="op">=</span> Job<span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span>conf<span class="op">);</span> </span>
<span id="cb7-35"><a href="#cb7-35"></a>        </span>
<span id="cb7-36"><a href="#cb7-36"></a>        <span class="co">// Assign a name to the job</span></span>
<span id="cb7-37"><a href="#cb7-37"></a>        job<span class="op">.</span><span class="fu">setJobName</span><span class="op">(</span><span class="st">"WordCounter"</span><span class="op">);</span></span>
<span id="cb7-38"><a href="#cb7-38"></a></span>
<span id="cb7-39"><a href="#cb7-39"></a>        <span class="co">// Set path of the input file/folder (if it is a folder, the job reads all the files in the specified folder) for this job</span></span>
<span id="cb7-40"><a href="#cb7-40"></a>        FileInputFormat<span class="op">.</span><span class="fu">addInputPath</span><span class="op">(</span>job<span class="op">,</span> inputPath<span class="op">);</span></span>
<span id="cb7-41"><a href="#cb7-41"></a></span>
<span id="cb7-42"><a href="#cb7-42"></a>        <span class="co">// Set path of the output folder for this job</span></span>
<span id="cb7-43"><a href="#cb7-43"></a>        FileOutputFormat<span class="op">.</span><span class="fu">setOutputPath</span><span class="op">(</span>job<span class="op">,</span> outputDir<span class="op">);</span></span>
<span id="cb7-44"><a href="#cb7-44"></a></span>
<span id="cb7-45"><a href="#cb7-45"></a>        <span class="co">// Set input format</span></span>
<span id="cb7-46"><a href="#cb7-46"></a>        <span class="co">// TextInputFormat = textual files </span></span>
<span id="cb7-47"><a href="#cb7-47"></a>        job<span class="op">.</span><span class="fu">setInputFormatClass</span><span class="op">(</span>TextInputFormat<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-48"><a href="#cb7-48"></a></span>
<span id="cb7-49"><a href="#cb7-49"></a>        <span class="co">// Set job output format</span></span>
<span id="cb7-50"><a href="#cb7-50"></a>        job<span class="op">.</span><span class="fu">setOutputFormatClass</span><span class="op">(</span>TextOutputFormat<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-51"><a href="#cb7-51"></a></span>
<span id="cb7-52"><a href="#cb7-52"></a>        <span class="co">// Specify the class of the Driver for this job</span></span>
<span id="cb7-53"><a href="#cb7-53"></a>        job<span class="op">.</span><span class="fu">setJarByClass</span><span class="op">(</span>WordCount<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-54"><a href="#cb7-54"></a></span>
<span id="cb7-55"><a href="#cb7-55"></a>        <span class="co">// Set mapper class</span></span>
<span id="cb7-56"><a href="#cb7-56"></a>        job<span class="op">.</span><span class="fu">setMapperClass</span><span class="op">(</span>WordCountMapper<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-57"><a href="#cb7-57"></a>        </span>
<span id="cb7-58"><a href="#cb7-58"></a>        <span class="co">// Set map output key and value classes</span></span>
<span id="cb7-59"><a href="#cb7-59"></a>        job<span class="op">.</span><span class="fu">setMapOutputKeyClass</span><span class="op">(</span><span class="bu">Text</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-60"><a href="#cb7-60"></a>        job<span class="op">.</span><span class="fu">setMapOutputValueClass</span><span class="op">(</span>IntWritable<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-61"><a href="#cb7-61"></a></span>
<span id="cb7-62"><a href="#cb7-62"></a>        <span class="co">// Set reduce class</span></span>
<span id="cb7-63"><a href="#cb7-63"></a>        job<span class="op">.</span><span class="fu">setReducerClass</span><span class="op">(</span>WordCountReducer<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-64"><a href="#cb7-64"></a>        </span>
<span id="cb7-65"><a href="#cb7-65"></a>        <span class="co">// Set reduce output key and value classes</span></span>
<span id="cb7-66"><a href="#cb7-66"></a>        job<span class="op">.</span><span class="fu">setOutputKeyClass</span><span class="op">(</span><span class="bu">Text</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-67"><a href="#cb7-67"></a>        job<span class="op">.</span><span class="fu">setOutputValueClass</span><span class="op">(</span>IntWritable<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-68"><a href="#cb7-68"></a></span>
<span id="cb7-69"><a href="#cb7-69"></a>        <span class="co">// Set number of reducers</span></span>
<span id="cb7-70"><a href="#cb7-70"></a>        job<span class="op">.</span><span class="fu">setNumReduceTasks</span><span class="op">(</span>numberOfReducers<span class="op">);</span></span>
<span id="cb7-71"><a href="#cb7-71"></a></span>
<span id="cb7-72"><a href="#cb7-72"></a>        <span class="co">// Execute the job and wait for completion</span></span>
<span id="cb7-73"><a href="#cb7-73"></a>        <span class="cf">if</span> <span class="op">(</span>job<span class="op">.</span><span class="fu">waitForCompletion</span><span class="op">(</span><span class="kw">true</span><span class="op">)==</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb7-74"><a href="#cb7-74"></a>            exitCode<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-75"><a href="#cb7-75"></a>        <span class="cf">else</span></span>
<span id="cb7-76"><a href="#cb7-76"></a>            exitCode<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb7-77"><a href="#cb7-77"></a>        <span class="cf">return</span> exitCode<span class="op">;</span></span>
<span id="cb7-78"><a href="#cb7-78"></a>    <span class="op">}</span> <span class="co">// End of the run method</span></span>
<span id="cb7-79"><a href="#cb7-79"></a></span>
<span id="cb7-80"><a href="#cb7-80"></a>    <span class="co">/* main method of the driver class */</span></span>
<span id="cb7-81"><a href="#cb7-81"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span> args<span class="op">[])</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb7-82"><a href="#cb7-82"></a></span>
<span id="cb7-83"><a href="#cb7-83"></a>        <span class="co">/* Exploit the ToolRunner class to "configure" and run the </span></span>
<span id="cb7-84"><a href="#cb7-84"></a><span class="co">        Hadoop application */</span></span>
<span id="cb7-85"><a href="#cb7-85"></a>    </span>
<span id="cb7-86"><a href="#cb7-86"></a>        intres <span class="op">=</span> ToolRunner<span class="op">.</span><span class="fu">run</span><span class="op">(</span></span>
<span id="cb7-87"><a href="#cb7-87"></a>            <span class="kw">new</span> <span class="bu">Configuration</span><span class="op">(),</span> </span>
<span id="cb7-88"><a href="#cb7-88"></a>            <span class="kw">new</span> <span class="fu">WordCount</span><span class="op">(),</span> </span>
<span id="cb7-89"><a href="#cb7-89"></a>            args</span>
<span id="cb7-90"><a href="#cb7-90"></a>        <span class="op">);</span></span>
<span id="cb7-91"><a href="#cb7-91"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">exit</span><span class="op">(</span>res<span class="op">);</span></span>
<span id="cb7-92"><a href="#cb7-92"></a>    <span class="op">}</span> <span class="co">// End of the main method</span></span>
<span id="cb7-93"><a href="#cb7-93"></a><span class="op">}</span> <span class="co">// End of public class WordCount</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="mapper-1" class="level5">
<h5 class="anchored" data-anchor-id="mapper-1">Mapper</h5>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">/* Set package */</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">wordcount</span><span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">/* Import libraries */</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IntWritable</span><span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">LongWritable</span><span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">Text</span><span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Mapper</span><span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">/* MapperClass */</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="kw">class</span> WordCountMapper <span class="kw">extends</span> Mapper<span class="op">&lt;</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>    LongWritable<span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>    <span class="bu">Text</span><span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>    <span class="bu">Text</span><span class="op">,</span> <span class="co">// Output key type</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>    IntWritable <span class="co">// Output value type</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="op">&gt;{</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>    <span class="co">/* Implementation of the map method */</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">map</span><span class="op">(</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>        LongWritable key<span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>        <span class="bu">Text</span> value<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>        <span class="bu">Context</span> context</span>
<span id="cb8-23"><a href="#cb8-23"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span> <span class="op">{</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>        <span class="co">// Split each sentence in words. Use whitespace(s) as delimiter</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>        <span class="co">// The split method returns an array of strings</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>        <span class="bu">String</span><span class="op">[]</span> words <span class="op">=</span> value<span class="op">.</span><span class="fu">toString</span><span class="op">().</span><span class="fu">split</span><span class="op">(</span><span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span><span class="op">);</span></span>
<span id="cb8-27"><a href="#cb8-27"></a></span>
<span id="cb8-28"><a href="#cb8-28"></a>        <span class="co">// Iterate over the set of words</span></span>
<span id="cb8-29"><a href="#cb8-29"></a>        <span class="cf">for</span><span class="op">(</span><span class="bu">String</span> word <span class="op">:</span> words<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-30"><a href="#cb8-30"></a>            <span class="co">// Transform word case</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>            <span class="bu">String</span> cleanedWord <span class="op">=</span> word<span class="op">.</span><span class="fu">toLowerCase</span><span class="op">();</span></span>
<span id="cb8-32"><a href="#cb8-32"></a></span>
<span id="cb8-33"><a href="#cb8-33"></a>            <span class="co">// emit one pair (word, 1) for each input word</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>            context<span class="op">.</span><span class="fu">write</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Text</span><span class="op">(</span>cleanedWord<span class="op">),</span> <span class="kw">new</span> <span class="fu">IntWritable</span><span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb8-35"><a href="#cb8-35"></a>        <span class="op">}</span></span>
<span id="cb8-36"><a href="#cb8-36"></a>    <span class="op">}</span> <span class="co">// End map method</span></span>
<span id="cb8-37"><a href="#cb8-37"></a><span class="op">}</span> <span class="co">// End of class WordCountMapper</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reducer-1" class="level5">
<h5 class="anchored" data-anchor-id="reducer-1">Reducer</h5>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">/* Set package */</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">wordcount</span><span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">/* Import libraries */</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IntWritable</span><span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">Text</span><span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Reducer</span><span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9"></a></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">/* Reducer Class */</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="kw">class</span> WordCountReducer <span class="kw">extends</span> Reducer<span class="op">&lt;</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="bu">Text</span><span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>IntWritable<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="bu">Text</span><span class="op">,</span> <span class="co">// Output key type</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>IntWritable <span class="co">// Output value type</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="op">&gt;{</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>    <span class="co">/* Implementation of the reduce method */</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">reduce</span><span class="op">(</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>        <span class="bu">Text</span> key<span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>        <span class="bu">Iterable</span><span class="op">&lt;</span>IntWritable<span class="op">&gt;</span> values<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>        <span class="bu">Context</span> context</span>
<span id="cb9-22"><a href="#cb9-22"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span><span class="op">{</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>        <span class="dt">int</span> occurrances<span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>        </span>
<span id="cb9-25"><a href="#cb9-25"></a>        <span class="co">// Iterate over the set of values and sum them </span></span>
<span id="cb9-26"><a href="#cb9-26"></a>        <span class="cf">for</span> <span class="op">(</span>IntWritable value <span class="op">:</span> values<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-27"><a href="#cb9-27"></a>            occurrances <span class="op">=</span> occurrances<span class="op">+</span> value<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb9-28"><a href="#cb9-28"></a>        <span class="op">}</span></span>
<span id="cb9-29"><a href="#cb9-29"></a></span>
<span id="cb9-30"><a href="#cb9-30"></a>        <span class="co">// Emit the total number of occurrences of the current word</span></span>
<span id="cb9-31"><a href="#cb9-31"></a>        context<span class="op">.</span><span class="fu">write</span><span class="op">(</span>key<span class="op">,</span> <span class="kw">new</span> <span class="fu">IntWritable</span><span class="op">(</span>occurrances<span class="op">));</span></span>
<span id="cb9-32"><a href="#cb9-32"></a>    <span class="op">}</span> <span class="co">// End reduce method</span></span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="op">}</span> <span class="co">// End of class WordCountReducer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="combiner" class="level3">
<h3 class="anchored" data-anchor-id="combiner">Combiner</h3>
<p>In standard MapReduce applications, the <code>(key,value)</code> pairs emitted by the Mappers are sent to the Reducers through the network. However, some pre-aggregations could be performed to limit the amount of network data by using Combiners (also called “minireducers”).</p>
<p>Consider the standard word count problem, and suppose that the input file is split in two input splits, hence, two Mappers are instantiated (one for each split).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Word count without Combiner</figcaption>
<p><img src="images/04_hadoop_implementation/word_count_no_combiner_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>A combiner can be locally called on the output <code>(key, value)</code> pairs of each mapper (it works on data stored in the main-memory or on the local hard disks) to pre-aggregate data, reducing the data moving through the network.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Word count with Combiner</figcaption>
<p><img src="images/04_hadoop_implementation/word_count_combiner_example.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>So, in MapReduce applications that include Combiners after the Mappers, the <code>(key,value)</code> pairs emitted by the Mappers are analyzed in main-memory (or on the local disk) and aggregated by the Combiners. Each Combiner pre-aggregates the values associated with the pairs emitted by the Mappers of a cluster node, limiting the amount of network data generated by each cluster node.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Combiner scope of application
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Combiners work only if the reduce function is <strong>commutative</strong> and <strong>associative</strong>.</li>
<li>The execution of combiners is not guaranteed: Hadoop decides at runtime if executing a combiner, and so the user cannot be sure of the combiner execution just by checking the code. Because of this, the developer/designer should write MapReduce jobs whose successful executions <strong>do not depend</strong> on whether the Combiner is executed.</li>
</ul>
</div>
</div>
<section id="combiner-instance" class="level4">
<h4 class="anchored" data-anchor-id="combiner-instance">Combiner (instance)</h4>
<p>The Combiner is an instance of the <code>org.apache.hadoop.mapreduce.Reducer</code> class. Notice that there is not a specific combiner-template class.</p>
<ul>
<li>It “implements” a pre-reduce phase that aggregates the pairs emitted in each node by Mappers</li>
<li>It is characterized by the <code>reduce()</code> method</li>
<li>It processes <code>(key, [list of values])</code> pairs and emits <code>(key, value)</code> pairs</li>
<li>It runs on the cluster</li>
</ul>
</section>
<section id="combiner-class" class="level4">
<h4 class="anchored" data-anchor-id="combiner-class">Combiner class</h4>
<p>The Combiner class extends the <code>org.apache.hadoop.mapreduce.Reducer</code> class, that is a generic type/generic class with four type parameters:</p>
<ul>
<li>input key type</li>
<li>input value type</li>
<li>output key type</li>
<li>output value type</li>
</ul>
<p>Notice that the output data types are the same as the output data types.</p>
<p>Combiners and Reducers extend the <strong>same class</strong>, and the designer/developer implements the <code>reduce()</code> method also for the Combiner instances. The Combiner is automatically called by Hadoop for each <code>(key, [list of values])</code> pair obtained by aggregating the local output of a Mapper.</p>
<p>The Combiner class is specified by using the <code>job.setCombinerClass()</code> method in the <code>run</code> method of the Driver (i.e., in the job configuration part of the code).</p>
</section>
<section id="example-adding-the-combiner-to-the-word-count-problem" class="level4">
<h4 class="anchored" data-anchor-id="example-adding-the-combiner-to-the-word-count-problem">Example: adding the Combiner to the Word Count problem</h4>
<p>Consider the word count problem (see <a href="#sec-wordcountexample"><span>Section&nbsp;6.0.3.4</span></a> for details), to add the combiner to solution seen before:</p>
<ul>
<li>Specify the combiner class in the Driver</li>
<li>Define the Combiner class. The reduce method of the combiner aggregates local pairs emitted by the mappers of a single cluster node, and emits partial results (local number of occurrences for each word) from each cluster node that is used to run the application.</li>
</ul>
<section id="specify-combiner-class-in-the-driver" class="level5">
<h5 class="anchored" data-anchor-id="specify-combiner-class-in-the-driver">Specify combiner class in the Driver</h5>
<p>Add the call to the combiner class in the Driver, before the <code>return</code> around line 68</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1"></a>        <span class="co">// Set combiner class</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>        job<span class="op">.</span><span class="fu">setCombinerClass</span><span class="op">(</span>WordCountCombiner<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-the-combiner-class" class="level5">
<h5 class="anchored" data-anchor-id="define-the-combiner-class">Define the Combiner class</h5>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">/* Set package */</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">wordcount</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">/* Import libraries */</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IntWritable</span><span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">Text</span><span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Reducer</span><span class="op">;</span></span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">/* Combiner Class */</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="kw">class</span> WordCountCombiner <span class="kw">extends</span> Reducer<span class="op">&lt;</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>    <span class="bu">Text</span><span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>    IntWritable<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>    <span class="bu">Text</span><span class="op">,</span> <span class="co">// Output key type</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>    IntWritable <span class="co">// Output value type</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="op">&gt;{</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">/* Implementation of the reduce method */</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">reduce</span><span class="op">(</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>        <span class="bu">Text</span> key<span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb11-20"><a href="#cb11-20"></a>        <span class="bu">Iterable</span><span class="op">&lt;</span>IntWritable<span class="op">&gt;</span> values<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>        <span class="bu">Context</span> context</span>
<span id="cb11-22"><a href="#cb11-22"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span><span class="op">{</span></span>
<span id="cb11-23"><a href="#cb11-23"></a>        <span class="dt">int</span> occurrances<span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-24"><a href="#cb11-24"></a>        <span class="co">// Iterate over the set of values and sum them </span></span>
<span id="cb11-25"><a href="#cb11-25"></a>        <span class="cf">for</span> <span class="op">(</span>IntWritable value <span class="op">:</span> values<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-26"><a href="#cb11-26"></a>            occurrances <span class="op">=</span> occurrances<span class="op">+</span> value<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>        <span class="op">}</span></span>
<span id="cb11-28"><a href="#cb11-28"></a>        <span class="co">// Emit the total number of occurrences of the current word</span></span>
<span id="cb11-29"><a href="#cb11-29"></a>        context<span class="op">.</span><span class="fu">write</span><span class="op">(</span>key<span class="op">,</span> <span class="kw">new</span> <span class="fu">IntWritable</span><span class="op">(</span>occurrances<span class="op">));</span></span>
<span id="cb11-30"><a href="#cb11-30"></a>    <span class="op">}</span> <span class="co">// End reduce method</span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="op">}</span> <span class="co">// End of class WordCountCombiner</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="final-thoughts" class="level4">
<h4 class="anchored" data-anchor-id="final-thoughts">Final thoughts</h4>
<p>The reducer and the combiner classes perform the same computation (the reduce method of the two classes is the same). Indeed, the developer/designer does not really need two different classes: he can simply specify that WordCountReducer is also the combiner class, for example by adding in the driver</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1"></a>        <span class="co">// Set combiner class</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>        job<span class="op">.</span><span class="fu">setCombinerClass</span><span class="op">(</span>WordCountReducer<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>        <span class="co">// "WordCountReducer.class" instead of "WordCountCombiner.class"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In 99% of the Hadoop applications the same class can be used to implement both combiner and reducer.</p>
</section>
</section>
<section id="personalized-data-types" class="level3">
<h3 class="anchored" data-anchor-id="personalized-data-types">Personalized Data Types</h3>
<p>Personalized Data Types are useful when the <strong>value</strong> of a key-value pair is a <strong>complex data type</strong>. Personalized Data Types are defined by implementing the <code>org.apache.hadoop.io.Writable</code> interface. To properly serialize the input-output data, the following methods must be implemented</p>
<ul>
<li><code>public void readFields(DataInput in)</code></li>
<li><code>public void write(DataOutput out)</code></li>
</ul>
<p>To properly format the output of the job (i.e., the output of the reducer) usually also the following method is “redefined”</p>
<ul>
<li><code>public String toString()</code></li>
</ul>
<p>If also a constructor is defined, remember to define also an empty constructor, otherwise the system will raise an error at runtime.</p>
<section id="example-2" class="level4">
<h4 class="anchored" data-anchor-id="example-2">Example</h4>
<p>Suppose to be interested in complex values composed of two parts, such as a counter (int) and a sum (float). In this case, an ad-hoc Data Type can be used to implement this complex data type in Hadoop.</p>
<div class="sourceCode" id="annotated-cell-14"><pre class="sourceCode numberSource java code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode java"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1"></a><span class="co">/* Set package */</span></span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2"></a></span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">combinerexample</span><span class="op">;</span></span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">DataInput</span><span class="op">;</span></span>
<span id="annotated-cell-14-5"><a href="#annotated-cell-14-5"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">DataOutput</span><span class="op">;</span></span>
<span id="annotated-cell-14-6"><a href="#annotated-cell-14-6"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="annotated-cell-14-7"><a href="#annotated-cell-14-7"></a></span>
<span id="annotated-cell-14-8"><a href="#annotated-cell-14-8"></a><span class="kw">public</span> <span class="kw">class</span> SumAndCountWritable <span class="kw">implements</span> </span>
<span id="annotated-cell-14-9"><a href="#annotated-cell-14-9"></a>org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">io</span><span class="op">.</span><span class="fu">Writable</span> <span class="op">{</span></span>
<span id="annotated-cell-14-10"><a href="#annotated-cell-14-10"></a>    <span class="co">/* Private variables */</span></span>
<span id="annotated-cell-14-11"><a href="#annotated-cell-14-11"></a>    <span class="kw">private</span> <span class="dt">float</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="annotated-cell-14-12"><a href="#annotated-cell-14-12"></a>    <span class="kw">private</span> <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="annotated-cell-14-13"><a href="#annotated-cell-14-13"></a></span>
<span id="annotated-cell-14-14"><a href="#annotated-cell-14-14"></a>    <span class="co">/* Methods to get and set private variables of the class */</span></span>
<span id="annotated-cell-14-15"><a href="#annotated-cell-14-15"></a>    <span class="kw">public</span> <span class="dt">float</span> <span class="fu">getSum</span><span class="op">()</span> <span class="op">{</span></span>
<span id="annotated-cell-14-16"><a href="#annotated-cell-14-16"></a>        <span class="cf">return</span> sum<span class="op">;</span></span>
<span id="annotated-cell-14-17"><a href="#annotated-cell-14-17"></a>    <span class="op">}</span></span>
<span id="annotated-cell-14-18"><a href="#annotated-cell-14-18"></a></span>
<span id="annotated-cell-14-19"><a href="#annotated-cell-14-19"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setSum</span><span class="op">(</span><span class="dt">float</span> sumValue<span class="op">)</span> <span class="op">{</span></span>
<span id="annotated-cell-14-20"><a href="#annotated-cell-14-20"></a>        sum<span class="op">=</span>sumValue<span class="op">;</span></span>
<span id="annotated-cell-14-21"><a href="#annotated-cell-14-21"></a>    <span class="op">}</span></span>
<span id="annotated-cell-14-22"><a href="#annotated-cell-14-22"></a></span>
<span id="annotated-cell-14-23"><a href="#annotated-cell-14-23"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getCount</span><span class="op">()</span> <span class="op">{</span></span>
<span id="annotated-cell-14-24"><a href="#annotated-cell-14-24"></a>        <span class="cf">return</span> count<span class="op">;</span></span>
<span id="annotated-cell-14-25"><a href="#annotated-cell-14-25"></a>    <span class="op">}</span></span>
<span id="annotated-cell-14-26"><a href="#annotated-cell-14-26"></a></span>
<span id="annotated-cell-14-27"><a href="#annotated-cell-14-27"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setCount</span><span class="op">(</span><span class="dt">int</span> countValue<span class="op">)</span> <span class="op">{</span></span>
<span id="annotated-cell-14-28"><a href="#annotated-cell-14-28"></a>        count<span class="op">=</span>countValue<span class="op">;</span></span>
<span id="annotated-cell-14-29"><a href="#annotated-cell-14-29"></a>    <span class="op">}</span></span>
<span id="annotated-cell-14-30"><a href="#annotated-cell-14-30"></a></span>
<span id="annotated-cell-14-31"><a href="#annotated-cell-14-31"></a>    <span class="co">/* Methods to serialize and deserialize the contents of the </span></span>
<span id="annotated-cell-14-32"><a href="#annotated-cell-14-32"></a><span class="co">    instances of this class */</span></span>
<span id="annotated-cell-14-33"><a href="#annotated-cell-14-33"></a>    <span class="at">@Override</span> <span class="co">/* Serialize the fields of this object to out */</span></span>
<span id="annotated-cell-14-34"><a href="#annotated-cell-14-34"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">write</span><span class="op">(</span><span class="bu">DataOutput</span> out<span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span> <span class="op">{</span></span>
<span id="annotated-cell-14-35"><a href="#annotated-cell-14-35"></a>        out<span class="op">.</span><span class="fu">writeFloat</span><span class="op">(</span>sum<span class="op">);</span></span>
<span id="annotated-cell-14-36"><a href="#annotated-cell-14-36"></a>        out<span class="op">.</span><span class="fu">writeInt</span><span class="op">(</span>count<span class="op">);</span></span>
<span id="annotated-cell-14-37"><a href="#annotated-cell-14-37"></a>    <span class="op">}</span></span>
<span id="annotated-cell-14-38"><a href="#annotated-cell-14-38"></a></span>
<span id="annotated-cell-14-39"><a href="#annotated-cell-14-39"></a>    <span class="at">@Override</span> <span class="co">/* Deserialize the fields of this object from in */</span></span>
<span id="annotated-cell-14-40"><a href="#annotated-cell-14-40"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">readFields</span><span class="op">(</span><span class="bu">DataInput</span> in<span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span> <span class="op">{</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1">1</button><span id="annotated-cell-14-41" class="code-annotation-target"><a href="#annotated-cell-14-41"></a>        um<span class="op">=</span>in<span class="op">.</span><span class="fu">readFloat</span><span class="op">();</span></span>
<span id="annotated-cell-14-42"><a href="#annotated-cell-14-42"></a>        count<span class="op">=</span>in<span class="op">.</span><span class="fu">readInt</span><span class="op">();</span></span>
<span id="annotated-cell-14-43"><a href="#annotated-cell-14-43"></a>    <span class="op">}</span></span>
<span id="annotated-cell-14-44"><a href="#annotated-cell-14-44"></a></span>
<span id="annotated-cell-14-45"><a href="#annotated-cell-14-45"></a>    <span class="co">/* Specify how to convert the contents of the instances of this </span></span>
<span id="annotated-cell-14-46"><a href="#annotated-cell-14-46"></a><span class="co">    class to a String</span></span>
<span id="annotated-cell-14-47"><a href="#annotated-cell-14-47"></a><span class="co">    * Useful to specify how to store/write the content of this class</span></span>
<span id="annotated-cell-14-48"><a href="#annotated-cell-14-48"></a><span class="co">    * in a textual file */</span></span>
<span id="annotated-cell-14-49"><a href="#annotated-cell-14-49"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">()</span></span>
<span id="annotated-cell-14-50"><a href="#annotated-cell-14-50"></a>    <span class="op">{</span></span>
<span id="annotated-cell-14-51"><a href="#annotated-cell-14-51"></a>        <span class="bu">String</span> formattedString<span class="op">=</span></span>
<span id="annotated-cell-14-52"><a href="#annotated-cell-14-52"></a>        <span class="kw">new</span> <span class="bu">String</span><span class="op">(</span><span class="st">"sum="</span><span class="op">+</span>sum<span class="op">+</span><span class="st">",count="</span><span class="op">+</span>count<span class="op">);</span></span>
<span id="annotated-cell-14-53"><a href="#annotated-cell-14-53"></a>        <span class="cf">return</span> formattedString<span class="op">;</span></span>
<span id="annotated-cell-14-54"><a href="#annotated-cell-14-54"></a>    <span class="op">}</span></span>
<span id="annotated-cell-14-55"><a href="#annotated-cell-14-55"></a><span class="op">}</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-annotation="1" data-code-lines="41">Notice that the order of the read must be coherent with the order of the write.</span>
</dd>
</dl>
</section>
<section id="complex-keys" class="level4">
<h4 class="anchored" data-anchor-id="complex-keys">Complex keys</h4>
<p>Personalized Data Types can be used also to manage complex <strong>keys</strong>. In that case the Personalized Data Type must implement the <code>org.apache.hadoop.io.WritableComparable</code> interface, since keys must be</p>
<ul>
<li>Compared/sorted: it is possible by implementing the <code>compareTo()</code> method; it is used by the Combiner locally.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1"></a><span class="at">@Override</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">public</span> <span class="dt">int</span> <span class="fu">compareTo</span><span class="op">(</span>IntPair ip<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="dt">int</span> cmp <span class="op">=</span> <span class="fu">compare</span><span class="op">(</span>first<span class="op">,</span> ip<span class="op">.</span><span class="fu">first</span><span class="op">);</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="cf">if</span> <span class="op">(</span>cmp <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>        <span class="cf">return</span> cmp<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="op">}</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="cf">return</span> <span class="fu">compare</span><span class="op">(</span>second<span class="op">,</span> ip<span class="op">.</span><span class="fu">second</span><span class="op">);</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="op">}</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">/**</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">*</span> Convenience method for comparing two ints<span class="co">.</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">*/</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">int</span> <span class="fu">compare</span><span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>    <span class="cf">return</span> <span class="op">(</span>a <span class="op">&lt;</span> b <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> <span class="op">(</span>a <span class="op">==</span> b <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<ul>
<li>Split in groups: it is possible by implementing the <code>hashCode()</code> method; it is used by the Reducer on the networks.</li>
</ul>
</section>
</section>
<section id="sharing-parameters-among-driver-mappers-and-reducers" class="level3">
<h3 class="anchored" data-anchor-id="sharing-parameters-among-driver-mappers-and-reducers">Sharing parameters among Driver, Mappers, and Reducers</h3>
<p>The configuration object is used to share the (basic) configuration of the Hadoop environment across the driver, the mappers and the reducers of the application/job. It stores a list of <code>(property-name, property-value)</code> pairs.</p>
<p>Also, personalized <code>(property-name, property-value)</code> pairs can be specified in the driver, and they can be used to share some parameters of the application with mappers and reducers. The personalized <code>(property-name, property-value)</code> pairs are useful to define shared small (constant) properties that are available only during the execution of the program. The driver sets these parameters, and Mappers and Reducers can access them, however they cannot modify them.</p>
<section id="how-to-use-these-parameters" class="level4">
<h4 class="anchored" data-anchor-id="how-to-use-these-parameters">How to use these parameters</h4>
<p>In the driver</p>
<ol type="1">
<li>Retrieve the configuration object</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1"></a><span class="bu">Configuration</span> conf <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getConf</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Set personalized properties</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1"></a>conf<span class="op">.</span><span class="fu">set</span><span class="op">(</span><span class="st">"property-name"</span><span class="op">,</span> <span class="st">"value"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the Mapper and/or Reducer</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1"></a>context<span class="op">.</span><span class="fu">getConfiguration</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">"property-name"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method returns a String containing the value of the specified property.</p>
</section>
</section>
<section id="counters" class="level3">
<h3 class="anchored" data-anchor-id="counters">Counters</h3>
<p>Hadoop provides a set of basic, built-in, counters to store some statistics about jobs, mappers, reducers, for example</p>
<ul>
<li>number of input and output records (i.e., pairs)</li>
<li>number of transmitted bytes</li>
</ul>
<p>Also other ad-hoc, user-defined, counters can be defined to compute global “statistics” associated with the goal of the application.</p>
<section id="user-defined-counters" class="level4">
<h4 class="anchored" data-anchor-id="user-defined-counters">User-defined counters</h4>
<p>User-defined counters are defined by means of Java <code>enum</code>, and each application can define an arbitrary number of enums. The name of the <code>enum</code> is the group name, and each <code>enum</code> has a number of “fields”, which are the counter names.</p>
<p>Counters are incremented in the Mappers and Reducers by using the <code>increment()</code> method</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1"></a>context<span class="op">.</span><span class="fu">getCounter</span><span class="op">(</span>countername<span class="op">).</span><span class="fu">increment</span><span class="op">(</span>value<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The global/final value of each counter, which is available at the end of the job, is then stored/printed by the Driver (at the end of the execution of the job). Driver can retrieve the final values of the counters using the <code>getCounters()</code> and <code>findCounter()</code> methods.</p>
<p>User-defined counters can be also defined on the fly by using the method <code>incrCounter("group name", "counter name", value)</code>. Dynamic counters are useful when the set of counters is unknown at design time.</p>
<section id="example-4" class="level5">
<h5 class="anchored" data-anchor-id="example-4">Example</h5>
<p>In the driver, add</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="kw">enum</span> COUNTERS <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>    ERROR_COUNT<span class="op">,</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>    MISSING_FIELDS_RECORD_COUNT</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This enum defines two counters</p>
<ul>
<li><code>COUNTERS.ERROR_COUNT</code></li>
<li><code>COUNTERS.MISSING_FIELDS_RECORD_COUNT</code></li>
</ul>
<p>To increment the <code>COUNTERS.ERROR_COUNT</code> counter in the mapper or the reducer, use</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1"></a>context<span class="op">.</span><span class="fu">getCounter</span><span class="op">(</span>COUNTERS<span class="op">.</span><span class="fu">ERROR_COUNT</span><span class="op">).</span><span class="fu">increment</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To retrieve the final value of the <code>COUNTERS.ERROR_COUNT</code> counter in the driver, use</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1"></a>Counter errorCounter <span class="op">=</span> job<span class="op">.</span><span class="fu">getCounters</span><span class="op">().</span><span class="fu">findCounter</span><span class="op">(</span>COUNTERS<span class="op">.</span><span class="fu">ERROR_COUNT</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="map-only-job" class="level3">
<h3 class="anchored" data-anchor-id="map-only-job">Map-only job</h3>
<p>In some applications, all the work can be performed by the mapper(s) (e.g., record filtering applications): Hadoop allows executing Map-only jobs, avoiding the reduce phase, and also the shuffle and sort phase.</p>
<p>The output of the map job is directly stored in HDFS, since the set of pairs emitted by the map phase is already the final output.</p>
<section id="implementation-of-a-map-only-job" class="level4">
<h4 class="anchored" data-anchor-id="implementation-of-a-map-only-job">Implementation of a Map-only job</h4>
<p>To implement a Map-only job</p>
<ul>
<li>Implement the map method</li>
<li>Set the number of reducers to 0 during the configuration of the job (in the driver), writing</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1"></a>job<span class="op">.</span><span class="fu">setNumReduceTasks</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="in-mapper-combiner" class="level3">
<h3 class="anchored" data-anchor-id="in-mapper-combiner">In-Mapper combiner</h3>
<p>Mapper classes are also characterized by a setup and a cleanup method, which are empty if they are not overridden.</p>
<section id="setup-method" class="level4">
<h4 class="anchored" data-anchor-id="setup-method">Setup method</h4>
<p>The setup method is called once for each mapper prior to the many calls of the map method. It can be used to set the values of in-mapper variables, which are used to maintain in-mapper statistics and preserve the state (locally for each mapper) within and across calls to the map method.</p>
</section>
<section id="cleanup-method" class="level4">
<h4 class="anchored" data-anchor-id="cleanup-method">Cleanup method</h4>
<p>The map method, invoked many times, updates the value of the in-mapper variables. Each mapper (each instance of the mapper class) has its own copy of the in-mapper variables.</p>
<p>The cleanup method is called once for each mapper after the many calls to the map method, and it can be used to emit <code>(key,value)</code> pairs based on the values of the in-mapper variables/statistics.</p>
<p>Also the reducer classes are characterized by a setup and a cleanup method.</p>
<ul>
<li>The setup method is called once for each reducer prior to the many calls of the reduce method.</li>
<li>The cleanup method is called once for each reducer after the many calls of the reduce method.</li>
</ul>
<p>In-MapperCombiners are a possible improvement over “standard” Combiners</p>
<ul>
<li>Initialize a set of in-mapper variables during the instance of the Mapper, in the setup method of the mapper;</li>
<li>Update the in-mapper variables/statistics in the map method. Usually, no (key,value) pairs are emitted in the map method of an in-mapper combiner.</li>
</ul>
<p>After all the input records (input <code>(key, value)</code> pairs) of a mapper have been analyzed by the map method, emit the output <code>(key, value)</code> pairs of the mapper: <code>(key, value)</code> pairs are emitted in the cleanup method of the mapper based on the values of the in-mapper variables</p>
<p>The in-mapper variables are used to perform the work of the combiner in the mapper, allowing to improve the overall performance of the application. However, pay attention to the amount of used main memory: each mapper may use a limited amount of main-memory, hence in-mapper variables should be “small” (at least smaller than the maximum amount of memory assigned to each mapper).</p>
</section>
<section id="in-mapper-combiner-word-count-pseudocode" class="level4">
<h4 class="anchored" data-anchor-id="in-mapper-combiner-word-count-pseudocode">In-Mapper combiner: Word count pseudocode</h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">class</span> MAPPER</span>
<span id="cb22-2"><a href="#cb22-2"></a>    method setup</span>
<span id="cb22-3"><a href="#cb22-3"></a>        A <span class="op">=</span> <span class="kw">new</span> AssociativeArray</span>
<span id="cb22-4"><a href="#cb22-4"></a>    method <span class="fu">map</span><span class="op">(</span>offset key<span class="op">,</span> line l<span class="op">)</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>        <span class="cf">for</span> all word w ∈ line l <span class="cf">do</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>            A<span class="op">{</span>w<span class="op">}</span> <span class="op">=</span> A<span class="op">{</span>w<span class="op">}</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>    method cleanup</span>
<span id="cb22-8"><a href="#cb22-8"></a>        <span class="cf">for</span> all word w in A <span class="cf">do</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>            <span class="fu">EMIT</span><span class="op">(</span>term w <span class="op">,</span> count A<span class="op">{</span>w<span class="op">})</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="maven-project" class="level3">
<h3 class="anchored" data-anchor-id="maven-project">Maven project</h3>
<section id="structure" class="level4">
<h4 class="anchored" data-anchor-id="structure">Structure</h4>
<ul>
<li><em>src</em> folder: contains the source code. May contain subfolders, but the important point is that it must contain the java files
<ul>
<li>DriverBigData.java</li>
<li>MapperBigData.java</li>
<li>ReducerBigData.java</li>
</ul></li>
<li><em>target</em> folder:
<ul>
<li><em>.jar</em> file: useful to run the application on the cluster. It’s the java archive that collects the three classes of the Hadoop application</li>
</ul></li>
<li><em>pom.xml</em> file: used to configure the Hadoop application</li>
</ul>
</section>
<section id="how-to-run-the-project" class="level4">
<h4 class="anchored" data-anchor-id="how-to-run-the-project">How to run the project</h4>
<p>Using Eclipse</p>
<ul>
<li>select the Driver <code>.java</code> file</li>
<li>Right click</li>
<li>Click “Run As”</li>
<li>If the arguments have already been set:
<ul>
<li>Click “Java Application”</li>
</ul></li>
<li>Otherwise
<ul>
<li>Click “Run Configurations”, to set the arguments</li>
<li>Go to “Arguments” section, and write the arguments. The arguments are
<ul>
<li>the number of reducers: <code>2</code></li>
<li>the (relative) path of the input folder <code>example_data</code></li>
<li>the (relative) path of the output folder <code>example_data_output</code></li>
</ul></li>
</ul></li>
</ul>
<pre><code>2 example_data example_data_output</code></pre>
<p>The output files are</p>
<ul>
<li>an empty file “_SUCCESS”, if the application run successfully</li>
<li>one file for each reducer instance: the intersection between the sets of words in each file is empty, which means that all the same words were processed by the same Reducer. For this reason the output is always a folder and not a single file.</li>
</ul>
</section>
<section id="how-to-create-a-.jar-file-from-the-project" class="level4">
<h4 class="anchored" data-anchor-id="how-to-create-a-.jar-file-from-the-project">How to create a <code>.jar</code> file from the project</h4>
<p>Using Eclipse, to create a <code>.jar</code> file from the project to run the project on the cluster</p>
<ul>
<li>Right click on the project name (e.g., “MapReduceProject”)</li>
<li>Click “Runs As”</li>
<li>Click “Maven build…”</li>
<li>In “Goals” write “package”</li>
<li>Click “Run”</li>
</ul>
</section>
<section id="how-to-run-the-.jar-in-the-bigdatapolito-cluster" class="level4">
<h4 class="anchored" data-anchor-id="how-to-run-the-.jar-in-the-bigdatapolito-cluster">How to run the <code>.jar</code> in the BigData@Polito cluster</h4>
<ul>
<li>Go to <a href="https://jupyter.polito.it/">https://jupyter.polito.it/</a> (i.e., the server gateway) and connect using the credentials</li>
<li>Copy the <code>.jar</code> file on server</li>
<li>Upload the input data in the HDFS</li>
<li>Use the terminal to run the <code>.jar</code>, using the <code>hadoop</code> command</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1"></a><span class="ex">hadoop</span> jar Exercise1-1.0.0.jar <span class="dt">\</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>it.polito.bigdata.hadoop.exercise1.DriverBigData <span class="dt">\</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>2 example_data example_data_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this configuration there are 3 file systems</p>
<ul>
<li>The local file system on the personal PC</li>
<li>The local file system on the gateway server</li>
<li>The distributed file system on the Hadoop cluster (the interface to manage it is https://bigdatalab.polito.it/hue)</li>
</ul>


<!-- -->

</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>An <strong>interface</strong> is like a template of a class, defining which methods must be implemented to be compliant with the interface<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Setting the number of Reducers is a balancing problem: having more Reducers decreases the time to aggregate the data, however it also increases the overhead needed to instantiate the Reducers<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03_intro_hadoop.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Hadoop and MapReduce</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05_mapreduce_patterns_1.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">MapReduce patterns - 1</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb25" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu"># How to write MapReduce programs in Hadoop</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>Designers and developers focus on the definition of the Map and Reduce functions (i.e., $m$ and $r$), and they don't need to manage the distributed execution of the map, shuffle and sort, and reduce phases. Indeed, the Hadoop framework coordinates the execution of the MapReduce program, managing:</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="ss">- </span>the parallel execution of the map and reduce phases</span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="ss">- </span>the execution of the shuffle and sort phase</span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="ss">- </span>the scheduling of the subtasks</span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="ss">- </span>the synchronization</span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="fu">## The components: summary</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>The programming language to use to give instructions to Hadoop is Java. A Hadoop MapReduce program consists of three main parts:</span>
<span id="cb25-11"><a href="#cb25-11"></a></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="ss">- </span>Driver</span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="ss">- </span>Mapper</span>
<span id="cb25-14"><a href="#cb25-14"></a><span class="ss">- </span>Reducer</span>
<span id="cb25-15"><a href="#cb25-15"></a></span>
<span id="cb25-16"><a href="#cb25-16"></a>Each part is "implemented" by means of a specific class.</span>
<span id="cb25-17"><a href="#cb25-17"></a></span>
<span id="cb25-18"><a href="#cb25-18"></a>:::{.callout-tip}</span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="fu">### Terminology</span></span>
<span id="cb25-20"><a href="#cb25-20"></a></span>
<span id="cb25-21"><a href="#cb25-21"></a>| Term | Definition |</span>
<span id="cb25-22"><a href="#cb25-22"></a>| - | ----- |</span>
<span id="cb25-23"><a href="#cb25-23"></a>| Driver class | The class containing the method/code that coordinates the configuration of the job and the “workflow” of the application |</span>
<span id="cb25-24"><a href="#cb25-24"></a>| Mapper class | A class "implementing" the map function |</span>
<span id="cb25-25"><a href="#cb25-25"></a>| Reducer class | A class "implementing" the reduce function |</span>
<span id="cb25-26"><a href="#cb25-26"></a>| Driver | Instance of the Driver class (i.e., an object) |</span>
<span id="cb25-27"><a href="#cb25-27"></a>| Mapper | Instance of the Mapper class (i.e., an object) |</span>
<span id="cb25-28"><a href="#cb25-28"></a>| Reducer | Instance of the Reducer class (i.e., an object) |</span>
<span id="cb25-29"><a href="#cb25-29"></a>| (Hadoop) Job | Execution/run of a MapReduce code over a data set |</span>
<span id="cb25-30"><a href="#cb25-30"></a>| Task | Execution/run of a Mapper (Map task) or a Reducer (Reduce task) on a slice of data. Notice that there may be many tasks for each job |</span>
<span id="cb25-31"><a href="#cb25-31"></a>| Input split | Fixed-size piece of the input data. Usually each split has approximately the same size of a HDFS block/chunk |</span>
<span id="cb25-32"><a href="#cb25-32"></a></span>
<span id="cb25-33"><a href="#cb25-33"></a>:::</span>
<span id="cb25-34"><a href="#cb25-34"></a></span>
<span id="cb25-35"><a href="#cb25-35"></a><span class="fu">### Driver (instance)</span></span>
<span id="cb25-36"><a href="#cb25-36"></a>The Driver is characterized by the <span class="in">`main()`</span> method, which accepts arguments from the command line (i.e., it is the entry point of the application). Also, it has a <span class="in">`run()`</span> method</span>
<span id="cb25-37"><a href="#cb25-37"></a></span>
<span id="cb25-38"><a href="#cb25-38"></a><span class="ss">- </span>It configures the job</span>
<span id="cb25-39"><a href="#cb25-39"></a><span class="ss">- </span>It submits the job to the Hadoop Cluster</span>
<span id="cb25-40"><a href="#cb25-40"></a><span class="ss">- </span>It "coordinates" the work flow of the application </span>
<span id="cb25-41"><a href="#cb25-41"></a><span class="ss">- </span>It runs on the client machine (i.e., it does not run on the cluster)</span>
<span id="cb25-42"><a href="#cb25-42"></a></span>
<span id="cb25-43"><a href="#cb25-43"></a><span class="fu">### Mapper (instance)</span></span>
<span id="cb25-44"><a href="#cb25-44"></a>The Mapper is an instance of the Mapper class.</span>
<span id="cb25-45"><a href="#cb25-45"></a></span>
<span id="cb25-46"><a href="#cb25-46"></a><span class="ss">- </span>It "implements" the map phase;</span>
<span id="cb25-47"><a href="#cb25-47"></a><span class="ss">- </span>It is characterized by the <span class="in">`map()`</span> method, which processes the <span class="in">`(key, value)`</span> pairs of the input file and emits <span class="in">`(key, value)`</span> pairs and is invoked one time for each input <span class="in">`(key, value)`</span> pair;</span>
<span id="cb25-48"><a href="#cb25-48"></a><span class="ss">- </span>It runs on the cluster.</span>
<span id="cb25-49"><a href="#cb25-49"></a></span>
<span id="cb25-50"><a href="#cb25-50"></a>:::{.callout-tip}</span>
<span id="cb25-51"><a href="#cb25-51"></a>The Driver will try to create one Mapper instance for each input block, pushing to the maximum parallelization possible.</span>
<span id="cb25-52"><a href="#cb25-52"></a>:::</span>
<span id="cb25-53"><a href="#cb25-53"></a></span>
<span id="cb25-54"><a href="#cb25-54"></a><span class="fu">### Reducer (instance)</span></span>
<span id="cb25-55"><a href="#cb25-55"></a>The Reducer is an instance of the Reduce class.</span>
<span id="cb25-56"><a href="#cb25-56"></a></span>
<span id="cb25-57"><a href="#cb25-57"></a><span class="ss">- </span>It "implements" the reduce phase;</span>
<span id="cb25-58"><a href="#cb25-58"></a><span class="ss">- </span>It is characterized by the <span class="in">`reduce()`</span> method, which processes <span class="in">`(key, [list of values])`</span> pairs and emits <span class="in">`(key, value)`</span> pairs and is invoked one time for each distinct key;</span>
<span id="cb25-59"><a href="#cb25-59"></a><span class="ss">- </span>It runs on the cluster.</span>
<span id="cb25-60"><a href="#cb25-60"></a></span>
<span id="cb25-61"><a href="#cb25-61"></a><span class="fu">## Hadoop implementation of the MapReduce phases</span></span>
<span id="cb25-62"><a href="#cb25-62"></a>The main characteristics Hadoop implementation of the MapReduce are the following</span>
<span id="cb25-63"><a href="#cb25-63"></a></span>
<span id="cb25-64"><a href="#cb25-64"></a><span class="ss">- </span>The input <span class="in">`key-value`</span> pairs are read from the HDFS file system.</span>
<span id="cb25-65"><a href="#cb25-65"></a><span class="ss">- </span>The map method of the Mapper is invoked over each input <span class="in">`key-value`</span> pair, and emits a set of intermediate <span class="in">`key-value`</span> pairs that are stored in the local file system of the computing server (they are not stored in HDFS).</span>
<span id="cb25-66"><a href="#cb25-66"></a><span class="ss">- </span>The intermediate results are aggregated by means of a shuffle and sort procedure, and a set of <span class="in">`(key, [list of values])`</span> pairs is generated. Notice that one <span class="in">`(key, [list of values])`</span> for each distinct key.</span>
<span id="cb25-67"><a href="#cb25-67"></a><span class="ss">- </span>The reduce method of the Reducer is applied over each <span class="in">`(key, [list of values])`</span> pair, and emits a set of <span class="in">`key-value`</span> pairs that are stored in HDFS (the final result of the MapReduce application).</span>
<span id="cb25-68"><a href="#cb25-68"></a><span class="ss">- </span>Intermediate <span class="in">`key-value`</span> pairs are transient, which means that they are not stored on the distributed files system, while they are stored locally to the node producing or processing them.</span>
<span id="cb25-69"><a href="#cb25-69"></a><span class="ss">- </span>In order to parallelize the work/the job, Hadoop executes a set of tasks in parallel</span>
<span id="cb25-70"><a href="#cb25-70"></a><span class="ss">    - </span>It instantiates one Mapper (Task) for each input split</span>
<span id="cb25-71"><a href="#cb25-71"></a><span class="ss">    - </span>It instantiates a user-specified number of Reducers: each reducer is associated with a set of keys, and it receives and processes all the key-value pairs associated with its set of keys</span>
<span id="cb25-72"><a href="#cb25-72"></a><span class="ss">- </span>Mappers and Reducers are executed on the nodes/servers of the clusters</span>
<span id="cb25-73"><a href="#cb25-73"></a></span>
<span id="cb25-74"><a href="#cb25-74"></a><span class="al">![MapReduce data flow with a single reducer](images/04_hadoop_implementation/data_flow_single_reducer.png)</span>{width=80%}</span>
<span id="cb25-75"><a href="#cb25-75"></a></span>
<span id="cb25-76"><a href="#cb25-76"></a><span class="al">![MapReduce data flow with multiple reducers](images/04_hadoop_implementation/data_flow_multiple_reducers.png)</span>{width=80%}</span>
<span id="cb25-77"><a href="#cb25-77"></a></span>
<span id="cb25-78"><a href="#cb25-78"></a><span class="fu">### Driver class</span></span>
<span id="cb25-79"><a href="#cb25-79"></a>The Driver class extends the <span class="in">`org.apache.hadoop.conf.Configured`</span> class and implements the <span class="in">`org.apache.hadoop.util.Tool`</span> interface ^<span class="co">[</span><span class="ot">An **interface** is like a template of a class, defining which methods must be implemented to be compliant with the interface</span><span class="co">]</span>. </span>
<span id="cb25-80"><a href="#cb25-80"></a></span>
<span id="cb25-81"><a href="#cb25-81"></a>It is possible to write a Driver class that does not extend Configured and does not implement Tool, however some low level details related to some command line parameters must be managed in that case.</span>
<span id="cb25-82"><a href="#cb25-82"></a></span>
<span id="cb25-83"><a href="#cb25-83"></a>The designer/developer implements the <span class="in">`main()`</span> and <span class="in">`run()`</span> methods.</span>
<span id="cb25-84"><a href="#cb25-84"></a></span>
<span id="cb25-85"><a href="#cb25-85"></a>The <span class="in">`run()`</span> method configures the job, defining</span>
<span id="cb25-86"><a href="#cb25-86"></a></span>
<span id="cb25-87"><a href="#cb25-87"></a><span class="ss">- </span>The name of the Job</span>
<span id="cb25-88"><a href="#cb25-88"></a><span class="ss">- </span>The job Input format</span>
<span id="cb25-89"><a href="#cb25-89"></a><span class="ss">- </span>The job Output format</span>
<span id="cb25-90"><a href="#cb25-90"></a><span class="ss">- </span>The Mapper class</span>
<span id="cb25-91"><a href="#cb25-91"></a><span class="ss">    - </span>Name of the class</span>
<span id="cb25-92"><a href="#cb25-92"></a><span class="ss">    - </span>Type of its input <span class="in">`(key, value)`</span> pairs </span>
<span id="cb25-93"><a href="#cb25-93"></a><span class="ss">    - </span>Type of its output <span class="in">`(key, value)`</span> pairs</span>
<span id="cb25-94"><a href="#cb25-94"></a><span class="ss">- </span>The Reducer class</span>
<span id="cb25-95"><a href="#cb25-95"></a><span class="ss">    - </span>Name of the class</span>
<span id="cb25-96"><a href="#cb25-96"></a><span class="ss">    - </span>Type of its input <span class="in">`(key, value)`</span> pairs </span>
<span id="cb25-97"><a href="#cb25-97"></a><span class="ss">    - </span>Type of its output <span class="in">`(key, value)`</span> pairs</span>
<span id="cb25-98"><a href="#cb25-98"></a><span class="ss">- </span>The Number of Reducers^<span class="co">[</span><span class="ot">Setting the number of Reducers is a balancing problem: having more Reducers decreases the time to aggregate the data, however it also increases the overhead needed to instantiate the Reducers</span><span class="co">]</span></span>
<span id="cb25-99"><a href="#cb25-99"></a></span>
<span id="cb25-100"><a href="#cb25-100"></a><span class="fu">### Mapper class</span></span>
<span id="cb25-101"><a href="#cb25-101"></a>The Mapper class extends the </span>
<span id="cb25-102"><a href="#cb25-102"></a></span>
<span id="cb25-103"><a href="#cb25-103"></a><span class="in">```java</span></span>
<span id="cb25-104"><a href="#cb25-104"></a>org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">mapreduce</span><span class="op">.</span><span class="fu">Mapper</span></span>
<span id="cb25-105"><a href="#cb25-105"></a><span class="in">```</span> </span>
<span id="cb25-106"><a href="#cb25-106"></a></span>
<span id="cb25-107"><a href="#cb25-107"></a>class which is a generic type/generic class with four type parameters: </span>
<span id="cb25-108"><a href="#cb25-108"></a></span>
<span id="cb25-109"><a href="#cb25-109"></a><span class="ss">- </span>input key type</span>
<span id="cb25-110"><a href="#cb25-110"></a><span class="ss">- </span>input value type</span>
<span id="cb25-111"><a href="#cb25-111"></a><span class="ss">- </span>output key type</span>
<span id="cb25-112"><a href="#cb25-112"></a><span class="ss">- </span>output value type</span>
<span id="cb25-113"><a href="#cb25-113"></a></span>
<span id="cb25-114"><a href="#cb25-114"></a>The designer/developer implements the <span class="in">`map()`</span> method, that is automatically called by the framework for each <span class="in">`(key, value)`</span> pair of the input file. </span>
<span id="cb25-115"><a href="#cb25-115"></a></span>
<span id="cb25-116"><a href="#cb25-116"></a>The <span class="in">`map()`</span> method</span>
<span id="cb25-117"><a href="#cb25-117"></a></span>
<span id="cb25-118"><a href="#cb25-118"></a><span class="ss">- </span>Processes its input <span class="in">`(key, value)`</span> pairs by using standard Java code</span>
<span id="cb25-119"><a href="#cb25-119"></a><span class="ss">- </span>Emits <span class="in">`(key, value)`</span> pairs by using the <span class="in">`context.write(key, value)`</span> method</span>
<span id="cb25-120"><a href="#cb25-120"></a></span>
<span id="cb25-121"><a href="#cb25-121"></a><span class="fu">### Reducer class</span></span>
<span id="cb25-122"><a href="#cb25-122"></a>The Reducer class extends the </span>
<span id="cb25-123"><a href="#cb25-123"></a></span>
<span id="cb25-124"><a href="#cb25-124"></a><span class="in">```java</span></span>
<span id="cb25-125"><a href="#cb25-125"></a>org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">mapreduce</span><span class="op">.</span><span class="fu">Reducer</span></span>
<span id="cb25-126"><a href="#cb25-126"></a><span class="in">```</span> </span>
<span id="cb25-127"><a href="#cb25-127"></a></span>
<span id="cb25-128"><a href="#cb25-128"></a>class, which is a generic type/generic class with four type parameters: </span>
<span id="cb25-129"><a href="#cb25-129"></a></span>
<span id="cb25-130"><a href="#cb25-130"></a><span class="ss">- </span>input key type</span>
<span id="cb25-131"><a href="#cb25-131"></a><span class="ss">- </span>input value type</span>
<span id="cb25-132"><a href="#cb25-132"></a><span class="ss">- </span>output key type</span>
<span id="cb25-133"><a href="#cb25-133"></a><span class="ss">- </span>output value type</span>
<span id="cb25-134"><a href="#cb25-134"></a></span>
<span id="cb25-135"><a href="#cb25-135"></a>The designer/developer implements the <span class="in">`reduce()`</span> method, that is automatically called by the framework for each <span class="in">`(key, [list of values])`</span> pair obtained by aggregating the output of the mapper(s).</span>
<span id="cb25-136"><a href="#cb25-136"></a></span>
<span id="cb25-137"><a href="#cb25-137"></a>The <span class="in">`reduce()`</span> method</span>
<span id="cb25-138"><a href="#cb25-138"></a></span>
<span id="cb25-139"><a href="#cb25-139"></a><span class="ss">- </span>Processes its input <span class="in">`(key, [list of values])`</span> pairs by using standard Java code</span>
<span id="cb25-140"><a href="#cb25-140"></a><span class="ss">- </span>Emits <span class="in">`(key, value)`</span> pairs by using the <span class="in">`context.write(key, value)`</span> method</span>
<span id="cb25-141"><a href="#cb25-141"></a></span>
<span id="cb25-142"><a href="#cb25-142"></a><span class="fu">### Data Types</span></span>
<span id="cb25-143"><a href="#cb25-143"></a>Hadoop has its own basic data types optimized for network serialization</span>
<span id="cb25-144"><a href="#cb25-144"></a></span>
<span id="cb25-145"><a href="#cb25-145"></a><span class="ss">- </span><span class="in">`org.apache.hadoop.io.Text`</span>: like Java String</span>
<span id="cb25-146"><a href="#cb25-146"></a><span class="ss">- </span><span class="in">`org.apache.hadoop.io.IntWritable`</span>: like Java Integer</span>
<span id="cb25-147"><a href="#cb25-147"></a><span class="ss">- </span><span class="in">`org.apache.hadoop.io.LongWritable`</span>: like Java Long</span>
<span id="cb25-148"><a href="#cb25-148"></a><span class="ss">- </span><span class="in">`org.apache.hadoop.io.FloatWritable`</span>: like Java Float</span>
<span id="cb25-149"><a href="#cb25-149"></a><span class="ss">- </span>...</span>
<span id="cb25-150"><a href="#cb25-150"></a></span>
<span id="cb25-151"><a href="#cb25-151"></a>The basic Hadoop data types implement the <span class="in">`org.apache.hadoop.io.Writable`</span> and <span class="in">`org.apache.hadoop.io.WritableComparable`</span> interfaces</span>
<span id="cb25-152"><a href="#cb25-152"></a></span>
<span id="cb25-153"><a href="#cb25-153"></a><span class="ss">- </span>All classes (data types) used to represent **keys** are instances of <span class="in">`WritableComparable`</span>: keys must be "comparable" for supporting the sort and shuffle phase</span>
<span id="cb25-154"><a href="#cb25-154"></a><span class="ss">- </span>All classes (data types) used to represent **values** are instances of <span class="in">`Writable`</span>: usually, they are also instances of <span class="in">`WritableComparable`</span> even if it is not indispensable</span>
<span id="cb25-155"><a href="#cb25-155"></a></span>
<span id="cb25-156"><a href="#cb25-156"></a>Developers can define new data types by implementing the <span class="in">`org.apache.hadoop.io.Writable`</span> and/or <span class="in">`org.apache.hadoop.io.WritableComparable`</span> interfaces, allowing to manage complex data types.</span>
<span id="cb25-157"><a href="#cb25-157"></a></span>
<span id="cb25-158"><a href="#cb25-158"></a><span class="fu">### Input: `InputFormat`</span></span>
<span id="cb25-159"><a href="#cb25-159"></a>The input of the MapReduce program is an HDFS file (or an HDFS folder), but the input of the Mapper is a set of <span class="in">`(key, value)`</span> pairs.</span>
<span id="cb25-160"><a href="#cb25-160"></a></span>
<span id="cb25-161"><a href="#cb25-161"></a>The classes extending the <span class="in">`org.apache.hadoop.mapreduce.InputFormat`</span> abstract class are used to read the input data and "logically transform" the input HDFS file in a set of <span class="in">`(key, value)`</span> pairs.</span>
<span id="cb25-162"><a href="#cb25-162"></a></span>
<span id="cb25-163"><a href="#cb25-163"></a><span class="in">`InputFormat`</span> describes the input-format specification for a MapReduce application and processes the input file(s). The <span class="in">`InputFormat`</span> class is used to </span>
<span id="cb25-164"><a href="#cb25-164"></a></span>
<span id="cb25-165"><a href="#cb25-165"></a><span class="ss">- </span>Read input data and validate the compliance of the input file with the expected input-format</span>
<span id="cb25-166"><a href="#cb25-166"></a><span class="ss">- </span>Split the input file(s) into logical Input Splits, each of which is then assigned to an individual Mapper</span>
<span id="cb25-167"><a href="#cb25-167"></a><span class="ss">- </span>Provide the <span class="in">`RecordReader`</span> implementation to be used to divide the logical input split in a set of <span class="in">`(key,value)`</span> pairs (also called records) for the mapper</span>
<span id="cb25-168"><a href="#cb25-168"></a></span>
<span id="cb25-169"><a href="#cb25-169"></a><span class="al">![Getting data to the Mapper](images/04_hadoop_implementation/from_hdfs_to_mapper.png)</span>{width=80%}</span>
<span id="cb25-170"><a href="#cb25-170"></a></span>
<span id="cb25-171"><a href="#cb25-171"></a><span class="in">`InputFormat`</span> identifies partitions of the data that form an input split</span>
<span id="cb25-172"><a href="#cb25-172"></a></span>
<span id="cb25-173"><a href="#cb25-173"></a><span class="ss">- </span>Each input split is a (reference to a) part of the input file processed by a single mapper</span>
<span id="cb25-174"><a href="#cb25-174"></a><span class="ss">- </span>Each split is divided into records, and the mapper processes one record (i.e., a <span class="in">`(key,value)`</span> pair) at a time</span>
<span id="cb25-175"><a href="#cb25-175"></a></span>
<span id="cb25-176"><a href="#cb25-176"></a>A set of predefined classes extending the <span class="in">`InputFormat`</span> abstract class are available for standard input file formats</span>
<span id="cb25-177"><a href="#cb25-177"></a></span>
<span id="cb25-178"><a href="#cb25-178"></a><span class="ss">- </span><span class="in">`TextInputFormat`</span>: <span class="in">`InputFormat`</span> for plain text files</span>
<span id="cb25-179"><a href="#cb25-179"></a><span class="ss">- </span><span class="in">`KeyValueTextInputFormat`</span>: another <span class="in">`InputFormat`</span> for plain text files</span>
<span id="cb25-180"><a href="#cb25-180"></a><span class="ss">- </span><span class="in">`SequenceFileInputFormat`</span>: an <span class="in">`InputFormat`</span> for sequential/binary files</span>
<span id="cb25-181"><a href="#cb25-181"></a><span class="ss">- </span>...</span>
<span id="cb25-182"><a href="#cb25-182"></a></span>
<span id="cb25-183"><a href="#cb25-183"></a><span class="fu">#### `TextInputFormat`</span></span>
<span id="cb25-184"><a href="#cb25-184"></a><span class="in">`TextInputFormat`</span> is an <span class="in">`InputFormat`</span> for plain text files. Files are broken into lines, where either linefeed or carriage-return are used to signal end of line. One pair <span class="in">`(key, value)`</span> is emitted for each line of the file:</span>
<span id="cb25-185"><a href="#cb25-185"></a></span>
<span id="cb25-186"><a href="#cb25-186"></a><span class="ss">- </span>Key is the position (offset) of the line in the file</span>
<span id="cb25-187"><a href="#cb25-187"></a><span class="ss">- </span>Value is the content of the line</span>
<span id="cb25-188"><a href="#cb25-188"></a></span>
<span id="cb25-189"><a href="#cb25-189"></a>:::{.callout-note collapse="true"}</span>
<span id="cb25-190"><a href="#cb25-190"></a><span class="fu">### Example</span></span>
<span id="cb25-191"><a href="#cb25-191"></a><span class="al">![Getting data to the Mapper](images/04_hadoop_implementation/textinputformat_example.png)</span>{width=80%}</span>
<span id="cb25-192"><a href="#cb25-192"></a>:::</span>
<span id="cb25-193"><a href="#cb25-193"></a></span>
<span id="cb25-194"><a href="#cb25-194"></a><span class="fu">#### `KeyValueTextInputFormat`</span></span>
<span id="cb25-195"><a href="#cb25-195"></a><span class="in">`KeyValueTextInputFormat`</span> is an <span class="in">`InputFormat`</span> for plain text files, where each line must have the format </span>
<span id="cb25-196"><a href="#cb25-196"></a></span>
<span id="cb25-197"><a href="#cb25-197"></a><span class="in">```java</span></span>
<span id="cb25-198"><a href="#cb25-198"></a>key<span class="op">&lt;</span>separator<span class="op">&gt;</span>value</span>
<span id="cb25-199"><a href="#cb25-199"></a><span class="in">```</span></span>
<span id="cb25-200"><a href="#cb25-200"></a></span>
<span id="cb25-201"><a href="#cb25-201"></a>and the default separator is tab (<span class="in">`\t`</span>).</span>
<span id="cb25-202"><a href="#cb25-202"></a></span>
<span id="cb25-203"><a href="#cb25-203"></a>Files are broken into lines, and either linefeed or carriage-return are used to signal end of line, and each line is split into key and value parts by considering the separator symbol/character.</span>
<span id="cb25-204"><a href="#cb25-204"></a></span>
<span id="cb25-205"><a href="#cb25-205"></a>One pair <span class="in">`(key, value)`</span> is emitted for each line of the file</span>
<span id="cb25-206"><a href="#cb25-206"></a></span>
<span id="cb25-207"><a href="#cb25-207"></a><span class="ss">- </span>Key is the text preceding the separator</span>
<span id="cb25-208"><a href="#cb25-208"></a><span class="ss">- </span>Value is the text following the separator</span>
<span id="cb25-209"><a href="#cb25-209"></a></span>
<span id="cb25-210"><a href="#cb25-210"></a>:::{.callout-note collapse="true"}</span>
<span id="cb25-211"><a href="#cb25-211"></a><span class="fu">### Example</span></span>
<span id="cb25-212"><a href="#cb25-212"></a><span class="al">![Getting data to the Mapper](images/04_hadoop_implementation/keyvaluetextinputformat_example.png)</span>{width=80%}</span>
<span id="cb25-213"><a href="#cb25-213"></a>:::</span>
<span id="cb25-214"><a href="#cb25-214"></a></span>
<span id="cb25-215"><a href="#cb25-215"></a><span class="fu">### Output: `OutputFormat`</span></span>
<span id="cb25-216"><a href="#cb25-216"></a>The classes extending the <span class="in">`org.apache.hadoop.mapreduce.OutputFormat`</span> abstract class are used to write the output of the MapReduce program in HDFS.</span>
<span id="cb25-217"><a href="#cb25-217"></a></span>
<span id="cb25-218"><a href="#cb25-218"></a>A set of predefined classes extending the <span class="in">`OutputFormat`</span> abstract class are available for standard output file formats</span>
<span id="cb25-219"><a href="#cb25-219"></a></span>
<span id="cb25-220"><a href="#cb25-220"></a><span class="ss">- </span><span class="in">`TextOutputFormat`</span>: an <span class="in">`OutputFormatfor`</span> plain text files</span>
<span id="cb25-221"><a href="#cb25-221"></a><span class="ss">- </span><span class="in">`SequenceFileOutputFormat`</span>: an <span class="in">`OutputFormatfor`</span> sequential/binary files</span>
<span id="cb25-222"><a href="#cb25-222"></a><span class="ss">- </span>...</span>
<span id="cb25-223"><a href="#cb25-223"></a></span>
<span id="cb25-224"><a href="#cb25-224"></a><span class="fu">#### `TextOutputFormat`</span></span>
<span id="cb25-225"><a href="#cb25-225"></a><span class="in">`TextOutputFormat`</span> is an <span class="in">`OutputFormat`</span> for plain text files: for each output <span class="in">`(key, value)`</span> pair, <span class="in">`TextOutputFormat`</span> writes one line in the output file. In particular, the format of each output line is </span>
<span id="cb25-226"><a href="#cb25-226"></a><span class="in">```java</span></span>
<span id="cb25-227"><a href="#cb25-227"></a><span class="st">"key</span><span class="sc">\t</span><span class="st">value</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb25-228"><a href="#cb25-228"></a><span class="in">```</span></span>
<span id="cb25-229"><a href="#cb25-229"></a></span>
<span id="cb25-230"><a href="#cb25-230"></a><span class="fu">## Structure of a MapReduce program in Hadoop</span></span>
<span id="cb25-231"><a href="#cb25-231"></a>Always start from these templates. The parts of the code that should be changed to customize the Hadoop application are highlighted using notes.</span>
<span id="cb25-232"><a href="#cb25-232"></a></span>
<span id="cb25-233"><a href="#cb25-233"></a><span class="fu">### Driver</span></span>
<span id="cb25-234"><a href="#cb25-234"></a><span class="in">```java</span></span>
<span id="cb25-235"><a href="#cb25-235"></a><span class="op">*</span> <span class="bu">Set</span> <span class="kw">package</span><span class="im"> </span><span class="op">*</span><span class="im">/ // &lt;1&gt; </span></span>
<span id="cb25-236"><a href="#cb25-236"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mypackage</span><span class="op">;</span> </span>
<span id="cb25-237"><a href="#cb25-237"></a></span>
<span id="cb25-238"><a href="#cb25-238"></a><span class="co">/* Import libraries */</span></span>
<span id="cb25-239"><a href="#cb25-239"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb25-240"><a href="#cb25-240"></a></span>
<span id="cb25-241"><a href="#cb25-241"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Job</span><span class="op">;</span></span>
<span id="cb25-242"><a href="#cb25-242"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Tool</span><span class="op">;</span></span>
<span id="cb25-243"><a href="#cb25-243"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">ToolRunner</span><span class="op">;</span></span>
<span id="cb25-244"><a href="#cb25-244"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">conf</span><span class="op">.</span><span class="im">Configuration</span><span class="op">;</span></span>
<span id="cb25-245"><a href="#cb25-245"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">conf</span><span class="op">.</span><span class="im">Configured</span><span class="op">;</span></span>
<span id="cb25-246"><a href="#cb25-246"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.*;</span></span>
<span id="cb25-247"><a href="#cb25-247"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">input</span><span class="op">.</span><span class="im">TextInputFormat</span><span class="op">;</span></span>
<span id="cb25-248"><a href="#cb25-248"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">output</span><span class="op">.</span><span class="im">TextOutputFormat</span><span class="op">;</span></span>
<span id="cb25-249"><a href="#cb25-249"></a></span>
<span id="cb25-250"><a href="#cb25-250"></a><span class="co">/* Driver class */</span></span>
<span id="cb25-251"><a href="#cb25-251"></a><span class="kw">public</span> <span class="kw">class</span> MapReduceAppDriver <span class="kw">extends</span> Configured <span class="kw">implements</span> <span class="bu">Tool</span> <span class="op">{</span> <span class="co">// &lt;2&gt; </span></span>
<span id="cb25-252"><a href="#cb25-252"></a>    <span class="at">@Override</span></span>
<span id="cb25-253"><a href="#cb25-253"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">run</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb25-254"><a href="#cb25-254"></a>        <span class="co">/* variables */</span></span>
<span id="cb25-255"><a href="#cb25-255"></a>        <span class="dt">int</span> exitCode<span class="op">;</span> </span>
<span id="cb25-256"><a href="#cb25-256"></a>        <span class="co">//...</span></span>
<span id="cb25-257"><a href="#cb25-257"></a></span>
<span id="cb25-258"><a href="#cb25-258"></a>        <span class="co">// Parse parameters</span></span>
<span id="cb25-259"><a href="#cb25-259"></a>        numberOfReducers <span class="op">=</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">parseInt</span><span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">]);</span> <span class="co">// Number of instances of the Reducer class</span></span>
<span id="cb25-260"><a href="#cb25-260"></a>        inputPath <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">(</span>args<span class="op">[</span><span class="dv">1</span><span class="op">]);</span> <span class="co">// Can be the path to a folder or to a file. If this is a folder path, the application will read all the files in it</span></span>
<span id="cb25-261"><a href="#cb25-261"></a>        outputDir <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">(</span>args<span class="op">[</span><span class="dv">2</span><span class="op">]);</span> <span class="co">// This is always the path to a folder</span></span>
<span id="cb25-262"><a href="#cb25-262"></a></span>
<span id="cb25-263"><a href="#cb25-263"></a>        <span class="co">// **********************</span></span>
<span id="cb25-264"><a href="#cb25-264"></a>        <span class="co">//     JOB</span></span>
<span id="cb25-265"><a href="#cb25-265"></a>        <span class="co">// **********************</span></span>
<span id="cb25-266"><a href="#cb25-266"></a>        <span class="co">// Define and configure a new job </span></span>
<span id="cb25-267"><a href="#cb25-267"></a>        <span class="bu">Configuration</span> conf <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getConf</span><span class="op">();</span> <span class="co">// Create a configuration object to design in it the application configuration</span></span>
<span id="cb25-268"><a href="#cb25-268"></a>        Job job <span class="op">=</span> Job<span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span>conf<span class="op">);</span> <span class="co">// Creation of the job, that is the application instance</span></span>
<span id="cb25-269"><a href="#cb25-269"></a></span>
<span id="cb25-270"><a href="#cb25-270"></a>        <span class="co">// Assign a name to the job</span></span>
<span id="cb25-271"><a href="#cb25-271"></a>        job<span class="op">.</span><span class="fu">setJobName</span><span class="op">(</span><span class="st">"My First MapReduce program"</span><span class="op">);</span> <span class="co">// &lt;3&gt;</span></span>
<span id="cb25-272"><a href="#cb25-272"></a></span>
<span id="cb25-273"><a href="#cb25-273"></a>        <span class="co">// Set path of the input file/folder (if it is a folder, the job reads all the files in the specified folder) for this job</span></span>
<span id="cb25-274"><a href="#cb25-274"></a>        FileInputFormat<span class="op">.</span><span class="fu">addInputPath</span><span class="op">(</span>job<span class="op">,</span> inputPath<span class="op">);</span></span>
<span id="cb25-275"><a href="#cb25-275"></a></span>
<span id="cb25-276"><a href="#cb25-276"></a>        <span class="co">// Set path of the output folder for this job</span></span>
<span id="cb25-277"><a href="#cb25-277"></a>        FileOutputFormat<span class="op">.</span><span class="fu">setOutputPath</span><span class="op">(</span>job<span class="op">,</span> outputDir<span class="op">);</span></span>
<span id="cb25-278"><a href="#cb25-278"></a></span>
<span id="cb25-279"><a href="#cb25-279"></a>        <span class="co">// Set input format</span></span>
<span id="cb25-280"><a href="#cb25-280"></a>        <span class="co">// TextInputFormat = textual files; the input types are (keys: LongWritable, values: text)</span></span>
<span id="cb25-281"><a href="#cb25-281"></a>        <span class="co">// KeyValueTextInputFormat = textual files; the input types are (keys: text, values: text)</span></span>
<span id="cb25-282"><a href="#cb25-282"></a>        job<span class="op">.</span><span class="fu">setInputFormatClass</span><span class="op">(</span>TextInputFormat<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// This class also includes the information about the type of input data // &lt;4&gt;</span></span>
<span id="cb25-283"><a href="#cb25-283"></a></span>
<span id="cb25-284"><a href="#cb25-284"></a>        <span class="co">// Set job output format</span></span>
<span id="cb25-285"><a href="#cb25-285"></a>        job<span class="op">.</span><span class="fu">setOutputFormatClass</span><span class="op">(</span>TextOutputFormat<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// &lt;5&gt;</span></span>
<span id="cb25-286"><a href="#cb25-286"></a></span>
<span id="cb25-287"><a href="#cb25-287"></a>        <span class="co">// **********************</span></span>
<span id="cb25-288"><a href="#cb25-288"></a>        <span class="co">//   DRIVER</span></span>
<span id="cb25-289"><a href="#cb25-289"></a>        <span class="co">// **********************</span></span>
<span id="cb25-290"><a href="#cb25-290"></a>        <span class="co">// Specify the class of the Driver for this job</span></span>
<span id="cb25-291"><a href="#cb25-291"></a>        job<span class="op">.</span><span class="fu">setJarByClass</span><span class="op">(</span>MapReduceAppDriver<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// &lt;6&gt;</span></span>
<span id="cb25-292"><a href="#cb25-292"></a></span>
<span id="cb25-293"><a href="#cb25-293"></a>        <span class="co">// **********************</span></span>
<span id="cb25-294"><a href="#cb25-294"></a>        <span class="co">//   MAPPER</span></span>
<span id="cb25-295"><a href="#cb25-295"></a>        <span class="co">// **********************</span></span>
<span id="cb25-296"><a href="#cb25-296"></a>        <span class="co">// Set mapper class</span></span>
<span id="cb25-297"><a href="#cb25-297"></a>        job<span class="op">.</span><span class="fu">setMapperClass</span><span class="op">(</span>MyMapperClass<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// &lt;7&gt;</span></span>
<span id="cb25-298"><a href="#cb25-298"></a>        </span>
<span id="cb25-299"><a href="#cb25-299"></a>        <span class="co">// Set map output key and value classes; these are also the key - value types of the reduces class</span></span>
<span id="cb25-300"><a href="#cb25-300"></a>        job<span class="op">.</span><span class="fu">setMapOutputKeyClass</span><span class="op">(</span>output key type<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// where type changes depending on the type (e.g., text, IntWritable) // &lt;8&gt;</span></span>
<span id="cb25-301"><a href="#cb25-301"></a>        job<span class="op">.</span><span class="fu">setMapOutputValueClass</span><span class="op">(</span>output value type<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// &lt;9&gt;</span></span>
<span id="cb25-302"><a href="#cb25-302"></a></span>
<span id="cb25-303"><a href="#cb25-303"></a>        <span class="co">// **********************</span></span>
<span id="cb25-304"><a href="#cb25-304"></a>        <span class="co">//   REDUCER</span></span>
<span id="cb25-305"><a href="#cb25-305"></a>        <span class="co">// **********************</span></span>
<span id="cb25-306"><a href="#cb25-306"></a>        <span class="co">// Set reduce class</span></span>
<span id="cb25-307"><a href="#cb25-307"></a>        job<span class="op">.</span><span class="fu">setReducerClass</span><span class="op">(</span>MyReducerClass<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// &lt;10&gt;</span></span>
<span id="cb25-308"><a href="#cb25-308"></a></span>
<span id="cb25-309"><a href="#cb25-309"></a>        <span class="co">// Set reduce output key and value classes</span></span>
<span id="cb25-310"><a href="#cb25-310"></a>        job<span class="op">.</span><span class="fu">setOutputKeyClass</span><span class="op">(</span>output key type<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// &lt;11&gt;</span></span>
<span id="cb25-311"><a href="#cb25-311"></a>        job<span class="op">.</span><span class="fu">setOutputValueClass</span><span class="op">(</span>output value type<span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// &lt;12&gt;</span></span>
<span id="cb25-312"><a href="#cb25-312"></a></span>
<span id="cb25-313"><a href="#cb25-313"></a>        <span class="co">// Set number of reducers</span></span>
<span id="cb25-314"><a href="#cb25-314"></a>        job<span class="op">.</span><span class="fu">setNumReduceTasks</span><span class="op">(</span>numberOfReducers<span class="op">);</span></span>
<span id="cb25-315"><a href="#cb25-315"></a></span>
<span id="cb25-316"><a href="#cb25-316"></a>        <span class="co">// **********************</span></span>
<span id="cb25-317"><a href="#cb25-317"></a>        <span class="co">//   OTHER</span></span>
<span id="cb25-318"><a href="#cb25-318"></a>        <span class="co">// **********************</span></span>
<span id="cb25-319"><a href="#cb25-319"></a>        <span class="co">// Execute the job and wait for completion</span></span>
<span id="cb25-320"><a href="#cb25-320"></a>        <span class="cf">if</span> <span class="op">(</span>job<span class="op">.</span><span class="fu">waitForCompletion</span><span class="op">(</span><span class="kw">true</span><span class="op">)==</span><span class="kw">true</span><span class="op">)</span> <span class="co">// with this method the application is run</span></span>
<span id="cb25-321"><a href="#cb25-321"></a>            exitCode<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-322"><a href="#cb25-322"></a>        <span class="cf">else</span></span>
<span id="cb25-323"><a href="#cb25-323"></a>            exitCode<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb25-324"><a href="#cb25-324"></a>        <span class="cf">return</span> exitCode<span class="op">;</span></span>
<span id="cb25-325"><a href="#cb25-325"></a>    <span class="op">}</span> <span class="co">// End of the run method</span></span>
<span id="cb25-326"><a href="#cb25-326"></a></span>
<span id="cb25-327"><a href="#cb25-327"></a>    <span class="co">/* main method of the driver class */</span></span>
<span id="cb25-328"><a href="#cb25-328"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span> args<span class="op">[])</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span> <span class="co">// This part of the code is always the same</span></span>
<span id="cb25-329"><a href="#cb25-329"></a>        <span class="co">/* Exploit the ToolRunner class to "configure" and run the Hadoop application */</span></span>
<span id="cb25-330"><a href="#cb25-330"></a>        <span class="dt">int</span> res <span class="op">=</span> ToolRunner<span class="op">.</span><span class="fu">run</span><span class="op">(</span></span>
<span id="cb25-331"><a href="#cb25-331"></a>            <span class="kw">new</span> <span class="bu">Configuration</span><span class="op">(),</span> </span>
<span id="cb25-332"><a href="#cb25-332"></a>            <span class="kw">new</span> <span class="fu">MapReduceAppDriver</span><span class="op">(),</span> <span class="co">// &lt;13&gt;</span></span>
<span id="cb25-333"><a href="#cb25-333"></a>            args</span>
<span id="cb25-334"><a href="#cb25-334"></a>        <span class="op">);</span></span>
<span id="cb25-335"><a href="#cb25-335"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">exit</span><span class="op">(</span>res<span class="op">);</span></span>
<span id="cb25-336"><a href="#cb25-336"></a>    <span class="op">}</span> <span class="co">// End of the main method</span></span>
<span id="cb25-337"><a href="#cb25-337"></a><span class="op">}</span> <span class="co">// End of public class MapReduceAppDriver</span></span>
<span id="cb25-338"><a href="#cb25-338"></a>```</span>
<span id="cb25-339"><a href="#cb25-339"></a><span class="fl">1.</span> `mypackage`</span>
<span id="cb25-340"><a href="#cb25-340"></a><span class="fl">2.</span> `MapReduceAppDriver`</span>
<span id="cb25-341"><a href="#cb25-341"></a><span class="fl">3.</span> `<span class="st">"My First MapReduce program"</span>`</span>
<span id="cb25-342"><a href="#cb25-342"></a><span class="fl">4.</span> `TextInputFormat`</span>
<span id="cb25-343"><a href="#cb25-343"></a><span class="fl">5.</span> `TextInputFormat`</span>
<span id="cb25-344"><a href="#cb25-344"></a><span class="fl">6.</span> `MapReduceAppDriver`</span>
<span id="cb25-345"><a href="#cb25-345"></a><span class="fl">7.</span> `MyMapperClass`</span>
<span id="cb25-346"><a href="#cb25-346"></a><span class="fl">8.</span> `output value type`</span>
<span id="cb25-347"><a href="#cb25-347"></a><span class="fl">9.</span> `output value type`</span>
<span id="cb25-348"><a href="#cb25-348"></a><span class="fl">10.</span> `MyReducerClass`</span>
<span id="cb25-349"><a href="#cb25-349"></a><span class="fl">11.</span> `output value type`</span>
<span id="cb25-350"><a href="#cb25-350"></a><span class="fl">12.</span> `output value type`</span>
<span id="cb25-351"><a href="#cb25-351"></a><span class="fl">13.</span> `MapReduceAppDriver`</span>
<span id="cb25-352"><a href="#cb25-352"></a></span>
<span id="cb25-353"><a href="#cb25-353"></a>### Mapper</span>
<span id="cb25-354"><a href="#cb25-354"></a></span>
<span id="cb25-355"><a href="#cb25-355"></a>```java</span>
<span id="cb25-356"><a href="#cb25-356"></a><span class="co">/* Set package */</span></span>
<span id="cb25-357"><a href="#cb25-357"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mypackage</span><span class="op">;</span> <span class="co">// &lt;1&gt;</span></span>
<span id="cb25-358"><a href="#cb25-358"></a></span>
<span id="cb25-359"><a href="#cb25-359"></a><span class="co">/* Import libraries */</span></span>
<span id="cb25-360"><a href="#cb25-360"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb25-361"><a href="#cb25-361"></a></span>
<span id="cb25-362"><a href="#cb25-362"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Mapper</span><span class="op">;</span></span>
<span id="cb25-363"><a href="#cb25-363"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.*;</span></span>
<span id="cb25-364"><a href="#cb25-364"></a></span>
<span id="cb25-365"><a href="#cb25-365"></a><span class="co">/* Mapper Class */</span></span>
<span id="cb25-366"><a href="#cb25-366"></a><span class="kw">class</span> myMapperClass <span class="kw">extends</span> Mapper<span class="op">&lt;</span> <span class="co">// Mapper is a template // &lt;2&gt;</span></span>
<span id="cb25-367"><a href="#cb25-367"></a>    MapperInputKeyType<span class="op">,</span> <span class="co">// Input key type (must be consistent with the InputFormat class specified in the Driver) // &lt;3&gt;</span></span>
<span id="cb25-368"><a href="#cb25-368"></a>    MapperInputValueType<span class="op">,</span> <span class="co">// Input value type (must be consistent with the InputFormat class specified in the Driver) // &lt;4&gt;</span></span>
<span id="cb25-369"><a href="#cb25-369"></a>    MapperOutputKeyType<span class="op">,</span> <span class="co">// Output key type // &lt;5&gt;</span></span>
<span id="cb25-370"><a href="#cb25-370"></a>    MapperOutputValueType <span class="co">// Output value type // &lt;6&gt;</span></span>
<span id="cb25-371"><a href="#cb25-371"></a><span class="op">&gt;{</span></span>
<span id="cb25-372"><a href="#cb25-372"></a><span class="co">/* Implementation of the map method */</span></span>
<span id="cb25-373"><a href="#cb25-373"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">map</span><span class="op">(</span></span>
<span id="cb25-374"><a href="#cb25-374"></a>        MapperInputKeyType key<span class="op">,</span> <span class="co">// Input key // &lt;7&gt;</span></span>
<span id="cb25-375"><a href="#cb25-375"></a>        MapperInputValueType value<span class="op">,</span> <span class="co">// Input value // &lt;8&gt;</span></span>
<span id="cb25-376"><a href="#cb25-376"></a>        <span class="bu">Context</span> context <span class="co">// This is an object containing the write method, that has to be invoked to return the (key, value) pairs</span></span>
<span id="cb25-377"><a href="#cb25-377"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span> <span class="op">{</span></span>
<span id="cb25-378"><a href="#cb25-378"></a></span>
<span id="cb25-379"><a href="#cb25-379"></a>        <span class="co">/* </span></span>
<span id="cb25-380"><a href="#cb25-380"></a><span class="co">        Process the input (key, value) pair and emit a set of (key,value) pairs. </span></span>
<span id="cb25-381"><a href="#cb25-381"></a><span class="co">        context.write(...) is used to emit (key, value) pairs context.write(new outputkey, new outputvalue); </span></span>
<span id="cb25-382"><a href="#cb25-382"></a><span class="co">        */</span> </span>
<span id="cb25-383"><a href="#cb25-383"></a></span>
<span id="cb25-384"><a href="#cb25-384"></a>        context<span class="op">.</span><span class="fu">write</span><span class="op">(</span><span class="kw">new</span> outputkey<span class="op">,</span> <span class="kw">new</span> outputvalue<span class="op">);</span> <span class="co">// &lt;9&gt;</span></span>
<span id="cb25-385"><a href="#cb25-385"></a>        <span class="co">// Notice context.write(...) has to be invoked a number of times equal to the number of (key, value) pairs have to be returned. Even 0 times is accepted</span></span>
<span id="cb25-386"><a href="#cb25-386"></a></span>
<span id="cb25-387"><a href="#cb25-387"></a>        <span class="co">// In the mapper instance also setup and cleanup methods can be implemented, but are not mandatory. Instead, the map method is mandatory</span></span>
<span id="cb25-388"><a href="#cb25-388"></a></span>
<span id="cb25-389"><a href="#cb25-389"></a>    <span class="op">}</span> <span class="co">// End of the map method</span></span>
<span id="cb25-390"><a href="#cb25-390"></a><span class="op">}</span> <span class="co">// End of class myMapperClass</span></span>
<span id="cb25-391"><a href="#cb25-391"></a>```</span>
<span id="cb25-392"><a href="#cb25-392"></a><span class="fl">1.</span> `mypackage`</span>
<span id="cb25-393"><a href="#cb25-393"></a><span class="fl">2.</span> `myMapperClass`</span>
<span id="cb25-394"><a href="#cb25-394"></a><span class="fl">3.</span> `MapperInputKeyType`</span>
<span id="cb25-395"><a href="#cb25-395"></a><span class="fl">4.</span> `MapperInputValueType`</span>
<span id="cb25-396"><a href="#cb25-396"></a><span class="fl">5.</span> `MapperOutputKeyType`</span>
<span id="cb25-397"><a href="#cb25-397"></a><span class="fl">6.</span> `MapperOutputValueType`</span>
<span id="cb25-398"><a href="#cb25-398"></a><span class="fl">7.</span> `MapperInputKeyType`</span>
<span id="cb25-399"><a href="#cb25-399"></a><span class="fl">8.</span> `MapperInputValueType`</span>
<span id="cb25-400"><a href="#cb25-400"></a><span class="fl">9.</span> `outputkey` and `outputvalue`</span>
<span id="cb25-401"><a href="#cb25-401"></a></span>
<span id="cb25-402"><a href="#cb25-402"></a>### Reducer</span>
<span id="cb25-403"><a href="#cb25-403"></a></span>
<span id="cb25-404"><a href="#cb25-404"></a>```java</span>
<span id="cb25-405"><a href="#cb25-405"></a><span class="co">/* Set package */</span></span>
<span id="cb25-406"><a href="#cb25-406"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mypackage</span><span class="op">;</span> <span class="co">// &lt;1&gt;</span></span>
<span id="cb25-407"><a href="#cb25-407"></a></span>
<span id="cb25-408"><a href="#cb25-408"></a><span class="co">/* Import libraries */</span></span>
<span id="cb25-409"><a href="#cb25-409"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb25-410"><a href="#cb25-410"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Reducer</span><span class="op">;</span></span>
<span id="cb25-411"><a href="#cb25-411"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.*;</span></span>
<span id="cb25-412"><a href="#cb25-412"></a></span>
<span id="cb25-413"><a href="#cb25-413"></a><span class="co">/* Reducer Class */</span></span>
<span id="cb25-414"><a href="#cb25-414"></a><span class="kw">class</span> myReducerClass <span class="kw">extends</span> Reducer<span class="op">&lt;</span> <span class="co">// Reducer is a template // &lt;2&gt;</span></span>
<span id="cb25-415"><a href="#cb25-415"></a>    ReducerInputKeyType<span class="op">,</span> <span class="co">// Input key type (must be consistent with the OutputKeyType of the Mapper) // &lt;3&gt;</span></span>
<span id="cb25-416"><a href="#cb25-416"></a>    ReducerInputValueType<span class="op">,</span> <span class="co">// Input value type (must be consistent with the OutputValueType of the Mapper) // &lt;4&gt;</span></span>
<span id="cb25-417"><a href="#cb25-417"></a>    ReducerOutputKeyType<span class="op">,</span> <span class="co">// Output key type (must be consistent with the OutputFormat class specified in the Driver) // &lt;5&gt;</span></span>
<span id="cb25-418"><a href="#cb25-418"></a>    ReducerOutputValueType <span class="co">// Output value type (must be consistent with the OutputFormat class specified in the Driver) // &lt;6&gt;</span></span>
<span id="cb25-419"><a href="#cb25-419"></a><span class="op">&gt;{</span></span>
<span id="cb25-420"><a href="#cb25-420"></a>    <span class="co">/* Implementation of the reduce method */</span></span>
<span id="cb25-421"><a href="#cb25-421"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">reduce</span><span class="op">(</span></span>
<span id="cb25-422"><a href="#cb25-422"></a>        ReducerInputKeyType key<span class="op">,</span> <span class="co">// Input key // &lt;7&gt;</span></span>
<span id="cb25-423"><a href="#cb25-423"></a>        <span class="bu">Iterable</span><span class="op">&lt;</span>ReducerInputValueType<span class="op">&gt;</span> values<span class="op">,</span> <span class="co">// Input values (list of values). Notice that since this is an Iterable it is not possible to iterate over it more than once (it works like a Python generator). This is done because the iterable can read directly the list from the file system without moving and storing the data on the local server // &lt;8&gt;</span></span>
<span id="cb25-424"><a href="#cb25-424"></a>        <span class="bu">Context</span> context</span>
<span id="cb25-425"><a href="#cb25-425"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span> <span class="op">{</span></span>
<span id="cb25-426"><a href="#cb25-426"></a></span>
<span id="cb25-427"><a href="#cb25-427"></a>        <span class="co">/* </span></span>
<span id="cb25-428"><a href="#cb25-428"></a><span class="co">        Process the input (key, [list of values]) pair and emit a set of (key,value) pairs. </span></span>
<span id="cb25-429"><a href="#cb25-429"></a><span class="co">        context.write(...) is used to emit (key, value) pairs context.write(new outputkey, new outputvalue); </span></span>
<span id="cb25-430"><a href="#cb25-430"></a><span class="co">        */</span></span>
<span id="cb25-431"><a href="#cb25-431"></a></span>
<span id="cb25-432"><a href="#cb25-432"></a>        context<span class="op">.</span><span class="fu">write</span><span class="op">(</span><span class="kw">new</span> outputkey<span class="op">,</span> <span class="kw">new</span> outputvalue<span class="op">);</span> <span class="co">// &lt;9&gt;</span></span>
<span id="cb25-433"><a href="#cb25-433"></a>        <span class="co">// Notice context.write(...) has to be invoked a number of times equal to the number of (key, value) pairs have to be returned. Even 0 times is accepted</span></span>
<span id="cb25-434"><a href="#cb25-434"></a>        <span class="co">// "new" has to be always specified</span></span>
<span id="cb25-435"><a href="#cb25-435"></a></span>
<span id="cb25-436"><a href="#cb25-436"></a>    <span class="op">}</span> <span class="co">// End of the reduce method</span></span>
<span id="cb25-437"><a href="#cb25-437"></a><span class="op">}</span> <span class="co">// End of class myReducerClass</span></span>
<span id="cb25-438"><a href="#cb25-438"></a>```</span>
<span id="cb25-439"><a href="#cb25-439"></a><span class="fl">1.</span> `mypackage`</span>
<span id="cb25-440"><a href="#cb25-440"></a><span class="fl">2.</span> `myReducerClass`</span>
<span id="cb25-441"><a href="#cb25-441"></a><span class="fl">3.</span> `ReducerInputKeyType`</span>
<span id="cb25-442"><a href="#cb25-442"></a><span class="fl">4.</span> `ReducerInputValueType`</span>
<span id="cb25-443"><a href="#cb25-443"></a><span class="fl">5.</span> `ReducerOutputKeyType`</span>
<span id="cb25-444"><a href="#cb25-444"></a><span class="fl">6.</span> `ReducerOutputValueType`</span>
<span id="cb25-445"><a href="#cb25-445"></a><span class="fl">7.</span> `ReducerInputKeyType`</span>
<span id="cb25-446"><a href="#cb25-446"></a><span class="fl">8.</span> `ReducerInputValueType`</span>
<span id="cb25-447"><a href="#cb25-447"></a><span class="fl">9.</span> `outputkey` and `outputvalue`</span>
<span id="cb25-448"><a href="#cb25-448"></a></span>
<span id="cb25-449"><a href="#cb25-449"></a>### Example of a MapReduce program in Hadoop<span class="op">:</span> Word Count <span class="op">{</span>#sec<span class="op">-</span>wordcountexample<span class="op">}</span></span>
<span id="cb25-450"><a href="#cb25-450"></a>The Word count problem consists of</span>
<span id="cb25-451"><a href="#cb25-451"></a></span>
<span id="cb25-452"><a href="#cb25-452"></a><span class="op">-</span> Input<span class="op">:</span> <span class="op">(</span>unstructured<span class="op">)</span> textual file<span class="op">,</span> where each line of the input file can contains a set of words</span>
<span id="cb25-453"><a href="#cb25-453"></a><span class="op">-</span> Output<span class="op">:</span> number of occurrences of each word appearing in the input file </span>
<span id="cb25-454"><a href="#cb25-454"></a><span class="op">-</span> Parameters<span class="op">/</span>arguments of the application<span class="op">:</span></span>
<span id="cb25-455"><a href="#cb25-455"></a>    <span class="op">-</span> `args<span class="op">[</span><span class="dv">0</span><span class="op">]</span>`<span class="op">:</span> number of instances of the reducer</span>
<span id="cb25-456"><a href="#cb25-456"></a>    <span class="op">-</span> `args<span class="op">[</span><span class="dv">1</span><span class="op">]</span>`<span class="op">:</span> path of the input file</span>
<span id="cb25-457"><a href="#cb25-457"></a>    <span class="op">-</span> `args<span class="op">[</span><span class="dv">2</span><span class="op">]</span>`<span class="op">:</span> path of the output folder</span>
<span id="cb25-458"><a href="#cb25-458"></a></span>
<span id="cb25-459"><a href="#cb25-459"></a><span class="op">:::{.</span><span class="fu">callout</span><span class="op">-</span>note collapse<span class="op">=</span><span class="st">"true"</span><span class="op">}</span></span>
<span id="cb25-460"><a href="#cb25-460"></a>### Word Count input and output examples</span>
<span id="cb25-461"><a href="#cb25-461"></a><span class="op">**</span>Input file<span class="op">**</span></span>
<span id="cb25-462"><a href="#cb25-462"></a></span>
<span id="cb25-463"><a href="#cb25-463"></a>```</span>
<span id="cb25-464"><a href="#cb25-464"></a>Toy example file <span class="cf">for</span> Hadoop<span class="op">.</span> <span class="fu">Hadoop</span> running example<span class="op">.</span></span>
<span id="cb25-465"><a href="#cb25-465"></a>```</span>
<span id="cb25-466"><a href="#cb25-466"></a></span>
<span id="cb25-467"><a href="#cb25-467"></a><span class="op">**</span>Output file<span class="op">**</span></span>
<span id="cb25-468"><a href="#cb25-468"></a></span>
<span id="cb25-469"><a href="#cb25-469"></a>```</span>
<span id="cb25-470"><a href="#cb25-470"></a><span class="op">(</span>toy<span class="op">,</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb25-471"><a href="#cb25-471"></a><span class="op">(</span>example<span class="op">,</span><span class="dv">2</span><span class="op">)</span></span>
<span id="cb25-472"><a href="#cb25-472"></a><span class="op">(</span>file<span class="op">,</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb25-473"><a href="#cb25-473"></a><span class="op">(</span><span class="cf">for</span><span class="op">,</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb25-474"><a href="#cb25-474"></a><span class="op">(</span>hadoop<span class="op">,</span><span class="dv">2</span><span class="op">)</span></span>
<span id="cb25-475"><a href="#cb25-475"></a><span class="op">(</span>running<span class="op">,</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb25-476"><a href="#cb25-476"></a>```</span>
<span id="cb25-477"><a href="#cb25-477"></a></span>
<span id="cb25-478"><a href="#cb25-478"></a><span class="op">:::</span></span>
<span id="cb25-479"><a href="#cb25-479"></a></span>
<span id="cb25-480"><a href="#cb25-480"></a>#### <span class="bu">Driver</span></span>
<span id="cb25-481"><a href="#cb25-481"></a></span>
<span id="cb25-482"><a href="#cb25-482"></a>```java</span>
<span id="cb25-483"><a href="#cb25-483"></a><span class="co">/* Set package */</span></span>
<span id="cb25-484"><a href="#cb25-484"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">wordcount</span><span class="op">;</span></span>
<span id="cb25-485"><a href="#cb25-485"></a></span>
<span id="cb25-486"><a href="#cb25-486"></a><span class="co">/* Import libraries */</span></span>
<span id="cb25-487"><a href="#cb25-487"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">conf</span><span class="op">.</span><span class="im">Configuration</span><span class="op">;</span></span>
<span id="cb25-488"><a href="#cb25-488"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">conf</span><span class="op">.</span><span class="im">Configured</span><span class="op">;</span></span>
<span id="cb25-489"><a href="#cb25-489"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">fs</span><span class="op">.</span><span class="im">Path</span><span class="op">;</span></span>
<span id="cb25-490"><a href="#cb25-490"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IntWritable</span><span class="op">;</span></span>
<span id="cb25-491"><a href="#cb25-491"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">Text</span><span class="op">;</span></span>
<span id="cb25-492"><a href="#cb25-492"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Job</span><span class="op">;</span></span>
<span id="cb25-493"><a href="#cb25-493"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">input</span><span class="op">.</span><span class="im">FileInputFormat</span><span class="op">;</span></span>
<span id="cb25-494"><a href="#cb25-494"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">input</span><span class="op">.</span><span class="im">TextInputFormat</span><span class="op">;</span></span>
<span id="cb25-495"><a href="#cb25-495"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">output</span><span class="op">.</span><span class="im">FileOutputFormat</span><span class="op">;</span></span>
<span id="cb25-496"><a href="#cb25-496"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">lib</span><span class="op">.</span><span class="im">output</span><span class="op">.</span><span class="im">TextOutputFormat</span><span class="op">;</span></span>
<span id="cb25-497"><a href="#cb25-497"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Tool</span><span class="op">;</span></span>
<span id="cb25-498"><a href="#cb25-498"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">ToolRunner</span><span class="op">;</span></span>
<span id="cb25-499"><a href="#cb25-499"></a></span>
<span id="cb25-500"><a href="#cb25-500"></a><span class="co">/* Driver class */</span></span>
<span id="cb25-501"><a href="#cb25-501"></a><span class="kw">public</span> <span class="kw">class</span> WordCount <span class="kw">extends</span> Configured <span class="kw">implements</span> <span class="bu">Tool</span> <span class="op">{</span></span>
<span id="cb25-502"><a href="#cb25-502"></a>    <span class="at">@Override</span></span>
<span id="cb25-503"><a href="#cb25-503"></a>    <span class="kw">public</span> <span class="fu">intrun</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb25-504"><a href="#cb25-504"></a>        Path inputPath<span class="op">;</span></span>
<span id="cb25-505"><a href="#cb25-505"></a>        Path outputDir<span class="op">;</span></span>
<span id="cb25-506"><a href="#cb25-506"></a>        <span class="dt">int</span> numberOfReducers<span class="op">;</span></span>
<span id="cb25-507"><a href="#cb25-507"></a>        <span class="dt">int</span> exitCode<span class="op">;</span> </span>
<span id="cb25-508"><a href="#cb25-508"></a>        </span>
<span id="cb25-509"><a href="#cb25-509"></a>        <span class="co">// Parse input parameters</span></span>
<span id="cb25-510"><a href="#cb25-510"></a>        numberOfReducers <span class="op">=</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">parseInt</span><span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb25-511"><a href="#cb25-511"></a>        inputPath <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">(</span>args<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb25-512"><a href="#cb25-512"></a>        outputDir <span class="op">=</span> <span class="kw">new</span> <span class="fu">Path</span><span class="op">(</span>args<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb25-513"><a href="#cb25-513"></a></span>
<span id="cb25-514"><a href="#cb25-514"></a>        <span class="co">// Define and configure a new job</span></span>
<span id="cb25-515"><a href="#cb25-515"></a>        <span class="bu">Configuration</span> conf <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getConf</span><span class="op">();</span></span>
<span id="cb25-516"><a href="#cb25-516"></a>        Job job <span class="op">=</span> Job<span class="op">.</span><span class="fu">getInstance</span><span class="op">(</span>conf<span class="op">);</span> </span>
<span id="cb25-517"><a href="#cb25-517"></a>        </span>
<span id="cb25-518"><a href="#cb25-518"></a>        <span class="co">// Assign a name to the job</span></span>
<span id="cb25-519"><a href="#cb25-519"></a>        job<span class="op">.</span><span class="fu">setJobName</span><span class="op">(</span><span class="st">"WordCounter"</span><span class="op">);</span></span>
<span id="cb25-520"><a href="#cb25-520"></a></span>
<span id="cb25-521"><a href="#cb25-521"></a>        <span class="co">// Set path of the input file/folder (if it is a folder, the job reads all the files in the specified folder) for this job</span></span>
<span id="cb25-522"><a href="#cb25-522"></a>        FileInputFormat<span class="op">.</span><span class="fu">addInputPath</span><span class="op">(</span>job<span class="op">,</span> inputPath<span class="op">);</span></span>
<span id="cb25-523"><a href="#cb25-523"></a></span>
<span id="cb25-524"><a href="#cb25-524"></a>        <span class="co">// Set path of the output folder for this job</span></span>
<span id="cb25-525"><a href="#cb25-525"></a>        FileOutputFormat<span class="op">.</span><span class="fu">setOutputPath</span><span class="op">(</span>job<span class="op">,</span> outputDir<span class="op">);</span></span>
<span id="cb25-526"><a href="#cb25-526"></a></span>
<span id="cb25-527"><a href="#cb25-527"></a>        <span class="co">// Set input format</span></span>
<span id="cb25-528"><a href="#cb25-528"></a>        <span class="co">// TextInputFormat = textual files </span></span>
<span id="cb25-529"><a href="#cb25-529"></a>        job<span class="op">.</span><span class="fu">setInputFormatClass</span><span class="op">(</span>TextInputFormat<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-530"><a href="#cb25-530"></a></span>
<span id="cb25-531"><a href="#cb25-531"></a>        <span class="co">// Set job output format</span></span>
<span id="cb25-532"><a href="#cb25-532"></a>        job<span class="op">.</span><span class="fu">setOutputFormatClass</span><span class="op">(</span>TextOutputFormat<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-533"><a href="#cb25-533"></a></span>
<span id="cb25-534"><a href="#cb25-534"></a>        <span class="co">// Specify the class of the Driver for this job</span></span>
<span id="cb25-535"><a href="#cb25-535"></a>        job<span class="op">.</span><span class="fu">setJarByClass</span><span class="op">(</span>WordCount<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-536"><a href="#cb25-536"></a></span>
<span id="cb25-537"><a href="#cb25-537"></a>        <span class="co">// Set mapper class</span></span>
<span id="cb25-538"><a href="#cb25-538"></a>        job<span class="op">.</span><span class="fu">setMapperClass</span><span class="op">(</span>WordCountMapper<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-539"><a href="#cb25-539"></a>        </span>
<span id="cb25-540"><a href="#cb25-540"></a>        <span class="co">// Set map output key and value classes</span></span>
<span id="cb25-541"><a href="#cb25-541"></a>        job<span class="op">.</span><span class="fu">setMapOutputKeyClass</span><span class="op">(</span><span class="bu">Text</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-542"><a href="#cb25-542"></a>        job<span class="op">.</span><span class="fu">setMapOutputValueClass</span><span class="op">(</span>IntWritable<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-543"><a href="#cb25-543"></a></span>
<span id="cb25-544"><a href="#cb25-544"></a>        <span class="co">// Set reduce class</span></span>
<span id="cb25-545"><a href="#cb25-545"></a>        job<span class="op">.</span><span class="fu">setReducerClass</span><span class="op">(</span>WordCountReducer<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-546"><a href="#cb25-546"></a>        </span>
<span id="cb25-547"><a href="#cb25-547"></a>        <span class="co">// Set reduce output key and value classes</span></span>
<span id="cb25-548"><a href="#cb25-548"></a>        job<span class="op">.</span><span class="fu">setOutputKeyClass</span><span class="op">(</span><span class="bu">Text</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-549"><a href="#cb25-549"></a>        job<span class="op">.</span><span class="fu">setOutputValueClass</span><span class="op">(</span>IntWritable<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-550"><a href="#cb25-550"></a></span>
<span id="cb25-551"><a href="#cb25-551"></a>        <span class="co">// Set number of reducers</span></span>
<span id="cb25-552"><a href="#cb25-552"></a>        job<span class="op">.</span><span class="fu">setNumReduceTasks</span><span class="op">(</span>numberOfReducers<span class="op">);</span></span>
<span id="cb25-553"><a href="#cb25-553"></a></span>
<span id="cb25-554"><a href="#cb25-554"></a>        <span class="co">// Execute the job and wait for completion</span></span>
<span id="cb25-555"><a href="#cb25-555"></a>        <span class="cf">if</span> <span class="op">(</span>job<span class="op">.</span><span class="fu">waitForCompletion</span><span class="op">(</span><span class="kw">true</span><span class="op">)==</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb25-556"><a href="#cb25-556"></a>            exitCode<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-557"><a href="#cb25-557"></a>        <span class="cf">else</span></span>
<span id="cb25-558"><a href="#cb25-558"></a>            exitCode<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb25-559"><a href="#cb25-559"></a>        <span class="cf">return</span> exitCode<span class="op">;</span></span>
<span id="cb25-560"><a href="#cb25-560"></a>    <span class="op">}</span> <span class="co">// End of the run method</span></span>
<span id="cb25-561"><a href="#cb25-561"></a></span>
<span id="cb25-562"><a href="#cb25-562"></a>    <span class="co">/* main method of the driver class */</span></span>
<span id="cb25-563"><a href="#cb25-563"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span> args<span class="op">[])</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb25-564"><a href="#cb25-564"></a></span>
<span id="cb25-565"><a href="#cb25-565"></a>        <span class="co">/* Exploit the ToolRunner class to "configure" and run the </span></span>
<span id="cb25-566"><a href="#cb25-566"></a><span class="co">        Hadoop application */</span></span>
<span id="cb25-567"><a href="#cb25-567"></a>    </span>
<span id="cb25-568"><a href="#cb25-568"></a>        intres <span class="op">=</span> ToolRunner<span class="op">.</span><span class="fu">run</span><span class="op">(</span></span>
<span id="cb25-569"><a href="#cb25-569"></a>            <span class="kw">new</span> <span class="bu">Configuration</span><span class="op">(),</span> </span>
<span id="cb25-570"><a href="#cb25-570"></a>            <span class="kw">new</span> <span class="fu">WordCount</span><span class="op">(),</span> </span>
<span id="cb25-571"><a href="#cb25-571"></a>            args</span>
<span id="cb25-572"><a href="#cb25-572"></a>        <span class="op">);</span></span>
<span id="cb25-573"><a href="#cb25-573"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">exit</span><span class="op">(</span>res<span class="op">);</span></span>
<span id="cb25-574"><a href="#cb25-574"></a>    <span class="op">}</span> <span class="co">// End of the main method</span></span>
<span id="cb25-575"><a href="#cb25-575"></a><span class="op">}</span> <span class="co">// End of public class WordCount</span></span>
<span id="cb25-576"><a href="#cb25-576"></a>```</span>
<span id="cb25-577"><a href="#cb25-577"></a></span>
<span id="cb25-578"><a href="#cb25-578"></a>#### Mapper</span>
<span id="cb25-579"><a href="#cb25-579"></a></span>
<span id="cb25-580"><a href="#cb25-580"></a>```java</span>
<span id="cb25-581"><a href="#cb25-581"></a><span class="co">/* Set package */</span></span>
<span id="cb25-582"><a href="#cb25-582"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">wordcount</span><span class="op">;</span></span>
<span id="cb25-583"><a href="#cb25-583"></a></span>
<span id="cb25-584"><a href="#cb25-584"></a><span class="co">/* Import libraries */</span></span>
<span id="cb25-585"><a href="#cb25-585"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb25-586"><a href="#cb25-586"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IntWritable</span><span class="op">;</span></span>
<span id="cb25-587"><a href="#cb25-587"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">LongWritable</span><span class="op">;</span></span>
<span id="cb25-588"><a href="#cb25-588"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">Text</span><span class="op">;</span></span>
<span id="cb25-589"><a href="#cb25-589"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Mapper</span><span class="op">;</span></span>
<span id="cb25-590"><a href="#cb25-590"></a></span>
<span id="cb25-591"><a href="#cb25-591"></a><span class="co">/* MapperClass */</span></span>
<span id="cb25-592"><a href="#cb25-592"></a><span class="kw">class</span> WordCountMapper <span class="kw">extends</span> Mapper<span class="op">&lt;</span></span>
<span id="cb25-593"><a href="#cb25-593"></a>    LongWritable<span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb25-594"><a href="#cb25-594"></a>    <span class="bu">Text</span><span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb25-595"><a href="#cb25-595"></a>    <span class="bu">Text</span><span class="op">,</span> <span class="co">// Output key type</span></span>
<span id="cb25-596"><a href="#cb25-596"></a>    IntWritable <span class="co">// Output value type</span></span>
<span id="cb25-597"><a href="#cb25-597"></a><span class="op">&gt;{</span></span>
<span id="cb25-598"><a href="#cb25-598"></a>    <span class="co">/* Implementation of the map method */</span></span>
<span id="cb25-599"><a href="#cb25-599"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">map</span><span class="op">(</span></span>
<span id="cb25-600"><a href="#cb25-600"></a>        LongWritable key<span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb25-601"><a href="#cb25-601"></a>        <span class="bu">Text</span> value<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb25-602"><a href="#cb25-602"></a>        <span class="bu">Context</span> context</span>
<span id="cb25-603"><a href="#cb25-603"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span> <span class="op">{</span></span>
<span id="cb25-604"><a href="#cb25-604"></a>        <span class="co">// Split each sentence in words. Use whitespace(s) as delimiter</span></span>
<span id="cb25-605"><a href="#cb25-605"></a>        <span class="co">// The split method returns an array of strings</span></span>
<span id="cb25-606"><a href="#cb25-606"></a>        <span class="bu">String</span><span class="op">[]</span> words <span class="op">=</span> value<span class="op">.</span><span class="fu">toString</span><span class="op">().</span><span class="fu">split</span><span class="op">(</span><span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span><span class="op">);</span></span>
<span id="cb25-607"><a href="#cb25-607"></a></span>
<span id="cb25-608"><a href="#cb25-608"></a>        <span class="co">// Iterate over the set of words</span></span>
<span id="cb25-609"><a href="#cb25-609"></a>        <span class="cf">for</span><span class="op">(</span><span class="bu">String</span> word <span class="op">:</span> words<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-610"><a href="#cb25-610"></a>            <span class="co">// Transform word case</span></span>
<span id="cb25-611"><a href="#cb25-611"></a>            <span class="bu">String</span> cleanedWord <span class="op">=</span> word<span class="op">.</span><span class="fu">toLowerCase</span><span class="op">();</span></span>
<span id="cb25-612"><a href="#cb25-612"></a></span>
<span id="cb25-613"><a href="#cb25-613"></a>            <span class="co">// emit one pair (word, 1) for each input word</span></span>
<span id="cb25-614"><a href="#cb25-614"></a>            context<span class="op">.</span><span class="fu">write</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Text</span><span class="op">(</span>cleanedWord<span class="op">),</span> <span class="kw">new</span> <span class="fu">IntWritable</span><span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb25-615"><a href="#cb25-615"></a>        <span class="op">}</span></span>
<span id="cb25-616"><a href="#cb25-616"></a>    <span class="op">}</span> <span class="co">// End map method</span></span>
<span id="cb25-617"><a href="#cb25-617"></a><span class="op">}</span> <span class="co">// End of class WordCountMapper</span></span>
<span id="cb25-618"><a href="#cb25-618"></a>```</span>
<span id="cb25-619"><a href="#cb25-619"></a></span>
<span id="cb25-620"><a href="#cb25-620"></a>#### Reducer</span>
<span id="cb25-621"><a href="#cb25-621"></a></span>
<span id="cb25-622"><a href="#cb25-622"></a>```java</span>
<span id="cb25-623"><a href="#cb25-623"></a><span class="co">/* Set package */</span></span>
<span id="cb25-624"><a href="#cb25-624"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">wordcount</span><span class="op">;</span></span>
<span id="cb25-625"><a href="#cb25-625"></a></span>
<span id="cb25-626"><a href="#cb25-626"></a><span class="co">/* Import libraries */</span></span>
<span id="cb25-627"><a href="#cb25-627"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb25-628"><a href="#cb25-628"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IntWritable</span><span class="op">;</span></span>
<span id="cb25-629"><a href="#cb25-629"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">Text</span><span class="op">;</span></span>
<span id="cb25-630"><a href="#cb25-630"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Reducer</span><span class="op">;</span></span>
<span id="cb25-631"><a href="#cb25-631"></a></span>
<span id="cb25-632"><a href="#cb25-632"></a><span class="co">/* Reducer Class */</span></span>
<span id="cb25-633"><a href="#cb25-633"></a><span class="kw">class</span> WordCountReducer <span class="kw">extends</span> Reducer<span class="op">&lt;</span></span>
<span id="cb25-634"><a href="#cb25-634"></a><span class="bu">Text</span><span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb25-635"><a href="#cb25-635"></a>IntWritable<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb25-636"><a href="#cb25-636"></a><span class="bu">Text</span><span class="op">,</span> <span class="co">// Output key type</span></span>
<span id="cb25-637"><a href="#cb25-637"></a>IntWritable <span class="co">// Output value type</span></span>
<span id="cb25-638"><a href="#cb25-638"></a><span class="op">&gt;{</span></span>
<span id="cb25-639"><a href="#cb25-639"></a>    <span class="co">/* Implementation of the reduce method */</span></span>
<span id="cb25-640"><a href="#cb25-640"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">reduce</span><span class="op">(</span></span>
<span id="cb25-641"><a href="#cb25-641"></a>        <span class="bu">Text</span> key<span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb25-642"><a href="#cb25-642"></a>        <span class="bu">Iterable</span><span class="op">&lt;</span>IntWritable<span class="op">&gt;</span> values<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb25-643"><a href="#cb25-643"></a>        <span class="bu">Context</span> context</span>
<span id="cb25-644"><a href="#cb25-644"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span><span class="op">{</span></span>
<span id="cb25-645"><a href="#cb25-645"></a>        <span class="dt">int</span> occurrances<span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-646"><a href="#cb25-646"></a>        </span>
<span id="cb25-647"><a href="#cb25-647"></a>        <span class="co">// Iterate over the set of values and sum them </span></span>
<span id="cb25-648"><a href="#cb25-648"></a>        <span class="cf">for</span> <span class="op">(</span>IntWritable value <span class="op">:</span> values<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-649"><a href="#cb25-649"></a>            occurrances <span class="op">=</span> occurrances<span class="op">+</span> value<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb25-650"><a href="#cb25-650"></a>        <span class="op">}</span></span>
<span id="cb25-651"><a href="#cb25-651"></a></span>
<span id="cb25-652"><a href="#cb25-652"></a>        <span class="co">// Emit the total number of occurrences of the current word</span></span>
<span id="cb25-653"><a href="#cb25-653"></a>        context<span class="op">.</span><span class="fu">write</span><span class="op">(</span>key<span class="op">,</span> <span class="kw">new</span> <span class="fu">IntWritable</span><span class="op">(</span>occurrances<span class="op">));</span></span>
<span id="cb25-654"><a href="#cb25-654"></a>    <span class="op">}</span> <span class="co">// End reduce method</span></span>
<span id="cb25-655"><a href="#cb25-655"></a><span class="op">}</span> <span class="co">// End of class WordCountReducer</span></span>
<span id="cb25-656"><a href="#cb25-656"></a>```</span>
<span id="cb25-657"><a href="#cb25-657"></a></span>
<span id="cb25-658"><a href="#cb25-658"></a>## Combiner</span>
<span id="cb25-659"><a href="#cb25-659"></a>In standard MapReduce applications<span class="op">,</span> the `<span class="op">(</span>key<span class="op">,</span>value<span class="op">)</span>` pairs emitted by the Mappers are sent to the Reducers through the network<span class="op">.</span> <span class="fu">However</span><span class="op">,</span> some pre<span class="op">-</span>aggregations could be performed to limit the amount of network data by using <span class="fu">Combiners</span> <span class="op">(</span>also called <span class="st">"minireducers"</span><span class="op">).</span></span>
<span id="cb25-660"><a href="#cb25-660"></a></span>
<span id="cb25-661"><a href="#cb25-661"></a><span class="fu">Consider</span> the standard word count problem<span class="op">,</span> and suppose that the input file is split in two input splits<span class="op">,</span> hence<span class="op">,</span> two Mappers are <span class="fu">instantiated</span> <span class="op">(</span>one <span class="cf">for</span> each split<span class="op">).</span></span>
<span id="cb25-662"><a href="#cb25-662"></a></span>
<span id="cb25-663"><a href="#cb25-663"></a><span class="op">![</span>Word count without Combiner<span class="op">](</span>images<span class="op">/</span><span class="dv">0</span><span class="er">4</span>_hadoop_implementation<span class="op">/</span>word_count_no_combiner_example<span class="op">.</span><span class="fu">png</span><span class="op">){</span>width<span class="op">=</span><span class="dv">80</span><span class="op">%}</span></span>
<span id="cb25-664"><a href="#cb25-664"></a></span>
<span id="cb25-665"><a href="#cb25-665"></a>A combiner can be locally called on the output `<span class="op">(</span>key<span class="op">,</span> value<span class="op">)</span>` pairs of each <span class="fu">mapper</span> <span class="op">(</span>it works on data stored in the main<span class="op">-</span>memory or on the local hard disks<span class="op">)</span> to pre<span class="op">-</span>aggregate data<span class="op">,</span> reducing the data moving through the network<span class="op">.</span></span>
<span id="cb25-666"><a href="#cb25-666"></a></span>
<span id="cb25-667"><a href="#cb25-667"></a><span class="op">![</span>Word count with Combiner<span class="op">](</span>images<span class="op">/</span><span class="dv">0</span><span class="er">4</span>_hadoop_implementation<span class="op">/</span>word_count_combiner_example<span class="op">.</span><span class="fu">png</span><span class="op">){</span>width<span class="op">=</span><span class="dv">80</span><span class="op">%}</span></span>
<span id="cb25-668"><a href="#cb25-668"></a></span>
<span id="cb25-669"><a href="#cb25-669"></a>So<span class="op">,</span> in MapReduce applications that include Combiners after the Mappers<span class="op">,</span> the `<span class="op">(</span>key<span class="op">,</span>value<span class="op">)</span>` pairs emitted by the Mappers are analyzed in main<span class="op">-</span><span class="fu">memory</span> <span class="op">(</span>or on the local disk<span class="op">)</span> and aggregated by the Combiners<span class="op">.</span> <span class="fu">Each</span> Combiner pre<span class="op">-</span>aggregates the values associated with the pairs emitted by the Mappers of a cluster node<span class="op">,</span> limiting the amount of network data generated by each cluster node<span class="op">.</span></span>
<span id="cb25-670"><a href="#cb25-670"></a></span>
<span id="cb25-671"><a href="#cb25-671"></a><span class="op">:::{.</span><span class="fu">callout</span><span class="op">-</span>important<span class="op">}</span></span>
<span id="cb25-672"><a href="#cb25-672"></a>### Combiner scope of application</span>
<span id="cb25-673"><a href="#cb25-673"></a><span class="op">-</span> Combiners work only <span class="cf">if</span> the reduce function is <span class="op">**</span>commutative<span class="op">**</span> and <span class="op">**</span>associative<span class="op">**.</span> </span>
<span id="cb25-674"><a href="#cb25-674"></a><span class="op">-</span> The execution of combiners is not guaranteed<span class="op">:</span> Hadoop decides at runtime <span class="cf">if</span> executing a combiner<span class="op">,</span> and so the user cannot be sure of the combiner execution just by checking the code<span class="op">.</span> <span class="fu">Because</span> of <span class="kw">this</span><span class="op">,</span> the developer<span class="op">/</span>designer should write MapReduce jobs whose successful executions <span class="op">**</span><span class="cf">do</span> not depend<span class="op">**</span> on whether the Combiner is executed<span class="op">.</span></span>
<span id="cb25-675"><a href="#cb25-675"></a><span class="op">:::</span></span>
<span id="cb25-676"><a href="#cb25-676"></a></span>
<span id="cb25-677"><a href="#cb25-677"></a>### <span class="fu">Combiner</span> <span class="op">(</span>instance<span class="op">)</span></span>
<span id="cb25-678"><a href="#cb25-678"></a>The Combiner is an instance of the `org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">mapreduce</span><span class="op">.</span><span class="fu">Reducer</span>` <span class="kw">class</span><span class="op">.</span> <span class="fu">Notice</span> that there is not a specific combiner<span class="op">-</span>template <span class="kw">class</span><span class="op">.</span></span>
<span id="cb25-679"><a href="#cb25-679"></a></span>
<span id="cb25-680"><a href="#cb25-680"></a><span class="op">-</span> It <span class="st">"implements"</span> a pre<span class="op">-</span>reduce phase that aggregates the pairs emitted in each node by Mappers</span>
<span id="cb25-681"><a href="#cb25-681"></a><span class="op">-</span> It is characterized by the `<span class="fu">reduce</span><span class="op">()</span>` method</span>
<span id="cb25-682"><a href="#cb25-682"></a><span class="op">-</span> It processes `<span class="op">(</span>key<span class="op">,</span> <span class="op">[</span>list of values<span class="op">])</span>` pairs and emits `<span class="op">(</span>key<span class="op">,</span> value<span class="op">)</span>` pairs</span>
<span id="cb25-683"><a href="#cb25-683"></a><span class="op">-</span> It runs on the cluster</span>
<span id="cb25-684"><a href="#cb25-684"></a></span>
<span id="cb25-685"><a href="#cb25-685"></a>### Combiner <span class="kw">class</span></span>
<span id="cb25-686"><a href="#cb25-686"></a>The Combiner <span class="kw">class</span> <span class="kw">extends</span> the `org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">mapreduce</span><span class="op">.</span><span class="fu">Reducer</span>` <span class="kw">class</span><span class="op">,</span> that is a generic type<span class="op">/</span>generic <span class="kw">class</span> with four type parameters<span class="op">:</span> </span>
<span id="cb25-687"><a href="#cb25-687"></a></span>
<span id="cb25-688"><a href="#cb25-688"></a><span class="op">-</span> input key type</span>
<span id="cb25-689"><a href="#cb25-689"></a><span class="op">-</span> input value type</span>
<span id="cb25-690"><a href="#cb25-690"></a><span class="op">-</span> output key type</span>
<span id="cb25-691"><a href="#cb25-691"></a><span class="op">-</span> output value type</span>
<span id="cb25-692"><a href="#cb25-692"></a></span>
<span id="cb25-693"><a href="#cb25-693"></a>Notice that the output data types are the same as the output data types<span class="op">.</span></span>
<span id="cb25-694"><a href="#cb25-694"></a></span>
<span id="cb25-695"><a href="#cb25-695"></a><span class="fu">Combiners</span> and Reducers extend the <span class="op">**</span>same <span class="kw">class</span><span class="op">**,</span> and the designer<span class="op">/</span>developer <span class="kw">implements</span> the `<span class="fu">reduce</span><span class="op">()</span>` method also <span class="cf">for</span> the Combiner instances<span class="op">.</span> <span class="fu">The</span> Combiner is automatically called by Hadoop <span class="cf">for</span> each `<span class="op">(</span>key<span class="op">,</span> <span class="op">[</span>list of values<span class="op">])</span>` pair obtained by aggregating the local output of a Mapper<span class="op">.</span></span>
<span id="cb25-696"><a href="#cb25-696"></a></span>
<span id="cb25-697"><a href="#cb25-697"></a><span class="fu">The</span> Combiner <span class="kw">class</span> is specified by using the `job<span class="op">.</span><span class="fu">setCombinerClass</span><span class="op">()</span>` method in the `run` method of the <span class="bu">Driver</span> <span class="op">(</span>i<span class="op">.</span><span class="fu">e</span><span class="op">.,</span> in the job configuration part of the code<span class="op">).</span></span>
<span id="cb25-698"><a href="#cb25-698"></a></span>
<span id="cb25-699"><a href="#cb25-699"></a>### Example<span class="op">:</span> adding the Combiner to the Word Count problem</span>
<span id="cb25-700"><a href="#cb25-700"></a>Consider the word count <span class="fu">problem</span> <span class="op">(</span>see <span class="at">@sec</span><span class="op">-</span>wordcountexample <span class="cf">for</span> details<span class="op">),</span> to add the combiner to solution seen before<span class="op">:</span> </span>
<span id="cb25-701"><a href="#cb25-701"></a></span>
<span id="cb25-702"><a href="#cb25-702"></a><span class="op">-</span> Specify the combiner <span class="kw">class</span> in the <span class="bu">Driver</span></span>
<span id="cb25-703"><a href="#cb25-703"></a><span class="op">-</span> Define the Combiner <span class="kw">class</span><span class="op">.</span> <span class="fu">The</span> reduce method of the combiner aggregates local pairs emitted by the mappers of a single cluster node<span class="op">,</span> and emits partial <span class="fu">results</span> <span class="op">(</span>local number of occurrences <span class="cf">for</span> each word<span class="op">)</span> from each cluster node that is used to run the application<span class="op">.</span></span>
<span id="cb25-704"><a href="#cb25-704"></a></span>
<span id="cb25-705"><a href="#cb25-705"></a>#### Specify combiner <span class="kw">class</span> in the <span class="bu">Driver</span></span>
<span id="cb25-706"><a href="#cb25-706"></a>Add the call to the combiner <span class="kw">class</span> in the <span class="bu">Driver</span><span class="op">,</span> before the `return` around line <span class="dv">68</span></span>
<span id="cb25-707"><a href="#cb25-707"></a></span>
<span id="cb25-708"><a href="#cb25-708"></a>```java</span>
<span id="cb25-709"><a href="#cb25-709"></a>        <span class="co">// Set combiner class</span></span>
<span id="cb25-710"><a href="#cb25-710"></a>        job<span class="op">.</span><span class="fu">setCombinerClass</span><span class="op">(</span>WordCountCombiner<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-711"><a href="#cb25-711"></a>```</span>
<span id="cb25-712"><a href="#cb25-712"></a></span>
<span id="cb25-713"><a href="#cb25-713"></a>#### Define the Combiner <span class="kw">class</span></span>
<span id="cb25-714"><a href="#cb25-714"></a></span>
<span id="cb25-715"><a href="#cb25-715"></a>```java</span>
<span id="cb25-716"><a href="#cb25-716"></a><span class="co">/* Set package */</span></span>
<span id="cb25-717"><a href="#cb25-717"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">wordcount</span><span class="op">;</span></span>
<span id="cb25-718"><a href="#cb25-718"></a></span>
<span id="cb25-719"><a href="#cb25-719"></a><span class="co">/* Import libraries */</span></span>
<span id="cb25-720"><a href="#cb25-720"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb25-721"><a href="#cb25-721"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IntWritable</span><span class="op">;</span></span>
<span id="cb25-722"><a href="#cb25-722"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">Text</span><span class="op">;</span></span>
<span id="cb25-723"><a href="#cb25-723"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">mapreduce</span><span class="op">.</span><span class="im">Reducer</span><span class="op">;</span></span>
<span id="cb25-724"><a href="#cb25-724"></a></span>
<span id="cb25-725"><a href="#cb25-725"></a><span class="co">/* Combiner Class */</span></span>
<span id="cb25-726"><a href="#cb25-726"></a><span class="kw">class</span> WordCountCombiner <span class="kw">extends</span> Reducer<span class="op">&lt;</span></span>
<span id="cb25-727"><a href="#cb25-727"></a>    <span class="bu">Text</span><span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb25-728"><a href="#cb25-728"></a>    IntWritable<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb25-729"><a href="#cb25-729"></a>    <span class="bu">Text</span><span class="op">,</span> <span class="co">// Output key type</span></span>
<span id="cb25-730"><a href="#cb25-730"></a>    IntWritable <span class="co">// Output value type</span></span>
<span id="cb25-731"><a href="#cb25-731"></a><span class="op">&gt;{</span></span>
<span id="cb25-732"><a href="#cb25-732"></a><span class="co">/* Implementation of the reduce method */</span></span>
<span id="cb25-733"><a href="#cb25-733"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">reduce</span><span class="op">(</span></span>
<span id="cb25-734"><a href="#cb25-734"></a>        <span class="bu">Text</span> key<span class="op">,</span> <span class="co">// Input key type</span></span>
<span id="cb25-735"><a href="#cb25-735"></a>        <span class="bu">Iterable</span><span class="op">&lt;</span>IntWritable<span class="op">&gt;</span> values<span class="op">,</span> <span class="co">// Input value type</span></span>
<span id="cb25-736"><a href="#cb25-736"></a>        <span class="bu">Context</span> context</span>
<span id="cb25-737"><a href="#cb25-737"></a>    <span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span><span class="op">,</span> <span class="bu">InterruptedException</span><span class="op">{</span></span>
<span id="cb25-738"><a href="#cb25-738"></a>        <span class="dt">int</span> occurrances<span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-739"><a href="#cb25-739"></a>        <span class="co">// Iterate over the set of values and sum them </span></span>
<span id="cb25-740"><a href="#cb25-740"></a>        <span class="cf">for</span> <span class="op">(</span>IntWritable value <span class="op">:</span> values<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-741"><a href="#cb25-741"></a>            occurrances <span class="op">=</span> occurrances<span class="op">+</span> value<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb25-742"><a href="#cb25-742"></a>        <span class="op">}</span></span>
<span id="cb25-743"><a href="#cb25-743"></a>        <span class="co">// Emit the total number of occurrences of the current word</span></span>
<span id="cb25-744"><a href="#cb25-744"></a>        context<span class="op">.</span><span class="fu">write</span><span class="op">(</span>key<span class="op">,</span> <span class="kw">new</span> <span class="fu">IntWritable</span><span class="op">(</span>occurrances<span class="op">));</span></span>
<span id="cb25-745"><a href="#cb25-745"></a>    <span class="op">}</span> <span class="co">// End reduce method</span></span>
<span id="cb25-746"><a href="#cb25-746"></a><span class="op">}</span> <span class="co">// End of class WordCountCombiner</span></span>
<span id="cb25-747"><a href="#cb25-747"></a>```</span>
<span id="cb25-748"><a href="#cb25-748"></a></span>
<span id="cb25-749"><a href="#cb25-749"></a>### Final thoughts</span>
<span id="cb25-750"><a href="#cb25-750"></a>The reducer and the combiner classes perform the same <span class="fu">computation</span> <span class="op">(</span>the reduce method of the two classes is the same<span class="op">).</span> <span class="fu">Indeed</span><span class="op">,</span> the developer<span class="op">/</span>designer does not really need two different classes<span class="op">:</span> he can simply specify that WordCountReducer is also the combiner <span class="kw">class</span><span class="op">,</span> <span class="cf">for</span> example by adding in the driver</span>
<span id="cb25-751"><a href="#cb25-751"></a></span>
<span id="cb25-752"><a href="#cb25-752"></a>```java</span>
<span id="cb25-753"><a href="#cb25-753"></a>        <span class="co">// Set combiner class</span></span>
<span id="cb25-754"><a href="#cb25-754"></a>        job<span class="op">.</span><span class="fu">setCombinerClass</span><span class="op">(</span>WordCountReducer<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb25-755"><a href="#cb25-755"></a>        <span class="co">// "WordCountReducer.class" instead of "WordCountCombiner.class"</span></span>
<span id="cb25-756"><a href="#cb25-756"></a>```</span>
<span id="cb25-757"><a href="#cb25-757"></a></span>
<span id="cb25-758"><a href="#cb25-758"></a>In <span class="dv">99</span><span class="op">%</span> of the Hadoop applications the same <span class="kw">class</span> can be used to implement both combiner and reducer<span class="op">.</span></span>
<span id="cb25-759"><a href="#cb25-759"></a></span>
<span id="cb25-760"><a href="#cb25-760"></a>## Personalized <span class="bu">Data</span> <span class="bu">Types</span></span>
<span id="cb25-761"><a href="#cb25-761"></a>Personalized <span class="bu">Data</span> <span class="bu">Types</span> are useful when the <span class="op">**</span>value<span class="op">**</span> of a key<span class="op">-</span>value pair is a <span class="op">**</span>complex data type<span class="op">**.</span> <span class="fu">Personalized</span> <span class="bu">Data</span> <span class="bu">Types</span> are defined by implementing the `org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">io</span><span class="op">.</span><span class="fu">Writable</span>` <span class="kw">interface</span><span class="op">.</span> <span class="fu">To</span> properly serialize the input<span class="op">-</span>output data<span class="op">,</span> the following methods must be implemented</span>
<span id="cb25-762"><a href="#cb25-762"></a></span>
<span id="cb25-763"><a href="#cb25-763"></a><span class="op">-</span> `public <span class="dt">void</span> <span class="fu">readFields</span><span class="op">(</span><span class="bu">DataInput</span> in<span class="op">)</span>`</span>
<span id="cb25-764"><a href="#cb25-764"></a><span class="op">-</span> `public <span class="dt">void</span> <span class="fu">write</span><span class="op">(</span><span class="bu">DataOutput</span> out<span class="op">)</span>`</span>
<span id="cb25-765"><a href="#cb25-765"></a></span>
<span id="cb25-766"><a href="#cb25-766"></a>To properly format the output of the <span class="fu">job</span> <span class="op">(</span>i<span class="op">.</span><span class="fu">e</span><span class="op">.,</span> the output of the reducer<span class="op">)</span> usually also the following method is <span class="st">"redefined"</span></span>
<span id="cb25-767"><a href="#cb25-767"></a></span>
<span id="cb25-768"><a href="#cb25-768"></a><span class="op">-</span> `public <span class="bu">String</span> <span class="fu">toString</span><span class="op">()</span>`</span>
<span id="cb25-769"><a href="#cb25-769"></a></span>
<span id="cb25-770"><a href="#cb25-770"></a>If also a constructor is defined<span class="op">,</span> remember to define also an empty constructor<span class="op">,</span> otherwise the system will raise an error at runtime<span class="op">.</span></span>
<span id="cb25-771"><a href="#cb25-771"></a></span>
<span id="cb25-772"><a href="#cb25-772"></a>### Example</span>
<span id="cb25-773"><a href="#cb25-773"></a>Suppose to be interested in complex values composed of two parts<span class="op">,</span> such as a <span class="fu">counter</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> and a <span class="fu">sum</span> <span class="op">(</span><span class="dt">float</span><span class="op">).</span> <span class="fu">In</span> <span class="kw">this</span> <span class="cf">case</span><span class="op">,</span> an ad<span class="op">-</span>hoc <span class="bu">Data</span> <span class="bu">Type</span> can be used to implement <span class="kw">this</span> complex data type in Hadoop<span class="op">.</span></span>
<span id="cb25-774"><a href="#cb25-774"></a></span>
<span id="cb25-775"><a href="#cb25-775"></a>```java</span>
<span id="cb25-776"><a href="#cb25-776"></a><span class="co">/* Set package */</span></span>
<span id="cb25-777"><a href="#cb25-777"></a></span>
<span id="cb25-778"><a href="#cb25-778"></a><span class="kw">package</span><span class="im"> it</span><span class="op">.</span><span class="im">polito</span><span class="op">.</span><span class="im">bigdata</span><span class="op">.</span><span class="im">hadoop</span><span class="op">.</span><span class="im">combinerexample</span><span class="op">;</span></span>
<span id="cb25-779"><a href="#cb25-779"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">DataInput</span><span class="op">;</span></span>
<span id="cb25-780"><a href="#cb25-780"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">DataOutput</span><span class="op">;</span></span>
<span id="cb25-781"><a href="#cb25-781"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">IOException</span><span class="op">;</span></span>
<span id="cb25-782"><a href="#cb25-782"></a></span>
<span id="cb25-783"><a href="#cb25-783"></a><span class="kw">public</span> <span class="kw">class</span> SumAndCountWritable <span class="kw">implements</span> </span>
<span id="cb25-784"><a href="#cb25-784"></a>org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">io</span><span class="op">.</span><span class="fu">Writable</span> <span class="op">{</span></span>
<span id="cb25-785"><a href="#cb25-785"></a>    <span class="co">/* Private variables */</span></span>
<span id="cb25-786"><a href="#cb25-786"></a>    <span class="kw">private</span> <span class="dt">float</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-787"><a href="#cb25-787"></a>    <span class="kw">private</span> <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-788"><a href="#cb25-788"></a></span>
<span id="cb25-789"><a href="#cb25-789"></a>    <span class="co">/* Methods to get and set private variables of the class */</span></span>
<span id="cb25-790"><a href="#cb25-790"></a>    <span class="kw">public</span> <span class="dt">float</span> <span class="fu">getSum</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-791"><a href="#cb25-791"></a>        <span class="cf">return</span> sum<span class="op">;</span></span>
<span id="cb25-792"><a href="#cb25-792"></a>    <span class="op">}</span></span>
<span id="cb25-793"><a href="#cb25-793"></a></span>
<span id="cb25-794"><a href="#cb25-794"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setSum</span><span class="op">(</span><span class="dt">float</span> sumValue<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-795"><a href="#cb25-795"></a>        sum<span class="op">=</span>sumValue<span class="op">;</span></span>
<span id="cb25-796"><a href="#cb25-796"></a>    <span class="op">}</span></span>
<span id="cb25-797"><a href="#cb25-797"></a></span>
<span id="cb25-798"><a href="#cb25-798"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getCount</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-799"><a href="#cb25-799"></a>        <span class="cf">return</span> count<span class="op">;</span></span>
<span id="cb25-800"><a href="#cb25-800"></a>    <span class="op">}</span></span>
<span id="cb25-801"><a href="#cb25-801"></a></span>
<span id="cb25-802"><a href="#cb25-802"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setCount</span><span class="op">(</span><span class="dt">int</span> countValue<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-803"><a href="#cb25-803"></a>        count<span class="op">=</span>countValue<span class="op">;</span></span>
<span id="cb25-804"><a href="#cb25-804"></a>    <span class="op">}</span></span>
<span id="cb25-805"><a href="#cb25-805"></a></span>
<span id="cb25-806"><a href="#cb25-806"></a>    <span class="co">/* Methods to serialize and deserialize the contents of the </span></span>
<span id="cb25-807"><a href="#cb25-807"></a><span class="co">    instances of this class */</span></span>
<span id="cb25-808"><a href="#cb25-808"></a>    <span class="at">@Override</span> <span class="co">/* Serialize the fields of this object to out */</span></span>
<span id="cb25-809"><a href="#cb25-809"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">write</span><span class="op">(</span><span class="bu">DataOutput</span> out<span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span> <span class="op">{</span></span>
<span id="cb25-810"><a href="#cb25-810"></a>        out<span class="op">.</span><span class="fu">writeFloat</span><span class="op">(</span>sum<span class="op">);</span></span>
<span id="cb25-811"><a href="#cb25-811"></a>        out<span class="op">.</span><span class="fu">writeInt</span><span class="op">(</span>count<span class="op">);</span></span>
<span id="cb25-812"><a href="#cb25-812"></a>    <span class="op">}</span></span>
<span id="cb25-813"><a href="#cb25-813"></a></span>
<span id="cb25-814"><a href="#cb25-814"></a>    <span class="at">@Override</span> <span class="co">/* Deserialize the fields of this object from in */</span></span>
<span id="cb25-815"><a href="#cb25-815"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">readFields</span><span class="op">(</span><span class="bu">DataInput</span> in<span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span> <span class="op">{</span></span>
<span id="cb25-816"><a href="#cb25-816"></a>        um<span class="op">=</span>in<span class="op">.</span><span class="fu">readFloat</span><span class="op">();</span> <span class="co">// &lt;1&gt;</span></span>
<span id="cb25-817"><a href="#cb25-817"></a>        count<span class="op">=</span>in<span class="op">.</span><span class="fu">readInt</span><span class="op">();</span></span>
<span id="cb25-818"><a href="#cb25-818"></a>    <span class="op">}</span></span>
<span id="cb25-819"><a href="#cb25-819"></a></span>
<span id="cb25-820"><a href="#cb25-820"></a>    <span class="co">/* Specify how to convert the contents of the instances of this </span></span>
<span id="cb25-821"><a href="#cb25-821"></a><span class="co">    class to a String</span></span>
<span id="cb25-822"><a href="#cb25-822"></a><span class="co">    * Useful to specify how to store/write the content of this class</span></span>
<span id="cb25-823"><a href="#cb25-823"></a><span class="co">    * in a textual file */</span></span>
<span id="cb25-824"><a href="#cb25-824"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">()</span></span>
<span id="cb25-825"><a href="#cb25-825"></a>    <span class="op">{</span></span>
<span id="cb25-826"><a href="#cb25-826"></a>        <span class="bu">String</span> formattedString<span class="op">=</span></span>
<span id="cb25-827"><a href="#cb25-827"></a>        <span class="kw">new</span> <span class="bu">String</span><span class="op">(</span><span class="st">"sum="</span><span class="op">+</span>sum<span class="op">+</span><span class="st">",count="</span><span class="op">+</span>count<span class="op">);</span></span>
<span id="cb25-828"><a href="#cb25-828"></a>        <span class="cf">return</span> formattedString<span class="op">;</span></span>
<span id="cb25-829"><a href="#cb25-829"></a>    <span class="op">}</span></span>
<span id="cb25-830"><a href="#cb25-830"></a><span class="op">}</span></span>
<span id="cb25-831"><a href="#cb25-831"></a>```</span>
<span id="cb25-832"><a href="#cb25-832"></a><span class="fl">1.</span> Notice that the order of the read must be coherent with the order of the write<span class="op">.</span></span>
<span id="cb25-833"><a href="#cb25-833"></a></span>
<span id="cb25-834"><a href="#cb25-834"></a>### Complex keys</span>
<span id="cb25-835"><a href="#cb25-835"></a>Personalized <span class="bu">Data</span> <span class="bu">Types</span> can be used also to manage complex <span class="op">**</span>keys<span class="op">**.</span> <span class="fu">In</span> that <span class="cf">case</span> the Personalized <span class="bu">Data</span> <span class="bu">Type</span> must implement the `org<span class="op">.</span><span class="fu">apache</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">io</span><span class="op">.</span><span class="fu">WritableComparable</span>` <span class="kw">interface</span><span class="op">,</span> since keys must be </span>
<span id="cb25-836"><a href="#cb25-836"></a></span>
<span id="cb25-837"><a href="#cb25-837"></a><span class="op">-</span> Compared<span class="op">/</span>sorted<span class="op">:</span> it is possible by implementing the `<span class="fu">compareTo</span><span class="op">()</span>` method<span class="op">;</span> it is used by the Combiner locally<span class="op">.</span></span>
<span id="cb25-838"><a href="#cb25-838"></a></span>
<span id="cb25-839"><a href="#cb25-839"></a><span class="op">:::{.</span><span class="fu">callout</span><span class="op">-</span>note collapse<span class="op">=</span><span class="st">"true"</span><span class="op">}</span></span>
<span id="cb25-840"><a href="#cb25-840"></a>### Example</span>
<span id="cb25-841"><a href="#cb25-841"></a></span>
<span id="cb25-842"><a href="#cb25-842"></a>```java</span>
<span id="cb25-843"><a href="#cb25-843"></a><span class="at">@Override</span></span>
<span id="cb25-844"><a href="#cb25-844"></a><span class="kw">public</span> <span class="dt">int</span> <span class="fu">compareTo</span><span class="op">(</span>IntPair ip<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-845"><a href="#cb25-845"></a>    <span class="dt">int</span> cmp <span class="op">=</span> <span class="fu">compare</span><span class="op">(</span>first<span class="op">,</span> ip<span class="op">.</span><span class="fu">first</span><span class="op">);</span></span>
<span id="cb25-846"><a href="#cb25-846"></a>    <span class="cf">if</span> <span class="op">(</span>cmp <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-847"><a href="#cb25-847"></a>        <span class="cf">return</span> cmp<span class="op">;</span></span>
<span id="cb25-848"><a href="#cb25-848"></a>    <span class="op">}</span></span>
<span id="cb25-849"><a href="#cb25-849"></a>    <span class="cf">return</span> <span class="fu">compare</span><span class="op">(</span>second<span class="op">,</span> ip<span class="op">.</span><span class="fu">second</span><span class="op">);</span></span>
<span id="cb25-850"><a href="#cb25-850"></a><span class="op">}</span></span>
<span id="cb25-851"><a href="#cb25-851"></a><span class="co">/**</span></span>
<span id="cb25-852"><a href="#cb25-852"></a><span class="co">*</span> Convenience method for comparing two ints<span class="co">.</span></span>
<span id="cb25-853"><a href="#cb25-853"></a><span class="co">*/</span></span>
<span id="cb25-854"><a href="#cb25-854"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">int</span> <span class="fu">compare</span><span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-855"><a href="#cb25-855"></a>    <span class="cf">return</span> <span class="op">(</span>a <span class="op">&lt;</span> b <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> <span class="op">(</span>a <span class="op">==</span> b <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb25-856"><a href="#cb25-856"></a><span class="op">}</span></span>
<span id="cb25-857"><a href="#cb25-857"></a>```</span>
<span id="cb25-858"><a href="#cb25-858"></a></span>
<span id="cb25-859"><a href="#cb25-859"></a><span class="op">:::</span></span>
<span id="cb25-860"><a href="#cb25-860"></a></span>
<span id="cb25-861"><a href="#cb25-861"></a><span class="op">-</span> Split in groups<span class="op">:</span> it is possible by implementing the `<span class="fu">hashCode</span><span class="op">()</span>` method<span class="op">;</span> it is used by the Reducer on the networks<span class="op">.</span> </span>
<span id="cb25-862"><a href="#cb25-862"></a></span>
<span id="cb25-863"><a href="#cb25-863"></a>## Sharing parameters among <span class="bu">Driver</span><span class="op">,</span> Mappers<span class="op">,</span> and Reducers</span>
<span id="cb25-864"><a href="#cb25-864"></a>The configuration object is used to share <span class="fu">the</span> <span class="op">(</span>basic<span class="op">)</span> configuration of the Hadoop environment across the driver<span class="op">,</span> the mappers and the reducers of the application<span class="op">/</span>job<span class="op">.</span> <span class="fu">It</span> stores a list of `<span class="op">(</span>property<span class="op">-</span>name<span class="op">,</span> property<span class="op">-</span>value<span class="op">)</span>` pairs<span class="op">.</span> </span>
<span id="cb25-865"><a href="#cb25-865"></a></span>
<span id="cb25-866"><a href="#cb25-866"></a><span class="fu">Also</span><span class="op">,</span> personalized `<span class="op">(</span>property<span class="op">-</span>name<span class="op">,</span> property<span class="op">-</span>value<span class="op">)</span>` pairs can be specified in the driver<span class="op">,</span> and they can be used to share some parameters of the application with mappers and reducers<span class="op">.</span> <span class="fu">The</span> personalized `<span class="op">(</span>property<span class="op">-</span>name<span class="op">,</span> property<span class="op">-</span>value<span class="op">)</span>` pairs are useful to define shared <span class="fu">small</span> <span class="op">(</span>constant<span class="op">)</span> properties that are available only during the execution of the program<span class="op">.</span> <span class="fu">The</span> driver sets these parameters<span class="op">,</span> and Mappers and Reducers can access them<span class="op">,</span> however they cannot modify them<span class="op">.</span></span>
<span id="cb25-867"><a href="#cb25-867"></a></span>
<span id="cb25-868"><a href="#cb25-868"></a>### How to use these parameters</span>
<span id="cb25-869"><a href="#cb25-869"></a>In the driver</span>
<span id="cb25-870"><a href="#cb25-870"></a></span>
<span id="cb25-871"><a href="#cb25-871"></a><span class="fl">1.</span> Retrieve the configuration object</span>
<span id="cb25-872"><a href="#cb25-872"></a></span>
<span id="cb25-873"><a href="#cb25-873"></a>```java</span>
<span id="cb25-874"><a href="#cb25-874"></a><span class="bu">Configuration</span> conf <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getConf</span><span class="op">();</span></span>
<span id="cb25-875"><a href="#cb25-875"></a>```</span>
<span id="cb25-876"><a href="#cb25-876"></a></span>
<span id="cb25-877"><a href="#cb25-877"></a><span class="fl">2.</span> <span class="bu">Set</span> personalized properties </span>
<span id="cb25-878"><a href="#cb25-878"></a></span>
<span id="cb25-879"><a href="#cb25-879"></a>```java</span>
<span id="cb25-880"><a href="#cb25-880"></a>conf<span class="op">.</span><span class="fu">set</span><span class="op">(</span><span class="st">"property-name"</span><span class="op">,</span> <span class="st">"value"</span><span class="op">);</span></span>
<span id="cb25-881"><a href="#cb25-881"></a>```</span>
<span id="cb25-882"><a href="#cb25-882"></a></span>
<span id="cb25-883"><a href="#cb25-883"></a>In the Mapper and<span class="op">/</span>or Reducer</span>
<span id="cb25-884"><a href="#cb25-884"></a>```java</span>
<span id="cb25-885"><a href="#cb25-885"></a>context<span class="op">.</span><span class="fu">getConfiguration</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">"property-name"</span><span class="op">)</span></span>
<span id="cb25-886"><a href="#cb25-886"></a>```</span>
<span id="cb25-887"><a href="#cb25-887"></a></span>
<span id="cb25-888"><a href="#cb25-888"></a>This method returns a <span class="bu">String</span> containing the value of the specified property<span class="op">.</span></span>
<span id="cb25-889"><a href="#cb25-889"></a></span>
<span id="cb25-890"><a href="#cb25-890"></a>## Counters</span>
<span id="cb25-891"><a href="#cb25-891"></a>Hadoop provides a set of basic<span class="op">,</span> built<span class="op">-</span>in<span class="op">,</span> counters to store some statistics about jobs<span class="op">,</span> mappers<span class="op">,</span> reducers<span class="op">,</span> <span class="cf">for</span> example </span>
<span id="cb25-892"><a href="#cb25-892"></a></span>
<span id="cb25-893"><a href="#cb25-893"></a><span class="op">-</span> number of input and output <span class="fu">records</span> <span class="op">(</span>i<span class="op">.</span><span class="fu">e</span><span class="op">.,</span> pairs<span class="op">)</span></span>
<span id="cb25-894"><a href="#cb25-894"></a><span class="op">-</span> number of transmitted bytes</span>
<span id="cb25-895"><a href="#cb25-895"></a></span>
<span id="cb25-896"><a href="#cb25-896"></a>Also other ad<span class="op">-</span>hoc<span class="op">,</span> user<span class="op">-</span>defined<span class="op">,</span> counters can be defined to compute global <span class="st">"statistics"</span> associated with the goal of the application<span class="op">.</span></span>
<span id="cb25-897"><a href="#cb25-897"></a></span>
<span id="cb25-898"><a href="#cb25-898"></a>### User<span class="op">-</span>defined counters</span>
<span id="cb25-899"><a href="#cb25-899"></a>User<span class="op">-</span>defined counters are defined by means of Java `enum`<span class="op">,</span> and each application can define an arbitrary number of enums<span class="op">.</span> <span class="fu">The</span> name of the `enum` is the group name<span class="op">,</span> and each `enum` has a number of <span class="st">"fields"</span><span class="op">,</span> which are the counter names<span class="op">.</span> </span>
<span id="cb25-900"><a href="#cb25-900"></a></span>
<span id="cb25-901"><a href="#cb25-901"></a><span class="fu">Counters</span> are incremented in the Mappers and Reducers by using the `<span class="fu">increment</span><span class="op">()</span>` method</span>
<span id="cb25-902"><a href="#cb25-902"></a></span>
<span id="cb25-903"><a href="#cb25-903"></a>```java</span>
<span id="cb25-904"><a href="#cb25-904"></a>context<span class="op">.</span><span class="fu">getCounter</span><span class="op">(</span>countername<span class="op">).</span><span class="fu">increment</span><span class="op">(</span>value<span class="op">);</span></span>
<span id="cb25-905"><a href="#cb25-905"></a>```</span>
<span id="cb25-906"><a href="#cb25-906"></a></span>
<span id="cb25-907"><a href="#cb25-907"></a>The global<span class="op">/</span><span class="dt">final</span> value of each counter<span class="op">,</span> which is available at the end of the job<span class="op">,</span> is then stored<span class="op">/</span>printed by the <span class="bu">Driver</span> <span class="op">(</span>at the end of the execution of the job<span class="op">).</span> <span class="fu">Driver</span> can retrieve the <span class="dt">final</span> values of the counters using the `<span class="fu">getCounters</span><span class="op">()</span>` and `<span class="fu">findCounter</span><span class="op">()</span>` methods<span class="op">.</span></span>
<span id="cb25-908"><a href="#cb25-908"></a></span>
<span id="cb25-909"><a href="#cb25-909"></a><span class="fu">User</span><span class="op">-</span>defined counters can be also defined on the fly by using the method `<span class="fu">incrCounter</span><span class="op">(</span><span class="st">"group name"</span><span class="op">,</span> <span class="st">"counter name"</span><span class="op">,</span> value<span class="op">)</span>`<span class="op">.</span> <span class="fu">Dynamic</span> counters are useful when the set of counters is unknown at design time<span class="op">.</span></span>
<span id="cb25-910"><a href="#cb25-910"></a></span>
<span id="cb25-911"><a href="#cb25-911"></a>#### Example</span>
<span id="cb25-912"><a href="#cb25-912"></a>In the driver<span class="op">,</span> add</span>
<span id="cb25-913"><a href="#cb25-913"></a></span>
<span id="cb25-914"><a href="#cb25-914"></a>```java</span>
<span id="cb25-915"><a href="#cb25-915"></a><span class="kw">public</span> <span class="dt">static</span> <span class="kw">enum</span> COUNTERS <span class="op">{</span></span>
<span id="cb25-916"><a href="#cb25-916"></a>    ERROR_COUNT<span class="op">,</span></span>
<span id="cb25-917"><a href="#cb25-917"></a>    MISSING_FIELDS_RECORD_COUNT</span>
<span id="cb25-918"><a href="#cb25-918"></a><span class="op">}</span></span>
<span id="cb25-919"><a href="#cb25-919"></a>```</span>
<span id="cb25-920"><a href="#cb25-920"></a></span>
<span id="cb25-921"><a href="#cb25-921"></a>This <span class="kw">enum</span> defines two counters</span>
<span id="cb25-922"><a href="#cb25-922"></a></span>
<span id="cb25-923"><a href="#cb25-923"></a><span class="op">-</span> `COUNTERS<span class="op">.</span><span class="fu">ERROR_COUNT</span>`</span>
<span id="cb25-924"><a href="#cb25-924"></a><span class="op">-</span> `COUNTERS<span class="op">.</span><span class="fu">MISSING_FIELDS_RECORD_COUNT</span>`</span>
<span id="cb25-925"><a href="#cb25-925"></a></span>
<span id="cb25-926"><a href="#cb25-926"></a>To increment the `COUNTERS<span class="op">.</span><span class="fu">ERROR_COUNT</span>` counter in the mapper or the reducer<span class="op">,</span> use </span>
<span id="cb25-927"><a href="#cb25-927"></a>```java</span>
<span id="cb25-928"><a href="#cb25-928"></a>context<span class="op">.</span><span class="fu">getCounter</span><span class="op">(</span>COUNTERS<span class="op">.</span><span class="fu">ERROR_COUNT</span><span class="op">).</span><span class="fu">increment</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb25-929"><a href="#cb25-929"></a>```</span>
<span id="cb25-930"><a href="#cb25-930"></a></span>
<span id="cb25-931"><a href="#cb25-931"></a>To retrieve the <span class="dt">final</span> value of the `COUNTERS<span class="op">.</span><span class="fu">ERROR_COUNT</span>` counter in the driver<span class="op">,</span> use </span>
<span id="cb25-932"><a href="#cb25-932"></a>```java</span>
<span id="cb25-933"><a href="#cb25-933"></a>Counter errorCounter <span class="op">=</span> job<span class="op">.</span><span class="fu">getCounters</span><span class="op">().</span><span class="fu">findCounter</span><span class="op">(</span>COUNTERS<span class="op">.</span><span class="fu">ERROR_COUNT</span><span class="op">);</span></span>
<span id="cb25-934"><a href="#cb25-934"></a>```</span>
<span id="cb25-935"><a href="#cb25-935"></a>## <span class="bu">Map</span><span class="op">-</span>only job</span>
<span id="cb25-936"><a href="#cb25-936"></a>In some applications<span class="op">,</span> all the work can be performed by the <span class="fu">mapper</span><span class="op">(</span>s<span class="op">)</span> <span class="op">(</span>e<span class="op">.</span><span class="fu">g</span><span class="op">.,</span> record filtering applications<span class="op">):</span> Hadoop allows executing <span class="bu">Map</span><span class="op">-</span>only jobs<span class="op">,</span> avoiding the reduce phase<span class="op">,</span> and also the shuffle and sort phase<span class="op">.</span> </span>
<span id="cb25-937"><a href="#cb25-937"></a></span>
<span id="cb25-938"><a href="#cb25-938"></a><span class="fu">The</span> output of the map job is directly stored in HDFS<span class="op">,</span> since the set of pairs emitted by the map phase is already the <span class="dt">final</span> output<span class="op">.</span></span>
<span id="cb25-939"><a href="#cb25-939"></a></span>
<span id="cb25-940"><a href="#cb25-940"></a>### Implementation of a <span class="bu">Map</span><span class="op">-</span>only job</span>
<span id="cb25-941"><a href="#cb25-941"></a>To implement a <span class="bu">Map</span><span class="op">-</span>only job</span>
<span id="cb25-942"><a href="#cb25-942"></a></span>
<span id="cb25-943"><a href="#cb25-943"></a><span class="op">-</span> Implement the map method</span>
<span id="cb25-944"><a href="#cb25-944"></a><span class="op">-</span> <span class="bu">Set</span> the number of reducers to <span class="dv">0</span> during the configuration of the <span class="fu">job</span> <span class="op">(</span>in the driver<span class="op">),</span> writing</span>
<span id="cb25-945"><a href="#cb25-945"></a></span>
<span id="cb25-946"><a href="#cb25-946"></a>```java</span>
<span id="cb25-947"><a href="#cb25-947"></a>job<span class="op">.</span><span class="fu">setNumReduceTasks</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb25-948"><a href="#cb25-948"></a>```</span>
<span id="cb25-949"><a href="#cb25-949"></a>## In<span class="op">-</span>Mapper combiner</span>
<span id="cb25-950"><a href="#cb25-950"></a>Mapper classes are also characterized by a setup and a cleanup method<span class="op">,</span> which are empty <span class="cf">if</span> they are not overridden<span class="op">.</span></span>
<span id="cb25-951"><a href="#cb25-951"></a></span>
<span id="cb25-952"><a href="#cb25-952"></a>### Setup method</span>
<span id="cb25-953"><a href="#cb25-953"></a>The setup method is called once <span class="cf">for</span> each mapper prior to the many calls of the map method<span class="op">.</span> <span class="fu">It</span> can be used to set the values of in<span class="op">-</span>mapper variables<span class="op">,</span> which are used to maintain in<span class="op">-</span>mapper statistics and preserve the <span class="fu">state</span> <span class="op">(</span>locally <span class="cf">for</span> each mapper<span class="op">)</span> within and across calls to the map method<span class="op">.</span></span>
<span id="cb25-954"><a href="#cb25-954"></a></span>
<span id="cb25-955"><a href="#cb25-955"></a>### Cleanup method</span>
<span id="cb25-956"><a href="#cb25-956"></a>The map method<span class="op">,</span> invoked many times<span class="op">,</span> updates the value of the in<span class="op">-</span>mapper variables<span class="op">.</span> <span class="fu">Each</span> <span class="fu">mapper</span> <span class="op">(</span>each instance of the mapper <span class="kw">class</span><span class="op">)</span> has its own copy of the in<span class="op">-</span>mapper variables<span class="op">.</span></span>
<span id="cb25-957"><a href="#cb25-957"></a></span>
<span id="cb25-958"><a href="#cb25-958"></a><span class="fu">The</span> cleanup method is called once <span class="cf">for</span> each mapper after the many calls to the map method<span class="op">,</span> and it can be used to emit `<span class="op">(</span>key<span class="op">,</span>value<span class="op">)</span>` pairs based on the values of the in<span class="op">-</span>mapper variables<span class="op">/</span>statistics<span class="op">.</span></span>
<span id="cb25-959"><a href="#cb25-959"></a></span>
<span id="cb25-960"><a href="#cb25-960"></a><span class="fu">Also</span> the reducer classes are characterized by a setup and a cleanup method<span class="op">.</span> </span>
<span id="cb25-961"><a href="#cb25-961"></a></span>
<span id="cb25-962"><a href="#cb25-962"></a><span class="op">-</span> The setup method is called once <span class="cf">for</span> each reducer prior to the many calls of the reduce method<span class="op">.</span> </span>
<span id="cb25-963"><a href="#cb25-963"></a><span class="op">-</span> The cleanup method is called once <span class="cf">for</span> each reducer after the many calls of the reduce method<span class="op">.</span></span>
<span id="cb25-964"><a href="#cb25-964"></a></span>
<span id="cb25-965"><a href="#cb25-965"></a><span class="fu">In</span><span class="op">-</span>MapperCombiners are a possible improvement over <span class="st">"standard"</span> Combiners</span>
<span id="cb25-966"><a href="#cb25-966"></a></span>
<span id="cb25-967"><a href="#cb25-967"></a><span class="op">-</span> Initialize a set of in<span class="op">-</span>mapper variables during the instance of the Mapper<span class="op">,</span> in the setup method of the mapper<span class="op">;</span></span>
<span id="cb25-968"><a href="#cb25-968"></a><span class="op">-</span> Update the in<span class="op">-</span>mapper variables<span class="op">/</span>statistics in the map method<span class="op">.</span> <span class="fu">Usually</span><span class="op">,</span> <span class="fu">no</span> <span class="op">(</span>key<span class="op">,</span>value<span class="op">)</span> pairs are emitted in the map method of an in<span class="op">-</span>mapper combiner<span class="op">.</span></span>
<span id="cb25-969"><a href="#cb25-969"></a></span>
<span id="cb25-970"><a href="#cb25-970"></a><span class="fu">After</span> all the input <span class="fu">records</span> <span class="op">(</span>input `<span class="op">(</span>key<span class="op">,</span> value<span class="op">)</span>` pairs<span class="op">)</span> of a mapper have been analyzed by the map method<span class="op">,</span> emit the output `<span class="op">(</span>key<span class="op">,</span> value<span class="op">)</span>` pairs of the mapper<span class="op">:</span> `<span class="op">(</span>key<span class="op">,</span> value<span class="op">)</span>` pairs are emitted in the cleanup method of the mapper based on the values of the in<span class="op">-</span>mapper variables</span>
<span id="cb25-971"><a href="#cb25-971"></a></span>
<span id="cb25-972"><a href="#cb25-972"></a>The in<span class="op">-</span>mapper variables are used to perform the work of the combiner in the mapper<span class="op">,</span> allowing to improve the overall performance of the application<span class="op">.</span> <span class="fu">However</span><span class="op">,</span> pay attention to the amount of used main memory<span class="op">:</span> each mapper may use a limited amount of main<span class="op">-</span>memory<span class="op">,</span> hence in<span class="op">-</span>mapper variables should be <span class="st">"small"</span> <span class="op">(</span>at least smaller than the maximum amount of memory assigned to each mapper<span class="op">).</span></span>
<span id="cb25-973"><a href="#cb25-973"></a></span>
<span id="cb25-974"><a href="#cb25-974"></a>### In<span class="op">-</span>Mapper combiner<span class="op">:</span> Word count pseudocode</span>
<span id="cb25-975"><a href="#cb25-975"></a></span>
<span id="cb25-976"><a href="#cb25-976"></a>```java</span>
<span id="cb25-977"><a href="#cb25-977"></a><span class="kw">class</span> MAPPER</span>
<span id="cb25-978"><a href="#cb25-978"></a>    method setup</span>
<span id="cb25-979"><a href="#cb25-979"></a>        A <span class="op">=</span> <span class="kw">new</span> AssociativeArray</span>
<span id="cb25-980"><a href="#cb25-980"></a>    method <span class="fu">map</span><span class="op">(</span>offset key<span class="op">,</span> line l<span class="op">)</span></span>
<span id="cb25-981"><a href="#cb25-981"></a>        <span class="cf">for</span> all word w ∈ line l <span class="cf">do</span></span>
<span id="cb25-982"><a href="#cb25-982"></a>            A<span class="op">{</span>w<span class="op">}</span> <span class="op">=</span> A<span class="op">{</span>w<span class="op">}</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb25-983"><a href="#cb25-983"></a>    method cleanup</span>
<span id="cb25-984"><a href="#cb25-984"></a>        <span class="cf">for</span> all word w in A <span class="cf">do</span></span>
<span id="cb25-985"><a href="#cb25-985"></a>            <span class="fu">EMIT</span><span class="op">(</span>term w <span class="op">,</span> count A<span class="op">{</span>w<span class="op">})</span></span>
<span id="cb25-986"><a href="#cb25-986"></a>```</span>
<span id="cb25-987"><a href="#cb25-987"></a></span>
<span id="cb25-988"><a href="#cb25-988"></a>## Maven project </span>
<span id="cb25-989"><a href="#cb25-989"></a>### Structure</span>
<span id="cb25-990"><a href="#cb25-990"></a><span class="op">-</span> <span class="op">*</span>src<span class="op">*</span> folder<span class="op">:</span> contains the source code<span class="op">.</span> <span class="fu">May</span> contain subfolders<span class="op">,</span> but the important point is that it must contain the java files</span>
<span id="cb25-991"><a href="#cb25-991"></a>    <span class="op">-</span> DriverBigData<span class="op">.</span><span class="fu">java</span></span>
<span id="cb25-992"><a href="#cb25-992"></a>    <span class="op">-</span> MapperBigData<span class="op">.</span><span class="fu">java</span></span>
<span id="cb25-993"><a href="#cb25-993"></a>    <span class="op">-</span> ReducerBigData<span class="op">.</span><span class="fu">java</span></span>
<span id="cb25-994"><a href="#cb25-994"></a><span class="op">-</span> <span class="op">*</span>target<span class="op">*</span> folder<span class="op">:</span> </span>
<span id="cb25-995"><a href="#cb25-995"></a>    <span class="op">-</span> <span class="op">*.</span><span class="fu">jar</span><span class="op">*</span> file<span class="op">:</span> useful to run the application on the cluster<span class="op">.</span> <span class="fu">It</span><span class="er">'</span>s the java archive that collects the three classes of the Hadoop application</span>
<span id="cb25-996"><a href="#cb25-996"></a><span class="op">-</span> <span class="op">*</span>pom<span class="op">.</span><span class="fu">xml</span><span class="op">*</span> file<span class="op">:</span> used to configure the Hadoop application</span>
<span id="cb25-997"><a href="#cb25-997"></a></span>
<span id="cb25-998"><a href="#cb25-998"></a>### How to run the project</span>
<span id="cb25-999"><a href="#cb25-999"></a>Using Eclipse</span>
<span id="cb25-1000"><a href="#cb25-1000"></a></span>
<span id="cb25-1001"><a href="#cb25-1001"></a><span class="op">-</span> select the <span class="bu">Driver</span> `<span class="op">.</span><span class="fu">java</span>` file</span>
<span id="cb25-1002"><a href="#cb25-1002"></a><span class="op">-</span> Right click</span>
<span id="cb25-1003"><a href="#cb25-1003"></a><span class="op">-</span> Click <span class="st">"Run As"</span></span>
<span id="cb25-1004"><a href="#cb25-1004"></a><span class="op">-</span> If the arguments have already been set<span class="op">:</span> </span>
<span id="cb25-1005"><a href="#cb25-1005"></a>    <span class="op">-</span> Click <span class="st">"Java Application"</span></span>
<span id="cb25-1006"><a href="#cb25-1006"></a><span class="op">-</span> Otherwise</span>
<span id="cb25-1007"><a href="#cb25-1007"></a>    <span class="op">-</span> Click <span class="st">"Run Configurations"</span><span class="op">,</span> to set the arguments</span>
<span id="cb25-1008"><a href="#cb25-1008"></a>    <span class="op">-</span> Go to <span class="st">"Arguments"</span> section<span class="op">,</span> and write the arguments<span class="op">.</span> <span class="fu">The</span> arguments are</span>
<span id="cb25-1009"><a href="#cb25-1009"></a>        <span class="op">-</span> the number of reducers<span class="op">:</span> `<span class="dv">2</span>`</span>
<span id="cb25-1010"><a href="#cb25-1010"></a>        <span class="op">-</span> <span class="fu">the</span> <span class="op">(</span>relative<span class="op">)</span> path of the input folder `example_data`</span>
<span id="cb25-1011"><a href="#cb25-1011"></a>        <span class="op">-</span> <span class="fu">the</span> <span class="op">(</span>relative<span class="op">)</span> path of the output folder `example_data_output`</span>
<span id="cb25-1012"><a href="#cb25-1012"></a></span>
<span id="cb25-1013"><a href="#cb25-1013"></a>```</span>
<span id="cb25-1014"><a href="#cb25-1014"></a><span class="dv">2</span> example_data example_data_output</span>
<span id="cb25-1015"><a href="#cb25-1015"></a>```</span>
<span id="cb25-1016"><a href="#cb25-1016"></a></span>
<span id="cb25-1017"><a href="#cb25-1017"></a>The output files are</span>
<span id="cb25-1018"><a href="#cb25-1018"></a></span>
<span id="cb25-1019"><a href="#cb25-1019"></a><span class="op">-</span> an empty file <span class="st">"_SUCCESS"</span><span class="op">,</span> <span class="cf">if</span> the application run successfully</span>
<span id="cb25-1020"><a href="#cb25-1020"></a><span class="op">-</span> one file <span class="cf">for</span> each reducer instance<span class="op">:</span> the intersection between the sets of words in each file is empty<span class="op">,</span> which means that all the same words were processed by the same Reducer<span class="op">.</span> <span class="fu">For</span> <span class="kw">this</span> reason the output is always a folder and not a single file<span class="op">.</span></span>
<span id="cb25-1021"><a href="#cb25-1021"></a></span>
<span id="cb25-1022"><a href="#cb25-1022"></a>### How to create a `<span class="op">.</span><span class="fu">jar</span>` file from the project</span>
<span id="cb25-1023"><a href="#cb25-1023"></a>Using Eclipse<span class="op">,</span> to create a `<span class="op">.</span><span class="fu">jar</span>` file from the project to run the project on the cluster</span>
<span id="cb25-1024"><a href="#cb25-1024"></a></span>
<span id="cb25-1025"><a href="#cb25-1025"></a><span class="op">-</span> Right click on the project <span class="fu">name</span> <span class="op">(</span>e<span class="op">.</span><span class="fu">g</span><span class="op">.,</span> <span class="st">"MapReduceProject"</span><span class="op">)</span></span>
<span id="cb25-1026"><a href="#cb25-1026"></a><span class="op">-</span> Click <span class="st">"Runs As"</span></span>
<span id="cb25-1027"><a href="#cb25-1027"></a><span class="op">-</span> Click <span class="st">"Maven build..."</span></span>
<span id="cb25-1028"><a href="#cb25-1028"></a><span class="op">-</span> In <span class="st">"Goals"</span> write <span class="st">"package"</span></span>
<span id="cb25-1029"><a href="#cb25-1029"></a><span class="op">-</span> Click <span class="st">"Run"</span></span>
<span id="cb25-1030"><a href="#cb25-1030"></a></span>
<span id="cb25-1031"><a href="#cb25-1031"></a>### How to run the `<span class="op">.</span><span class="fu">jar</span>` in the BigData<span class="at">@Polito</span> cluster</span>
<span id="cb25-1032"><a href="#cb25-1032"></a><span class="op">-</span> Go to <span class="op">[</span>https<span class="op">:</span><span class="co">//jupyter.polito.it/](https://jupyter.polito.it/) (i.e., the server gateway) and connect using the credentials</span></span>
<span id="cb25-1033"><a href="#cb25-1033"></a><span class="op">-</span> Copy the `<span class="op">.</span><span class="fu">jar</span>` file on server </span>
<span id="cb25-1034"><a href="#cb25-1034"></a><span class="op">-</span> Upload the input data in the HDFS</span>
<span id="cb25-1035"><a href="#cb25-1035"></a><span class="op">-</span> Use the terminal to run the `<span class="op">.</span><span class="fu">jar</span>`<span class="op">,</span> using the `hadoop` command</span>
<span id="cb25-1036"><a href="#cb25-1036"></a></span>
<span id="cb25-1037"><a href="#cb25-1037"></a>```bash</span>
<span id="cb25-1038"><a href="#cb25-1038"></a>hadoop jar Exercise1<span class="op">-</span><span class="fl">1.0.0</span><span class="op">.</span><span class="fu">jar</span> \</span>
<span id="cb25-1039"><a href="#cb25-1039"></a>it<span class="op">.</span><span class="fu">polito</span><span class="op">.</span><span class="fu">bigdata</span><span class="op">.</span><span class="fu">hadoop</span><span class="op">.</span><span class="fu">exercise1</span><span class="op">.</span><span class="fu">DriverBigData</span> \</span>
<span id="cb25-1040"><a href="#cb25-1040"></a><span class="dv">2</span> example_data example_data_output</span>
<span id="cb25-1041"><a href="#cb25-1041"></a>```</span>
<span id="cb25-1042"><a href="#cb25-1042"></a></span>
<span id="cb25-1043"><a href="#cb25-1043"></a>In <span class="kw">this</span> configuration there are <span class="dv">3</span> file systems</span>
<span id="cb25-1044"><a href="#cb25-1044"></a></span>
<span id="cb25-1045"><a href="#cb25-1045"></a><span class="op">-</span> The local file system on the personal PC</span>
<span id="cb25-1046"><a href="#cb25-1046"></a><span class="op">-</span> The local file system on the gateway server</span>
<span id="cb25-1047"><a href="#cb25-1047"></a><span class="op">-</span> The distributed file system on the Hadoop <span class="fu">cluster</span> <span class="op">(</span>the <span class="kw">interface</span> to manage it is https<span class="op">:</span><span class="co">//bigdatalab.polito.it/hue)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>