<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Distributed architectures for big data processing and analytics - 9&nbsp; MapReduce patterns - 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08_sql_operators_mapreduce.html" rel="next">
<link href="./06_mapreduce_advanced_topics.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07_mapreduce_patterns_2.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MapReduce patterns - 2</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Distributed architectures for big data processing and analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">About this Book</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Big data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_architectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Big data architectures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03b_HDFS_clc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">HDFS and Hadoop: command line commands</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_intro_hadoop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Hadoop and MapReduce</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_hadoop_implementation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How to write MapReduce programs in Hadoop</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_mapreduce_patterns_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">MapReduce patterns - 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_mapreduce_advanced_topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MapReduce and Hadoop Advanced Topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_mapreduce_patterns_2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MapReduce patterns - 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_sql_operators_mapreduce.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Relational Algebra Operations and MapReduce</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10b_spark_submit_execute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">How to submit/execute a Spark application</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_intro_spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_rdd_based_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">RDD based programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_rdd_keyvalue_pairs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">RDDs and key-value pairs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_rdd_numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">RDD of numbers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_cache_accumulators_broadcast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Cache, Accumulators, Broadcast Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15b_pagerank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Introduction to PageRank</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_sparksql_dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Spark SQL and DataFrames</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18a_spark_mllib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Spark MLlib</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18b_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Classification algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18c_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Clustering algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18d_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Regression algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18e_mining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Itemset and Association rule mining</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_graph_analytics_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Graph analytics in Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_graph_analytics_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Graph Analytics in Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_streaming_analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_structured_streaming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Spark structured streaming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_streaming_frameworks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-organization-patterns" id="toc-data-organization-patterns" class="nav-link active" data-scroll-target="#data-organization-patterns">Data organization patterns</a></li>
  <li><a href="#metapatterns" id="toc-metapatterns" class="nav-link" data-scroll-target="#metapatterns">Metapatterns</a></li>
  <li><a href="#join-patterns" id="toc-join-patterns" class="nav-link" data-scroll-target="#join-patterns">Join patterns</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MapReduce patterns - 2</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="data-organization-patterns" class="level3">
<h3 class="anchored" data-anchor-id="data-organization-patterns">Data organization patterns</h3>
<p>Data organization patterns are used to reorganize/split in subsets the input data</p>
<ul>
<li>Binning</li>
<li>Shuffling</li>
</ul>
<p>The output of an application based on an organization pattern is usually the input of another application(s)</p>
<section id="binning" class="level4">
<h4 class="anchored" data-anchor-id="binning">Binning</h4>
<p>The goal is to organize/move the input records into categories, to partition a big data set into distinct, smaller data sets (“bins”) containing similar records. Each partition is usually the input of a following analysis.</p>
<p>This is done because the input data set contains heterogonous data, but each data analysis usually is focused only on a specific subsets of the data.</p>
<section id="structure" class="level5">
<h5 class="anchored" data-anchor-id="structure">Structure</h5>
<p>Binning is based on a Map-only job</p>
<ul>
<li>Driver sets the list of “bins/output files” by means of <code>MultipleOutputs</code></li>
<li>Mappers select, for each input <code>(key, value)</code> pair, the output bin/file associated with it and emit a <code>(key,value)</code> in that file
<ul>
<li>key of the emitted pair is key of the input pair</li>
<li>value of the emitted pair is value of the input pair</li>
</ul></li>
<li>No Combiner or Reducer is used in this pattern</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Binning structure</figcaption>
<p><img src="images/07_mapreduce_patterns_2/binning_structure.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
</section>
<section id="shuffling" class="level4">
<h4 class="anchored" data-anchor-id="shuffling">Shuffling</h4>
<p>The goal is to randomize the order of the data (records), for anonymization reasons or for selecting a subset of random data (records).</p>
<section id="structure-1" class="level5">
<h5 class="anchored" data-anchor-id="structure-1">Structure</h5>
<ul>
<li>Mappers emit one <code>(key, value)</code> for each input record
<ul>
<li>key is a random key (i.e., a random number)</li>
<li>value is the input record</li>
</ul></li>
<li>Reducers emit one <code>(key, value)</code> pair for each value in <code>[list-of-values]</code> of the input <code>(key, [list-of-values])</code> pair</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Shuffling structure</figcaption>
<p><img src="images/07_mapreduce_patterns_2/shuffling_structure.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
</section>
</section>
<section id="metapatterns" class="level3">
<h3 class="anchored" data-anchor-id="metapatterns">Metapatterns</h3>
<p>Metapatterns are used to organize the workflow of a complex application executing many jobs</p>
<ul>
<li>Job Chaining</li>
</ul>
<section id="job-chaining" class="level4">
<h4 class="anchored" data-anchor-id="job-chaining">Job Chaining</h4>
<p>The goal is to execute a sequence of jobs (synchronizing them). Job chaining allows to manage the workflow of complex applications based on many phases (iterations). Each phase is associated with a different MapReduce Job (i.e., one sub-application), and the output of a phase is the input of the next one. This is done because real application are usually based on many phases.</p>
<section id="structure-2" class="level5">
<h5 class="anchored" data-anchor-id="structure-2">Structure</h5>
<ul>
<li>The (single) Driver contains the workflow of the application and executes the jobs in the proper order</li>
<li>Mappers, reducers, and combiners: each phase of the complex application is implement by a MapReduce Job (i.e., it is associated with a mapper, a reducer, and a combiner, if it is useful)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Job chaining structure</figcaption>
<p><img src="images/07_mapreduce_patterns_2/jobchaining_structure.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>More complex workflows, which execute jobs in parallel, can also be implemented, however, the synchronization of the jobs become more complex.</p>
</section>
</section>
</section>
<section id="join-patterns" class="level3">
<h3 class="anchored" data-anchor-id="join-patterns">Join patterns</h3>
<p>Are use to implement the join operators of the relational algebra (i.e., the join operators of traditional relational databases)</p>
<ul>
<li>Reduce side join</li>
<li>Map side join</li>
</ul>
<p>The explanation will focus on the natural join however, the pattern is analogous for the other types of joins (theta-, semi-, outer-join).</p>
<section id="reduce-side-natural-join" class="level4">
<h4 class="anchored" data-anchor-id="reduce-side-natural-join">Reduce side natural join</h4>
<p>The goal is to join the content of two relations (i.e., relational tables) when both tables are large.</p>
<section id="structure-3" class="level5">
<h5 class="anchored" data-anchor-id="structure-3">Structure</h5>
<p>There are two mapper classes, that is one mapper class for each table. Mappers emit one <code>(key, value)</code> pair for each input record</p>
<ul>
<li>Key is the value of the common attribute(s)</li>
<li>Value is the concatenation of the name of the table of the current record and the content of the current record</li>
</ul>
</section>
</section>
<section id="example-join-pattern" class="level4">
<h4 class="anchored" data-anchor-id="example-join-pattern">Example: join pattern</h4>
<p>Suppose join the following tables have to be joined</p>
<ul>
<li><strong><em>Users</em></strong> with schema <em>userid</em>, <em>name</em>, <em>surname</em></li>
<li><strong><em>Likes</em></strong> with schema <em>userid</em>, <em>movieGenre</em></li>
</ul>
<p>The values <code>userid=u1</code>, <code>name=Paolo</code>, <code>surname=Garza</code> of the <strong><em>Users</em></strong> table will generate the pair</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">(</span>userid<span class="op">=</span>u1<span class="op">,</span> <span class="st">"Users:name=Paolo, surname=Garza"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The values <code>userid=u1</code>, <code>movieGenre=horror</code> of the <strong><em>Likes</em></strong> table will generate the pair</p>
<pre><code>(userid=u1, "Likes:movieGenre=horror")</code></pre>
<p>The reducers iterate over the values associated with each key (value of the common attributes) and compute the “local natural join” for the current key. So, they generate a copy for each pair of values such that one record is a record of the first table and the other is the record of the other table.</p>
</section>
<section id="example" class="level4">
<h4 class="anchored" data-anchor-id="example">Example</h4>
<p>The <code>(key, [list of values])</code> pair</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">(</span>userid<span class="op">=</span>u1<span class="op">,</span> <span class="op">[</span><span class="st">"User:name=Paolo, surname=Garza"</span><span class="op">,</span> <span class="st">"Likes:movieGenre=horror"</span><span class="op">,</span> <span class="st">"Likes:movieGenre=adventure"</span><span class="op">])</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>will generate the following output <code>(key,value)</code> pairs</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1"></a><span class="op">(</span>userid<span class="op">=</span>u1<span class="op">,</span> <span class="st">"name=Paolo, surname=Garza, genre=horror"</span><span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="op">(</span>userid<span class="op">=</span>u1<span class="op">,</span> <span class="st">"name=Paolo, surname=Garza, genre=adventure"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Reduce side natural join structure</figcaption>
<p><img src="images/07_mapreduce_patterns_2/reducesidenaturaljoin_structure.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="map-side-natural-join" class="level4">
<h4 class="anchored" data-anchor-id="map-side-natural-join">Map side natural join</h4>
<p>The goal is to join the content of two relations (i.e., relational tables) when one table is large, while the other is small enough to be completely loaded in main memory (frequently one of the two tables is small).</p>
<section id="structure-4" class="level5">
<h5 class="anchored" data-anchor-id="structure-4">Structure</h5>
<p>This is a Map-only job</p>
<ul>
<li>Mapper class processes the content of the large table: it receives one input <code>(key,value)</code> pair for each record of the large table, and joins it with the “small” table.</li>
</ul>
<p>The distributed cache approach is used to “provide” a copy of the small table to all mappers: each mapper performs the “local natural join” between the current record (of the large table) it is processing and the records of the small table (that is in the distributed cache).</p>
<p>Notice that the content of the small table (file) is loaded in the main memory of each mapper during the execution of its setup method.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption class="figure-caption">Map side natural join structure</figcaption>
<p><img src="images/07_mapreduce_patterns_2/mapsidenaturaljoin_structure.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
</section>
<section id="other-join-patterns" class="level4">
<h4 class="anchored" data-anchor-id="other-join-patterns">Other join patterns</h4>
<p>The SQL language is characterized by many types of joins</p>
<ul>
<li>Theta-join</li>
<li>Semi-join</li>
<li>Outer-join</li>
</ul>
<p>The same patterns used for implementing the natural join can be used also for the other SQL joins.</p>
<p>The “local join” in the reducer of the reduce side natural join (in the mapper of the map side natural join) is replaced with the type of join of interest (theta-, semi-, or outer-join).</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06_mapreduce_advanced_topics.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MapReduce and Hadoop Advanced Topics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08_sql_operators_mapreduce.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Relational Algebra Operations and MapReduce</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb5" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu"># MapReduce patterns - 2</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">## Data organization patterns</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>Data organization patterns are used to reorganize/split in subsets the input data</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="ss">- </span>Binning</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="ss">- </span>Shuffling</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>The output of an application based on an organization pattern is usually the input of another application(s)</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="fu">### Binning</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>The goal is to organize/move the input records into categories, to partition a big data set into distinct, smaller data sets ("bins") containing similar records. Each partition is usually the input of a following analysis.</span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>This is done because the input data set contains heterogonous data, but each data analysis usually is focused only on a specific subsets of the data.</span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="fu">#### Structure</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>Binning is based on a Map-only job</span>
<span id="cb5-17"><a href="#cb5-17"></a></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="ss">- </span>Driver sets the list of "bins/output files" by means of <span class="in">`MultipleOutputs`</span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="ss">- </span>Mappers select, for each input <span class="in">`(key, value)`</span> pair, the output bin/file associated with it and emit a <span class="in">`(key,value)`</span> in that file</span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="ss">    - </span>key of the emitted pair is key of the input pair</span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="ss">    - </span>value of the emitted pair is value of the input pair</span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="ss">- </span>No Combiner or Reducer is used in this pattern</span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="al">![Binning structure](images/07_mapreduce_patterns_2/binning_structure.png)</span>{width=80%}</span>
<span id="cb5-25"><a href="#cb5-25"></a></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="fu">### Shuffling</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>The goal is to randomize the order of the data (records), for anonymization reasons or for selecting a subset of random data (records).</span>
<span id="cb5-28"><a href="#cb5-28"></a></span>
<span id="cb5-29"><a href="#cb5-29"></a><span class="fu">#### Structure</span></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="ss">- </span>Mappers emit one <span class="in">`(key, value)`</span> for each input record</span>
<span id="cb5-31"><a href="#cb5-31"></a><span class="ss">    - </span>key is a random key (i.e., a random number)</span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="ss">    - </span>value is the input record</span>
<span id="cb5-33"><a href="#cb5-33"></a><span class="ss">- </span>Reducers emit one <span class="in">`(key, value)`</span> pair for each value in <span class="in">`[list-of-values]`</span> of the input <span class="in">`(key, [list-of-values])`</span> pair</span>
<span id="cb5-34"><a href="#cb5-34"></a></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="al">![Shuffling structure](images/07_mapreduce_patterns_2/shuffling_structure.png)</span>{width=80%}</span>
<span id="cb5-36"><a href="#cb5-36"></a></span>
<span id="cb5-37"><a href="#cb5-37"></a><span class="fu">## Metapatterns</span></span>
<span id="cb5-38"><a href="#cb5-38"></a>Metapatterns are used to organize the workflow of a complex application executing many jobs</span>
<span id="cb5-39"><a href="#cb5-39"></a></span>
<span id="cb5-40"><a href="#cb5-40"></a><span class="ss">- </span>Job Chaining</span>
<span id="cb5-41"><a href="#cb5-41"></a></span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="fu">### Job Chaining</span></span>
<span id="cb5-43"><a href="#cb5-43"></a>The goal is to execute a sequence of jobs (synchronizing them). Job chaining allows to manage the workflow of complex applications based on many phases (iterations). Each phase is associated with a different MapReduce Job (i.e., one sub-application), and the output of a phase is the input of the next one. This is done because real application are usually based on many phases.</span>
<span id="cb5-44"><a href="#cb5-44"></a></span>
<span id="cb5-45"><a href="#cb5-45"></a><span class="fu">#### Structure</span></span>
<span id="cb5-46"><a href="#cb5-46"></a><span class="ss">- </span>The (single) Driver contains the workflow of the application and executes the jobs in the proper order</span>
<span id="cb5-47"><a href="#cb5-47"></a><span class="ss">- </span>Mappers, reducers, and combiners: each phase of the complex application is implement by a MapReduce Job (i.e., it is associated with a mapper, a reducer, and a combiner, if it is useful)</span>
<span id="cb5-48"><a href="#cb5-48"></a></span>
<span id="cb5-49"><a href="#cb5-49"></a><span class="al">![Job chaining structure](images/07_mapreduce_patterns_2/jobchaining_structure.png)</span>{width=80%}</span>
<span id="cb5-50"><a href="#cb5-50"></a></span>
<span id="cb5-51"><a href="#cb5-51"></a>More complex workflows, which execute jobs in parallel, can also be implemented, however, the synchronization of the jobs become more complex.</span>
<span id="cb5-52"><a href="#cb5-52"></a></span>
<span id="cb5-53"><a href="#cb5-53"></a><span class="fu">## Join patterns</span></span>
<span id="cb5-54"><a href="#cb5-54"></a>Are use to implement the join operators of the relational algebra (i.e., the join operators of traditional relational databases)</span>
<span id="cb5-55"><a href="#cb5-55"></a></span>
<span id="cb5-56"><a href="#cb5-56"></a><span class="ss">- </span>Reduce side join</span>
<span id="cb5-57"><a href="#cb5-57"></a><span class="ss">- </span>Map side join</span>
<span id="cb5-58"><a href="#cb5-58"></a></span>
<span id="cb5-59"><a href="#cb5-59"></a>The explanation will focus on the natural join however, the pattern is analogous for the other types of joins (theta-, semi-, outer-join).</span>
<span id="cb5-60"><a href="#cb5-60"></a></span>
<span id="cb5-61"><a href="#cb5-61"></a><span class="fu">### Reduce side natural join</span></span>
<span id="cb5-62"><a href="#cb5-62"></a>The goal is to join the content of two relations (i.e., relational tables) when both tables are large. </span>
<span id="cb5-63"><a href="#cb5-63"></a></span>
<span id="cb5-64"><a href="#cb5-64"></a><span class="fu">#### Structure</span></span>
<span id="cb5-65"><a href="#cb5-65"></a>There are two mapper classes, that is one mapper class for each table. Mappers emit one <span class="in">`(key, value)`</span> pair for each input record </span>
<span id="cb5-66"><a href="#cb5-66"></a></span>
<span id="cb5-67"><a href="#cb5-67"></a><span class="ss">- </span>Key is the value of the common attribute(s)</span>
<span id="cb5-68"><a href="#cb5-68"></a><span class="ss">- </span>Value is the concatenation of the name of the table of the current record and the content of the current record</span>
<span id="cb5-69"><a href="#cb5-69"></a></span>
<span id="cb5-70"><a href="#cb5-70"></a><span class="fu">### Example: join pattern</span></span>
<span id="cb5-71"><a href="#cb5-71"></a>Suppose join the following tables have to be joined</span>
<span id="cb5-72"><a href="#cb5-72"></a></span>
<span id="cb5-73"><a href="#cb5-73"></a><span class="ss">- </span>***Users*** with schema *userid*, *name*, *surname*</span>
<span id="cb5-74"><a href="#cb5-74"></a><span class="ss">- </span>***Likes*** with schema *userid*, *movieGenre*</span>
<span id="cb5-75"><a href="#cb5-75"></a></span>
<span id="cb5-76"><a href="#cb5-76"></a>The values <span class="in">`userid=u1`</span>, <span class="in">`name=Paolo`</span>, <span class="in">`surname=Garza`</span> of the ***Users*** table will generate the pair</span>
<span id="cb5-77"><a href="#cb5-77"></a></span>
<span id="cb5-78"><a href="#cb5-78"></a><span class="in">```java</span></span>
<span id="cb5-79"><a href="#cb5-79"></a><span class="op">(</span>userid<span class="op">=</span>u1<span class="op">,</span> <span class="st">"Users:name=Paolo, surname=Garza"</span><span class="op">)</span></span>
<span id="cb5-80"><a href="#cb5-80"></a><span class="in">```</span></span>
<span id="cb5-81"><a href="#cb5-81"></a></span>
<span id="cb5-82"><a href="#cb5-82"></a>The values <span class="in">`userid=u1`</span>, <span class="in">`movieGenre=horror`</span> of the ***Likes*** table will generate the pair</span>
<span id="cb5-83"><a href="#cb5-83"></a></span>
<span id="cb5-84"><a href="#cb5-84"></a><span class="in">```</span></span>
<span id="cb5-85"><a href="#cb5-85"></a><span class="in">(userid=u1, "Likes:movieGenre=horror")</span></span>
<span id="cb5-86"><a href="#cb5-86"></a><span class="in">```</span></span>
<span id="cb5-87"><a href="#cb5-87"></a></span>
<span id="cb5-88"><a href="#cb5-88"></a>The reducers iterate over the values associated with each key (value of the common attributes) and compute the "local natural join" for the current key. So, they generate a copy for each pair of values such that one record is a record of the first table and the other is the record of the other table.</span>
<span id="cb5-89"><a href="#cb5-89"></a></span>
<span id="cb5-90"><a href="#cb5-90"></a><span class="fu">### Example</span></span>
<span id="cb5-91"><a href="#cb5-91"></a>The <span class="in">`(key, [list of values])`</span> pair</span>
<span id="cb5-92"><a href="#cb5-92"></a></span>
<span id="cb5-93"><a href="#cb5-93"></a><span class="in">```java</span></span>
<span id="cb5-94"><a href="#cb5-94"></a><span class="op">(</span>userid<span class="op">=</span>u1<span class="op">,</span> <span class="op">[</span><span class="st">"User:name=Paolo, surname=Garza"</span><span class="op">,</span> <span class="st">"Likes:movieGenre=horror"</span><span class="op">,</span> <span class="st">"Likes:movieGenre=adventure"</span><span class="op">])</span> </span>
<span id="cb5-95"><a href="#cb5-95"></a><span class="in">```</span></span>
<span id="cb5-96"><a href="#cb5-96"></a></span>
<span id="cb5-97"><a href="#cb5-97"></a>will generate the following output <span class="in">`(key,value)`</span> pairs</span>
<span id="cb5-98"><a href="#cb5-98"></a></span>
<span id="cb5-99"><a href="#cb5-99"></a><span class="in">```java</span></span>
<span id="cb5-100"><a href="#cb5-100"></a><span class="op">(</span>userid<span class="op">=</span>u1<span class="op">,</span> <span class="st">"name=Paolo, surname=Garza, genre=horror"</span><span class="op">)</span></span>
<span id="cb5-101"><a href="#cb5-101"></a></span>
<span id="cb5-102"><a href="#cb5-102"></a><span class="op">(</span>userid<span class="op">=</span>u1<span class="op">,</span> <span class="st">"name=Paolo, surname=Garza, genre=adventure"</span><span class="op">)</span></span>
<span id="cb5-103"><a href="#cb5-103"></a><span class="in">```</span></span>
<span id="cb5-104"><a href="#cb5-104"></a></span>
<span id="cb5-105"><a href="#cb5-105"></a><span class="al">![Reduce side natural join structure](images/07_mapreduce_patterns_2/reducesidenaturaljoin_structure.png)</span>{width=80%}</span>
<span id="cb5-106"><a href="#cb5-106"></a></span>
<span id="cb5-107"><a href="#cb5-107"></a><span class="fu">### Map side natural join</span></span>
<span id="cb5-108"><a href="#cb5-108"></a>The goal is to join the content of two relations (i.e., relational tables) when one table is large, while the other is small enough to be completely loaded in main memory (frequently one of the two tables is small).</span>
<span id="cb5-109"><a href="#cb5-109"></a></span>
<span id="cb5-110"><a href="#cb5-110"></a><span class="fu">#### Structure</span></span>
<span id="cb5-111"><a href="#cb5-111"></a>This is a Map-only job</span>
<span id="cb5-112"><a href="#cb5-112"></a></span>
<span id="cb5-113"><a href="#cb5-113"></a><span class="ss">- </span>Mapper class processes the content of the large table: it receives one input <span class="in">`(key,value)`</span> pair for each record of the large table, and joins it with the "small" table.</span>
<span id="cb5-114"><a href="#cb5-114"></a></span>
<span id="cb5-115"><a href="#cb5-115"></a>The distributed cache approach is used to "provide" a copy of the small table to all mappers: each mapper performs the "local natural join" between the current record (of the large table) it is processing and the records of the small table (that is in the distributed cache).</span>
<span id="cb5-116"><a href="#cb5-116"></a></span>
<span id="cb5-117"><a href="#cb5-117"></a>Notice that the content of the small table (file) is loaded in the main memory of each mapper during the execution of its setup method.</span>
<span id="cb5-118"><a href="#cb5-118"></a></span>
<span id="cb5-119"><a href="#cb5-119"></a><span class="al">![Map side natural join structure](images/07_mapreduce_patterns_2/mapsidenaturaljoin_structure.png)</span>{width=80%}</span>
<span id="cb5-120"><a href="#cb5-120"></a></span>
<span id="cb5-121"><a href="#cb5-121"></a><span class="fu">### Other join patterns</span></span>
<span id="cb5-122"><a href="#cb5-122"></a>The SQL language is characterized by many types of joins</span>
<span id="cb5-123"><a href="#cb5-123"></a></span>
<span id="cb5-124"><a href="#cb5-124"></a><span class="ss">- </span>Theta-join</span>
<span id="cb5-125"><a href="#cb5-125"></a><span class="ss">- </span>Semi-join</span>
<span id="cb5-126"><a href="#cb5-126"></a><span class="ss">- </span>Outer-join</span>
<span id="cb5-127"><a href="#cb5-127"></a></span>
<span id="cb5-128"><a href="#cb5-128"></a>The same patterns used for implementing the natural join can be used also for the other SQL joins.</span>
<span id="cb5-129"><a href="#cb5-129"></a></span>
<span id="cb5-130"><a href="#cb5-130"></a>The "local join" in the reducer of the reduce side natural join (in the mapper of the map side natural join) is replaced with the type of join of interest (theta-, semi-, or outer-join).</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>