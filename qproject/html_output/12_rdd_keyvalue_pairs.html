<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Distributed architectures for big data processing and analytics - 14&nbsp; RDDs and key-value pairs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13_rdd_numbers.html" rel="next">
<link href="./11_rdd_based_programming.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12_rdd_keyvalue_pairs.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">RDDs and key-value pairs</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Distributed architectures for big data processing and analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">About this Book</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Big data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_architectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Big data architectures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03b_HDFS_clc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">HDFS and Hadoop: command line commands</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_intro_hadoop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Hadoop and MapReduce</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_hadoop_implementation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How to write MapReduce programs in Hadoop</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_mapreduce_patterns_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">MapReduce patterns - 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_mapreduce_advanced_topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MapReduce and Hadoop Advanced Topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_mapreduce_patterns_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MapReduce patterns - 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_sql_operators_mapreduce.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Relational Algebra Operations and MapReduce</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10b_spark_submit_execute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">How to submit/execute a Spark application</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_intro_spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_rdd_based_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">RDD based programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_rdd_keyvalue_pairs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">RDDs and key-value pairs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_rdd_numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">RDD of numbers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_cache_accumulators_broadcast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Cache, Accumulators, Broadcast Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15b_pagerank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Introduction to PageRank</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_sparksql_dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Spark SQL and DataFrames</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18a_spark_mllib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Spark MLlib</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18b_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Classification algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18c_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Clustering algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18d_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Regression algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18e_mining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Itemset and Association rule mining</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_graph_analytics_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Graph analytics in Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_graph_analytics_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Graph Analytics in Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_streaming_analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_structured_streaming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Spark structured streaming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_streaming_frameworks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Streaming data analytics frameworks</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#creating-rdds-of-key-value-pairs" id="toc-creating-rdds-of-key-value-pairs" class="nav-link active" data-scroll-target="#creating-rdds-of-key-value-pairs">Creating RDDs of key-value pairs</a></li>
  <li><a href="#rdds-of-key-value-pairs-by-using-the-map-transformation" id="toc-rdds-of-key-value-pairs-by-using-the-map-transformation" class="nav-link" data-scroll-target="#rdds-of-key-value-pairs-by-using-the-map-transformation">RDDs of key-value pairs by using the Map transformation</a></li>
  <li><a href="#rdds-of-key-value-pairs-by-using-the-flatmap-transformation" id="toc-rdds-of-key-value-pairs-by-using-the-flatmap-transformation" class="nav-link" data-scroll-target="#rdds-of-key-value-pairs-by-using-the-flatmap-transformation">RDDs of key-value pairs by using the flatMap transformation</a></li>
  <li><a href="#rdds-of-key-value-pairs-by-using-parallelize" id="toc-rdds-of-key-value-pairs-by-using-parallelize" class="nav-link" data-scroll-target="#rdds-of-key-value-pairs-by-using-parallelize">RDDs of key-value pairs by using parallelize</a></li>
  <li><a href="#transformations-on-rdds-of-key-value-pairs" id="toc-transformations-on-rdds-of-key-value-pairs" class="nav-link" data-scroll-target="#transformations-on-rdds-of-key-value-pairs">Transformations on RDDs of key-value pairs</a></li>
  <li><a href="#rdd-based-programming" id="toc-rdd-based-programming" class="nav-link" data-scroll-target="#rdd-based-programming">RDD-based programming</a></li>
  <li><a href="#actions-on-rdds-of-key-value-pairs" id="toc-actions-on-rdds-of-key-value-pairs" class="nav-link" data-scroll-target="#actions-on-rdds-of-key-value-pairs">Actions on RDDs of key-value pairs</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">RDDs and key-value pairs</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Spark supports also RDDs of key-value pairs. Key-value pairs in python are represented by means of python tuples:</p>
<ul>
<li>The first value is the key part of the pair</li>
<li>The second value is the value part of the pair</li>
</ul>
<p>RDDs of key-value pairs are sometimes called “pair RDDs”.</p>
<p>RDDs of key-value pairs are characterized by</p>
<ul>
<li>specific operations (e.g., <code>reduceByKey()</code>, <code>join()</code>), which analyze the content of one group (key) at a time;</li>
<li>operations available for the standard RDDs (e.g., <code>filter()</code>, <code>map()</code>, <code>reduce()</code>).</li>
</ul>
<p>Many applications are based on RDDs of key-value pairs: the operations available for RDDs of key-value pairs allow grouping data by key and performing computation by key (i.e., by group). The basic idea is similar to the one of the MapReduce-based programs in Hadoop, but there are more operations already available.</p>
<section id="creating-rdds-of-key-value-pairs" class="level3">
<h3 class="anchored" data-anchor-id="creating-rdds-of-key-value-pairs">Creating RDDs of key-value pairs</h3>
<p>RDDs of key-value pairs can be built</p>
<ul>
<li>From other RDDs by applying the <code>map()</code> or the <code>flatMap()</code> transformation on other RDDs;</li>
<li>From a Python in-memory collection of tuple (key-value pairs) by using the <code>parallelize()</code> method of the <code>SparkContext</code> class.</li>
</ul>
<p>Key-value pairs are represented as standard built-in Python tuples composed of two elements</p>
<ul>
<li>Key</li>
<li>Value</li>
</ul>
</section>
<section id="rdds-of-key-value-pairs-by-using-the-map-transformation" class="level3">
<h3 class="anchored" data-anchor-id="rdds-of-key-value-pairs-by-using-the-map-transformation">RDDs of key-value pairs by using the Map transformation</h3>
<p>The goal is to define an RDD of key-value pairs by using the map transformation: apply a function <code>f</code> on each element of the input RDD that returns one tuple for each input element. The new RDD of key-value pairs contains one tuple <code>y</code> for each element <code>x</code> of the input RDD.</p>
<p>The standard <code>map(f)</code> transformation is used, and the new RDD of key-value pairs contains one tuple <code>y</code> for each input element <code>x</code> of the input RDD (<span class="math inline">\(y=f(x)\)</span>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Create an RDD from a textual file containing the first names of a list of users; each line of the file contains one first name;</li>
<li>Create an RDD of key-value pairs containing a list of pairs <code>(first name, 1)</code>.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>namesRDD <span class="op">=</span> sc.textFile(<span class="st">"first_names.txt"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">## Create an RDD of key-value pairs</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>nameOnePairRDD <span class="op">=</span> namesRDD.<span class="bu">map</span>(<span class="kw">lambda</span> name: (name, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>nameOnePairRDD</code></td>
<td>It contains key-value pairs (i.e., tuples) of type (string, integer)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="rdds-of-key-value-pairs-by-using-the-flatmap-transformation" class="level3">
<h3 class="anchored" data-anchor-id="rdds-of-key-value-pairs-by-using-the-flatmap-transformation">RDDs of key-value pairs by using the flatMap transformation</h3>
<p>Define an RDD of key-value pairs by using the flatMap transformation: apply a function <code>f</code> on each element of the input RDD that returns a list of tuples for each input element. The new PairRDD contains all the pairs obtained by applying <code>f</code> on each element <code>x</code> of the input RDD.</p>
<p>The standard <code>flatMap(f)</code> transformation is used, and the new RDD of key-value pairs contains the tuples returned by the execution of <code>f</code> on each element <code>x</code> of the input RDD.</p>
<p><span class="math display">\[
[y]= f(x)
\]</span></p>
<ul>
<li>Given a element <span class="math inline">\(x\)</span> of the input RDD, <span class="math inline">\(f\)</span> applied on <span class="math inline">\(x\)</span> returns a list of pairs <span class="math inline">\([y]\)</span>;</li>
<li>The new RDD is a list of pairs contains all the pairs of the returned list of pairs. It is not an RDD of lists.</li>
</ul>
<p><span class="math inline">\([y]\)</span> can be the empty list.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a textual file; each line of the file contains a set of words;</li>
<li>Create a <code>PairRDD</code> containing a list of pairs <code>(word, 1)</code>: one pair for each word occurring in the input document (with repetitions).</li>
</ol>
<p><strong>Version 1</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">## Define the function associated with the flatMap transformation</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">def</span> wordsOnes(line):</span>
<span id="cb2-3"><a href="#cb2-3"></a>    pairs <span class="op">=</span> []</span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="cf">for</span> word <span class="kw">in</span> line.split(<span class="st">' '</span>):</span>
<span id="cb2-5"><a href="#cb2-5"></a>        pairs.append( (word, <span class="dv">1</span>))</span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="cf">return</span> pairs</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>linesRDD <span class="op">=</span> sc.textFile(<span class="st">"document.txt"</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">## Create an RDD of key-value pairs based on the input document</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">## One pair (word,1) for each input word</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>wordOnePairRDD <span class="op">=</span> linesRDD.flatMap(wordsOnes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Version 2</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>linesRDD <span class="op">=</span> sc.textFile(<span class="st">"document.txt"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">## Create an RDD of key-value pairs based on the input document</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">## One pair (word,1) for each input word</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>wordOnePairRDD <span class="op">=</span> linesRDD.flatMap(</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="kw">lambda</span> line: <span class="bu">map</span>(<span class="kw">lambda</span> w: (w, <span class="dv">1</span>), line.split(<span class="st">' '</span>))</span>
<span id="cb3-8"><a href="#cb3-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>map(lambda w: (w, 1), line.split(' '))</code></td>
<td>This is the map of python. It is not the Spark’s map transformation.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="rdds-of-key-value-pairs-by-using-parallelize" class="level3">
<h3 class="anchored" data-anchor-id="rdds-of-key-value-pairs-by-using-parallelize">RDDs of key-value pairs by using parallelize</h3>
<p>Use the parallelize method to create an RDD of key-value pairs from a local python in-memory collection of tuples.</p>
<p>It is based on the standard <code>parallelize(c)</code> method of the <code>SparkContext</code> class: each element (tuple) of the local python collection becomes a key-vaue pair of the returned RDD.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create an RDD from a local python list containing the following key-value pairs</p>
<ul>
<li><code>("Paolo", 40)</code></li>
<li><code>("Giorgio", 22)</code></li>
<li><code>("Paolo", 35)</code></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>nameAge <span class="op">=</span> [</span>
<span id="cb4-3"><a href="#cb4-3"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb4-4"><a href="#cb4-4"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb4-5"><a href="#cb4-5"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>]</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>nameAge</code></td>
<td>This is a local in-memory python list of key-value pairs (tuples), that is stored in the main memory of the Driver.</td>
</tr>
<tr class="even">
<td><code>nameAgePairRDD</code></td>
<td>This is an RDD or key-value pairs based on the content of the local in-memory python list. The RDD is stored in the “distributed” main memory of the cluster servers</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="transformations-on-rdds-of-key-value-pairs" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="transformations-on-rdds-of-key-value-pairs">Transformations on RDDs of key-value pairs</h3>
<p>All the standard transformations can be applied, where the specified functions operate on tuples, but also specific transformations are available (e.g., <code>reduceByKey()</code>, <code>groupyKey()</code>, <code>mapValues()</code>, <code>join()</code>).</p>
<section id="reducebykey-transformation" class="level4">
<h4 class="anchored" data-anchor-id="reducebykey-transformation">ReduceByKey transformation</h4>
<p>The goal is to create a new RDD of key-value pairs where there is one pair for each distinct key <code>k</code> of the input RDD of key-value pairs:</p>
<ul>
<li>The value associated with key <code>k</code> in the new RDD of key-value pairs is computed by applying a function <code>f</code> on the values associated with <code>k</code> in the input RDD of key-value pairs; the function <code>f</code> must be associative and commutative, otherwise the result depends on how data are partitioned and analyzed;</li>
<li>The data type of the new RDD of key-value pairs is the same of the input RDD of key-value pairs.</li>
</ul>
<p>The reduceByKey transformation is based on the <code>reduceByKey(f)</code> method of the <code>RDD</code> class. A function <code>f</code> is passed to the reduceByKey method</p>
<ul>
<li>Given the values of two input pairs, <code>f</code> is used to combine them in one single value;</li>
<li><code>f</code> is recursively invoked over the values of the pairs associated with one key at a time until the input values associated with one key are reduced to one single value.</li>
</ul>
<p>The retuned RDD contains a number of key-value pairs equal to the number of distinct keys in the input key-value pair RDD.</p>
<p>Similarly to the <code>reduce()</code> action, the <code>reduceByKey()</code> transformation aggregate values, however <code>reduceByKey()</code> is executed on RDDs of key-value pairs and returns a set of key-value pairs, while <code>reduce()</code> is executed on an RDD and returns one single value (stored in a local python variable). Moreover, <code>reduceByKey()</code> is a transformation, and so it is executed lazily and its result is stored in another RDD, whereas <code>reduce()</code> is an action.</p>
<p>A shuffle operation is executed for computing the result of the <code>reduceByKey()</code> transformation. The result/value for each group/key is computed from data stored in different input partitions.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the pairs, where the key is the first name of a user and the value is his/her age
<ul>
<li><code>("Paolo", 40)</code></li>
<li><code>("Giorgio", 22)</code></li>
<li><code>("Paolo", 35)</code></li>
</ul></li>
<li>Create a new RDD of key-value pairs containing one pair for each name. In the returned RDD, associate each name with the age of the youngest user with that name.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>nameAge <span class="op">=</span> [</span>
<span id="cb5-3"><a href="#cb5-3"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb5-4"><a href="#cb5-4"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb5-5"><a href="#cb5-5"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a>]</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">## Select for each name the lowest age value</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>youngestPairRDD<span class="op">=</span> nameAgePairRDD.reduceByKey(<span class="kw">lambda</span> age1, age2: <span class="bu">min</span>(age1, age2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>youngestPairRDD</code></td>
<td>The returned RDD of key-value pairs contains one pair for each distinct input key (i.e., for each distinct name in this example)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="foldbykey-transformation" class="level4">
<h4 class="anchored" data-anchor-id="foldbykey-transformation">FoldByKey transformation</h4>
<p>The <code>foldByKey()</code> has the same goal of the <code>reduceBykey()</code> transformation, however</p>
<ul>
<li>It is characterized also by a “zero” value</li>
<li>Functions must be associative but are not required to be commutative</li>
</ul>
<p>The foldByKey transformation is based on the <code>foldByKey(zeroValue, op)</code> method of the <code>RDD</code> class. A function <code>op</code> is passed to the fold method:</p>
<ul>
<li>Given values of two input pairs, <code>op</code> is used to combine them in one single value</li>
<li><code>op</code> is also used to combine input values with the “zero” value</li>
<li><code>op</code> is recursively invoked over the values of the pairs associated with one key at a time until the input values are reduced to one single value</li>
</ul>
<p>The “zero” value is the neutral value for the used function <code>op</code> (i.e., “zero” combined with any value <span class="math inline">\(v\)</span> by using <code>op</code> is equal to <span class="math inline">\(v\)</span>).</p>
<p>A shuffle operation is executed for computing the result of the <code>foldByKey()</code> transformation. The result/value for each group/key is computed from data stored in different input partitions.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the pairs, where the key is the first name of a user and the value is a message published by him/her
<ul>
<li><code>("Paolo", "Message1")</code></li>
<li><code>("Giorgio", "Message2")</code></li>
<li><code>("Paolo", "Message3")</code></li>
</ul></li>
<li>Create a new RDD of key-value pairs containing one pair for each name. In the returned RDD, associate each name the concatenation of its messages (preserving the order of the messages in the input RDD).</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>nameMess <span class="op">=</span> [</span>
<span id="cb6-3"><a href="#cb6-3"></a>    (<span class="st">"Paolo"</span>,<span class="st">"Message1"</span>),</span>
<span id="cb6-4"><a href="#cb6-4"></a>    (<span class="st">"Giorgio"</span>,<span class="st">"Message2"</span>),</span>
<span id="cb6-5"><a href="#cb6-5"></a>    (<span class="st">"Paolo"</span>,<span class="st">"Message3"</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a>]</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>nameMessPairRDD <span class="op">=</span> sc.parallelize(nameMess)</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">## Concatenate the messages of each user</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>concatPairRDD<span class="op">=</span> nameMessPairRDD.foldByKey(<span class="st">''</span>, <span class="kw">lambda</span> m1, m2: m1<span class="op">+</span>m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="combinebykey-transformation" class="level4">
<h4 class="anchored" data-anchor-id="combinebykey-transformation">CombineByKey transformation</h4>
<p>The goal is to create a new RDD of key-value pairs where there is one pair for each distinct key <span class="math inline">\(k\)</span> of the input RDD of key-value pairs. The value associated with the key <span class="math inline">\(k\)</span> in the new RDD of key-value pairs is computed by applying user-provided functions on the values associated with <span class="math inline">\(k\)</span> in the input RDD of key-value pairs: the user-provided function must be associative, otherwise the result depends how data are partitioned and analyzed.</p>
<p>The data type of the new RDD of key-value pairs can be different with respect to the data type of the input RDD of key-value pairs.</p>
<p>The combineByKey transformation is based on the <code>combineByKey(createCombiner, mergeValue, mergeCombiner)</code> method of the <code>RDD</code> class</p>
<ul>
<li>The values of the input RDD of pairs are of type <span class="math inline">\(V\)</span></li>
<li>The values of the returned RDD of pairs are of type <span class="math inline">\(U\)</span></li>
<li>The type of the keys is <span class="math inline">\(K\)</span> for both RDDs of pairs</li>
</ul>
<p>The <code>createCombiner</code> function contains the code that is used to transform a single value (type <span class="math inline">\(V\)</span>) of the input RDD of key-value pairs into a value of the data type (type <span class="math inline">\(U\)</span>) of the output RDD of key-value pairs. It is used to transform the first value of each key in each partition to a value of type <span class="math inline">\(U\)</span>.</p>
<p>The <code>mergeValue</code> function contains the code that is used to combine one value of type <span class="math inline">\(U\)</span> with one value of type <span class="math inline">\(V\)</span>: it is used in each partition to combine the initial values (type <span class="math inline">\(V\)</span>) of each key with the intermediate ones (type <span class="math inline">\(U\)</span>) of each key.</p>
<p>The <code>mergeCombiner</code> function contains the code that is used to combine two values of type <span class="math inline">\(U\)</span>: it is used to combine intermediate values of each key returned by the analysis of different partitions.</p>
<p>The <code>combineByKey</code> function is more general than <code>reduceByKey</code> and <code>foldByKey</code> because the data types of the values of the input and the returned RDD of pairs can be different; for this reason, more functions must be implemented in this case.</p>
<p>A shuffle operation is executed for computing the result of the <code>combineByKey()</code> transformation: the result/value for each group/key is computed from data stored in different input partitions.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the the following pairs: the key is the first name of a user and the value is his/her age
<ul>
<li><code>("Paolo", 40)</code></li>
<li><code>("Giorgio", 22)</code></li>
<li><code>("Paolo", 35)</code></li>
</ul></li>
<li>Store the results in an output HDFS folder. The output contains one line for each name followed by the average age of the users with that name</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>nameAge <span class="op">=</span> [</span>
<span id="cb7-3"><a href="#cb7-3"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb7-4"><a href="#cb7-4"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb7-5"><a href="#cb7-5"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a>]</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">## Compute the sum of ages and</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">## the number of input pairs for each name (key)</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>sumNumPerNamePairRDD <span class="op">=</span> nameAgePairRDD.combineByKey(</span>
<span id="cb7-14"><a href="#cb7-14"></a>    <span class="kw">lambda</span> inputElem: (inputElem, <span class="dv">1</span>),</span>
<span id="cb7-15"><a href="#cb7-15"></a>    <span class="kw">lambda</span> intermediateElem, inputElem: (</span>
<span id="cb7-16"><a href="#cb7-16"></a>        intermediateElem[<span class="dv">0</span>]<span class="op">+</span>inputElem, </span>
<span id="cb7-17"><a href="#cb7-17"></a>        intermediateElem[<span class="dv">1</span>]<span class="op">+</span><span class="dv">1</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>    ),</span>
<span id="cb7-19"><a href="#cb7-19"></a>    <span class="kw">lambda</span> intermediateElem1, intermediateElem2: (</span>
<span id="cb7-20"><a href="#cb7-20"></a>        intermediateElem1[<span class="dv">0</span>]<span class="op">+</span>intermediateElem2[<span class="dv">0</span>], </span>
<span id="cb7-21"><a href="#cb7-21"></a>        intermediateElem1[<span class="dv">1</span>]<span class="op">+</span>intermediateElem2[<span class="dv">1</span>]</span>
<span id="cb7-22"><a href="#cb7-22"></a>    )</span>
<span id="cb7-23"><a href="#cb7-23"></a>)</span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">## Compute the average for each name</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>avgPerNamePairRDD <span class="op">=</span> sumNumPerNamePairRDD.<span class="bu">map</span>(</span>
<span id="cb7-27"><a href="#cb7-27"></a>    <span class="kw">lambda</span> pair: (pair[<span class="dv">0</span>], pair[<span class="dv">1</span>][<span class="dv">0</span>]<span class="op">/</span>pair[<span class="dv">1</span>][<span class="dv">1</span>])</span>
<span id="cb7-28"><a href="#cb7-28"></a>)</span>
<span id="cb7-29"><a href="#cb7-29"></a></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb7-31"><a href="#cb7-31"></a>avgPerNamePairRDD.saveAsTextFile(outputPath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>lambda inputElem:</code></td>
<td>Given an input value (an age), it returns a tuple containing (age,1)</td>
</tr>
<tr class="even">
<td><code>lambda intermediateElem, inputElem:</code></td>
<td>Given an input value (an age) and an intermediate value (<em>sum ages</em>, <em>num represented values</em>), it combines them and returns a new updated tuple (<em>sum ages</em>, <em>num represented values</em>)</td>
</tr>
<tr class="odd">
<td><code>lambda intermediateElem1, intermediateElem2:</code></td>
<td>Given two intermediate result tuples (<em>sum ages</em>, <em>num represented values</em>), it combines them and returns a new updated tuple (<em>sum ages</em>, <em>num represented values</em>)</td>
</tr>
<tr class="even">
<td><code>lambda pair:</code></td>
<td>Compute the average age for each key (i.e., for each name) by combining <em>sum ages</em> and <em>num represented values</em>. Each input pair is characterized by a value that is a tuple containing (<em>sum ages</em>, <em>num represented values</em>).</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="groupbykey-transformation" class="level4">
<h4 class="anchored" data-anchor-id="groupbykey-transformation">GroupByKey transformation</h4>
<p>The goal is to create a new RDD of key-value pairs where there is one pair for each distinct key <span class="math inline">\(k\)</span> of the input RDD of key-value pairs: the value associated with key <span class="math inline">\(k\)</span> in the new RDD of key-value pairs is the list of values associated with <span class="math inline">\(k\)</span> in the input RDD of key-value pairs.</p>
<p>The groupByKey transformation is based on the <code>groupByKey()</code> method of the <code>RDD</code> class.</p>
<p>If grouping values per key to perform then an aggregation such as sum or average over the values of each key then groupByKey is not the right choice: <code>reduceByKey</code>, <code>aggregateByKey</code>, or <code>combineByKey</code> provide better performances for associative and commutative aggregations; <code>groupByKey</code> is useful if an aggregation or compute a function that is not associative must be applied.</p>
<p>A shuffle operation is executed for computing the result of the <code>groupByKey()</code> transformation: each group/key is associated with/is composed of values which are stored in different partitions of the input RDD.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the following pairs: the key is the first name of a user and the value is his/her age.
<ul>
<li><code>("Paolo", 40)</code></li>
<li><code>("Giorgio", 22)</code></li>
<li><code>("Paolo", 35)</code></li>
</ul></li>
<li>Store the results in an output HDFS folder. The output contains one line for each name followed by the ages of all the users with that name.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>nameAge <span class="op">=</span> [</span>
<span id="cb8-3"><a href="#cb8-3"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb8-4"><a href="#cb8-4"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb8-5"><a href="#cb8-5"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb8-6"><a href="#cb8-6"></a>]</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">## Create one group for each name with the list of associated ages</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>agesPerNamePairRDD <span class="op">=</span> nameAgePairRDD.groupByKey()</span>
<span id="cb8-13"><a href="#cb8-13"></a></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>agesPerNamePairRDD<span class="op">\</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>    .mapValues(<span class="kw">lambda</span> listValues: <span class="bu">list</span>(listValues))<span class="op">\</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>    .saveAsTextFile(outputPath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>agesPerNamePairRDD</code></td>
<td>In this RDD of key-value pairs each tuple is composed of a string (key of the pair) and a collection of integers (the value of the pair - a <code>ResultIterable</code> object)</td>
</tr>
<tr class="even">
<td><code>.mapValues(lambda listValues: list(listValues))</code></td>
<td>This part is used to format the content of the value part of each pair before storing the result in the output folder: this transforms a <code>ResultIterable</code> object to a Python list. Without this map the output will contain the pointers to <code>ResultIterable</code> objects instead of a readable list of integer values</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="mapvalues-transformation" class="level4">
<h4 class="anchored" data-anchor-id="mapvalues-transformation">MapValues transformation</h4>
<p>The goal is to apply a function <span class="math inline">\(f\)</span> over the value of each pair of an input RDD or key-value pairs and return a new RDD of key-value pairs: one pair is created in the returned RDD for each input pair</p>
<ul>
<li>The key of the created pair is equal to the key of the input pair</li>
<li>The value of the created pair is obtained by applying the function <span class="math inline">\(f\)</span> on the value of the input pair</li>
</ul>
<p>The data type of the values of the new RDD of key-value pairs can be different from the data type of the values of the input RDD of key-value pairs. The data type of the key is the same.</p>
<p>The mapValues transformation is based on the <code>mapValues(f)</code> method of the <code>RDD</code> class: a function <code>f</code> is passed to the mapValues method, where <code>f</code> contains the code that is applied to transform each input value into the a new value that is stored in the RDD of key-value pairs. The retuned RDD of pairs contains a number of key-value pairs equal to the number of key-value pairs of the input RDD of pairs (the key part is not changed).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the following pairs: the key is the first name of a user and the value is his/her age.
<ul>
<li><code>("Paolo", 40)</code></li>
<li><code>("Giorgio", 22)</code></li>
<li><code>("Paolo", 35)</code></li>
</ul></li>
<li>Increase the age of each user (+1 year) and store the result in the HDFS file system, one output line per user.</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>nameAge <span class="op">=</span> [</span>
<span id="cb9-3"><a href="#cb9-3"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb9-4"><a href="#cb9-4"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb9-5"><a href="#cb9-5"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a>]</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">## Increment age of all users</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>plusOnePairRDD <span class="op">=</span> nameAgePairRDD.mapValues(<span class="kw">lambda</span> age: age<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb9-13"><a href="#cb9-13"></a></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">## Save the result on disk</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>plusOnePairRDD.saveAsTextFile(outputPath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="flatmapvalues-transformation" class="level4">
<h4 class="anchored" data-anchor-id="flatmapvalues-transformation">FlatMapValues transformation</h4>
<p>The goal is to apply a function <span class="math inline">\(f\)</span> over the value of each pair of an input RDD or key-value pairs and return a new RDD of key-value pairs (<span class="math inline">\(f\)</span> returns a list of values for each input value). A list of pairs is inserted in the returned RDD for each input pair</p>
<ul>
<li>The key of the created pairs is equal to the key of the input pair</li>
<li>The values of the created pairs are obtained by applying the function <span class="math inline">\(f\)</span> on the value of the input pair</li>
</ul>
<p>The data type of the values of the new RDD of key-value pairs can be different from the data type of the values of the input RDD of key-value pairs. The data type of the key is the same.</p>
<p>The flatMapValues transformation is based on <code>flatMapValues(f)</code> method of the <code>RDD</code> class: a function <code>f</code> is passed to the <code>mapValues</code> method, where <code>f</code> contains the code that is applied to transform each input value into a set of new values that are stored in the new RDD of key-value pairs. The keys of the input pairs are not changed.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the pairs
<ul>
<li><code>("Sentence#1", "Sentence test")</code></li>
<li><code>("Sentence#2", "Sentence test number 2")</code></li>
<li><code>("Sentence#3", "Sentence test number 3")</code></li>
</ul></li>
<li>Select the words of each sentence and store in the HDFS file system one pair (senteceId, word) per line.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>sentences <span class="op">=</span> [</span>
<span id="cb10-3"><a href="#cb10-3"></a>    (<span class="st">"Sentence#1"</span>, <span class="st">"Sentence test"</span>),</span>
<span id="cb10-4"><a href="#cb10-4"></a>    (<span class="st">"Sentence#2"</span>, <span class="st">"Sentence test number 2"</span>),</span>
<span id="cb10-5"><a href="#cb10-5"></a>    (<span class="st">"Sentence#3"</span>, <span class="st">"Sentence test number 3"</span>)</span>
<span id="cb10-6"><a href="#cb10-6"></a>]</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>sentPairRDD <span class="op">=</span> sc.parallelize(sentences)</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">## “Extract” words from each sentence</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>sentIdWord <span class="op">=</span> sentPairRDD.flatMapValues(<span class="kw">lambda</span> s: s.split(<span class="st">' '</span>))</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">## Save the result on disk</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>sentIdWord.saveAsTextFile(outputPath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="keys-transformation" class="level4">
<h4 class="anchored" data-anchor-id="keys-transformation">Keys transformation</h4>
<p>The goal is to return the list of keys of the input RDD of pairs and store them in a new RDD. The returned RDD is not an RDD of key-value pairs, instead it is a standard RDD of single elements, with duplicate keys not removed.</p>
<p>The keys transformation is based on the <code>keys()</code> method of the <code>RDD</code> class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the following pairs: the key is the first name of a user and the value is his/her age
<ul>
<li><code>("Paolo", 40)</code></li>
<li><code>("Giorgio", 22)</code></li>
<li><code>("Paolo", 35)</code></li>
</ul></li>
<li>Store the names of the input users in an output HDFS folder. The output contains one name per line (duplicate names are removed).</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>nameAge <span class="op">=</span> [</span>
<span id="cb11-3"><a href="#cb11-3"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb11-4"><a href="#cb11-4"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb11-5"><a href="#cb11-5"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a>]</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb11-10"><a href="#cb11-10"></a></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">## Select the key part of the input RDD of key-value pairs</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>namesRDD <span class="op">=</span> nameAgePairRDD.keys().distinct()</span>
<span id="cb11-13"><a href="#cb11-13"></a></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>namesRDD.saveAsTextFile(outputPath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="values-transformation" class="level4">
<h4 class="anchored" data-anchor-id="values-transformation">Values transformation</h4>
<p>The goal is to return the list of values of the input RDD of pairs and store them in a new RDD. The returned RDD is not an RDD of key-value pairs, instead it is a standard RDD of single elements, with duplicate values are not removed.</p>
<p>The values transformation is based on the <code>values()</code> method of the <code>RDD</code> class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the pairs: the key is the first name of a user and the value is his/her age
<ul>
<li><code>("Paolo", 40)</code></li>
<li><code>("Giorgio", 22)</code></li>
<li><code>("Paolo", 22)</code></li>
</ul></li>
<li>Store the ages of the input users in an output HDFS folder, containing one age per line and duplicate ages/values are not removed.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>nameAge <span class="op">=</span> [</span>
<span id="cb12-3"><a href="#cb12-3"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb12-4"><a href="#cb12-4"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb12-5"><a href="#cb12-5"></a>    (<span class="st">"Paolo"</span>,<span class="dv">22</span>)</span>
<span id="cb12-6"><a href="#cb12-6"></a>]</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb12-10"><a href="#cb12-10"></a></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">## Select the value part of the input RDD of key-value pairs</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>agesRDD <span class="op">=</span> nameAgePairRDD.values()</span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb12-15"><a href="#cb12-15"></a>agesRDD.saveAsTextFile(outputPath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="sortbykey-transformation" class="level4">
<h4 class="anchored" data-anchor-id="sortbykey-transformation">SortByKey transformation</h4>
<p>The goal is to return a new RDD of key-value pairs obtained by sorting, in ascending order, the pairs of the input RDD by key (notice that the final order is related to the default sorting function of the data type of the input keys). The content of the new RDD of key-value pairs is the same of the input RDD but the pairs are sorted by key in the new returned RDD.</p>
<p>The sortByKey transformation is based on the <code>sortByKey()</code> method of the <code>RDD</code> class (pairs are sorted by key in ascending order). The <code>sortByKey(ascending)</code> method of the <code>RDD</code> class is also available: this method allows to specify if the sort order is ascending or descending by means of a Boolean parameter (<code>True</code> for ascending, <code>False</code> for descending).</p>
<p>A shuffle operation is executed for computing the result of the <code>sortByKey()</code> transformation, since pairs from different partitions of the input RDD must be compared to sort the input pairs by key.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD from a local python list containing the pairs: the key is the first name of a user and the value is his/her age
<ul>
<li><code>("Paolo", 40)</code></li>
<li><code>("Giorgio", 22)</code></li>
<li><code>("Paolo", 35)</code></li>
</ul></li>
<li>Sort the users by name and store the result in the HDFS file system.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>nameAge <span class="op">=</span> [</span>
<span id="cb13-3"><a href="#cb13-3"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb13-4"><a href="#cb13-4"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb13-5"><a href="#cb13-5"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb13-6"><a href="#cb13-6"></a>]</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb13-10"><a href="#cb13-10"></a></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">## Sort by name the content of the input RDD of key-value pairs</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>sortedNameAgePairRDD <span class="op">=</span> nameAgePairRDD.sortByKey()</span>
<span id="cb13-13"><a href="#cb13-13"></a></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>sortedNameAgePairRDD.saveAsTextFile(outputPath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="summary" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="summary">Summary</h4>
<p>All the examples reported in the following tables are applied on an RDD of pairs containing the following tuples (pairs): <code>[("k1", 2), ("k3", 4), ("k3", 6)]</code>.</p>
<ul>
<li>The key of each tuple is a string</li>
<li>The value of each tuple is an integer</li>
</ul>
<div class="column-page">
<p><strong>Purposes</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>reduceByKey(f)</code></td>
<td>Return an RDD of pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD of pairs is obtained by combining the values of the input RDD associated with the same key. The input RDD of pairs and the new RDD of pairs have the same data type.</td>
</tr>
<tr class="even">
<td><code>foldByKey(zeroValue, op)</code></td>
<td>Similar to the <code>reduceByKey()</code> transformation, however <code>foldByKey()</code> is characterized also by a zero value.</td>
</tr>
<tr class="odd">
<td><code>combineByKey(</code> <code>createCombiner,</code> <code>mergeValue,</code> <code>mergeCombiner</code> <code>)</code></td>
<td>Return an RDD of key-value pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD is obtained by combining the values of the input RDD associated with the same key. The values of the input RDD of pairs and the values of the new (returned) RDD of pairs can be characterized by different data types.</td>
</tr>
<tr class="even">
<td><code>groupByKey()</code></td>
<td>Return an RDD of pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD of pairs is a collection containing all the values of the input RDD associated with one of the input keys.</td>
</tr>
<tr class="odd">
<td><code>mapValues(f)</code></td>
<td>Apply a function over each pair of an RDD of pairs and return a new RDD of pairs. The applied function returns one pair for each pair of the input RDD of pairs. The function is applied only on the value part without changing the key. The values of the input RDD and the values of new RDD can have different data types.</td>
</tr>
<tr class="even">
<td><code>flatMapValues(f)</code></td>
<td>Apply a function over each pair of an RDD of pairs and return a new RDD of pairs. The applied function returns a set of pairs (from 0 to many) for each pair of the input RDD of pairs. The function is applied only on the value part without changing the key. The values of the input RDD and the values of new RDD can have different data types.</td>
</tr>
<tr class="odd">
<td><code>keys()</code></td>
<td>Return an RDD containing the keys of the input <code>pairRDD</code>.</td>
</tr>
<tr class="even">
<td><code>values()</code></td>
<td>Return an RDD containing the values of the input <code>pairRDD</code>.</td>
</tr>
<tr class="odd">
<td><code>sortByKey()</code></td>
<td>Return a <code>PairRDD</code> sorted by key. The input <code>PairRDD</code> and the new <code>PairRDD</code> have the same data type.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 45%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Example</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>reduceByKey(f)</code></td>
<td><p><code>reduceByKey(lambda v1, v2: v1+v2)</code></p>
<p>Sum values per key</p></td>
<td><code>[("k1",2),("k3",10)]</code></td>
</tr>
<tr class="even">
<td><code>foldByKey(zeroValue, op)</code></td>
<td><p><code>foldByKey(0,lambda v1, v2: v1+v2)</code></p>
<p>Sum values per key. The zero value is 0</p></td>
<td><code>[("k1",2),("k3",10)]</code></td>
</tr>
<tr class="odd">
<td><code>combineByKey(</code> <code>createCombiner,</code> <code>mergeValue,</code> <code>mergeCombiner</code> <code>)</code></td>
<td><p><code>combineByKey(</code> <code>lambda e: (e, 1),</code> <code>lambda c, e: (c[0]+e, c[1]+1),</code> <code>lambda c1, c2: (c1[0]+c2[0], c1[1]+c2[1])</code> <code>)</code></p>
<p>Sum values by key and count the number of pairs by key in one single step</p></td>
<td><code>[("k1",(2,1)),("k3",(10,2))]</code></td>
</tr>
<tr class="even">
<td><code>groupByKey()</code></td>
<td><code>groupByKey()</code></td>
<td><code>[("k1",[2]),("k3",[4,6])]</code></td>
</tr>
<tr class="odd">
<td><code>mapValues(f)</code></td>
<td><p><code>mapValues(lambda v: v+1)</code></p>
<p>Increment the value part by 1</p></td>
<td><code>[("k1",3),("k3",5),("k3",7)]</code></td>
</tr>
<tr class="even">
<td><code>flatMapValues(f)</code></td>
<td><code>flatMapValues(lambda v: list(range(v,6)))</code></td>
<td><code>[</code> <code>("k1",2),</code> <code>("k1",3),</code> <code>("k1",4),</code> <code>("k1",5),</code> <code>("k3",4),</code> <code>("k3",5)</code> <code>]</code></td>
</tr>
<tr class="odd">
<td><code>keys()</code></td>
<td><code>keys()</code></td>
<td><code>["k1","k3“,"k3"]</code></td>
</tr>
<tr class="even">
<td><code>values()</code></td>
<td><code>values()</code></td>
<td><code>[2, 4, 6]</code></td>
</tr>
<tr class="odd">
<td><code>sortByKey()</code></td>
<td><code>sortByKey()</code></td>
<td><code>[("k1",2),("k3",4),("k3",6)]</code></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="rdd-based-programming" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="rdd-based-programming">RDD-based programming</h3>
<section id="transformations-on-two-rdds-of-key-value-pairs" class="level4">
<h4 class="anchored" data-anchor-id="transformations-on-two-rdds-of-key-value-pairs">Transformations on two RDDs of key-value pairs</h4>
<p>Spark supports also some transformations that are applied on two RDDs of key-value pairs at the same time (e.g., <code>subtractByKey</code>, <code>join</code>, <code>coGroup</code>).</p>
</section>
<section id="subtractbykey-transformation" class="level4">
<h4 class="anchored" data-anchor-id="subtractbykey-transformation">SubtractByKey transformation</h4>
<p>The goal is to create a new RDD of key-value pairs containing only the pairs of the first input RDD of pairs associated with a key that is not appearing as key in the pairs of the second input RDD or pairs. The two input RDD of pairs must have the same type of keys, but the data type of the values can be different. The data type of the new RDD of pairs is the same of the first input RDD of pairs.</p>
<p>The subtractByKey transformation is based on the <code>subtractByKey(other)</code> method of the <code>RDD</code> class. The two input RDDs of pairs analyzed by <code>subtractByKey</code> are the one which the method is invoked on and the one passed as parameter (i.e., <code>other</code>).</p>
<p>A shuffle operation is executed for computing the result of the <code>subtractByKey()</code> transformation, since keys from different partitions of the two input RDDs must be compared.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create two RDDs of key-value pairs from two local python lists
<ul>
<li>First list – Profiles of the users of a blog <code>(username,age)</code>: <code>[("PaoloG",40),("Giorgio",22),("PaoloB",35)]</code></li>
<li>Second list – Banned users <code>(username,motivation)</code>: <code>[("PaoloB","spam"),("Giorgio","Vandalism")]</code></li>
</ul></li>
<li>Create a new RDD of pairs containing only the profiles of the non-banned users.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">## Create the first local python list</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>profiles <span class="op">=</span> [(<span class="st">"PaoloG"</span>,<span class="dv">40</span>),(<span class="st">"Giorgio"</span>,<span class="dv">22</span>),(<span class="st">"PaoloB"</span>,<span class="dv">35</span>)]</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">## Create the RDD of pairs from the profiles local list</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>profilesPairRDD <span class="op">=</span> sc.parallelize (profiles)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">## Create the second local python list</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>banned <span class="op">=</span> [(<span class="st">"PaoloB"</span>,<span class="st">"spam"</span>),(<span class="st">"Giorgio"</span>,<span class="st">"Vandalism"</span>)]</span>
<span id="cb14-9"><a href="#cb14-9"></a></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">## Create the RDD of pairs from the banned local list</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>bannedPairRDD <span class="op">=</span> sc.parallelize (banned)</span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">## Select the profiles of the “good” users</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>selectedProfiles <span class="op">=</span> profilesPairRDD.subtractByKey(bannedPairRDD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="join-transformation" class="level4">
<h4 class="anchored" data-anchor-id="join-transformation">Join transformation</h4>
<p>The goal is to Join the key-value pairs of two RDDs of key-value pairs based on the value of the key of the pairs: each pair of the input RDD of pairs is combined with all the pairs of the other RDD of pairs with the same key. The new RDD of key-value pairs has the same key data type of the input RDDs of pairs, and has a tuple as value (the pair of values of the two joined input pairs). The two input RDDs of key-value pairs must have the same type of keys, but the data types of the values can be different.</p>
<p>The join transformation is based on the <code>join(other)</code> method of the <code>RDD</code> class: the two input RDDs of pairs analyzed by join are the one which the method is invoked on and the one passed as parameter (i.e., <code>other</code>).</p>
<p>A shuffle operation is executed for computing the result of the <code>join()</code> transformation, since keys from different partitions of the two input RDDs must be compared and values from different partitions must be retrieved.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create two RDDs of key-value pairs from two local python lists
<ul>
<li>First list – List of questions (QuestionId, Text of the question): <code>[(1,"What is ...?"),(2,"Who is ...?")]</code></li>
<li>Second list – List of answers (QuestionId, Text of the answer): <code>[(1,"It is a car"),(1,"It is a byke"),(2,"She is Jenny")]</code></li>
</ul></li>
<li>Create a new RDD of pairs to associate each question with its answers: one pair for each possible pair (question-answer)</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">## Create the first local Python list</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>questions<span class="op">=</span> [(<span class="dv">1</span>,<span class="st">"What is ...?"</span>),(<span class="dv">2</span>,<span class="st">"Who is ...?"</span>)]</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">## Create the RDD of pairs from the local list</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>questionsPairRDD <span class="op">=</span> sc.parallelize(questions)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">## Create the second local python list</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>answers <span class="op">=</span> [(<span class="dv">1</span>,<span class="st">"It is a car"</span>),(<span class="dv">1</span>,<span class="st">"It is a byke"</span>),(<span class="dv">2</span>,<span class="st">"She is Jenny"</span>)]</span>
<span id="cb15-9"><a href="#cb15-9"></a></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">## Create the RDD of pairs from the local list</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>answersPairRDD <span class="op">=</span> sc.parallelize(answers)</span>
<span id="cb15-12"><a href="#cb15-12"></a></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">## Join questions with answers</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>joinPairRDD <span class="op">=</span> questionsPairRDD.join(answersPairRDD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>joinPairRDD</code></td>
<td>The key part of the returned RDD of pairs is an integer number. The value part of the returned RDD of pairs is a tuple containing two values: (question,answer).</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="cogroup-transformation" class="level4">
<h4 class="anchored" data-anchor-id="cogroup-transformation">CoGroup transformation</h4>
<p>The goal is to associate each key <span class="math inline">\(k\)</span> of the two input RDDs of key-value pairs with</p>
<ul>
<li>The list of values associated with <span class="math inline">\(k\)</span> in the first input RDD of pairs</li>
<li>The list of values associated with <span class="math inline">\(k\)</span> in the second input RDD of pairs</li>
</ul>
<p>The new RDD of key-value pairs has the same key data type of the two input RDDs of pairs, and has a tuple as value (the two lists of values of the two input RDDs of pairs). The two input RDDs of key-value pairs must have the same type of keys, but the data types of the values can be different.</p>
<p>The cogroup transformation is based on the <code>cogroup(other)</code> method of the <code>RDD</code> class: the two input RDDs of pairs analyzed by cogroup are the one which the method is invoked on and the one passed as parameter (i.e., <code>other</code>).</p>
<p>A shuffle operation is executed for computing the result of the <code>cogroup()</code> transformation, since keys from different partitions of the two input RDDs must be compared and values from different partitions must be retrieved.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create two RDDs of key-value pairs from two local python lists
<ul>
<li>First list – List of liked movies <code>(userId,likedMovies)</code>: <code>[(1,"Star Trek"),(1,"Forrest Gump"),(2,"Forrest Gump")]</code></li>
<li>Second list – List of liked directors <code>(userId,likedDirector)</code>: <code>[(1,"Woody Allen"),(2,"Quentin Tarantino"),(2,"Alfred Hitchcock")]</code></li>
</ul></li>
<li>Create a new RDD of pairs containing one pair for each userId (key) associated with
<ul>
<li>The list of liked movies</li>
<li>The list of liked directors</li>
</ul></li>
</ol>
<p><em>Inputs</em> - <code>[(1,"Star Trek"),(1,"Forrest Gump"),(2,"Forrest Gump")]</code> - <code>[(1,"Woody Allen"),(2,"Quentin Tarantino"),(2,"Alfred Hitchcock")]</code></p>
<p><em>Output</em> - <code>(1,(["Star Trek","Forrest Gump"],["Woody Allen"]))</code> - <code>(2,(["Forrest Gump"],["Quentin Tarantino","Alfred Hitchcock"]))</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">## Create the first local python list</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>movies<span class="op">=</span> [</span>
<span id="cb16-3"><a href="#cb16-3"></a>    (<span class="dv">1</span>,<span class="st">"Star Trek"</span>),</span>
<span id="cb16-4"><a href="#cb16-4"></a>    (<span class="dv">1</span>,<span class="st">"Forrest Gump"</span>),</span>
<span id="cb16-5"><a href="#cb16-5"></a>    (<span class="dv">2</span>,<span class="st">"Forrest Gump"</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a>]</span>
<span id="cb16-7"><a href="#cb16-7"></a></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">## Create the RDD of pairs from the first local list</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>moviesPairRDD <span class="op">=</span> sc.parallelize(movies)</span>
<span id="cb16-10"><a href="#cb16-10"></a></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">## Create the second local python list</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>directors <span class="op">=</span> [</span>
<span id="cb16-13"><a href="#cb16-13"></a>    (<span class="dv">1</span>,<span class="st">"Woody Allen"</span>),</span>
<span id="cb16-14"><a href="#cb16-14"></a>    (<span class="dv">2</span>,<span class="st">"Quentin Tarantino"</span>),</span>
<span id="cb16-15"><a href="#cb16-15"></a>    (<span class="dv">2</span>,<span class="st">"Alfred Hitchcock"</span>)</span>
<span id="cb16-16"><a href="#cb16-16"></a>]</span>
<span id="cb16-17"><a href="#cb16-17"></a></span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="co">## Create the RDD of pairs from the second local list</span></span>
<span id="cb16-19"><a href="#cb16-19"></a>directorsPairRDD <span class="op">=</span> sc.parallelize(directors)</span>
<span id="cb16-20"><a href="#cb16-20"></a></span>
<span id="cb16-21"><a href="#cb16-21"></a><span class="co">## Cogroup movies and directors per user</span></span>
<span id="cb16-22"><a href="#cb16-22"></a>cogroupPairRDD <span class="op">=</span> moviesPairRDD.cogroup(directorsPairRDD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>cogroupPairRDD</code></td>
<td>Notice that the value part of the returned tuples is a tuple containing two lists: the first value contains the list of movies (iterable) liked by a user; the second value contains the list of directors (iterable) liked by a user.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-1" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="summary-1">Summary</h4>
<p>All the examples reported in the following tables are applied on the following two RDDs of key-value pairs</p>
<ul>
<li><code>inputRDD1</code>: <code>[('k1',2),('k3',4),('k3',6)]</code></li>
<li><code>inputRDD2</code>: <code>[('k3',9)]</code></li>
</ul>
<div class="column-page">
<p><strong>Purposes</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>subtractByKey(other)</code></td>
<td>Return a new RDD of key-value pairs. The returned pairs are those of input RDD on which the method is invoked such that the key part does not occur in the keys of the RDD that is passed as parameter. The values are not considered to take the decision.</td>
</tr>
<tr class="even">
<td><code>join(other)</code></td>
<td>Return a new RDD of pairs corresponding to join of the two input RDDs. The join is based on the value of the key.</td>
</tr>
<tr class="odd">
<td><code>cogroup(other)</code></td>
<td><p>For each key <span class="math inline">\(k\)</span> in one of the two input RDDs of pairs, return a pair <span class="math inline">\((k, tuple)\)</span>, where tuple contains:</p>
<ul>
<li>the list (iterable) of values of the first input RDD associated with key <span class="math inline">\(k\)</span>;</li>
<li>the list (iterable) of values of the second input RDD associated with key <span class="math inline">\(k\)</span>.</li>
</ul></td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 45%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Example</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>subtractByKey(other)</code></td>
<td><code>inputRDD1.subtractByKey(inputRDD2)</code></td>
<td><code>[('k1',2)]</code></td>
</tr>
<tr class="even">
<td><code>join(other)</code></td>
<td><code>inputRDD1.join(inputRDD2)</code></td>
<td><code>[('k3',(4,9)),('k3',(6,9))]</code></td>
</tr>
<tr class="odd">
<td><code>cogroup(other)</code></td>
<td><code>inputRDD1.cogroup(inputRDD2)</code></td>
<td><code>[('k1',([2],[])),('k3',([4,6],[9]))]</code></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="actions-on-rdds-of-key-value-pairs" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="actions-on-rdds-of-key-value-pairs">Actions on RDDs of key-value pairs</h3>
<p>Spark supports also some specific actions on RDDs of key-value pairs (e.g., <code>countByKey</code>, <code>collectAsMap</code>, <code>lookup</code>).</p>
<section id="countbykey-action" class="level4">
<h4 class="anchored" data-anchor-id="countbykey-action">CountByKey action</h4>
<p>The countByKey action returns a local python dictionary containing the information about the number of elements associated with each key in the input RDD of key-value pairs (i.e., the number of times each key occurs in the input RDD).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pay attention to the number of distinct keys of the input RDD of pairs: if the number of distinct keys is large, the result of the action cannot be stored in a local variable of the Driver.</p>
</div>
</div>
<p>The countBykey action is based on the <code>countBykey()</code> method of the <code>RDD</code> class. Notice that data are sent on the network to compute the final result.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of pairs from the following python list (each pair contains a movie and the rating given by someone to that movie): <code>[("Forrest Gump",4),("Star Trek",5),("Forrest Gump",3)]</code>;</li>
<li>Compute the number of ratings for each movie.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>movieRating<span class="op">=</span> [</span>
<span id="cb17-3"><a href="#cb17-3"></a>    (<span class="st">"Forrest Gump"</span>,<span class="dv">4</span>),</span>
<span id="cb17-4"><a href="#cb17-4"></a>    (<span class="st">"Star Trek"</span>,<span class="dv">5</span>),</span>
<span id="cb17-5"><a href="#cb17-5"></a>    (<span class="st">"Forrest Gump"</span>,<span class="dv">3</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a>]</span>
<span id="cb17-7"><a href="#cb17-7"></a></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>movieRatingRDD <span class="op">=</span> sc.parallelize(movieRating)</span>
<span id="cb17-10"><a href="#cb17-10"></a></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="co">## Compute the number of rating for each movie</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>movieNumRatings <span class="op">=</span> movieRatingRDD.countByKey()</span>
<span id="cb17-13"><a href="#cb17-13"></a></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="co">## Print the result on the standard output</span></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="bu">print</span>(movieNumRatings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>movieNumRatings</code></td>
<td>Pay attention to the size of the returned local python dictionary (i.e., in this case, the number of distinct movies).</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="collectasmap-action" class="level4">
<h4 class="anchored" data-anchor-id="collectasmap-action">CollectAsMap action</h4>
<p>The collectAsMap action returns a local dictionary containing the same pairs of the considered input RDD of pairs. Pay attention to the size of the returned RDD: data are sent on the network.</p>
<p>The collectAsMap action is based on the <code>collectAsMap()</code> method of the <code>RDD</code> class.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pay attention that the collectAsMap action returns a dictionary object, and a dictionary cannot contain duplicate keys: each key can be associated with at most one value, and if the input RDD of pairs contains more than one pair with the same key, only one of those pairs is stored in the returned local python dictionary (usually, the last one occurring in the input RDD of pairs).</p>
</div>
</div>
<p>Use collectAsMap only if sure that each key appears only once in the input RDD of key-value pairs.</p>
<p>The <code>collectAsMap()</code> method returns a local dictionary while <code>collect()</code> return a list of key-value pairs (i.e., a list of tuples). Notice that the list of pairs returned by <code>collect()</code> can contain more than one pair associated with the same key.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of pairs from the following python list (each pair contains a userId and the name of the user): <code>[("User1","Paolo"),("User2","Luca"),("User3","Daniele")]</code>;</li>
<li>Retrieve the pairs of the created RDD of pairs and store them in a local python dictionary that is instantiated in the Driver.</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>users <span class="op">=</span> [</span>
<span id="cb18-3"><a href="#cb18-3"></a>    (<span class="st">"User1"</span>,<span class="st">"Paolo"</span>),</span>
<span id="cb18-4"><a href="#cb18-4"></a>    (<span class="st">"User2"</span>,<span class="st">"Luca"</span>),</span>
<span id="cb18-5"><a href="#cb18-5"></a>    (<span class="st">"User3"</span>,<span class="st">"Daniele"</span>)</span>
<span id="cb18-6"><a href="#cb18-6"></a>]</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">#Create the RDD of pairs from the local list</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>usersRDD <span class="op">=</span> sc.parallelize(users)</span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co">## Retrieve the content of usersRDD and store it in a</span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co">## local python dictionary</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>retrievedPairs <span class="op">=</span> usersRDD.collectAsMap()</span>
<span id="cb18-14"><a href="#cb18-14"></a></span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="co">## Print the result on the standard output</span></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="bu">print</span>(retrievedPairs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>retrievedPairs</code></td>
<td>Pay attention to the size of the returned local python dictionary (i.e., in this case, the number of distinct users).</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="lookup-action" class="level4">
<h4 class="anchored" data-anchor-id="lookup-action">Lookup action</h4>
<p>The lookup(<span class="math inline">\(k\)</span>) action returns a local python list containing the values of the pairs of the input RDD associated with the key <span class="math inline">\(k\)</span> specified as parameter.</p>
<p>The lookup action is based on the <code>lookup(key)</code> method of the <code>RDD</code> class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create an RDD of pairs from the following python list (each pair contains a movie and the rating given by someone to that movie): <code>[("Forrest Gump",4),("Star Trek",5),("Forrest Gump",3)]</code></li>
<li>Retrieve the ratings associated with the movie “Forrest Gump” and store them in a local python list in the Driver.</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">## Create the local python list</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>movieRating<span class="op">=</span> [(<span class="st">"Forrest Gump"</span>,<span class="dv">4</span>),(<span class="st">"Star Trek"</span>,<span class="dv">5</span>),(<span class="st">"Forrest Gump"</span>,<span class="dv">3</span>)]</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>movieRatingRDD <span class="op">=</span> sc.parallelize(movieRating)</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co">## Select the ratings associated with “Forrest Gump”</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>movieRatings <span class="op">=</span> movieRatingRDD.lookup(<span class="st">"Forrest Gump"</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co">## Print the result on the standard output</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="bu">print</span>(movieRatings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>movieRatings</code></td>
<td>Pay attention to the size of the returned local list (i.e., in this case, the number of ratings associated with “Forrest Gump”).</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-2" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="summary-2">Summary</h4>
<p>All the examples reported in the following tables are applied on the following RDD of key-value pairs:</p>
<ul>
<li><code>inputRDD</code>: <code>[('k1',2),('k3',4),('k3',6)]</code></li>
</ul>
<div class="column-page">
<p><strong>Purposes</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>countByKey()</code></td>
<td>Return a local python dictionary containing the number of elements in the input RDD for each key of the input RDD of pairs.</td>
</tr>
<tr class="even">
<td><code>collectAsMap()</code></td>
<td>Return a local python dictionary containing the pairs of the input RDD of pairs.</td>
</tr>
<tr class="odd">
<td><code>lookup(key)</code></td>
<td>Return a local python list containing all the values associated with the key specified as parameter.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 45%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Example</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>countByKey()</code></td>
<td><code>inputRDD.countByKey()</code></td>
<td><code>{('k1',1),('K3',2)}</code></td>
</tr>
<tr class="even">
<td><code>collectAsMap()</code></td>
<td><code>inputRDD.collectAsMap()</code></td>
<td><p><code>{('k1',2),('k3',6)}</code></p>
<p>Or</p>
<p><code>{('k1',2),('k3',4)}</code></p>
<p>Depending on the order of the pairs in the input RDD of pairs</p></td>
</tr>
<tr class="odd">
<td><code>lookup(key)</code></td>
<td><code>inputRDD.lookup('k3')</code></td>
<td><code>[4,6]</code></td>
</tr>
</tbody>
</table>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./11_rdd_based_programming.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">RDD based programming</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13_rdd_numbers.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">RDD of numbers</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu"># RDDs and key-value pairs</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>Spark supports also RDDs of key-value pairs. Key-value pairs in python are represented by means of python tuples:</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="ss">- </span>The first value is the key part of the pair</span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="ss">- </span>The second value is the value part of the pair</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a>RDDs of key-value pairs are sometimes called "pair RDDs".</span>
<span id="cb20-8"><a href="#cb20-8"></a></span>
<span id="cb20-9"><a href="#cb20-9"></a>RDDs of key-value pairs are characterized by </span>
<span id="cb20-10"><a href="#cb20-10"></a></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="ss">- </span>specific operations (e.g., <span class="in">`reduceByKey()`</span>, <span class="in">`join()`</span>), which analyze the content of one group (key) at a time;</span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="ss">- </span>operations available for the standard RDDs (e.g., <span class="in">`filter()`</span>, <span class="in">`map()`</span>, <span class="in">`reduce()`</span>).</span>
<span id="cb20-13"><a href="#cb20-13"></a></span>
<span id="cb20-14"><a href="#cb20-14"></a>Many applications are based on RDDs of key-value pairs: the operations available for RDDs of key-value pairs allow grouping data by key and performing computation by key (i.e., by group). The basic idea is similar to the one of the MapReduce-based programs in Hadoop, but there are more operations already available.</span>
<span id="cb20-15"><a href="#cb20-15"></a></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="fu">## Creating RDDs of key-value pairs</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>RDDs of key-value pairs can be built</span>
<span id="cb20-18"><a href="#cb20-18"></a></span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="ss">- </span>From other RDDs by applying the <span class="in">`map()`</span> or the <span class="in">`flatMap()`</span> transformation on other RDDs;</span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="ss">- </span>From a Python in-memory collection of tuple (key-value pairs) by using the <span class="in">`parallelize()`</span> method of the <span class="in">`SparkContext`</span> class.</span>
<span id="cb20-21"><a href="#cb20-21"></a></span>
<span id="cb20-22"><a href="#cb20-22"></a>Key-value pairs are represented as standard built-in Python tuples composed of two elements</span>
<span id="cb20-23"><a href="#cb20-23"></a></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="ss">- </span>Key</span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="ss">- </span>Value</span>
<span id="cb20-26"><a href="#cb20-26"></a></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="fu">## RDDs of key-value pairs by using the Map transformation</span></span>
<span id="cb20-28"><a href="#cb20-28"></a>The goal is to define an RDD of key-value pairs by using the map transformation: apply a function <span class="in">`f`</span> on each element of the input RDD that returns one tuple for each input element. The new RDD of key-value pairs contains one tuple <span class="in">`y`</span> for each element <span class="in">`x`</span> of the input RDD.</span>
<span id="cb20-29"><a href="#cb20-29"></a></span>
<span id="cb20-30"><a href="#cb20-30"></a>The standard <span class="in">`map(f)`</span> transformation is used, and the new RDD of key-value pairs contains one tuple <span class="in">`y`</span> for each input element <span class="in">`x`</span> of the input RDD ($y=f(x)$).</span>
<span id="cb20-31"><a href="#cb20-31"></a></span>
<span id="cb20-32"><a href="#cb20-32"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-33"><a href="#cb20-33"></a><span class="fu">### Example</span></span>
<span id="cb20-34"><a href="#cb20-34"></a><span class="ss">- </span>Create an RDD from a textual file containing the first names of a list of users; each line of the file contains one first name;</span>
<span id="cb20-35"><a href="#cb20-35"></a><span class="ss">- </span>Create an RDD of key-value pairs containing a list of pairs <span class="in">`(first name, 1)`</span>.</span>
<span id="cb20-36"><a href="#cb20-36"></a></span>
<span id="cb20-37"><a href="#cb20-37"></a><span class="in">```python</span></span>
<span id="cb20-38"><a href="#cb20-38"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb20-39"><a href="#cb20-39"></a>namesRDD <span class="op">=</span> sc.textFile(<span class="st">"first_names.txt"</span>)</span>
<span id="cb20-40"><a href="#cb20-40"></a></span>
<span id="cb20-41"><a href="#cb20-41"></a><span class="co">## Create an RDD of key-value pairs</span></span>
<span id="cb20-42"><a href="#cb20-42"></a>nameOnePairRDD <span class="op">=</span> namesRDD.<span class="bu">map</span>(<span class="kw">lambda</span> name: (name, <span class="dv">1</span>))</span>
<span id="cb20-43"><a href="#cb20-43"></a><span class="in">```</span></span>
<span id="cb20-44"><a href="#cb20-44"></a></span>
<span id="cb20-45"><a href="#cb20-45"></a>|||</span>
<span id="cb20-46"><a href="#cb20-46"></a>|-|----|</span>
<span id="cb20-47"><a href="#cb20-47"></a>| <span class="in">`nameOnePairRDD`</span> | It contains key-value pairs (i.e., tuples) of type (string, integer) |</span>
<span id="cb20-48"><a href="#cb20-48"></a></span>
<span id="cb20-49"><a href="#cb20-49"></a>:::</span>
<span id="cb20-50"><a href="#cb20-50"></a></span>
<span id="cb20-51"><a href="#cb20-51"></a><span class="fu">## RDDs of key-value pairs by using the flatMap transformation</span></span>
<span id="cb20-52"><a href="#cb20-52"></a>Define an RDD of key-value pairs by using the flatMap transformation: apply a function <span class="in">`f`</span> on each element of the input RDD that returns a list of tuples for each input element. The new PairRDD contains all the pairs obtained by applying <span class="in">`f`</span> on each element <span class="in">`x`</span> of the input RDD.</span>
<span id="cb20-53"><a href="#cb20-53"></a></span>
<span id="cb20-54"><a href="#cb20-54"></a>The standard <span class="in">`flatMap(f)`</span> transformation is used, and the new RDD of key-value pairs contains the tuples returned by the execution of <span class="in">`f`</span> on each element <span class="in">`x`</span> of the input RDD.</span>
<span id="cb20-55"><a href="#cb20-55"></a></span>
<span id="cb20-56"><a href="#cb20-56"></a>$$</span>
<span id="cb20-57"><a href="#cb20-57"></a><span class="co">[</span><span class="ot">y</span><span class="co">]</span>= f(x)</span>
<span id="cb20-58"><a href="#cb20-58"></a>$$</span>
<span id="cb20-59"><a href="#cb20-59"></a></span>
<span id="cb20-60"><a href="#cb20-60"></a><span class="ss">- </span>Given a element $x$ of the input RDD, $f$ applied on $x$ returns a list of pairs $<span class="co">[</span><span class="ot">y</span><span class="co">]</span>$;</span>
<span id="cb20-61"><a href="#cb20-61"></a><span class="ss">- </span>The new RDD is a list of pairs contains all the pairs of the returned list of pairs. It is not an RDD of lists.</span>
<span id="cb20-62"><a href="#cb20-62"></a></span>
<span id="cb20-63"><a href="#cb20-63"></a>$<span class="co">[</span><span class="ot">y</span><span class="co">]</span>$ can be the empty list.</span>
<span id="cb20-64"><a href="#cb20-64"></a></span>
<span id="cb20-65"><a href="#cb20-65"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-66"><a href="#cb20-66"></a><span class="fu">### Example</span></span>
<span id="cb20-67"><a href="#cb20-67"></a><span class="ss">1. </span>Create an RDD from a textual file; each line of the file contains a set of words;</span>
<span id="cb20-68"><a href="#cb20-68"></a><span class="ss">2. </span>Create a <span class="in">`PairRDD`</span> containing a list of pairs <span class="in">`(word, 1)`</span>: one pair for each word occurring in the input document (with repetitions).</span>
<span id="cb20-69"><a href="#cb20-69"></a></span>
<span id="cb20-70"><a href="#cb20-70"></a>**Version 1**</span>
<span id="cb20-71"><a href="#cb20-71"></a></span>
<span id="cb20-72"><a href="#cb20-72"></a><span class="in">```python</span></span>
<span id="cb20-73"><a href="#cb20-73"></a><span class="co">## Define the function associated with the flatMap transformation</span></span>
<span id="cb20-74"><a href="#cb20-74"></a><span class="kw">def</span> wordsOnes(line):</span>
<span id="cb20-75"><a href="#cb20-75"></a>    pairs <span class="op">=</span> []</span>
<span id="cb20-76"><a href="#cb20-76"></a>    <span class="cf">for</span> word <span class="kw">in</span> line.split(<span class="st">' '</span>):</span>
<span id="cb20-77"><a href="#cb20-77"></a>        pairs.append( (word, <span class="dv">1</span>))</span>
<span id="cb20-78"><a href="#cb20-78"></a>    <span class="cf">return</span> pairs</span>
<span id="cb20-79"><a href="#cb20-79"></a></span>
<span id="cb20-80"><a href="#cb20-80"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb20-81"><a href="#cb20-81"></a>linesRDD <span class="op">=</span> sc.textFile(<span class="st">"document.txt"</span>)</span>
<span id="cb20-82"><a href="#cb20-82"></a></span>
<span id="cb20-83"><a href="#cb20-83"></a><span class="co">## Create an RDD of key-value pairs based on the input document</span></span>
<span id="cb20-84"><a href="#cb20-84"></a><span class="co">## One pair (word,1) for each input word</span></span>
<span id="cb20-85"><a href="#cb20-85"></a>wordOnePairRDD <span class="op">=</span> linesRDD.flatMap(wordsOnes)</span>
<span id="cb20-86"><a href="#cb20-86"></a><span class="in">```</span></span>
<span id="cb20-87"><a href="#cb20-87"></a></span>
<span id="cb20-88"><a href="#cb20-88"></a>**Version 2**</span>
<span id="cb20-89"><a href="#cb20-89"></a><span class="in">```python</span></span>
<span id="cb20-90"><a href="#cb20-90"></a><span class="co">## Read the content of the input textual file</span></span>
<span id="cb20-91"><a href="#cb20-91"></a>linesRDD <span class="op">=</span> sc.textFile(<span class="st">"document.txt"</span>)</span>
<span id="cb20-92"><a href="#cb20-92"></a></span>
<span id="cb20-93"><a href="#cb20-93"></a><span class="co">## Create an RDD of key-value pairs based on the input document</span></span>
<span id="cb20-94"><a href="#cb20-94"></a><span class="co">## One pair (word,1) for each input word</span></span>
<span id="cb20-95"><a href="#cb20-95"></a>wordOnePairRDD <span class="op">=</span> linesRDD.flatMap(</span>
<span id="cb20-96"><a href="#cb20-96"></a>    <span class="kw">lambda</span> line: <span class="bu">map</span>(<span class="kw">lambda</span> w: (w, <span class="dv">1</span>), line.split(<span class="st">' '</span>))</span>
<span id="cb20-97"><a href="#cb20-97"></a>)</span>
<span id="cb20-98"><a href="#cb20-98"></a><span class="in">```</span></span>
<span id="cb20-99"><a href="#cb20-99"></a></span>
<span id="cb20-100"><a href="#cb20-100"></a>|||</span>
<span id="cb20-101"><a href="#cb20-101"></a>|-|----|</span>
<span id="cb20-102"><a href="#cb20-102"></a>| <span class="in">`map(lambda w: (w, 1), line.split(' '))`</span> | This is the map of python. It is not the Spark’s map transformation. |</span>
<span id="cb20-103"><a href="#cb20-103"></a></span>
<span id="cb20-104"><a href="#cb20-104"></a>:::</span>
<span id="cb20-105"><a href="#cb20-105"></a></span>
<span id="cb20-106"><a href="#cb20-106"></a><span class="fu">## RDDs of key-value pairs by using parallelize</span></span>
<span id="cb20-107"><a href="#cb20-107"></a>Use the parallelize method to create an RDD of key-value pairs from a local python in-memory collection of tuples.</span>
<span id="cb20-108"><a href="#cb20-108"></a></span>
<span id="cb20-109"><a href="#cb20-109"></a>It is based on the standard <span class="in">`parallelize(c)`</span> method of the <span class="in">`SparkContext`</span> class: each element (tuple) of the local python collection becomes a key-vaue pair of the returned RDD.</span>
<span id="cb20-110"><a href="#cb20-110"></a></span>
<span id="cb20-111"><a href="#cb20-111"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-112"><a href="#cb20-112"></a><span class="fu">### Example</span></span>
<span id="cb20-113"><a href="#cb20-113"></a>Create an RDD from a local python list containing the following key-value pairs</span>
<span id="cb20-114"><a href="#cb20-114"></a></span>
<span id="cb20-115"><a href="#cb20-115"></a><span class="ss">- </span><span class="in">`("Paolo", 40)`</span></span>
<span id="cb20-116"><a href="#cb20-116"></a><span class="ss">- </span><span class="in">`("Giorgio", 22)`</span></span>
<span id="cb20-117"><a href="#cb20-117"></a><span class="ss">- </span><span class="in">`("Paolo", 35)`</span></span>
<span id="cb20-118"><a href="#cb20-118"></a></span>
<span id="cb20-119"><a href="#cb20-119"></a><span class="in">```python</span></span>
<span id="cb20-120"><a href="#cb20-120"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-121"><a href="#cb20-121"></a>nameAge <span class="op">=</span> [</span>
<span id="cb20-122"><a href="#cb20-122"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb20-123"><a href="#cb20-123"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb20-124"><a href="#cb20-124"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb20-125"><a href="#cb20-125"></a>]</span>
<span id="cb20-126"><a href="#cb20-126"></a></span>
<span id="cb20-127"><a href="#cb20-127"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-128"><a href="#cb20-128"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb20-129"><a href="#cb20-129"></a><span class="in">```</span></span>
<span id="cb20-130"><a href="#cb20-130"></a></span>
<span id="cb20-131"><a href="#cb20-131"></a>|||</span>
<span id="cb20-132"><a href="#cb20-132"></a>|-|----|</span>
<span id="cb20-133"><a href="#cb20-133"></a>| <span class="in">`nameAge`</span> | This is a local in-memory python list of key-value pairs (tuples), that is stored in the main memory of the Driver. |</span>
<span id="cb20-134"><a href="#cb20-134"></a>| <span class="in">`nameAgePairRDD`</span> | This is an RDD or key-value pairs based on the content of the local in-memory python list. The RDD is stored in the “distributed” main memory of the cluster servers |</span>
<span id="cb20-135"><a href="#cb20-135"></a></span>
<span id="cb20-136"><a href="#cb20-136"></a>:::</span>
<span id="cb20-137"><a href="#cb20-137"></a></span>
<span id="cb20-138"><a href="#cb20-138"></a><span class="fu">## Transformations on RDDs of key-value pairs</span></span>
<span id="cb20-139"><a href="#cb20-139"></a>All the standard transformations can be applied, where the specified functions operate on tuples, but also specific transformations are available (e.g., <span class="in">`reduceByKey()`</span>, <span class="in">`groupyKey()`</span>, <span class="in">`mapValues()`</span>, <span class="in">`join()`</span>).</span>
<span id="cb20-140"><a href="#cb20-140"></a></span>
<span id="cb20-141"><a href="#cb20-141"></a><span class="fu">### ReduceByKey transformation</span></span>
<span id="cb20-142"><a href="#cb20-142"></a>The goal is to create a new RDD of key-value pairs where there is one pair for each distinct key <span class="in">`k`</span> of the input RDD of key-value pairs: </span>
<span id="cb20-143"><a href="#cb20-143"></a></span>
<span id="cb20-144"><a href="#cb20-144"></a><span class="ss">- </span>The value associated with key <span class="in">`k`</span> in the new RDD of key-value pairs is computed by applying a function <span class="in">`f`</span> on the values associated with <span class="in">`k`</span> in the input RDD of key-value pairs; the function <span class="in">`f`</span> must be associative and commutative, otherwise the result depends on how data are partitioned and analyzed;</span>
<span id="cb20-145"><a href="#cb20-145"></a><span class="ss">- </span>The data type of the new RDD of key-value pairs is the same of the input RDD of key-value pairs.</span>
<span id="cb20-146"><a href="#cb20-146"></a></span>
<span id="cb20-147"><a href="#cb20-147"></a>The reduceByKey transformation is based on the <span class="in">`reduceByKey(f)`</span> method of the <span class="in">`RDD`</span> class. A function <span class="in">`f`</span> is passed to the reduceByKey method</span>
<span id="cb20-148"><a href="#cb20-148"></a></span>
<span id="cb20-149"><a href="#cb20-149"></a><span class="ss">- </span>Given the values of two input pairs, <span class="in">`f`</span> is used to combine them in one single value;</span>
<span id="cb20-150"><a href="#cb20-150"></a><span class="ss">- </span><span class="in">`f`</span> is recursively invoked over the values of the pairs associated with one key at a time until the input values associated with one key are reduced to one single value.</span>
<span id="cb20-151"><a href="#cb20-151"></a></span>
<span id="cb20-152"><a href="#cb20-152"></a>The retuned RDD contains a number of key-value pairs equal to the number of distinct keys in the input key-value pair RDD.</span>
<span id="cb20-153"><a href="#cb20-153"></a></span>
<span id="cb20-154"><a href="#cb20-154"></a>Similarly to the <span class="in">`reduce()`</span> action, the <span class="in">`reduceByKey()`</span> transformation aggregate values, however <span class="in">`reduceByKey()`</span> is executed on RDDs of key-value pairs and returns a set of key-value pairs, while <span class="in">`reduce()`</span> is executed on an RDD and returns one single value (stored in a local python variable). Moreover, <span class="in">`reduceByKey()`</span> is a transformation, and so it is executed lazily and its result is stored in another RDD, whereas <span class="in">`reduce()`</span> is an action.</span>
<span id="cb20-155"><a href="#cb20-155"></a></span>
<span id="cb20-156"><a href="#cb20-156"></a>A shuffle operation is executed for computing the result of the <span class="in">`reduceByKey()`</span> transformation. The result/value for each group/key is computed from data stored in different input partitions.</span>
<span id="cb20-157"><a href="#cb20-157"></a></span>
<span id="cb20-158"><a href="#cb20-158"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-159"><a href="#cb20-159"></a><span class="fu">### Example</span></span>
<span id="cb20-160"><a href="#cb20-160"></a><span class="ss">1. </span>Create an RDD from a local python list containing the pairs, where the key is the first name of a user and the value is his/her age</span>
<span id="cb20-161"><a href="#cb20-161"></a><span class="ss">    - </span><span class="in">`("Paolo", 40)`</span></span>
<span id="cb20-162"><a href="#cb20-162"></a><span class="ss">    - </span><span class="in">`("Giorgio", 22)`</span></span>
<span id="cb20-163"><a href="#cb20-163"></a><span class="ss">    - </span><span class="in">`("Paolo", 35)`</span></span>
<span id="cb20-164"><a href="#cb20-164"></a><span class="ss">2. </span>Create a new RDD of key-value pairs containing one pair for each name. In the returned RDD, associate each name with the age of the youngest user with that name.</span>
<span id="cb20-165"><a href="#cb20-165"></a></span>
<span id="cb20-166"><a href="#cb20-166"></a><span class="in">```python</span></span>
<span id="cb20-167"><a href="#cb20-167"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-168"><a href="#cb20-168"></a>nameAge <span class="op">=</span> [</span>
<span id="cb20-169"><a href="#cb20-169"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb20-170"><a href="#cb20-170"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb20-171"><a href="#cb20-171"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb20-172"><a href="#cb20-172"></a>]</span>
<span id="cb20-173"><a href="#cb20-173"></a></span>
<span id="cb20-174"><a href="#cb20-174"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-175"><a href="#cb20-175"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb20-176"><a href="#cb20-176"></a></span>
<span id="cb20-177"><a href="#cb20-177"></a><span class="co">## Select for each name the lowest age value</span></span>
<span id="cb20-178"><a href="#cb20-178"></a>youngestPairRDD<span class="op">=</span> nameAgePairRDD.reduceByKey(<span class="kw">lambda</span> age1, age2: <span class="bu">min</span>(age1, age2))</span>
<span id="cb20-179"><a href="#cb20-179"></a><span class="in">```</span></span>
<span id="cb20-180"><a href="#cb20-180"></a></span>
<span id="cb20-181"><a href="#cb20-181"></a>|||</span>
<span id="cb20-182"><a href="#cb20-182"></a>|-|----|</span>
<span id="cb20-183"><a href="#cb20-183"></a>| <span class="in">`youngestPairRDD`</span> | The returned RDD of key-value pairs contains one pair for each distinct input key (i.e., for each distinct name in this example) |</span>
<span id="cb20-184"><a href="#cb20-184"></a></span>
<span id="cb20-185"><a href="#cb20-185"></a>:::</span>
<span id="cb20-186"><a href="#cb20-186"></a></span>
<span id="cb20-187"><a href="#cb20-187"></a><span class="fu">### FoldByKey transformation</span></span>
<span id="cb20-188"><a href="#cb20-188"></a>The <span class="in">`foldByKey()`</span> has the same goal of the <span class="in">`reduceBykey()`</span> transformation, however</span>
<span id="cb20-189"><a href="#cb20-189"></a></span>
<span id="cb20-190"><a href="#cb20-190"></a><span class="ss">- </span>It is characterized also by a "zero" value</span>
<span id="cb20-191"><a href="#cb20-191"></a><span class="ss">- </span>Functions must be associative but are not required to be commutative</span>
<span id="cb20-192"><a href="#cb20-192"></a></span>
<span id="cb20-193"><a href="#cb20-193"></a>The foldByKey transformation is based on the <span class="in">`foldByKey(zeroValue, op)`</span> method of the <span class="in">`RDD`</span> class. A function <span class="in">`op`</span> is passed to the fold method:</span>
<span id="cb20-194"><a href="#cb20-194"></a></span>
<span id="cb20-195"><a href="#cb20-195"></a><span class="ss">- </span>Given values of two input pairs, <span class="in">`op`</span> is used to combine them in one single value</span>
<span id="cb20-196"><a href="#cb20-196"></a><span class="ss">- </span><span class="in">`op`</span> is also used to combine input values with the "zero" value</span>
<span id="cb20-197"><a href="#cb20-197"></a><span class="ss">- </span><span class="in">`op`</span> is recursively invoked over the values of the pairs associated with one key at a time until the input values are reduced to one single value</span>
<span id="cb20-198"><a href="#cb20-198"></a></span>
<span id="cb20-199"><a href="#cb20-199"></a>The "zero" value is the neutral value for the used function <span class="in">`op`</span> (i.e., "zero" combined with any value $v$ by using <span class="in">`op`</span> is equal to $v$).</span>
<span id="cb20-200"><a href="#cb20-200"></a></span>
<span id="cb20-201"><a href="#cb20-201"></a>A shuffle operation is executed for computing the result of the <span class="in">`foldByKey()`</span> transformation. The result/value for each group/key is computed from data stored in different input partitions.</span>
<span id="cb20-202"><a href="#cb20-202"></a></span>
<span id="cb20-203"><a href="#cb20-203"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-204"><a href="#cb20-204"></a><span class="fu">### Example</span></span>
<span id="cb20-205"><a href="#cb20-205"></a><span class="ss">1. </span>Create an RDD from a local python list containing the pairs, where the key is the first name of a user and the value is a message published by him/her</span>
<span id="cb20-206"><a href="#cb20-206"></a><span class="ss">    - </span><span class="in">`("Paolo", "Message1")`</span></span>
<span id="cb20-207"><a href="#cb20-207"></a><span class="ss">    - </span><span class="in">`("Giorgio", "Message2")`</span></span>
<span id="cb20-208"><a href="#cb20-208"></a><span class="ss">    - </span><span class="in">`("Paolo", "Message3")`</span></span>
<span id="cb20-209"><a href="#cb20-209"></a><span class="ss">2. </span>Create a new RDD of key-value pairs containing one pair for each name. In the returned RDD, associate each name the concatenation of its messages (preserving the order of the messages in the input RDD).</span>
<span id="cb20-210"><a href="#cb20-210"></a></span>
<span id="cb20-211"><a href="#cb20-211"></a><span class="in">```python</span></span>
<span id="cb20-212"><a href="#cb20-212"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-213"><a href="#cb20-213"></a>nameMess <span class="op">=</span> [</span>
<span id="cb20-214"><a href="#cb20-214"></a>    (<span class="st">"Paolo"</span>,<span class="st">"Message1"</span>),</span>
<span id="cb20-215"><a href="#cb20-215"></a>    (<span class="st">"Giorgio"</span>,<span class="st">"Message2"</span>),</span>
<span id="cb20-216"><a href="#cb20-216"></a>    (<span class="st">"Paolo"</span>,<span class="st">"Message3"</span>)</span>
<span id="cb20-217"><a href="#cb20-217"></a>]</span>
<span id="cb20-218"><a href="#cb20-218"></a></span>
<span id="cb20-219"><a href="#cb20-219"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-220"><a href="#cb20-220"></a>nameMessPairRDD <span class="op">=</span> sc.parallelize(nameMess)</span>
<span id="cb20-221"><a href="#cb20-221"></a></span>
<span id="cb20-222"><a href="#cb20-222"></a><span class="co">## Concatenate the messages of each user</span></span>
<span id="cb20-223"><a href="#cb20-223"></a>concatPairRDD<span class="op">=</span> nameMessPairRDD.foldByKey(<span class="st">''</span>, <span class="kw">lambda</span> m1, m2: m1<span class="op">+</span>m2)</span>
<span id="cb20-224"><a href="#cb20-224"></a><span class="in">```</span></span>
<span id="cb20-225"><a href="#cb20-225"></a></span>
<span id="cb20-226"><a href="#cb20-226"></a>:::</span>
<span id="cb20-227"><a href="#cb20-227"></a></span>
<span id="cb20-228"><a href="#cb20-228"></a><span class="fu">### CombineByKey transformation</span></span>
<span id="cb20-229"><a href="#cb20-229"></a>The goal is to create a new RDD of key-value pairs where there is one pair for each distinct key $k$ of the input RDD of key-value pairs. The value associated with the key $k$ in the new RDD of key-value pairs is computed by applying user-provided functions on the values associated with $k$ in the input RDD of key-value pairs: the user-provided function must be associative, otherwise the result depends how data are partitioned and analyzed.</span>
<span id="cb20-230"><a href="#cb20-230"></a></span>
<span id="cb20-231"><a href="#cb20-231"></a>The data type of the new RDD of key-value pairs can be different with respect to the data type of the input RDD of key-value pairs.</span>
<span id="cb20-232"><a href="#cb20-232"></a></span>
<span id="cb20-233"><a href="#cb20-233"></a>The combineByKey transformation is based on the <span class="in">`combineByKey(createCombiner, mergeValue, mergeCombiner)`</span> method of the <span class="in">`RDD`</span> class</span>
<span id="cb20-234"><a href="#cb20-234"></a></span>
<span id="cb20-235"><a href="#cb20-235"></a><span class="ss">- </span>The values of the input RDD of pairs are of type $V$</span>
<span id="cb20-236"><a href="#cb20-236"></a><span class="ss">- </span>The values of the returned RDD of pairs are of type $U$</span>
<span id="cb20-237"><a href="#cb20-237"></a><span class="ss">- </span>The type of the keys is $K$ for both RDDs of pairs</span>
<span id="cb20-238"><a href="#cb20-238"></a></span>
<span id="cb20-239"><a href="#cb20-239"></a>The <span class="in">`createCombiner`</span> function contains the code that is used to transform a single value (type $V$) of the input RDD of key-value pairs into a value of the data type (type $U$) of the output RDD of key-value pairs. It is used to transform the first value of each key in each partition to a value of type $U$.</span>
<span id="cb20-240"><a href="#cb20-240"></a></span>
<span id="cb20-241"><a href="#cb20-241"></a>The <span class="in">`mergeValue`</span> function contains the code that is used to combine one value of type $U$ with one value of type $V$: it is used in each partition to combine the initial values (type $V$) of each key with the intermediate ones (type $U$) of each key.</span>
<span id="cb20-242"><a href="#cb20-242"></a></span>
<span id="cb20-243"><a href="#cb20-243"></a>The <span class="in">`mergeCombiner`</span> function contains the code that is used to combine two values of type $U$: it is used to combine intermediate values of each key returned by the analysis of different partitions.</span>
<span id="cb20-244"><a href="#cb20-244"></a></span>
<span id="cb20-245"><a href="#cb20-245"></a>The <span class="in">`combineByKey`</span> function is more general than <span class="in">`reduceByKey`</span> and <span class="in">`foldByKey`</span> because the data types of the values of the input and the returned RDD of pairs can be different; for this reason, more functions must be implemented in this case.</span>
<span id="cb20-246"><a href="#cb20-246"></a></span>
<span id="cb20-247"><a href="#cb20-247"></a>A shuffle operation is executed for computing the result of the <span class="in">`combineByKey()`</span> transformation: the result/value for each group/key is computed from data stored in different input partitions.</span>
<span id="cb20-248"><a href="#cb20-248"></a></span>
<span id="cb20-249"><a href="#cb20-249"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-250"><a href="#cb20-250"></a><span class="fu">### Example</span></span>
<span id="cb20-251"><a href="#cb20-251"></a><span class="ss">1. </span>Create an RDD from a local python list containing the the following pairs: the key is the first name of a user and the value is his/her age</span>
<span id="cb20-252"><a href="#cb20-252"></a><span class="ss">    - </span><span class="in">`("Paolo", 40)`</span></span>
<span id="cb20-253"><a href="#cb20-253"></a><span class="ss">    - </span><span class="in">`("Giorgio", 22)`</span></span>
<span id="cb20-254"><a href="#cb20-254"></a><span class="ss">    - </span><span class="in">`("Paolo", 35)`</span></span>
<span id="cb20-255"><a href="#cb20-255"></a><span class="ss">2. </span>Store the results in an output HDFS folder. The output contains one line for each name followed by the average age of the users with that name</span>
<span id="cb20-256"><a href="#cb20-256"></a></span>
<span id="cb20-257"><a href="#cb20-257"></a><span class="in">```python</span></span>
<span id="cb20-258"><a href="#cb20-258"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-259"><a href="#cb20-259"></a>nameAge <span class="op">=</span> [</span>
<span id="cb20-260"><a href="#cb20-260"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb20-261"><a href="#cb20-261"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb20-262"><a href="#cb20-262"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb20-263"><a href="#cb20-263"></a>]</span>
<span id="cb20-264"><a href="#cb20-264"></a></span>
<span id="cb20-265"><a href="#cb20-265"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-266"><a href="#cb20-266"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb20-267"><a href="#cb20-267"></a></span>
<span id="cb20-268"><a href="#cb20-268"></a><span class="co">## Compute the sum of ages and</span></span>
<span id="cb20-269"><a href="#cb20-269"></a><span class="co">## the number of input pairs for each name (key)</span></span>
<span id="cb20-270"><a href="#cb20-270"></a>sumNumPerNamePairRDD <span class="op">=</span> nameAgePairRDD.combineByKey(</span>
<span id="cb20-271"><a href="#cb20-271"></a>    <span class="kw">lambda</span> inputElem: (inputElem, <span class="dv">1</span>),</span>
<span id="cb20-272"><a href="#cb20-272"></a>    <span class="kw">lambda</span> intermediateElem, inputElem: (</span>
<span id="cb20-273"><a href="#cb20-273"></a>        intermediateElem[<span class="dv">0</span>]<span class="op">+</span>inputElem, </span>
<span id="cb20-274"><a href="#cb20-274"></a>        intermediateElem[<span class="dv">1</span>]<span class="op">+</span><span class="dv">1</span></span>
<span id="cb20-275"><a href="#cb20-275"></a>    ),</span>
<span id="cb20-276"><a href="#cb20-276"></a>    <span class="kw">lambda</span> intermediateElem1, intermediateElem2: (</span>
<span id="cb20-277"><a href="#cb20-277"></a>        intermediateElem1[<span class="dv">0</span>]<span class="op">+</span>intermediateElem2[<span class="dv">0</span>], </span>
<span id="cb20-278"><a href="#cb20-278"></a>        intermediateElem1[<span class="dv">1</span>]<span class="op">+</span>intermediateElem2[<span class="dv">1</span>]</span>
<span id="cb20-279"><a href="#cb20-279"></a>    )</span>
<span id="cb20-280"><a href="#cb20-280"></a>)</span>
<span id="cb20-281"><a href="#cb20-281"></a></span>
<span id="cb20-282"><a href="#cb20-282"></a><span class="co">## Compute the average for each name</span></span>
<span id="cb20-283"><a href="#cb20-283"></a>avgPerNamePairRDD <span class="op">=</span> sumNumPerNamePairRDD.<span class="bu">map</span>(</span>
<span id="cb20-284"><a href="#cb20-284"></a>    <span class="kw">lambda</span> pair: (pair[<span class="dv">0</span>], pair[<span class="dv">1</span>][<span class="dv">0</span>]<span class="op">/</span>pair[<span class="dv">1</span>][<span class="dv">1</span>])</span>
<span id="cb20-285"><a href="#cb20-285"></a>)</span>
<span id="cb20-286"><a href="#cb20-286"></a></span>
<span id="cb20-287"><a href="#cb20-287"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb20-288"><a href="#cb20-288"></a>avgPerNamePairRDD.saveAsTextFile(outputPath)</span>
<span id="cb20-289"><a href="#cb20-289"></a><span class="in">```</span></span>
<span id="cb20-290"><a href="#cb20-290"></a></span>
<span id="cb20-291"><a href="#cb20-291"></a>|||</span>
<span id="cb20-292"><a href="#cb20-292"></a>|-|----|</span>
<span id="cb20-293"><a href="#cb20-293"></a>| <span class="in">`lambda inputElem:`</span> | Given an input value (an age), it returns a tuple containing (age,1) |</span>
<span id="cb20-294"><a href="#cb20-294"></a>| <span class="in">`lambda intermediateElem, inputElem:`</span> | Given an input value (an age) and an intermediate value (*sum ages*, *num represented values*), it combines them and returns a new updated tuple (*sum ages*, *num represented values*) |</span>
<span id="cb20-295"><a href="#cb20-295"></a>| <span class="in">`lambda intermediateElem1, intermediateElem2:`</span> | Given two intermediate result tuples (*sum ages*, *num represented values*), it combines them and returns a new updated tuple (*sum ages*, *num represented values*) |</span>
<span id="cb20-296"><a href="#cb20-296"></a>| <span class="in">`lambda pair:`</span> | Compute the average age for each key (i.e., for each name) by combining *sum ages* and *num represented values*. Each input pair is characterized by a value that is a tuple containing (*sum ages*, *num represented values*). |</span>
<span id="cb20-297"><a href="#cb20-297"></a></span>
<span id="cb20-298"><a href="#cb20-298"></a>:::</span>
<span id="cb20-299"><a href="#cb20-299"></a></span>
<span id="cb20-300"><a href="#cb20-300"></a><span class="fu">### GroupByKey transformation</span></span>
<span id="cb20-301"><a href="#cb20-301"></a>The goal is to create a new RDD of key-value pairs where there is one pair for each distinct key $k$ of the input RDD of key-value pairs: the value associated with key $k$ in the new RDD of key-value pairs is the list of values associated with $k$ in the input RDD of key-value pairs.</span>
<span id="cb20-302"><a href="#cb20-302"></a></span>
<span id="cb20-303"><a href="#cb20-303"></a>The groupByKey transformation is based on the <span class="in">`groupByKey()`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb20-304"><a href="#cb20-304"></a></span>
<span id="cb20-305"><a href="#cb20-305"></a>If grouping values per key to perform then an aggregation such as sum or average over the values of each key then groupByKey is not the right choice: <span class="in">`reduceByKey`</span>, <span class="in">`aggregateByKey`</span>, or <span class="in">`combineByKey`</span> provide better performances for associative and commutative aggregations; <span class="in">`groupByKey`</span> is useful if an aggregation or compute a function that is not associative must be applied.</span>
<span id="cb20-306"><a href="#cb20-306"></a></span>
<span id="cb20-307"><a href="#cb20-307"></a>A shuffle operation is executed for computing the result of the <span class="in">`groupByKey()`</span> transformation: each group/key is associated with/is composed of values which are stored in different partitions of the input RDD.</span>
<span id="cb20-308"><a href="#cb20-308"></a></span>
<span id="cb20-309"><a href="#cb20-309"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-310"><a href="#cb20-310"></a><span class="fu">### Example</span></span>
<span id="cb20-311"><a href="#cb20-311"></a><span class="ss">1. </span>Create an RDD from a local python list containing the following pairs: the key is the first name of a user and the value is his/her age.</span>
<span id="cb20-312"><a href="#cb20-312"></a><span class="ss">    - </span><span class="in">`("Paolo", 40)`</span></span>
<span id="cb20-313"><a href="#cb20-313"></a><span class="ss">    - </span><span class="in">`("Giorgio", 22)`</span></span>
<span id="cb20-314"><a href="#cb20-314"></a><span class="ss">    - </span><span class="in">`("Paolo", 35)`</span></span>
<span id="cb20-315"><a href="#cb20-315"></a><span class="ss">2. </span>Store the results in an output HDFS folder. The output contains one line for each name followed by the ages of all the users with that name.</span>
<span id="cb20-316"><a href="#cb20-316"></a></span>
<span id="cb20-317"><a href="#cb20-317"></a><span class="in">```python</span></span>
<span id="cb20-318"><a href="#cb20-318"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-319"><a href="#cb20-319"></a>nameAge <span class="op">=</span> [</span>
<span id="cb20-320"><a href="#cb20-320"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb20-321"><a href="#cb20-321"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb20-322"><a href="#cb20-322"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb20-323"><a href="#cb20-323"></a>]</span>
<span id="cb20-324"><a href="#cb20-324"></a></span>
<span id="cb20-325"><a href="#cb20-325"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-326"><a href="#cb20-326"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb20-327"><a href="#cb20-327"></a></span>
<span id="cb20-328"><a href="#cb20-328"></a><span class="co">## Create one group for each name with the list of associated ages</span></span>
<span id="cb20-329"><a href="#cb20-329"></a>agesPerNamePairRDD <span class="op">=</span> nameAgePairRDD.groupByKey()</span>
<span id="cb20-330"><a href="#cb20-330"></a></span>
<span id="cb20-331"><a href="#cb20-331"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb20-332"><a href="#cb20-332"></a>agesPerNamePairRDD<span class="op">\</span></span>
<span id="cb20-333"><a href="#cb20-333"></a>    .mapValues(<span class="kw">lambda</span> listValues: <span class="bu">list</span>(listValues))<span class="op">\</span></span>
<span id="cb20-334"><a href="#cb20-334"></a>    .saveAsTextFile(outputPath)</span>
<span id="cb20-335"><a href="#cb20-335"></a><span class="in">```</span></span>
<span id="cb20-336"><a href="#cb20-336"></a></span>
<span id="cb20-337"><a href="#cb20-337"></a>|||</span>
<span id="cb20-338"><a href="#cb20-338"></a>|-|----|</span>
<span id="cb20-339"><a href="#cb20-339"></a>| <span class="in">`agesPerNamePairRDD`</span> | In this RDD of key-value pairs each tuple is composed of a string (key of the pair) and a collection of integers (the value of the pair - a <span class="in">`ResultIterable`</span> object) |</span>
<span id="cb20-340"><a href="#cb20-340"></a>| <span class="in">`.mapValues(lambda listValues: list(listValues))`</span> | This part is used to format the content of the value part of each pair before storing the result in the output folder: this transforms a <span class="in">`ResultIterable`</span> object to a Python list. Without this map the output will contain the pointers to <span class="in">`ResultIterable`</span> objects instead of a readable list of integer values |</span>
<span id="cb20-341"><a href="#cb20-341"></a>:::</span>
<span id="cb20-342"><a href="#cb20-342"></a></span>
<span id="cb20-343"><a href="#cb20-343"></a><span class="fu">### MapValues transformation</span></span>
<span id="cb20-344"><a href="#cb20-344"></a>The goal is to apply a function $f$ over the value of each pair of an input RDD or key-value pairs and return a new RDD of key-value pairs: one pair is created in the returned RDD for each input pair</span>
<span id="cb20-345"><a href="#cb20-345"></a></span>
<span id="cb20-346"><a href="#cb20-346"></a><span class="ss">- </span>The key of the created pair is equal to the key of the input pair</span>
<span id="cb20-347"><a href="#cb20-347"></a><span class="ss">- </span>The value of the created pair is obtained by applying the function $f$ on the value of the input pair</span>
<span id="cb20-348"><a href="#cb20-348"></a></span>
<span id="cb20-349"><a href="#cb20-349"></a>The data type of the values of the new RDD of key-value pairs can be different from the data type of the values of the input RDD of key-value pairs. The data type of the key is the same.</span>
<span id="cb20-350"><a href="#cb20-350"></a></span>
<span id="cb20-351"><a href="#cb20-351"></a>The mapValues transformation is based on the <span class="in">`mapValues(f)`</span> method of the <span class="in">`RDD`</span> class: a function <span class="in">`f`</span> is passed to the mapValues method, where <span class="in">`f`</span> contains the code that is applied to transform each input value into the a new value that is stored in the RDD of key-value pairs. The retuned RDD of pairs contains a number of key-value pairs equal to the number of key-value pairs of the input RDD of pairs (the key part is not changed).</span>
<span id="cb20-352"><a href="#cb20-352"></a></span>
<span id="cb20-353"><a href="#cb20-353"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-354"><a href="#cb20-354"></a><span class="fu">### Example</span></span>
<span id="cb20-355"><a href="#cb20-355"></a><span class="ss">1. </span>Create an RDD from a local python list containing the following pairs: the key is the first name of a user and the value is his/her age.</span>
<span id="cb20-356"><a href="#cb20-356"></a><span class="ss">    - </span><span class="in">`("Paolo", 40)`</span></span>
<span id="cb20-357"><a href="#cb20-357"></a><span class="ss">    - </span><span class="in">`("Giorgio", 22)`</span></span>
<span id="cb20-358"><a href="#cb20-358"></a><span class="ss">    - </span><span class="in">`("Paolo", 35)`</span></span>
<span id="cb20-359"><a href="#cb20-359"></a><span class="ss">2. </span>Increase the age of each user (+1 year) and store the result in the HDFS file system, one output line per user.</span>
<span id="cb20-360"><a href="#cb20-360"></a></span>
<span id="cb20-361"><a href="#cb20-361"></a><span class="in">```python</span></span>
<span id="cb20-362"><a href="#cb20-362"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-363"><a href="#cb20-363"></a>nameAge <span class="op">=</span> [</span>
<span id="cb20-364"><a href="#cb20-364"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb20-365"><a href="#cb20-365"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb20-366"><a href="#cb20-366"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb20-367"><a href="#cb20-367"></a>]</span>
<span id="cb20-368"><a href="#cb20-368"></a></span>
<span id="cb20-369"><a href="#cb20-369"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-370"><a href="#cb20-370"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb20-371"><a href="#cb20-371"></a></span>
<span id="cb20-372"><a href="#cb20-372"></a><span class="co">## Increment age of all users</span></span>
<span id="cb20-373"><a href="#cb20-373"></a>plusOnePairRDD <span class="op">=</span> nameAgePairRDD.mapValues(<span class="kw">lambda</span> age: age<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb20-374"><a href="#cb20-374"></a></span>
<span id="cb20-375"><a href="#cb20-375"></a><span class="co">## Save the result on disk</span></span>
<span id="cb20-376"><a href="#cb20-376"></a>plusOnePairRDD.saveAsTextFile(outputPath)</span>
<span id="cb20-377"><a href="#cb20-377"></a><span class="in">```</span></span>
<span id="cb20-378"><a href="#cb20-378"></a>:::</span>
<span id="cb20-379"><a href="#cb20-379"></a></span>
<span id="cb20-380"><a href="#cb20-380"></a><span class="fu">### FlatMapValues transformation</span></span>
<span id="cb20-381"><a href="#cb20-381"></a>The goal is to apply a function $f$ over the value of each pair of an input RDD or key-value pairs and return a new RDD of key-value pairs ($f$ returns a list of values for each input value). A list of pairs is inserted in the returned RDD for each input pair</span>
<span id="cb20-382"><a href="#cb20-382"></a></span>
<span id="cb20-383"><a href="#cb20-383"></a><span class="ss">- </span>The key of the created pairs is equal to the key of the input pair</span>
<span id="cb20-384"><a href="#cb20-384"></a><span class="ss">- </span>The values of the created pairs are obtained by applying the function $f$ on the value of the input pair</span>
<span id="cb20-385"><a href="#cb20-385"></a></span>
<span id="cb20-386"><a href="#cb20-386"></a>The data type of the values of the new RDD of key-value pairs can be different from the data type of the values of the input RDD of key-value pairs. The data type of the key is the same.</span>
<span id="cb20-387"><a href="#cb20-387"></a></span>
<span id="cb20-388"><a href="#cb20-388"></a>The flatMapValues transformation is based on <span class="in">`flatMapValues(f)`</span> method of the <span class="in">`RDD`</span> class: a function <span class="in">`f`</span> is passed to the <span class="in">`mapValues`</span> method, where <span class="in">`f`</span> contains the code that is applied to transform each input value into a set of new values that are stored in the new RDD of key-value pairs. The keys of the input pairs are not changed.</span>
<span id="cb20-389"><a href="#cb20-389"></a></span>
<span id="cb20-390"><a href="#cb20-390"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-391"><a href="#cb20-391"></a><span class="fu">### Example</span></span>
<span id="cb20-392"><a href="#cb20-392"></a><span class="ss">1. </span>Create an RDD from a local python list containing the pairs</span>
<span id="cb20-393"><a href="#cb20-393"></a><span class="ss">    - </span><span class="in">`("Sentence#1", "Sentence test")`</span></span>
<span id="cb20-394"><a href="#cb20-394"></a><span class="ss">    - </span><span class="in">`("Sentence#2", "Sentence test number 2")`</span></span>
<span id="cb20-395"><a href="#cb20-395"></a><span class="ss">    - </span><span class="in">`("Sentence#3", "Sentence test number 3")`</span></span>
<span id="cb20-396"><a href="#cb20-396"></a><span class="ss">2. </span>Select the words of each sentence and store in the HDFS file system one pair (senteceId, word) per line.</span>
<span id="cb20-397"><a href="#cb20-397"></a></span>
<span id="cb20-398"><a href="#cb20-398"></a><span class="in">```python</span></span>
<span id="cb20-399"><a href="#cb20-399"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-400"><a href="#cb20-400"></a>sentences <span class="op">=</span> [</span>
<span id="cb20-401"><a href="#cb20-401"></a>    (<span class="st">"Sentence#1"</span>, <span class="st">"Sentence test"</span>),</span>
<span id="cb20-402"><a href="#cb20-402"></a>    (<span class="st">"Sentence#2"</span>, <span class="st">"Sentence test number 2"</span>),</span>
<span id="cb20-403"><a href="#cb20-403"></a>    (<span class="st">"Sentence#3"</span>, <span class="st">"Sentence test number 3"</span>)</span>
<span id="cb20-404"><a href="#cb20-404"></a>]</span>
<span id="cb20-405"><a href="#cb20-405"></a></span>
<span id="cb20-406"><a href="#cb20-406"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-407"><a href="#cb20-407"></a>sentPairRDD <span class="op">=</span> sc.parallelize(sentences)</span>
<span id="cb20-408"><a href="#cb20-408"></a></span>
<span id="cb20-409"><a href="#cb20-409"></a><span class="co">## “Extract” words from each sentence</span></span>
<span id="cb20-410"><a href="#cb20-410"></a>sentIdWord <span class="op">=</span> sentPairRDD.flatMapValues(<span class="kw">lambda</span> s: s.split(<span class="st">' '</span>))</span>
<span id="cb20-411"><a href="#cb20-411"></a></span>
<span id="cb20-412"><a href="#cb20-412"></a><span class="co">## Save the result on disk</span></span>
<span id="cb20-413"><a href="#cb20-413"></a>sentIdWord.saveAsTextFile(outputPath)</span>
<span id="cb20-414"><a href="#cb20-414"></a><span class="in">```</span></span>
<span id="cb20-415"><a href="#cb20-415"></a>:::</span>
<span id="cb20-416"><a href="#cb20-416"></a></span>
<span id="cb20-417"><a href="#cb20-417"></a><span class="fu">### Keys transformation</span></span>
<span id="cb20-418"><a href="#cb20-418"></a>The goal is to return the list of keys of the input RDD of pairs and store them in a new RDD. The returned RDD is not an RDD of key-value pairs, instead it is a standard RDD of single elements, with duplicate keys not removed.</span>
<span id="cb20-419"><a href="#cb20-419"></a></span>
<span id="cb20-420"><a href="#cb20-420"></a>The keys transformation is based on the <span class="in">`keys()`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb20-421"><a href="#cb20-421"></a></span>
<span id="cb20-422"><a href="#cb20-422"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-423"><a href="#cb20-423"></a><span class="fu">### Example</span></span>
<span id="cb20-424"><a href="#cb20-424"></a><span class="ss">1. </span>Create an RDD from a local python list containing the following pairs: the key is the first name of a user and the value is his/her age</span>
<span id="cb20-425"><a href="#cb20-425"></a><span class="ss">    - </span><span class="in">`("Paolo", 40)`</span></span>
<span id="cb20-426"><a href="#cb20-426"></a><span class="ss">    - </span><span class="in">`("Giorgio", 22)`</span></span>
<span id="cb20-427"><a href="#cb20-427"></a><span class="ss">    - </span><span class="in">`("Paolo", 35)`</span></span>
<span id="cb20-428"><a href="#cb20-428"></a><span class="ss">2. </span>Store the names of the input users in an output HDFS folder. The output contains one name per line (duplicate names are removed).</span>
<span id="cb20-429"><a href="#cb20-429"></a></span>
<span id="cb20-430"><a href="#cb20-430"></a><span class="in">```python</span></span>
<span id="cb20-431"><a href="#cb20-431"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-432"><a href="#cb20-432"></a>nameAge <span class="op">=</span> [</span>
<span id="cb20-433"><a href="#cb20-433"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb20-434"><a href="#cb20-434"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb20-435"><a href="#cb20-435"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb20-436"><a href="#cb20-436"></a>]</span>
<span id="cb20-437"><a href="#cb20-437"></a></span>
<span id="cb20-438"><a href="#cb20-438"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-439"><a href="#cb20-439"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb20-440"><a href="#cb20-440"></a></span>
<span id="cb20-441"><a href="#cb20-441"></a><span class="co">## Select the key part of the input RDD of key-value pairs</span></span>
<span id="cb20-442"><a href="#cb20-442"></a>namesRDD <span class="op">=</span> nameAgePairRDD.keys().distinct()</span>
<span id="cb20-443"><a href="#cb20-443"></a></span>
<span id="cb20-444"><a href="#cb20-444"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb20-445"><a href="#cb20-445"></a>namesRDD.saveAsTextFile(outputPath)</span>
<span id="cb20-446"><a href="#cb20-446"></a><span class="in">```</span></span>
<span id="cb20-447"><a href="#cb20-447"></a>:::</span>
<span id="cb20-448"><a href="#cb20-448"></a></span>
<span id="cb20-449"><a href="#cb20-449"></a><span class="fu">### Values transformation</span></span>
<span id="cb20-450"><a href="#cb20-450"></a>The goal is to return the list of values of the input RDD of pairs and store them in a new RDD. The returned RDD is not an RDD of key-value pairs, instead it is a standard RDD of single elements, with duplicate values are not removed. </span>
<span id="cb20-451"><a href="#cb20-451"></a></span>
<span id="cb20-452"><a href="#cb20-452"></a>The values transformation is based on the <span class="in">`values()`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb20-453"><a href="#cb20-453"></a></span>
<span id="cb20-454"><a href="#cb20-454"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-455"><a href="#cb20-455"></a><span class="fu">### Example</span></span>
<span id="cb20-456"><a href="#cb20-456"></a><span class="ss">1. </span>Create an RDD from a local python list containing the pairs: the key is the first name of a user and the value is his/her age</span>
<span id="cb20-457"><a href="#cb20-457"></a><span class="ss">    - </span><span class="in">`("Paolo", 40)`</span></span>
<span id="cb20-458"><a href="#cb20-458"></a><span class="ss">    - </span><span class="in">`("Giorgio", 22)`</span></span>
<span id="cb20-459"><a href="#cb20-459"></a><span class="ss">    - </span><span class="in">`("Paolo", 22)`</span></span>
<span id="cb20-460"><a href="#cb20-460"></a><span class="ss">2. </span>Store the ages of the input users in an output HDFS folder, containing one age per line and duplicate ages/values are not removed.</span>
<span id="cb20-461"><a href="#cb20-461"></a></span>
<span id="cb20-462"><a href="#cb20-462"></a><span class="in">```python</span></span>
<span id="cb20-463"><a href="#cb20-463"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-464"><a href="#cb20-464"></a>nameAge <span class="op">=</span> [</span>
<span id="cb20-465"><a href="#cb20-465"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb20-466"><a href="#cb20-466"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb20-467"><a href="#cb20-467"></a>    (<span class="st">"Paolo"</span>,<span class="dv">22</span>)</span>
<span id="cb20-468"><a href="#cb20-468"></a>]</span>
<span id="cb20-469"><a href="#cb20-469"></a></span>
<span id="cb20-470"><a href="#cb20-470"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-471"><a href="#cb20-471"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb20-472"><a href="#cb20-472"></a></span>
<span id="cb20-473"><a href="#cb20-473"></a><span class="co">## Select the value part of the input RDD of key-value pairs</span></span>
<span id="cb20-474"><a href="#cb20-474"></a>agesRDD <span class="op">=</span> nameAgePairRDD.values()</span>
<span id="cb20-475"><a href="#cb20-475"></a></span>
<span id="cb20-476"><a href="#cb20-476"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb20-477"><a href="#cb20-477"></a>agesRDD.saveAsTextFile(outputPath)</span>
<span id="cb20-478"><a href="#cb20-478"></a><span class="in">```</span></span>
<span id="cb20-479"><a href="#cb20-479"></a>:::</span>
<span id="cb20-480"><a href="#cb20-480"></a></span>
<span id="cb20-481"><a href="#cb20-481"></a><span class="fu">### SortByKey transformation</span></span>
<span id="cb20-482"><a href="#cb20-482"></a>The goal is to return a new RDD of key-value pairs obtained by sorting, in ascending order, the pairs of the input RDD by key (notice that the final order is related to the default sorting function of the data type of the input keys). The content of the new RDD of key-value pairs is the same of the input RDD but the pairs are sorted by key in the new returned RDD.</span>
<span id="cb20-483"><a href="#cb20-483"></a></span>
<span id="cb20-484"><a href="#cb20-484"></a>The sortByKey transformation is based on the <span class="in">`sortByKey()`</span> method of the <span class="in">`RDD`</span> class (pairs are sorted by key in ascending order). The <span class="in">`sortByKey(ascending)`</span> method of the <span class="in">`RDD`</span> class is also available: this method allows to specify if the sort order is ascending or descending by means of a Boolean parameter (<span class="in">`True`</span> for ascending, <span class="in">`False`</span> for descending).</span>
<span id="cb20-485"><a href="#cb20-485"></a></span>
<span id="cb20-486"><a href="#cb20-486"></a>A shuffle operation is executed for computing the result of the <span class="in">`sortByKey()`</span> transformation, since pairs from different partitions of the input RDD must be compared to sort the input pairs by key.</span>
<span id="cb20-487"><a href="#cb20-487"></a></span>
<span id="cb20-488"><a href="#cb20-488"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-489"><a href="#cb20-489"></a><span class="fu">### Example</span></span>
<span id="cb20-490"><a href="#cb20-490"></a><span class="ss">1. </span>Create an RDD from a local python list containing the pairs: the key is the first name of a user and the value is his/her age</span>
<span id="cb20-491"><a href="#cb20-491"></a><span class="ss">    - </span><span class="in">`("Paolo", 40)`</span></span>
<span id="cb20-492"><a href="#cb20-492"></a><span class="ss">    - </span><span class="in">`("Giorgio", 22)`</span></span>
<span id="cb20-493"><a href="#cb20-493"></a><span class="ss">    - </span><span class="in">`("Paolo", 35)`</span></span>
<span id="cb20-494"><a href="#cb20-494"></a><span class="ss">2. </span>Sort the users by name and store the result in the HDFS file system.</span>
<span id="cb20-495"><a href="#cb20-495"></a></span>
<span id="cb20-496"><a href="#cb20-496"></a><span class="in">```python</span></span>
<span id="cb20-497"><a href="#cb20-497"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-498"><a href="#cb20-498"></a>nameAge <span class="op">=</span> [</span>
<span id="cb20-499"><a href="#cb20-499"></a>    (<span class="st">"Paolo"</span>,<span class="dv">40</span>),</span>
<span id="cb20-500"><a href="#cb20-500"></a>    (<span class="st">"Giorgio"</span>,<span class="dv">22</span>),</span>
<span id="cb20-501"><a href="#cb20-501"></a>    (<span class="st">"Paolo"</span>,<span class="dv">35</span>)</span>
<span id="cb20-502"><a href="#cb20-502"></a>]</span>
<span id="cb20-503"><a href="#cb20-503"></a></span>
<span id="cb20-504"><a href="#cb20-504"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-505"><a href="#cb20-505"></a>nameAgePairRDD <span class="op">=</span> sc.parallelize(nameAge)</span>
<span id="cb20-506"><a href="#cb20-506"></a></span>
<span id="cb20-507"><a href="#cb20-507"></a><span class="co">## Sort by name the content of the input RDD of key-value pairs</span></span>
<span id="cb20-508"><a href="#cb20-508"></a>sortedNameAgePairRDD <span class="op">=</span> nameAgePairRDD.sortByKey()</span>
<span id="cb20-509"><a href="#cb20-509"></a></span>
<span id="cb20-510"><a href="#cb20-510"></a><span class="co">## Store the result in an output folder</span></span>
<span id="cb20-511"><a href="#cb20-511"></a>sortedNameAgePairRDD.saveAsTextFile(outputPath)</span>
<span id="cb20-512"><a href="#cb20-512"></a><span class="in">```</span></span>
<span id="cb20-513"><a href="#cb20-513"></a>:::</span>
<span id="cb20-514"><a href="#cb20-514"></a></span>
<span id="cb20-515"><a href="#cb20-515"></a><span class="fu">### Summary</span></span>
<span id="cb20-516"><a href="#cb20-516"></a>All the examples reported in the following tables are applied on an RDD of pairs containing the following tuples (pairs): <span class="in">`[("k1", 2), ("k3", 4), ("k3", 6)]`</span>.</span>
<span id="cb20-517"><a href="#cb20-517"></a></span>
<span id="cb20-518"><a href="#cb20-518"></a><span class="ss">- </span>The key of each tuple is a string</span>
<span id="cb20-519"><a href="#cb20-519"></a><span class="ss">- </span>The value of each tuple is an integer</span>
<span id="cb20-520"><a href="#cb20-520"></a></span>
<span id="cb20-521"><a href="#cb20-521"></a>::::{.content-visible when-format="html"}</span>
<span id="cb20-522"><a href="#cb20-522"></a>:::{.column-page}</span>
<span id="cb20-523"><a href="#cb20-523"></a></span>
<span id="cb20-524"><a href="#cb20-524"></a>**Purposes**</span>
<span id="cb20-525"><a href="#cb20-525"></a></span>
<span id="cb20-526"><a href="#cb20-526"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-527"><a href="#cb20-527"></a>| Transformation             | Purpose                                                                                                                                                                                                                                                                                                                                                    |</span>
<span id="cb20-528"><a href="#cb20-528"></a>+============================+============================================================================================================================================================================================================================================================================================================================================================+</span>
<span id="cb20-529"><a href="#cb20-529"></a>| <span class="in">`reduceByKey(f)`</span>           | Return an RDD of pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD of pairs is obtained by combining the values of the input RDD associated with the same key. The input RDD of pairs and the new RDD of pairs have the same data type.                                                              |</span>
<span id="cb20-530"><a href="#cb20-530"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-531"><a href="#cb20-531"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-532"><a href="#cb20-532"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-533"><a href="#cb20-533"></a>| <span class="in">`foldByKey(zeroValue, op)`</span> | Similar to the <span class="in">`reduceByKey()`</span> transformation, however <span class="in">`foldByKey()`</span> is characterized also by a zero value.                                                                                                                                                                                                                                                |</span>
<span id="cb20-534"><a href="#cb20-534"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-535"><a href="#cb20-535"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-536"><a href="#cb20-536"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-537"><a href="#cb20-537"></a>| <span class="in">`combineByKey(`</span>            | Return an RDD of key-value pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD is obtained by combining the values of the input RDD associated with the same key. The values of the input RDD of pairs and the values of the new (returned) RDD of pairs can be characterized by different data types. |</span>
<span id="cb20-538"><a href="#cb20-538"></a>|     <span class="in">`createCombiner,`</span>      |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-539"><a href="#cb20-539"></a>|     <span class="in">`mergeValue,`</span>          |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-540"><a href="#cb20-540"></a>|     <span class="in">`mergeCombiner`</span>        |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-541"><a href="#cb20-541"></a>| <span class="in">`)`</span>                        |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-542"><a href="#cb20-542"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-543"><a href="#cb20-543"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-544"><a href="#cb20-544"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-545"><a href="#cb20-545"></a>| <span class="in">`groupByKey()`</span>             | Return an RDD of pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD of pairs is a collection containing all the values of the input RDD associated with one of the input keys.                                                                                                                        |</span>
<span id="cb20-546"><a href="#cb20-546"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-547"><a href="#cb20-547"></a>| <span class="in">`mapValues(f)`</span>             | Apply a function over each pair of an RDD of pairs and return a new RDD of pairs. The applied function returns one pair for each pair of the input RDD of pairs. The function is applied only on the value part without changing the key. The values of the input RDD and the values of new RDD can have different data types.                             |</span>
<span id="cb20-548"><a href="#cb20-548"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-549"><a href="#cb20-549"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-550"><a href="#cb20-550"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-551"><a href="#cb20-551"></a>| <span class="in">`flatMapValues(f)`</span>         | Apply a function over each pair of an RDD of pairs and return a new RDD of pairs. The applied function returns a set of pairs (from 0 to many) for each pair of the input RDD of pairs. The function is applied only on the value part without changing the key. The values of the input RDD and the values of new RDD can have different data types.      |</span>
<span id="cb20-552"><a href="#cb20-552"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-553"><a href="#cb20-553"></a>| <span class="in">`keys()`</span>                   | Return an RDD containing the keys of the input <span class="in">`pairRDD`</span>.                                                                                                                                                                                                                                                                                                  |</span>
<span id="cb20-554"><a href="#cb20-554"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-555"><a href="#cb20-555"></a>| <span class="in">`values()`</span>                 | Return an RDD containing the values of the input <span class="in">`pairRDD`</span>.                                                                                                                                                                                                                                                                                                |</span>
<span id="cb20-556"><a href="#cb20-556"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-557"><a href="#cb20-557"></a>| <span class="in">`sortByKey()`</span>              | Return a <span class="in">`PairRDD`</span> sorted by key. The input <span class="in">`PairRDD`</span> and the new <span class="in">`PairRDD`</span> have the same data type.                                                                                                                                                                                                                                                       |</span>
<span id="cb20-558"><a href="#cb20-558"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-559"><a href="#cb20-559"></a></span>
<span id="cb20-560"><a href="#cb20-560"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb20-561"><a href="#cb20-561"></a></span>
<span id="cb20-562"><a href="#cb20-562"></a>**Examples**</span>
<span id="cb20-563"><a href="#cb20-563"></a></span>
<span id="cb20-564"><a href="#cb20-564"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-565"><a href="#cb20-565"></a>| Transformation             | Example                                                                   | Result                         |</span>
<span id="cb20-566"><a href="#cb20-566"></a>+============================+===========================================================================+================================+</span>
<span id="cb20-567"><a href="#cb20-567"></a>| <span class="in">`reduceByKey(f)`</span>           | <span class="in">`reduceByKey(lambda v1, v2: v1+v2)`</span>                                       | <span class="in">`[("k1",2),("k3",10)]`</span>         |</span>
<span id="cb20-568"><a href="#cb20-568"></a>|                            |                                                                           |                                |</span>
<span id="cb20-569"><a href="#cb20-569"></a>|                            | Sum values per key                                                        |                                |</span>
<span id="cb20-570"><a href="#cb20-570"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-571"><a href="#cb20-571"></a>| <span class="in">`foldByKey(zeroValue, op)`</span> | <span class="in">`foldByKey(0,lambda v1, v2: v1+v2)`</span>                                       | <span class="in">`[("k1",2),("k3",10)]`</span>         |</span>
<span id="cb20-572"><a href="#cb20-572"></a>|                            |                                                                           |                                |</span>
<span id="cb20-573"><a href="#cb20-573"></a>|                            | Sum values per key. The zero value is 0                                   |                                |</span>
<span id="cb20-574"><a href="#cb20-574"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-575"><a href="#cb20-575"></a>| <span class="in">`combineByKey(`</span>            | <span class="in">`combineByKey(`</span>                                                           | <span class="in">`[("k1",(2,1)),("k3",(10,2))]`</span> |</span>
<span id="cb20-576"><a href="#cb20-576"></a>|     <span class="in">`createCombiner,`</span>      |     <span class="in">`lambda e: (e, 1),`</span>                                                   |                                |</span>
<span id="cb20-577"><a href="#cb20-577"></a>|     <span class="in">`mergeValue,`</span>          |     <span class="in">`lambda c, e: (c[0]+e, c[1]+1),`</span>                                      |                                |</span>
<span id="cb20-578"><a href="#cb20-578"></a>|     <span class="in">`mergeCombiner`</span>        |     <span class="in">`lambda c1, c2: (c1[0]+c2[0], c1[1]+c2[1])`</span>                           |                                |</span>
<span id="cb20-579"><a href="#cb20-579"></a>| <span class="in">`)`</span>                        | <span class="in">`)`</span>                                                                       |                                |</span>
<span id="cb20-580"><a href="#cb20-580"></a>|                            |                                                                           |                                |</span>
<span id="cb20-581"><a href="#cb20-581"></a>|                            | Sum values by key and count the number of pairs by key in one single step |                                |</span>
<span id="cb20-582"><a href="#cb20-582"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-583"><a href="#cb20-583"></a>| <span class="in">`groupByKey()`</span>             | <span class="in">`groupByKey()`</span>                                                            | <span class="in">`[("k1",[2]),("k3",[4,6])]`</span>    |</span>
<span id="cb20-584"><a href="#cb20-584"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-585"><a href="#cb20-585"></a>| <span class="in">`mapValues(f)`</span>             | <span class="in">`mapValues(lambda v: v+1)`</span>                                                | <span class="in">`[("k1",3),("k3",5),("k3",7)]`</span> |</span>
<span id="cb20-586"><a href="#cb20-586"></a>|                            |                                                                           |                                |</span>
<span id="cb20-587"><a href="#cb20-587"></a>|                            | Increment the value part by 1                                             |                                |</span>
<span id="cb20-588"><a href="#cb20-588"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-589"><a href="#cb20-589"></a>| <span class="in">`flatMapValues(f)`</span>         | <span class="in">`flatMapValues(lambda v: list(range(v,6)))`</span>                               | <span class="in">`[`</span>                            |</span>
<span id="cb20-590"><a href="#cb20-590"></a>|                            |                                                                           |     <span class="in">`("k1",2),`</span>                |</span>
<span id="cb20-591"><a href="#cb20-591"></a>|                            |                                                                           |     <span class="in">`("k1",3),`</span>                |</span>
<span id="cb20-592"><a href="#cb20-592"></a>|                            |                                                                           |     <span class="in">`("k1",4),`</span>                |</span>
<span id="cb20-593"><a href="#cb20-593"></a>|                            |                                                                           |     <span class="in">`("k1",5),`</span>                |</span>
<span id="cb20-594"><a href="#cb20-594"></a>|                            |                                                                           |     <span class="in">`("k3",4),`</span>                |</span>
<span id="cb20-595"><a href="#cb20-595"></a>|                            |                                                                           |     <span class="in">`("k3",5)`</span>                 |</span>
<span id="cb20-596"><a href="#cb20-596"></a>|                            |                                                                           | <span class="in">`]`</span>                            |</span>
<span id="cb20-597"><a href="#cb20-597"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-598"><a href="#cb20-598"></a>| <span class="in">`keys()`</span>                   | <span class="in">`keys()`</span>                                                                  | <span class="in">`["k1","k3“,"k3"]`</span>             |</span>
<span id="cb20-599"><a href="#cb20-599"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-600"><a href="#cb20-600"></a>| <span class="in">`values()`</span>                 | <span class="in">`values()`</span>                                                                | <span class="in">`[2, 4, 6]`</span>                    |</span>
<span id="cb20-601"><a href="#cb20-601"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-602"><a href="#cb20-602"></a>| <span class="in">`sortByKey()`</span>              | <span class="in">`sortByKey()`</span>                                                             | <span class="in">`[("k1",2),("k3",4),("k3",6)]`</span> |</span>
<span id="cb20-603"><a href="#cb20-603"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-604"><a href="#cb20-604"></a></span>
<span id="cb20-605"><a href="#cb20-605"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb20-606"><a href="#cb20-606"></a></span>
<span id="cb20-607"><a href="#cb20-607"></a>:::</span>
<span id="cb20-608"><a href="#cb20-608"></a>::::</span>
<span id="cb20-609"><a href="#cb20-609"></a></span>
<span id="cb20-610"><a href="#cb20-610"></a>:::{.content-visible when-format="pdf"}</span>
<span id="cb20-611"><a href="#cb20-611"></a></span>
<span id="cb20-612"><a href="#cb20-612"></a>\newpage</span>
<span id="cb20-613"><a href="#cb20-613"></a></span>
<span id="cb20-614"><a href="#cb20-614"></a>\blandscape</span>
<span id="cb20-615"><a href="#cb20-615"></a></span>
<span id="cb20-616"><a href="#cb20-616"></a>**Purposes**</span>
<span id="cb20-617"><a href="#cb20-617"></a></span>
<span id="cb20-618"><a href="#cb20-618"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-619"><a href="#cb20-619"></a>| Transformation             | Purpose                                                                                                                                                                                                                                                                                                                                                    |</span>
<span id="cb20-620"><a href="#cb20-620"></a>+============================+============================================================================================================================================================================================================================================================================================================================================================+</span>
<span id="cb20-621"><a href="#cb20-621"></a>| <span class="in">`reduceByKey(f)`</span>           | Return an RDD of pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD of pairs is obtained by combining the values of the input RDD associated with the same key. The input RDD of pairs and the new RDD of pairs have the same data type.                                                              |</span>
<span id="cb20-622"><a href="#cb20-622"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-623"><a href="#cb20-623"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-624"><a href="#cb20-624"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-625"><a href="#cb20-625"></a>| <span class="in">`foldByKey(zeroValue, op)`</span> | Similar to the <span class="in">`reduceByKey()`</span> transformation, however <span class="in">`foldByKey()`</span> is characterized also by a zero value.                                                                                                                                                                                                                                                |</span>
<span id="cb20-626"><a href="#cb20-626"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-627"><a href="#cb20-627"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-628"><a href="#cb20-628"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-629"><a href="#cb20-629"></a>| <span class="in">`combineByKey(`</span>            | Return an RDD of key-value pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD is obtained by combining the values of the input RDD associated with the same key. The values of the input RDD of pairs and the values of the new (returned) RDD of pairs can be characterized by different data types. |</span>
<span id="cb20-630"><a href="#cb20-630"></a>|     <span class="in">`createCombiner,`</span>      |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-631"><a href="#cb20-631"></a>|     <span class="in">`mergeValue,`</span>          |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-632"><a href="#cb20-632"></a>|     <span class="in">`mergeCombiner`</span>        |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-633"><a href="#cb20-633"></a>| <span class="in">`)`</span>                        |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-634"><a href="#cb20-634"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-635"><a href="#cb20-635"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-636"><a href="#cb20-636"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-637"><a href="#cb20-637"></a>| <span class="in">`groupByKey()`</span>             | Return an RDD of pairs containing one pair for each key of the input RDD of pairs. The value of each pair of the new RDD of pairs is a collection containing all the values of the input RDD associated with one of the input keys.                                                                                                                        |</span>
<span id="cb20-638"><a href="#cb20-638"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-639"><a href="#cb20-639"></a>| <span class="in">`mapValues(f)`</span>             | Apply a function over each pair of an RDD of pairs and return a new RDD of pairs. The applied function returns one pair for each pair of the input RDD of pairs. The function is applied only on the value part without changing the key. The values of the input RDD and the values of new RDD can have different data types.                             |</span>
<span id="cb20-640"><a href="#cb20-640"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-641"><a href="#cb20-641"></a>|                            |                                                                                                                                                                                                                                                                                                                                                            |</span>
<span id="cb20-642"><a href="#cb20-642"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-643"><a href="#cb20-643"></a>| <span class="in">`flatMapValues(f)`</span>         | Apply a function over each pair of an RDD of pairs and return a new RDD of pairs. The applied function returns a set of pairs (from 0 to many) for each pair of the input RDD of pairs. The function is applied only on the value part without changing the key. The values of the input RDD and the values of new RDD can have different data types.      |</span>
<span id="cb20-644"><a href="#cb20-644"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-645"><a href="#cb20-645"></a>| <span class="in">`keys()`</span>                   | Return an RDD containing the keys of the input <span class="in">`pairRDD`</span>.                                                                                                                                                                                                                                                                                                  |</span>
<span id="cb20-646"><a href="#cb20-646"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-647"><a href="#cb20-647"></a>| <span class="in">`values()`</span>                 | Return an RDD containing the values of the input <span class="in">`pairRDD`</span>.                                                                                                                                                                                                                                                                                                |</span>
<span id="cb20-648"><a href="#cb20-648"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-649"><a href="#cb20-649"></a>| <span class="in">`sortByKey()`</span>              | Return a <span class="in">`PairRDD`</span> sorted by key. The input <span class="in">`PairRDD`</span> and the new <span class="in">`PairRDD`</span> have the same data type.                                                                                                                                                                                                                                                       |</span>
<span id="cb20-650"><a href="#cb20-650"></a>+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-651"><a href="#cb20-651"></a></span>
<span id="cb20-652"><a href="#cb20-652"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb20-653"><a href="#cb20-653"></a></span>
<span id="cb20-654"><a href="#cb20-654"></a>\newpage</span>
<span id="cb20-655"><a href="#cb20-655"></a></span>
<span id="cb20-656"><a href="#cb20-656"></a>**Examples**</span>
<span id="cb20-657"><a href="#cb20-657"></a></span>
<span id="cb20-658"><a href="#cb20-658"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-659"><a href="#cb20-659"></a>| Transformation             | Example                                                                   | Result                         |</span>
<span id="cb20-660"><a href="#cb20-660"></a>+============================+===========================================================================+================================+</span>
<span id="cb20-661"><a href="#cb20-661"></a>| <span class="in">`reduceByKey(f)`</span>           | <span class="in">`reduceByKey(lambda v1, v2: v1+v2)`</span>                                       | <span class="in">`[("k1",2),("k3",10)]`</span>         |</span>
<span id="cb20-662"><a href="#cb20-662"></a>|                            |                                                                           |                                |</span>
<span id="cb20-663"><a href="#cb20-663"></a>|                            | Sum values per key                                                        |                                |</span>
<span id="cb20-664"><a href="#cb20-664"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-665"><a href="#cb20-665"></a>| <span class="in">`foldByKey(zeroValue, op)`</span> | <span class="in">`foldByKey(0,lambda v1, v2: v1+v2)`</span>                                       | <span class="in">`[("k1",2),("k3",10)]`</span>         |</span>
<span id="cb20-666"><a href="#cb20-666"></a>|                            |                                                                           |                                |</span>
<span id="cb20-667"><a href="#cb20-667"></a>|                            | Sum values per key. The zero value is 0                                   |                                |</span>
<span id="cb20-668"><a href="#cb20-668"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-669"><a href="#cb20-669"></a>| <span class="in">`combineByKey(`</span>            | <span class="in">`combineByKey(`</span>                                                           | <span class="in">`[("k1",(2,1)),("k3",(10,2))]`</span> |</span>
<span id="cb20-670"><a href="#cb20-670"></a>|     <span class="in">`createCombiner,`</span>      |     <span class="in">`lambda e: (e, 1),`</span>                                                   |                                |</span>
<span id="cb20-671"><a href="#cb20-671"></a>|     <span class="in">`mergeValue,`</span>          |     <span class="in">`lambda c, e: (c[0]+e, c[1]+1),`</span>                                      |                                |</span>
<span id="cb20-672"><a href="#cb20-672"></a>|     <span class="in">`mergeCombiner`</span>        |     <span class="in">`lambda c1, c2: (c1[0]+c2[0], c1[1]+c2[1])`</span>                           |                                |</span>
<span id="cb20-673"><a href="#cb20-673"></a>| <span class="in">`)`</span>                        | <span class="in">`)`</span>                                                                       |                                |</span>
<span id="cb20-674"><a href="#cb20-674"></a>|                            |                                                                           |                                |</span>
<span id="cb20-675"><a href="#cb20-675"></a>|                            | Sum values by key and count the number of pairs by key in one single step |                                |</span>
<span id="cb20-676"><a href="#cb20-676"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-677"><a href="#cb20-677"></a>| <span class="in">`groupByKey()`</span>             | <span class="in">`groupByKey()`</span>                                                            | <span class="in">`[("k1",[2]),("k3",[4,6])]`</span>    |</span>
<span id="cb20-678"><a href="#cb20-678"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-679"><a href="#cb20-679"></a>| <span class="in">`mapValues(f)`</span>             | <span class="in">`mapValues(lambda v: v+1)`</span>                                                | <span class="in">`[("k1",3),("k3",5),("k3",7)]`</span> |</span>
<span id="cb20-680"><a href="#cb20-680"></a>|                            |                                                                           |                                |</span>
<span id="cb20-681"><a href="#cb20-681"></a>|                            | Increment the value part by 1                                             |                                |</span>
<span id="cb20-682"><a href="#cb20-682"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-683"><a href="#cb20-683"></a>| <span class="in">`flatMapValues(f)`</span>         | <span class="in">`flatMapValues(lambda v: list(range(v,6)))`</span>                               | <span class="in">`[`</span>                            |</span>
<span id="cb20-684"><a href="#cb20-684"></a>|                            |                                                                           |     <span class="in">`("k1",2),`</span>                |</span>
<span id="cb20-685"><a href="#cb20-685"></a>|                            |                                                                           |     <span class="in">`("k1",3),`</span>                |</span>
<span id="cb20-686"><a href="#cb20-686"></a>|                            |                                                                           |     <span class="in">`("k1",4),`</span>                |</span>
<span id="cb20-687"><a href="#cb20-687"></a>|                            |                                                                           |     <span class="in">`("k1",5),`</span>                |</span>
<span id="cb20-688"><a href="#cb20-688"></a>|                            |                                                                           |     <span class="in">`("k3",4),`</span>                |</span>
<span id="cb20-689"><a href="#cb20-689"></a>|                            |                                                                           |     <span class="in">`("k3",5)`</span>                 |</span>
<span id="cb20-690"><a href="#cb20-690"></a>|                            |                                                                           | <span class="in">`]`</span>                            |</span>
<span id="cb20-691"><a href="#cb20-691"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-692"><a href="#cb20-692"></a>| <span class="in">`keys()`</span>                   | <span class="in">`keys()`</span>                                                                  | <span class="in">`["k1","k3“,"k3"]`</span>             |</span>
<span id="cb20-693"><a href="#cb20-693"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-694"><a href="#cb20-694"></a>| <span class="in">`values()`</span>                 | <span class="in">`values()`</span>                                                                | <span class="in">`[2, 4, 6]`</span>                    |</span>
<span id="cb20-695"><a href="#cb20-695"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-696"><a href="#cb20-696"></a>| <span class="in">`sortByKey()`</span>              | <span class="in">`sortByKey()`</span>                                                             | <span class="in">`[("k1",2),("k3",4),("k3",6)]`</span> |</span>
<span id="cb20-697"><a href="#cb20-697"></a>+----------------------------+---------------------------------------------------------------------------+--------------------------------+</span>
<span id="cb20-698"><a href="#cb20-698"></a></span>
<span id="cb20-699"><a href="#cb20-699"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb20-700"><a href="#cb20-700"></a></span>
<span id="cb20-701"><a href="#cb20-701"></a>\elandscape</span>
<span id="cb20-702"><a href="#cb20-702"></a></span>
<span id="cb20-703"><a href="#cb20-703"></a>:::</span>
<span id="cb20-704"><a href="#cb20-704"></a></span>
<span id="cb20-705"><a href="#cb20-705"></a><span class="fu">## RDD-based programming</span></span>
<span id="cb20-706"><a href="#cb20-706"></a><span class="fu">### Transformations on two RDDs of key-value pairs</span></span>
<span id="cb20-707"><a href="#cb20-707"></a>Spark supports also some transformations that are applied on two RDDs of key-value pairs at the same time (e.g., <span class="in">`subtractByKey`</span>, <span class="in">`join`</span>, <span class="in">`coGroup`</span>).</span>
<span id="cb20-708"><a href="#cb20-708"></a></span>
<span id="cb20-709"><a href="#cb20-709"></a><span class="fu">### SubtractByKey transformation</span></span>
<span id="cb20-710"><a href="#cb20-710"></a>The goal is to create a new RDD of key-value pairs containing only the pairs of the first input RDD of pairs associated with a key that is not appearing as key in the pairs of the second input RDD or pairs. The two input RDD of pairs must have the same type of keys, but the data type of the values can be different. The data type of the new RDD of pairs is the same of the first input RDD of pairs.</span>
<span id="cb20-711"><a href="#cb20-711"></a></span>
<span id="cb20-712"><a href="#cb20-712"></a>The subtractByKey transformation is based on the <span class="in">`subtractByKey(other)`</span> method of the <span class="in">`RDD`</span> class. The two input RDDs of pairs analyzed by <span class="in">`subtractByKey`</span> are the one which the method is invoked on and the one passed as parameter (i.e., <span class="in">`other`</span>).</span>
<span id="cb20-713"><a href="#cb20-713"></a></span>
<span id="cb20-714"><a href="#cb20-714"></a>A shuffle operation is executed for computing the result of the <span class="in">`subtractByKey()`</span> transformation, since keys from different partitions of the two input RDDs must be compared.</span>
<span id="cb20-715"><a href="#cb20-715"></a></span>
<span id="cb20-716"><a href="#cb20-716"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-717"><a href="#cb20-717"></a><span class="fu">### Example</span></span>
<span id="cb20-718"><a href="#cb20-718"></a><span class="ss">1. </span>Create two RDDs of key-value pairs from two local python lists</span>
<span id="cb20-719"><a href="#cb20-719"></a><span class="ss">    - </span>First list – Profiles of the users of a blog <span class="in">`(username,age)`</span>: <span class="in">`[("PaoloG",40),("Giorgio",22),("PaoloB",35)]`</span></span>
<span id="cb20-720"><a href="#cb20-720"></a><span class="ss">    - </span>Second list – Banned users <span class="in">`(username,motivation)`</span>: <span class="in">`[("PaoloB","spam"),("Giorgio","Vandalism")]`</span></span>
<span id="cb20-721"><a href="#cb20-721"></a><span class="ss">2. </span>Create a new RDD of pairs containing only the profiles of the non-banned users.</span>
<span id="cb20-722"><a href="#cb20-722"></a></span>
<span id="cb20-723"><a href="#cb20-723"></a><span class="in">```python</span></span>
<span id="cb20-724"><a href="#cb20-724"></a><span class="co">## Create the first local python list</span></span>
<span id="cb20-725"><a href="#cb20-725"></a>profiles <span class="op">=</span> [(<span class="st">"PaoloG"</span>,<span class="dv">40</span>),(<span class="st">"Giorgio"</span>,<span class="dv">22</span>),(<span class="st">"PaoloB"</span>,<span class="dv">35</span>)]</span>
<span id="cb20-726"><a href="#cb20-726"></a></span>
<span id="cb20-727"><a href="#cb20-727"></a><span class="co">## Create the RDD of pairs from the profiles local list</span></span>
<span id="cb20-728"><a href="#cb20-728"></a>profilesPairRDD <span class="op">=</span> sc.parallelize (profiles)</span>
<span id="cb20-729"><a href="#cb20-729"></a></span>
<span id="cb20-730"><a href="#cb20-730"></a><span class="co">## Create the second local python list</span></span>
<span id="cb20-731"><a href="#cb20-731"></a>banned <span class="op">=</span> [(<span class="st">"PaoloB"</span>,<span class="st">"spam"</span>),(<span class="st">"Giorgio"</span>,<span class="st">"Vandalism"</span>)]</span>
<span id="cb20-732"><a href="#cb20-732"></a></span>
<span id="cb20-733"><a href="#cb20-733"></a><span class="co">## Create the RDD of pairs from the banned local list</span></span>
<span id="cb20-734"><a href="#cb20-734"></a>bannedPairRDD <span class="op">=</span> sc.parallelize (banned)</span>
<span id="cb20-735"><a href="#cb20-735"></a></span>
<span id="cb20-736"><a href="#cb20-736"></a><span class="co">## Select the profiles of the “good” users</span></span>
<span id="cb20-737"><a href="#cb20-737"></a>selectedProfiles <span class="op">=</span> profilesPairRDD.subtractByKey(bannedPairRDD)</span>
<span id="cb20-738"><a href="#cb20-738"></a><span class="in">```</span></span>
<span id="cb20-739"><a href="#cb20-739"></a></span>
<span id="cb20-740"><a href="#cb20-740"></a>:::</span>
<span id="cb20-741"><a href="#cb20-741"></a></span>
<span id="cb20-742"><a href="#cb20-742"></a><span class="fu">### Join transformation</span></span>
<span id="cb20-743"><a href="#cb20-743"></a>The goal is to Join the key-value pairs of two RDDs of key-value pairs based on the value of the key of the pairs: each pair of the input RDD of pairs is combined with all the pairs of the other RDD of pairs with the same key. The new RDD of key-value pairs has the same key data type of the input RDDs of pairs, and has a tuple as value (the pair of values of the two joined input pairs). The two input RDDs of key-value pairs must have the same type of keys, but the data types of the values can be different.</span>
<span id="cb20-744"><a href="#cb20-744"></a></span>
<span id="cb20-745"><a href="#cb20-745"></a>The join transformation is based on the <span class="in">`join(other)`</span> method of the <span class="in">`RDD`</span> class: the two input RDDs of pairs analyzed by join are the one which the method is invoked on and the one passed as parameter (i.e., <span class="in">`other`</span>).</span>
<span id="cb20-746"><a href="#cb20-746"></a></span>
<span id="cb20-747"><a href="#cb20-747"></a>A shuffle operation is executed for computing the result of the <span class="in">`join()`</span> transformation, since keys from different partitions of the two input RDDs must be compared and values from different partitions must be retrieved.</span>
<span id="cb20-748"><a href="#cb20-748"></a></span>
<span id="cb20-749"><a href="#cb20-749"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-750"><a href="#cb20-750"></a><span class="fu">### Example</span></span>
<span id="cb20-751"><a href="#cb20-751"></a><span class="ss">1. </span>Create two RDDs of key-value pairs from two local python lists</span>
<span id="cb20-752"><a href="#cb20-752"></a><span class="ss">    - </span>First list – List of questions (QuestionId, Text of the question): <span class="in">`[(1,"What is ...?"),(2,"Who is ...?")]`</span></span>
<span id="cb20-753"><a href="#cb20-753"></a><span class="ss">    - </span>Second list – List of answers (QuestionId, Text of the answer): <span class="in">`[(1,"It is a car"),(1,"It is a byke"),(2,"She is Jenny")]`</span></span>
<span id="cb20-754"><a href="#cb20-754"></a><span class="ss">2. </span>Create a new RDD of pairs to associate each question with its answers: one pair for each possible pair (question-answer)</span>
<span id="cb20-755"><a href="#cb20-755"></a></span>
<span id="cb20-756"><a href="#cb20-756"></a><span class="in">```python</span></span>
<span id="cb20-757"><a href="#cb20-757"></a><span class="co">## Create the first local Python list</span></span>
<span id="cb20-758"><a href="#cb20-758"></a>questions<span class="op">=</span> [(<span class="dv">1</span>,<span class="st">"What is ...?"</span>),(<span class="dv">2</span>,<span class="st">"Who is ...?"</span>)]</span>
<span id="cb20-759"><a href="#cb20-759"></a></span>
<span id="cb20-760"><a href="#cb20-760"></a><span class="co">## Create the RDD of pairs from the local list</span></span>
<span id="cb20-761"><a href="#cb20-761"></a>questionsPairRDD <span class="op">=</span> sc.parallelize(questions)</span>
<span id="cb20-762"><a href="#cb20-762"></a></span>
<span id="cb20-763"><a href="#cb20-763"></a><span class="co">## Create the second local python list</span></span>
<span id="cb20-764"><a href="#cb20-764"></a>answers <span class="op">=</span> [(<span class="dv">1</span>,<span class="st">"It is a car"</span>),(<span class="dv">1</span>,<span class="st">"It is a byke"</span>),(<span class="dv">2</span>,<span class="st">"She is Jenny"</span>)]</span>
<span id="cb20-765"><a href="#cb20-765"></a></span>
<span id="cb20-766"><a href="#cb20-766"></a><span class="co">## Create the RDD of pairs from the local list</span></span>
<span id="cb20-767"><a href="#cb20-767"></a>answersPairRDD <span class="op">=</span> sc.parallelize(answers)</span>
<span id="cb20-768"><a href="#cb20-768"></a></span>
<span id="cb20-769"><a href="#cb20-769"></a><span class="co">## Join questions with answers</span></span>
<span id="cb20-770"><a href="#cb20-770"></a>joinPairRDD <span class="op">=</span> questionsPairRDD.join(answersPairRDD)</span>
<span id="cb20-771"><a href="#cb20-771"></a><span class="in">```</span></span>
<span id="cb20-772"><a href="#cb20-772"></a></span>
<span id="cb20-773"><a href="#cb20-773"></a>|||</span>
<span id="cb20-774"><a href="#cb20-774"></a>|-|---|</span>
<span id="cb20-775"><a href="#cb20-775"></a>| <span class="in">`joinPairRDD`</span> | The key part of the returned RDD of pairs is an integer number. The value part of the returned RDD of pairs is a tuple containing two values: (question,answer). |</span>
<span id="cb20-776"><a href="#cb20-776"></a></span>
<span id="cb20-777"><a href="#cb20-777"></a>:::</span>
<span id="cb20-778"><a href="#cb20-778"></a></span>
<span id="cb20-779"><a href="#cb20-779"></a><span class="fu">### CoGroup transformation</span></span>
<span id="cb20-780"><a href="#cb20-780"></a>The goal is to associate each key $k$ of the two input RDDs of key-value pairs with </span>
<span id="cb20-781"><a href="#cb20-781"></a></span>
<span id="cb20-782"><a href="#cb20-782"></a><span class="ss">- </span>The list of values associated with $k$ in the first input RDD of pairs</span>
<span id="cb20-783"><a href="#cb20-783"></a><span class="ss">- </span>The list of values associated with $k$ in the second input RDD of pairs</span>
<span id="cb20-784"><a href="#cb20-784"></a></span>
<span id="cb20-785"><a href="#cb20-785"></a>The new RDD of key-value pairs has the same key data type of the two input RDDs of pairs, and has a tuple as value (the two lists of values of the two input RDDs of pairs). The two input RDDs of key-value pairs must have the same type of keys, but the data types of the values can be different.</span>
<span id="cb20-786"><a href="#cb20-786"></a></span>
<span id="cb20-787"><a href="#cb20-787"></a>The cogroup transformation is based on the <span class="in">`cogroup(other)`</span> method of the <span class="in">`RDD`</span> class: the two input RDDs of pairs analyzed by cogroup are the one which the method is invoked on and the one passed as parameter (i.e., <span class="in">`other`</span>).</span>
<span id="cb20-788"><a href="#cb20-788"></a></span>
<span id="cb20-789"><a href="#cb20-789"></a>A shuffle operation is executed for computing the result of the <span class="in">`cogroup()`</span> transformation, since keys from different partitions of the two input RDDs must be compared and values from different partitions must be retrieved.</span>
<span id="cb20-790"><a href="#cb20-790"></a></span>
<span id="cb20-791"><a href="#cb20-791"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-792"><a href="#cb20-792"></a><span class="fu">### Example</span></span>
<span id="cb20-793"><a href="#cb20-793"></a><span class="ss">1. </span>Create two RDDs of key-value pairs from two local python lists</span>
<span id="cb20-794"><a href="#cb20-794"></a><span class="ss">    - </span>First list – List of liked movies <span class="in">`(userId,likedMovies)`</span>: <span class="in">`[(1,"Star Trek"),(1,"Forrest Gump"),(2,"Forrest Gump")]`</span></span>
<span id="cb20-795"><a href="#cb20-795"></a><span class="ss">    - </span>Second list – List of liked directors <span class="in">`(userId,likedDirector)`</span>: <span class="in">`[(1,"Woody Allen"),(2,"Quentin Tarantino"),(2,"Alfred Hitchcock")]`</span></span>
<span id="cb20-796"><a href="#cb20-796"></a><span class="ss">2. </span>Create a new RDD of pairs containing one pair for each userId (key) associated with</span>
<span id="cb20-797"><a href="#cb20-797"></a><span class="ss">    - </span>The list of liked movies</span>
<span id="cb20-798"><a href="#cb20-798"></a><span class="ss">    - </span>The list of liked directors</span>
<span id="cb20-799"><a href="#cb20-799"></a></span>
<span id="cb20-800"><a href="#cb20-800"></a>*Inputs*</span>
<span id="cb20-801"><a href="#cb20-801"></a><span class="ss">- </span><span class="in">`[(1,"Star Trek"),(1,"Forrest Gump"),(2,"Forrest Gump")]`</span></span>
<span id="cb20-802"><a href="#cb20-802"></a><span class="ss">- </span><span class="in">`[(1,"Woody Allen"),(2,"Quentin Tarantino"),(2,"Alfred Hitchcock")]`</span></span>
<span id="cb20-803"><a href="#cb20-803"></a></span>
<span id="cb20-804"><a href="#cb20-804"></a>*Output*</span>
<span id="cb20-805"><a href="#cb20-805"></a><span class="ss">- </span><span class="in">`(1,(["Star Trek","Forrest Gump"],["Woody Allen"]))`</span></span>
<span id="cb20-806"><a href="#cb20-806"></a><span class="ss">- </span><span class="in">`(2,(["Forrest Gump"],["Quentin Tarantino","Alfred Hitchcock"]))`</span></span>
<span id="cb20-807"><a href="#cb20-807"></a></span>
<span id="cb20-808"><a href="#cb20-808"></a><span class="in">```python</span></span>
<span id="cb20-809"><a href="#cb20-809"></a><span class="co">## Create the first local python list</span></span>
<span id="cb20-810"><a href="#cb20-810"></a>movies<span class="op">=</span> [</span>
<span id="cb20-811"><a href="#cb20-811"></a>    (<span class="dv">1</span>,<span class="st">"Star Trek"</span>),</span>
<span id="cb20-812"><a href="#cb20-812"></a>    (<span class="dv">1</span>,<span class="st">"Forrest Gump"</span>),</span>
<span id="cb20-813"><a href="#cb20-813"></a>    (<span class="dv">2</span>,<span class="st">"Forrest Gump"</span>)</span>
<span id="cb20-814"><a href="#cb20-814"></a>]</span>
<span id="cb20-815"><a href="#cb20-815"></a></span>
<span id="cb20-816"><a href="#cb20-816"></a><span class="co">## Create the RDD of pairs from the first local list</span></span>
<span id="cb20-817"><a href="#cb20-817"></a>moviesPairRDD <span class="op">=</span> sc.parallelize(movies)</span>
<span id="cb20-818"><a href="#cb20-818"></a></span>
<span id="cb20-819"><a href="#cb20-819"></a><span class="co">## Create the second local python list</span></span>
<span id="cb20-820"><a href="#cb20-820"></a>directors <span class="op">=</span> [</span>
<span id="cb20-821"><a href="#cb20-821"></a>    (<span class="dv">1</span>,<span class="st">"Woody Allen"</span>),</span>
<span id="cb20-822"><a href="#cb20-822"></a>    (<span class="dv">2</span>,<span class="st">"Quentin Tarantino"</span>),</span>
<span id="cb20-823"><a href="#cb20-823"></a>    (<span class="dv">2</span>,<span class="st">"Alfred Hitchcock"</span>)</span>
<span id="cb20-824"><a href="#cb20-824"></a>]</span>
<span id="cb20-825"><a href="#cb20-825"></a></span>
<span id="cb20-826"><a href="#cb20-826"></a><span class="co">## Create the RDD of pairs from the second local list</span></span>
<span id="cb20-827"><a href="#cb20-827"></a>directorsPairRDD <span class="op">=</span> sc.parallelize(directors)</span>
<span id="cb20-828"><a href="#cb20-828"></a></span>
<span id="cb20-829"><a href="#cb20-829"></a><span class="co">## Cogroup movies and directors per user</span></span>
<span id="cb20-830"><a href="#cb20-830"></a>cogroupPairRDD <span class="op">=</span> moviesPairRDD.cogroup(directorsPairRDD)</span>
<span id="cb20-831"><a href="#cb20-831"></a><span class="in">```</span></span>
<span id="cb20-832"><a href="#cb20-832"></a></span>
<span id="cb20-833"><a href="#cb20-833"></a>|||</span>
<span id="cb20-834"><a href="#cb20-834"></a>|-|---|</span>
<span id="cb20-835"><a href="#cb20-835"></a>| <span class="in">`cogroupPairRDD`</span> | Notice that the value part of the returned tuples is a tuple containing two lists: the first value contains the list of movies (iterable) liked by a user; the second value contains the list of directors (iterable) liked by a user. |</span>
<span id="cb20-836"><a href="#cb20-836"></a></span>
<span id="cb20-837"><a href="#cb20-837"></a>:::</span>
<span id="cb20-838"><a href="#cb20-838"></a></span>
<span id="cb20-839"><a href="#cb20-839"></a><span class="fu">### Summary</span></span>
<span id="cb20-840"><a href="#cb20-840"></a>All the examples reported in the following tables are applied on the following two RDDs of key-value pairs</span>
<span id="cb20-841"><a href="#cb20-841"></a></span>
<span id="cb20-842"><a href="#cb20-842"></a><span class="ss">- </span><span class="in">`inputRDD1`</span>: <span class="in">`[('k1',2),('k3',4),('k3',6)]`</span></span>
<span id="cb20-843"><a href="#cb20-843"></a><span class="ss">- </span><span class="in">`inputRDD2`</span>: <span class="in">`[('k3',9)]`</span></span>
<span id="cb20-844"><a href="#cb20-844"></a></span>
<span id="cb20-845"><a href="#cb20-845"></a>::::{.content-visible when-format="html"}</span>
<span id="cb20-846"><a href="#cb20-846"></a>:::{.column-page}</span>
<span id="cb20-847"><a href="#cb20-847"></a></span>
<span id="cb20-848"><a href="#cb20-848"></a>**Purposes**</span>
<span id="cb20-849"><a href="#cb20-849"></a></span>
<span id="cb20-850"><a href="#cb20-850"></a>+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-851"><a href="#cb20-851"></a>| Transformation         | Purpose                                                                                                                                                                                                                                                     |</span>
<span id="cb20-852"><a href="#cb20-852"></a>+========================+=============================================================================================================================================================================================================================================================+</span>
<span id="cb20-853"><a href="#cb20-853"></a>| <span class="in">`subtractByKey(other)`</span> | Return a new RDD of key-value pairs. The returned pairs are those of input RDD on which the method is invoked such that the key part does not occur in the keys of the RDD that is passed as parameter. The values are not considered to take the decision. |</span>
<span id="cb20-854"><a href="#cb20-854"></a>+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-855"><a href="#cb20-855"></a>| <span class="in">`join(other)`</span>          | Return a new RDD of pairs corresponding to join of the two input RDDs. The join is based on the value of the key.                                                                                                                                           |</span>
<span id="cb20-856"><a href="#cb20-856"></a>+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-857"><a href="#cb20-857"></a>| <span class="in">`cogroup(other)`</span>       | For each key $k$ in one of the two input RDDs of pairs, return a pair $(k, tuple)$, where tuple contains:                                                                                                                                                   |</span>
<span id="cb20-858"><a href="#cb20-858"></a>|                        |                                                                                                                                                                                                                                                             |</span>
<span id="cb20-859"><a href="#cb20-859"></a>|                        | - the list (iterable) of values of the first input RDD associated with key $k$;                                                                                                                                                                             |</span>
<span id="cb20-860"><a href="#cb20-860"></a>|                        | - the list (iterable) of values of the second input RDD associated with key $k$.                                                                                                                                                                            |</span>
<span id="cb20-861"><a href="#cb20-861"></a>+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-862"><a href="#cb20-862"></a></span>
<span id="cb20-863"><a href="#cb20-863"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb20-864"><a href="#cb20-864"></a></span>
<span id="cb20-865"><a href="#cb20-865"></a>**Examples**</span>
<span id="cb20-866"><a href="#cb20-866"></a></span>
<span id="cb20-867"><a href="#cb20-867"></a>+------------------------+--------------------------------------+----------------------------------------+</span>
<span id="cb20-868"><a href="#cb20-868"></a>| Transformation         | Example                              | Result                                 |</span>
<span id="cb20-869"><a href="#cb20-869"></a>+========================+======================================+========================================+</span>
<span id="cb20-870"><a href="#cb20-870"></a>| <span class="in">`subtractByKey(other)`</span> | <span class="in">`inputRDD1.subtractByKey(inputRDD2)`</span> | <span class="in">`[('k1',2)]`</span>                           |</span>
<span id="cb20-871"><a href="#cb20-871"></a>+------------------------+--------------------------------------+----------------------------------------+</span>
<span id="cb20-872"><a href="#cb20-872"></a>| <span class="in">`join(other)`</span>          | <span class="in">`inputRDD1.join(inputRDD2)`</span>          | <span class="in">`[('k3',(4,9)),('k3',(6,9))]`</span>          |</span>
<span id="cb20-873"><a href="#cb20-873"></a>+------------------------+--------------------------------------+----------------------------------------+</span>
<span id="cb20-874"><a href="#cb20-874"></a>| <span class="in">`cogroup(other)`</span>       | <span class="in">`inputRDD1.cogroup(inputRDD2)`</span>       | <span class="in">`[('k1',([2],[])),('k3',([4,6],[9]))]`</span> |</span>
<span id="cb20-875"><a href="#cb20-875"></a>|                        |                                      |                                        |</span>
<span id="cb20-876"><a href="#cb20-876"></a>|                        |                                      |                                        |</span>
<span id="cb20-877"><a href="#cb20-877"></a>|                        |                                      |                                        |</span>
<span id="cb20-878"><a href="#cb20-878"></a>+------------------------+--------------------------------------+----------------------------------------+</span>
<span id="cb20-879"><a href="#cb20-879"></a></span>
<span id="cb20-880"><a href="#cb20-880"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb20-881"><a href="#cb20-881"></a></span>
<span id="cb20-882"><a href="#cb20-882"></a>:::</span>
<span id="cb20-883"><a href="#cb20-883"></a>::::</span>
<span id="cb20-884"><a href="#cb20-884"></a></span>
<span id="cb20-885"><a href="#cb20-885"></a>:::{.content-visible when-format="pdf"}</span>
<span id="cb20-886"><a href="#cb20-886"></a></span>
<span id="cb20-887"><a href="#cb20-887"></a>\newpage</span>
<span id="cb20-888"><a href="#cb20-888"></a></span>
<span id="cb20-889"><a href="#cb20-889"></a>\blandscape</span>
<span id="cb20-890"><a href="#cb20-890"></a></span>
<span id="cb20-891"><a href="#cb20-891"></a>**Purposes**</span>
<span id="cb20-892"><a href="#cb20-892"></a></span>
<span id="cb20-893"><a href="#cb20-893"></a>+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-894"><a href="#cb20-894"></a>| Transformation         | Purpose                                                                                                                                                                                                                                                     |</span>
<span id="cb20-895"><a href="#cb20-895"></a>+========================+=============================================================================================================================================================================================================================================================+</span>
<span id="cb20-896"><a href="#cb20-896"></a>| <span class="in">`subtractByKey(other)`</span> | Return a new RDD of key-value pairs. The returned pairs are those of input RDD on which the method is invoked such that the key part does not occur in the keys of the RDD that is passed as parameter. The values are not considered to take the decision. |</span>
<span id="cb20-897"><a href="#cb20-897"></a>+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-898"><a href="#cb20-898"></a>| <span class="in">`join(other)`</span>          | Return a new RDD of pairs corresponding to join of the two input RDDs. The join is based on the value of the key.                                                                                                                                           |</span>
<span id="cb20-899"><a href="#cb20-899"></a>+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-900"><a href="#cb20-900"></a>| <span class="in">`cogroup(other)`</span>       | For each key $k$ in one of the two input RDDs of pairs, return a pair $(k, tuple)$, where tuple contains:                                                                                                                                                   |</span>
<span id="cb20-901"><a href="#cb20-901"></a>|                        |                                                                                                                                                                                                                                                             |</span>
<span id="cb20-902"><a href="#cb20-902"></a>|                        | - the list (iterable) of values of the first input RDD associated with key $k$;                                                                                                                                                                             |</span>
<span id="cb20-903"><a href="#cb20-903"></a>|                        | - the list (iterable) of values of the second input RDD associated with key $k$.                                                                                                                                                                            |</span>
<span id="cb20-904"><a href="#cb20-904"></a>+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-905"><a href="#cb20-905"></a></span>
<span id="cb20-906"><a href="#cb20-906"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb20-907"><a href="#cb20-907"></a></span>
<span id="cb20-908"><a href="#cb20-908"></a>\newpage</span>
<span id="cb20-909"><a href="#cb20-909"></a></span>
<span id="cb20-910"><a href="#cb20-910"></a>**Examples**</span>
<span id="cb20-911"><a href="#cb20-911"></a></span>
<span id="cb20-912"><a href="#cb20-912"></a>+------------------------+--------------------------------------+----------------------------------------+</span>
<span id="cb20-913"><a href="#cb20-913"></a>| Transformation         | Example                              | Result                                 |</span>
<span id="cb20-914"><a href="#cb20-914"></a>+========================+======================================+========================================+</span>
<span id="cb20-915"><a href="#cb20-915"></a>| <span class="in">`subtractByKey(other)`</span> | <span class="in">`inputRDD1.subtractByKey(inputRDD2)`</span> | <span class="in">`[('k1',2)]`</span>                           |</span>
<span id="cb20-916"><a href="#cb20-916"></a>+------------------------+--------------------------------------+----------------------------------------+</span>
<span id="cb20-917"><a href="#cb20-917"></a>| <span class="in">`join(other)`</span>          | <span class="in">`inputRDD1.join(inputRDD2)`</span>          | <span class="in">`[('k3',(4,9)),('k3',(6,9))]`</span>          |</span>
<span id="cb20-918"><a href="#cb20-918"></a>+------------------------+--------------------------------------+----------------------------------------+</span>
<span id="cb20-919"><a href="#cb20-919"></a>| <span class="in">`cogroup(other)`</span>       | <span class="in">`inputRDD1.cogroup(inputRDD2)`</span>       | <span class="in">`[('k1',([2],[])),('k3',([4,6],[9]))]`</span> |</span>
<span id="cb20-920"><a href="#cb20-920"></a>|                        |                                      |                                        |</span>
<span id="cb20-921"><a href="#cb20-921"></a>|                        |                                      |                                        |</span>
<span id="cb20-922"><a href="#cb20-922"></a>|                        |                                      |                                        |</span>
<span id="cb20-923"><a href="#cb20-923"></a>+------------------------+--------------------------------------+----------------------------------------+</span>
<span id="cb20-924"><a href="#cb20-924"></a></span>
<span id="cb20-925"><a href="#cb20-925"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb20-926"><a href="#cb20-926"></a></span>
<span id="cb20-927"><a href="#cb20-927"></a>\elandscape</span>
<span id="cb20-928"><a href="#cb20-928"></a></span>
<span id="cb20-929"><a href="#cb20-929"></a>:::</span>
<span id="cb20-930"><a href="#cb20-930"></a></span>
<span id="cb20-931"><a href="#cb20-931"></a><span class="fu">## Actions on RDDs of key-value pairs</span></span>
<span id="cb20-932"><a href="#cb20-932"></a>Spark supports also some specific actions on RDDs of key-value pairs (e.g., <span class="in">`countByKey`</span>, <span class="in">`collectAsMap`</span>, <span class="in">`lookup`</span>).</span>
<span id="cb20-933"><a href="#cb20-933"></a></span>
<span id="cb20-934"><a href="#cb20-934"></a><span class="fu">### CountByKey action</span></span>
<span id="cb20-935"><a href="#cb20-935"></a>The countByKey action returns a local python dictionary containing the information about the number of elements associated with each key in the input RDD of key-value pairs (i.e., the number of times each key occurs in the input RDD).</span>
<span id="cb20-936"><a href="#cb20-936"></a></span>
<span id="cb20-937"><a href="#cb20-937"></a>:::{.callout-warning}</span>
<span id="cb20-938"><a href="#cb20-938"></a>Pay attention to the number of distinct keys of the input RDD of pairs: if the number of distinct keys is large, the result of the action cannot be stored in a local variable of the Driver.</span>
<span id="cb20-939"><a href="#cb20-939"></a>:::</span>
<span id="cb20-940"><a href="#cb20-940"></a></span>
<span id="cb20-941"><a href="#cb20-941"></a>The countBykey action is based on the <span class="in">`countBykey()`</span> method of the <span class="in">`RDD`</span> class. Notice that data are sent on the network to compute the final result.</span>
<span id="cb20-942"><a href="#cb20-942"></a></span>
<span id="cb20-943"><a href="#cb20-943"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-944"><a href="#cb20-944"></a><span class="fu">### Example</span></span>
<span id="cb20-945"><a href="#cb20-945"></a><span class="ss">1. </span>Create an RDD of pairs from the following python list (each pair contains a movie and the rating given by someone to that movie): <span class="in">`[("Forrest Gump",4),("Star Trek",5),("Forrest Gump",3)]`</span>;</span>
<span id="cb20-946"><a href="#cb20-946"></a><span class="ss">2. </span>Compute the number of ratings for each movie.</span>
<span id="cb20-947"><a href="#cb20-947"></a></span>
<span id="cb20-948"><a href="#cb20-948"></a><span class="in">```python</span></span>
<span id="cb20-949"><a href="#cb20-949"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-950"><a href="#cb20-950"></a>movieRating<span class="op">=</span> [</span>
<span id="cb20-951"><a href="#cb20-951"></a>    (<span class="st">"Forrest Gump"</span>,<span class="dv">4</span>),</span>
<span id="cb20-952"><a href="#cb20-952"></a>    (<span class="st">"Star Trek"</span>,<span class="dv">5</span>),</span>
<span id="cb20-953"><a href="#cb20-953"></a>    (<span class="st">"Forrest Gump"</span>,<span class="dv">3</span>)</span>
<span id="cb20-954"><a href="#cb20-954"></a>]</span>
<span id="cb20-955"><a href="#cb20-955"></a></span>
<span id="cb20-956"><a href="#cb20-956"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-957"><a href="#cb20-957"></a>movieRatingRDD <span class="op">=</span> sc.parallelize(movieRating)</span>
<span id="cb20-958"><a href="#cb20-958"></a></span>
<span id="cb20-959"><a href="#cb20-959"></a><span class="co">## Compute the number of rating for each movie</span></span>
<span id="cb20-960"><a href="#cb20-960"></a>movieNumRatings <span class="op">=</span> movieRatingRDD.countByKey()</span>
<span id="cb20-961"><a href="#cb20-961"></a></span>
<span id="cb20-962"><a href="#cb20-962"></a><span class="co">## Print the result on the standard output</span></span>
<span id="cb20-963"><a href="#cb20-963"></a><span class="bu">print</span>(movieNumRatings)</span>
<span id="cb20-964"><a href="#cb20-964"></a><span class="in">```</span></span>
<span id="cb20-965"><a href="#cb20-965"></a></span>
<span id="cb20-966"><a href="#cb20-966"></a>|||</span>
<span id="cb20-967"><a href="#cb20-967"></a>|-|---|</span>
<span id="cb20-968"><a href="#cb20-968"></a>| <span class="in">`movieNumRatings`</span> | Pay attention to the size of the returned local python dictionary (i.e., in this case, the number of distinct movies). |</span>
<span id="cb20-969"><a href="#cb20-969"></a></span>
<span id="cb20-970"><a href="#cb20-970"></a>:::</span>
<span id="cb20-971"><a href="#cb20-971"></a></span>
<span id="cb20-972"><a href="#cb20-972"></a><span class="fu">### CollectAsMap action</span></span>
<span id="cb20-973"><a href="#cb20-973"></a>The collectAsMap action returns a local dictionary containing the same pairs of the considered input RDD of pairs. Pay attention to the size of the returned RDD: data are sent on the network.</span>
<span id="cb20-974"><a href="#cb20-974"></a></span>
<span id="cb20-975"><a href="#cb20-975"></a>The collectAsMap action is based on the <span class="in">`collectAsMap()`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb20-976"><a href="#cb20-976"></a></span>
<span id="cb20-977"><a href="#cb20-977"></a>:::{.callout-warning}</span>
<span id="cb20-978"><a href="#cb20-978"></a>Pay attention that the collectAsMap action returns a dictionary object, and a dictionary cannot contain duplicate keys: each key can be associated with at most one value, and if the input RDD of pairs contains more than one pair with the same key, only one of those pairs is stored in the returned local python dictionary (usually, the last one occurring in the input RDD of pairs).</span>
<span id="cb20-979"><a href="#cb20-979"></a>:::</span>
<span id="cb20-980"><a href="#cb20-980"></a></span>
<span id="cb20-981"><a href="#cb20-981"></a>Use collectAsMap only if sure that each key appears only once in the input RDD of key-value pairs.</span>
<span id="cb20-982"><a href="#cb20-982"></a></span>
<span id="cb20-983"><a href="#cb20-983"></a>The <span class="in">`collectAsMap()`</span> method returns a local dictionary while <span class="in">`collect()`</span> return a list of key-value pairs (i.e., a list of tuples). Notice that the list of pairs returned by <span class="in">`collect()`</span> can contain more than one pair associated with the same key.</span>
<span id="cb20-984"><a href="#cb20-984"></a></span>
<span id="cb20-985"><a href="#cb20-985"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-986"><a href="#cb20-986"></a><span class="fu">### Example</span></span>
<span id="cb20-987"><a href="#cb20-987"></a><span class="ss">1. </span>Create an RDD of pairs from the following python list (each pair contains a userId and the name of the user): <span class="in">`[("User1","Paolo"),("User2","Luca"),("User3","Daniele")]`</span>;</span>
<span id="cb20-988"><a href="#cb20-988"></a><span class="ss">2. </span>Retrieve the pairs of the created RDD of pairs and store them in a local python dictionary that is instantiated in the Driver.</span>
<span id="cb20-989"><a href="#cb20-989"></a></span>
<span id="cb20-990"><a href="#cb20-990"></a><span class="in">```python</span></span>
<span id="cb20-991"><a href="#cb20-991"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-992"><a href="#cb20-992"></a>users <span class="op">=</span> [</span>
<span id="cb20-993"><a href="#cb20-993"></a>    (<span class="st">"User1"</span>,<span class="st">"Paolo"</span>),</span>
<span id="cb20-994"><a href="#cb20-994"></a>    (<span class="st">"User2"</span>,<span class="st">"Luca"</span>),</span>
<span id="cb20-995"><a href="#cb20-995"></a>    (<span class="st">"User3"</span>,<span class="st">"Daniele"</span>)</span>
<span id="cb20-996"><a href="#cb20-996"></a>]</span>
<span id="cb20-997"><a href="#cb20-997"></a></span>
<span id="cb20-998"><a href="#cb20-998"></a><span class="co">#Create the RDD of pairs from the local list</span></span>
<span id="cb20-999"><a href="#cb20-999"></a>usersRDD <span class="op">=</span> sc.parallelize(users)</span>
<span id="cb20-1000"><a href="#cb20-1000"></a></span>
<span id="cb20-1001"><a href="#cb20-1001"></a><span class="co">## Retrieve the content of usersRDD and store it in a</span></span>
<span id="cb20-1002"><a href="#cb20-1002"></a><span class="co">## local python dictionary</span></span>
<span id="cb20-1003"><a href="#cb20-1003"></a>retrievedPairs <span class="op">=</span> usersRDD.collectAsMap()</span>
<span id="cb20-1004"><a href="#cb20-1004"></a></span>
<span id="cb20-1005"><a href="#cb20-1005"></a><span class="co">## Print the result on the standard output</span></span>
<span id="cb20-1006"><a href="#cb20-1006"></a><span class="bu">print</span>(retrievedPairs)</span>
<span id="cb20-1007"><a href="#cb20-1007"></a><span class="in">```</span></span>
<span id="cb20-1008"><a href="#cb20-1008"></a></span>
<span id="cb20-1009"><a href="#cb20-1009"></a>|||</span>
<span id="cb20-1010"><a href="#cb20-1010"></a>|-|---|</span>
<span id="cb20-1011"><a href="#cb20-1011"></a>| <span class="in">`retrievedPairs`</span> | Pay attention to the size of the returned local python dictionary (i.e., in this case, the number of distinct users). |</span>
<span id="cb20-1012"><a href="#cb20-1012"></a></span>
<span id="cb20-1013"><a href="#cb20-1013"></a>:::</span>
<span id="cb20-1014"><a href="#cb20-1014"></a></span>
<span id="cb20-1015"><a href="#cb20-1015"></a><span class="fu">### Lookup action</span></span>
<span id="cb20-1016"><a href="#cb20-1016"></a>The lookup($k$) action returns a local python list containing the values of the pairs of the input RDD associated with the key $k$ specified as parameter.</span>
<span id="cb20-1017"><a href="#cb20-1017"></a></span>
<span id="cb20-1018"><a href="#cb20-1018"></a>The lookup action is based on the <span class="in">`lookup(key)`</span> method of the <span class="in">`RDD`</span> class.</span>
<span id="cb20-1019"><a href="#cb20-1019"></a></span>
<span id="cb20-1020"><a href="#cb20-1020"></a>:::{.callout-note collapse="true"}</span>
<span id="cb20-1021"><a href="#cb20-1021"></a><span class="fu">### Example</span></span>
<span id="cb20-1022"><a href="#cb20-1022"></a><span class="ss">1. </span>Create an RDD of pairs from the following python list (each pair contains a movie and the rating given by someone to that movie): <span class="in">`[("Forrest Gump",4),("Star Trek",5),("Forrest Gump",3)]`</span></span>
<span id="cb20-1023"><a href="#cb20-1023"></a><span class="ss">2. </span>Retrieve the ratings associated with the movie "Forrest Gump" and store them in a local python list in the Driver.</span>
<span id="cb20-1024"><a href="#cb20-1024"></a></span>
<span id="cb20-1025"><a href="#cb20-1025"></a><span class="in">```python</span></span>
<span id="cb20-1026"><a href="#cb20-1026"></a><span class="co">## Create the local python list</span></span>
<span id="cb20-1027"><a href="#cb20-1027"></a>movieRating<span class="op">=</span> [(<span class="st">"Forrest Gump"</span>,<span class="dv">4</span>),(<span class="st">"Star Trek"</span>,<span class="dv">5</span>),(<span class="st">"Forrest Gump"</span>,<span class="dv">3</span>)]</span>
<span id="cb20-1028"><a href="#cb20-1028"></a></span>
<span id="cb20-1029"><a href="#cb20-1029"></a><span class="co">## Create the RDD of pairs from the local collection</span></span>
<span id="cb20-1030"><a href="#cb20-1030"></a>movieRatingRDD <span class="op">=</span> sc.parallelize(movieRating)</span>
<span id="cb20-1031"><a href="#cb20-1031"></a></span>
<span id="cb20-1032"><a href="#cb20-1032"></a><span class="co">## Select the ratings associated with “Forrest Gump”</span></span>
<span id="cb20-1033"><a href="#cb20-1033"></a>movieRatings <span class="op">=</span> movieRatingRDD.lookup(<span class="st">"Forrest Gump"</span>)</span>
<span id="cb20-1034"><a href="#cb20-1034"></a></span>
<span id="cb20-1035"><a href="#cb20-1035"></a><span class="co">## Print the result on the standard output</span></span>
<span id="cb20-1036"><a href="#cb20-1036"></a><span class="bu">print</span>(movieRatings)</span>
<span id="cb20-1037"><a href="#cb20-1037"></a><span class="in">```</span></span>
<span id="cb20-1038"><a href="#cb20-1038"></a></span>
<span id="cb20-1039"><a href="#cb20-1039"></a>|||</span>
<span id="cb20-1040"><a href="#cb20-1040"></a>|-|---|</span>
<span id="cb20-1041"><a href="#cb20-1041"></a>| <span class="in">`movieRatings`</span> | Pay attention to the size of the returned local list (i.e., in this case, the number of ratings associated with "Forrest Gump"). |</span>
<span id="cb20-1042"><a href="#cb20-1042"></a></span>
<span id="cb20-1043"><a href="#cb20-1043"></a>:::</span>
<span id="cb20-1044"><a href="#cb20-1044"></a></span>
<span id="cb20-1045"><a href="#cb20-1045"></a><span class="fu">### Summary</span></span>
<span id="cb20-1046"><a href="#cb20-1046"></a>All the examples reported in the following tables are applied on the following RDD of key-value pairs:</span>
<span id="cb20-1047"><a href="#cb20-1047"></a></span>
<span id="cb20-1048"><a href="#cb20-1048"></a><span class="ss">- </span><span class="in">`inputRDD`</span>: <span class="in">`[('k1',2),('k3',4),('k3',6)]`</span></span>
<span id="cb20-1049"><a href="#cb20-1049"></a></span>
<span id="cb20-1050"><a href="#cb20-1050"></a>::::{.content-visible when-format="html"}</span>
<span id="cb20-1051"><a href="#cb20-1051"></a>:::{.column-page}</span>
<span id="cb20-1052"><a href="#cb20-1052"></a></span>
<span id="cb20-1053"><a href="#cb20-1053"></a>**Purposes**</span>
<span id="cb20-1054"><a href="#cb20-1054"></a></span>
<span id="cb20-1055"><a href="#cb20-1055"></a>+------------------+-----------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-1056"><a href="#cb20-1056"></a>| Transformation   | Purpose                                                                                                                     |</span>
<span id="cb20-1057"><a href="#cb20-1057"></a>+==================+=============================================================================================================================+</span>
<span id="cb20-1058"><a href="#cb20-1058"></a>| <span class="in">`countByKey()`</span>   | Return a local python dictionary containing the number of elements in the input RDD for each key of the input RDD of pairs. |</span>
<span id="cb20-1059"><a href="#cb20-1059"></a>+------------------+-----------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-1060"><a href="#cb20-1060"></a>| <span class="in">`collectAsMap()`</span> | Return a local python dictionary containing the pairs of the input RDD of pairs.                                            |</span>
<span id="cb20-1061"><a href="#cb20-1061"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1062"><a href="#cb20-1062"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1063"><a href="#cb20-1063"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1064"><a href="#cb20-1064"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1065"><a href="#cb20-1065"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1066"><a href="#cb20-1066"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1067"><a href="#cb20-1067"></a>+------------------+-----------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-1068"><a href="#cb20-1068"></a>| <span class="in">`lookup(key)`</span>    | Return a local python list containing all the values associated with the key specified as parameter.                        |</span>
<span id="cb20-1069"><a href="#cb20-1069"></a>+------------------+-----------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-1070"><a href="#cb20-1070"></a></span>
<span id="cb20-1071"><a href="#cb20-1071"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb20-1072"><a href="#cb20-1072"></a></span>
<span id="cb20-1073"><a href="#cb20-1073"></a>**Examples**</span>
<span id="cb20-1074"><a href="#cb20-1074"></a></span>
<span id="cb20-1075"><a href="#cb20-1075"></a>+------------------+---------------------------+---------------------------------------------------------------+</span>
<span id="cb20-1076"><a href="#cb20-1076"></a>| Transformation   | Example                   | Result                                                        |</span>
<span id="cb20-1077"><a href="#cb20-1077"></a>+==================+===========================+===============================================================+</span>
<span id="cb20-1078"><a href="#cb20-1078"></a>| <span class="in">`countByKey()`</span>   | <span class="in">`inputRDD.countByKey()`</span>   | <span class="in">`{('k1',1),('K3',2)}`</span>                                         |</span>
<span id="cb20-1079"><a href="#cb20-1079"></a>+------------------+---------------------------+---------------------------------------------------------------+</span>
<span id="cb20-1080"><a href="#cb20-1080"></a>| <span class="in">`collectAsMap()`</span> | <span class="in">`inputRDD.collectAsMap()`</span> | <span class="in">`{('k1',2),('k3',6)}`</span>                                         |</span>
<span id="cb20-1081"><a href="#cb20-1081"></a>|                  |                           |                                                               |</span>
<span id="cb20-1082"><a href="#cb20-1082"></a>|                  |                           | Or                                                            |</span>
<span id="cb20-1083"><a href="#cb20-1083"></a>|                  |                           |                                                               |</span>
<span id="cb20-1084"><a href="#cb20-1084"></a>|                  |                           | <span class="in">`{('k1',2),('k3',4)}`</span>                                         |</span>
<span id="cb20-1085"><a href="#cb20-1085"></a>|                  |                           |                                                               |</span>
<span id="cb20-1086"><a href="#cb20-1086"></a>|                  |                           | Depending on the order of the pairs in the input RDD of pairs |</span>
<span id="cb20-1087"><a href="#cb20-1087"></a>+------------------+---------------------------+---------------------------------------------------------------+</span>
<span id="cb20-1088"><a href="#cb20-1088"></a>| <span class="in">`lookup(key)`</span>    | <span class="in">`inputRDD.lookup('k3')`</span>   | <span class="in">`[4,6]`</span>                                                       |</span>
<span id="cb20-1089"><a href="#cb20-1089"></a>+------------------+---------------------------+---------------------------------------------------------------+</span>
<span id="cb20-1090"><a href="#cb20-1090"></a></span>
<span id="cb20-1091"><a href="#cb20-1091"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb20-1092"><a href="#cb20-1092"></a></span>
<span id="cb20-1093"><a href="#cb20-1093"></a>:::</span>
<span id="cb20-1094"><a href="#cb20-1094"></a>::::</span>
<span id="cb20-1095"><a href="#cb20-1095"></a></span>
<span id="cb20-1096"><a href="#cb20-1096"></a>:::{.content-visible when-format="pdf"}</span>
<span id="cb20-1097"><a href="#cb20-1097"></a></span>
<span id="cb20-1098"><a href="#cb20-1098"></a>\newpage</span>
<span id="cb20-1099"><a href="#cb20-1099"></a></span>
<span id="cb20-1100"><a href="#cb20-1100"></a>\blandscape</span>
<span id="cb20-1101"><a href="#cb20-1101"></a></span>
<span id="cb20-1102"><a href="#cb20-1102"></a>**Purposes**</span>
<span id="cb20-1103"><a href="#cb20-1103"></a></span>
<span id="cb20-1104"><a href="#cb20-1104"></a>+------------------+-----------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-1105"><a href="#cb20-1105"></a>| Transformation   | Purpose                                                                                                                     |</span>
<span id="cb20-1106"><a href="#cb20-1106"></a>+==================+=============================================================================================================================+</span>
<span id="cb20-1107"><a href="#cb20-1107"></a>| <span class="in">`countByKey()`</span>   | Return a local python dictionary containing the number of elements in the input RDD for each key of the input RDD of pairs. |</span>
<span id="cb20-1108"><a href="#cb20-1108"></a>+------------------+-----------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-1109"><a href="#cb20-1109"></a>| <span class="in">`collectAsMap()`</span> | Return a local python dictionary containing the pairs of the input RDD of pairs.                                            |</span>
<span id="cb20-1110"><a href="#cb20-1110"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1111"><a href="#cb20-1111"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1112"><a href="#cb20-1112"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1113"><a href="#cb20-1113"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1114"><a href="#cb20-1114"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1115"><a href="#cb20-1115"></a>|                  |                                                                                                                             |</span>
<span id="cb20-1116"><a href="#cb20-1116"></a>+------------------+-----------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-1117"><a href="#cb20-1117"></a>| <span class="in">`lookup(key)`</span>    | Return a local python list containing all the values associated with the key specified as parameter.                        |</span>
<span id="cb20-1118"><a href="#cb20-1118"></a>+------------------+-----------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb20-1119"><a href="#cb20-1119"></a></span>
<span id="cb20-1120"><a href="#cb20-1120"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,75</span><span class="co">]</span>"}</span>
<span id="cb20-1121"><a href="#cb20-1121"></a></span>
<span id="cb20-1122"><a href="#cb20-1122"></a>\newpage</span>
<span id="cb20-1123"><a href="#cb20-1123"></a></span>
<span id="cb20-1124"><a href="#cb20-1124"></a>**Examples**</span>
<span id="cb20-1125"><a href="#cb20-1125"></a></span>
<span id="cb20-1126"><a href="#cb20-1126"></a>+------------------+---------------------------+---------------------------------------------------------------+</span>
<span id="cb20-1127"><a href="#cb20-1127"></a>| Transformation   | Example                   | Result                                                        |</span>
<span id="cb20-1128"><a href="#cb20-1128"></a>+==================+===========================+===============================================================+</span>
<span id="cb20-1129"><a href="#cb20-1129"></a>| <span class="in">`countByKey()`</span>   | <span class="in">`inputRDD.countByKey()`</span>   | <span class="in">`{('k1',1),('K3',2)}`</span>                                         |</span>
<span id="cb20-1130"><a href="#cb20-1130"></a>+------------------+---------------------------+---------------------------------------------------------------+</span>
<span id="cb20-1131"><a href="#cb20-1131"></a>| <span class="in">`collectAsMap()`</span> | <span class="in">`inputRDD.collectAsMap()`</span> | <span class="in">`{('k1',2),('k3',6)}`</span>                                         |</span>
<span id="cb20-1132"><a href="#cb20-1132"></a>|                  |                           |                                                               |</span>
<span id="cb20-1133"><a href="#cb20-1133"></a>|                  |                           | Or                                                            |</span>
<span id="cb20-1134"><a href="#cb20-1134"></a>|                  |                           |                                                               |</span>
<span id="cb20-1135"><a href="#cb20-1135"></a>|                  |                           | <span class="in">`{('k1',2),('k3',4)}`</span>                                         |</span>
<span id="cb20-1136"><a href="#cb20-1136"></a>|                  |                           |                                                               |</span>
<span id="cb20-1137"><a href="#cb20-1137"></a>|                  |                           | Depending on the order of the pairs in the input RDD of pairs |</span>
<span id="cb20-1138"><a href="#cb20-1138"></a>+------------------+---------------------------+---------------------------------------------------------------+</span>
<span id="cb20-1139"><a href="#cb20-1139"></a>| <span class="in">`lookup(key)`</span>    | <span class="in">`inputRDD.lookup('k3')`</span>   | <span class="in">`[4,6]`</span>                                                       |</span>
<span id="cb20-1140"><a href="#cb20-1140"></a>+------------------+---------------------------+---------------------------------------------------------------+</span>
<span id="cb20-1141"><a href="#cb20-1141"></a></span>
<span id="cb20-1142"><a href="#cb20-1142"></a>: {tbl-colwidths="<span class="co">[</span><span class="ot">25,45,30</span><span class="co">]</span>"}</span>
<span id="cb20-1143"><a href="#cb20-1143"></a></span>
<span id="cb20-1144"><a href="#cb20-1144"></a>\elandscape</span>
<span id="cb20-1145"><a href="#cb20-1145"></a></span>
<span id="cb20-1146"><a href="#cb20-1146"></a>:::</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>